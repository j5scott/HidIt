
<!-- saved from url=(0075)https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/3_Processes.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Adobe PageMill 3.0 Win">
  <title>Operating Systems: Processes</title><style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, monospace}
.codetext {
	font-family: Courier New, Courier, monospace;
}
-->
  .hideWord{color:blue;background-color:blue}.hideWord2{color:white;background-color:white}.hoverOver{color:red;opacity:1;background-color:white}.whiteBG{background-color:white!important}.imageHide{opacity:0.02!important}.imageReveal{opacity:1.0!important}.imageReveal:parent{background-color:white!important}.imageHide:parent{background-color:blue!important}</style></head>
<body bgcolor="#ffff80" class="whiteBG">

<h1><span></span><center><span>
</span> <span></span> <span class="hideWord">Processes
</span></center></h1>

<h3></h3>

<ol>
  <li><span>Abraham</span> <span>Silberschatz,</span> <span>Greg</span> <span>Gagne,</span> <span>and</span> <span>Peter</span> <span>Baer</span> <span>Galvin,</span> <span>"Operating</span> <span>System</span> <span>Concepts,</span> <span>Ninth</span> <span>Edition</span> <span>",</span> <span>Chapter</span> </li></ol>

<h3><span>3</span>.<span>1</span> <span>Process</span> </h3>
<ul>
  <li><span>A</span> <span>process</span> <span>is</span> <span class="hideWord">an</span> <span>instance</span> <span>of</span> <span>a</span> <span>program</span> <span>in</span> <span>execution</span>.</li>
  <li><span>Batch</span> <span>systems</span> <span>work</span> <span>in</span> <span>terms</span> <span>of</span> <span>"jobs"</span>.<span></span> <span>Many</span> <span>modern</span> <span>process</span> <span>concepts</span> <span>are</span> <span>still</span> <span>expressed</span> <span>in</span> <span>terms</span> <span>of</span> <span>jobs,</span> <span>(</span> <span>e</span>.<span>g</span>.<span></span> <span>job</span> <span>scheduling</span> <span>),</span> <span>and</span> <span>the</span> <span>two</span> <span>terms</span> <span>are</span> <span>often</span> <span>used</span> <span>interchangeably</span>.<span></span> <span></span> </li>
</ul>
<blockquote>
  <h4><span>3</span>.<span>1</span>.<span>1</span> <span>The</span> </h4>
  <ul>
    <li><span>Process</span> <span>memory</span> <span>is</span> <span>divided</span> <span>into</span> <span>four</span> <span>sections</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>3</span>.<span>1</span> <span>below:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>text</span> <span>section</span> <span class="hideWord">comprises</span> <span>the</span> <span>compiled</span> <span>program</span> <span>code,</span> <span>read</span> <span>in</span> <span>from</span> <span>non-volatile</span> <span>storage</span> <span>when</span> <span>the</span> <span>program</span> <span>is</span> <span>launched</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>data</span> <span>section</span> <span>stores</span> <span>global</span> <span>and</span> <span>static</span> <span>variables,</span> <span></span> <span></span> <span>allocated</span> <span>and</span> <span>initialized</span> <span>prior</span> <span>to</span> <span>executing</span> <span>main</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>heap</span> <span>is</span> <span>used</span> <span>for</span> <span>dynamic</span> <span>memory</span> <span>allocation,</span> <span>and</span> <span>is</span> <span>managed</span> <span>via</span> <span>calls</span> <span>to</span> <span>new,</span> <span>delete,</span> <span>malloc,</span> <span>free,</span> <span>etc</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>stack</span> <span>is</span> <span>used</span> <span>for</span> <span>local</span> <span>variables</span>.<span></span> <span>Space</span> <span>on</span> <span class="hideWord">the</span> <span>stack</span> <span>is</span> <span>reserved</span> <span>for</span> <span>local</span> <span>variables</span> <span>when</span> <span>they</span> <span>are</span> <span>declared</span> <span>(</span> <span>at</span> <span>function</span> <span>entrance</span> <span>or</span> <span>elsewhere,</span> <span>depending</span> <span>on</span> <span>the</span> <span>language</span> <span>),</span> <span>and</span> <span>the</span> <span>space</span> <span>is</span> <span>freed</span> <span>up</span> <span>when</span> <span>the</span> <span>variables</span> <span>go</span> <span>out</span> <span>of</span> <span>scope</span>.<span></span> <span>Note</span> <span>that</span> <span>the</span> <span>stack</span> <span>is</span> <span>also</span> <span>used</span> <span>for</span> <span>function</span> <span>return</span> <span>values,</span> <span>and</span> <span>the</span> <span>exact</span> <span>mechanisms</span> <span>of</span> <span>stack</span> <span>management</span> <span>may</span> <span>be</span> <span>language</span> <span>specific</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Note</span> <span>that</span> <span>the</span> <span>stack</span> <span>and</span> <span>the</span> <span>heap</span> <span>start</span> <span>at</span> <span>opposite</span> <span>ends</span> <span>of</span> <span>the</span> <span>process's</span> <span>free</span> <span>space</span> <span>and</span> <span>grow</span> <span>towards</span> <span>each</span> <span>other</span>.<span></span> <span>If</span> <span>they</span> <span>should</span> <span>ever</span> <span>meet,</span> <span>then</span> <span>either</span> <span>a</span> <span>stack</span> <span>overflow</span> <span>error</span> <span>will</span> <span>occur,</span> <span>or</span> <span>else</span> <span>a</span> <span>call</span> <span>to</span> <span>new</span> <span>or</span> <span>malloc</span> <span>will</span> <span>fail</span> <span>due</span> <span>to</span> <span>insufficient</span> <span>memory</span> <span>available</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>When</span> <span>processes</span> <span>are</span> <span>swapped</span> <span>out</span> <span>of</span> <span>memory</span> <span>and</span> <span>later</span> <span>restored,</span> <span>additional</span> <span>information</span> <span>must</span> <span>also</span> <span>be</span> <span>stored</span> <span>and</span> <span>restored</span>.<span></span> <span>Key</span> <span>among</span> <span>them</span> <span>are</span> <span>the</span> <span>program</span> <span>counter</span> <span>and</span> <span>the</span> <span>value</span> <span>of</span> <span>all</span> <span>program</span> <span>registers</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_01_Process_Memory.jpg" width="237" height="381" class="imageHide"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>1</span> <span>-</span> <span>A</span> <span>process</span> <span>in</span> <span>memory</span></strong></p>
<h4><span>3</span>.<span>1</span>.<span>2</span> <span>Process</span> </h4>
  <ul>
    <li><span>Processes</span> <span>may</span> <span>be</span> <span>in</span> <span>one</span> <span>of</span> <span>5</span> <span>states,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>3</span>.<span>2</span> <span>below</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>New</span></strong><span></span> <span>-</span> <span>The</span> <span>process</span> <span>is</span> <span>in</span> <span>the</span> <span>stage</span> <span>of</span> <span>being</span> <span>created</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Ready</span> <span></span></strong><span>-</span> <span>The</span> <span>process</span> <span>has</span> <span>all</span> <span>the</span> <span>resources</span> <span>available</span> <span>that</span> <span>it</span> <span>needs</span> <span>to</span> <span>run,</span> <span>but</span> <span>the</span> <span>CPU</span> <span>is</span> <span>not</span> <span>currently</span> <span>working</span> <span>on</span> <span>this</span> <span>process's</span> <span>instructions</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Running</span> <span></span></strong><span>-</span> <span>The</span> <span>CPU</span> <span>is</span> <span>working</span> <span>on</span> <span>this</span> <span>process's</span> <span>instructions</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Waiting</span></strong><span></span> <span>-</span> <span>The</span> <span>process</span> <span>cannot</span> <span>run</span> <span>at</span> <span>the</span> <span>moment,</span> <span>because</span> <span>it</span> <span>is</span> <span>waiting</span> <span>for</span> <span>some</span> <span>resource</span> <span>to</span> <span>become</span> <span>available</span> <span>or</span> <span>for</span> <span>some</span> <span>event</span> <span>to</span> <span>occur</span>.<span></span> <span>For</span> <span>example</span> <span>the</span> <span>process</span> <span>may</span> <span>be</span> <span>waiting</span> <span>for</span> <span>keyboard</span> <span>input,</span> <span>disk</span> <span>access</span> <span>request,</span> <span>inter-process</span> <span>messages,</span> <span>a</span> <span>timer</span> <span>to</span> <span>go</span> <span>off,</span> <span>or</span> <span>a</span> <span>child</span> <span>process</span> <span>to</span> <span>finish</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Terminated</span> <span>-</span> <span></span></strong><span>The</span> <span>process</span> <span>has</span> <span>completed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>load</span> <span>average</span> <span>reported</span> <span>by</span> <span>the</span> <span>"w"</span> <span>command</span> <span>indicate</span> <span>the</span> <span>average</span> <span>number</span> <span>of</span> <span>processes</span> <span>in</span> <span>the</span> <span>"Ready"</span> <span>state</span> <span>over</span> <span>the</span> <span>last</span> <span>1,</span> <span>5,</span> <span>and</span> <span>15</span> <span>minutes,</span> <span>i</span>.<span>e</span>.<span></span> <span>processes</span> <span>who</span> <span>have</span> <span>everything</span> <span>they</span> <span>need</span> <span>to</span> <span>run</span> <span>but</span> <span>cannot</span> <span>because</span> <span>the</span> <span>CPU</span> <span>is</span> <span>busy</span> <span>doing</span> <span>something</span> <span>else</span>.</li>
    <li><span>Some</span> <span>systems</span> <span>may</span> <span>have</span> <span>other</span> <span>states</span> <span>besides</span> <span>the</span> <span>ones</span> <span>listed</span> <span>here</span>.<span></span> <span></span> <span></span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_02_ProcessState.jpg" width="652" height="254"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>2</span> <span>-</span> <span>Diagram</span> <span>of</span> <span>process</span> <span>state</span></strong></p>
</blockquote>
  <h4><span>3</span>.<span>1</span>.<span>3</span> <span>Process</span> <span>Control</span> </h4>
  <p><span>For</span> <span>each</span> <span>process</span> <span>there</span> <span>is</span> <span>a</span> <span>Process</span> <span>Control</span> <span>Block,</span> <span>PCB,</span> <span>which</span> <span>stores</span> <span>the</span> <span>following</span> <span>(</span> <span>types</span> <span>of</span> <span>)</span> <span>process-specific</span> <span>information,</span> <span>as</span> <span>illustrated</span> <span>in</span> <span>Figure</span> <span>3</span>.<span>1</span>.<span></span> <span>(</span> <span>Specific</span> <span>details</span> <span>may</span> <span>vary</span> <span>from</span> <span>system</span> <span>to</span> <span>system</span>.<span></span> <span>)</span> </p>
  <ul>
    <li><span></span><strong><span>Process</span> <span>State</span></strong><span></span> <span>-</span> <span>Running,</span> <span>waiting,</span> <span>etc</span>.<span>,</span> <span>as</span> <span>discussed</span> <span>above</span>.</li>
    <li><span></span><strong><span>Process</span> <span>ID</span></strong><span>,</span> <span>and</span> <span>parent</span> <span>process</span> <span>ID</span>.<span></span> <span></span> <span></span> <span></span> </li>
    <li><span></span><strong><span>CPU</span> <span>registers</span> <span>and</span> <span>Program</span> <span>Counter</span></strong><span></span> <span>-</span> <span>These</span> <span>need</span> <span>to</span> <span>be</span> <span>saved</span> <span>and</span> <span>restored</span> <span>when</span> <span>swapping</span> <span>processes</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU</span>.</li>
    <li><span></span><strong><span>CPU-Scheduling</span> <span>information</span></strong><span></span> <span>-</span> <span>Such</span> <span>as</span> <span>priority</span> <span>information</span> <span>and</span> <span>pointers</span> <span>to</span> <span>scheduling</span> <span>queues</span>.</li>
    <li><span></span><strong><span>Memory-Management</span> <span>information</span></strong><span></span> <span>-</span> <span>E</span>.<span>g</span>.<span></span> <span>page</span> <span>tables</span> <span>or</span> <span>segment</span> <span>tables</span>.</li>
    <li><span></span><strong><span>Accounting</span> <span>information</span></strong><span></span> <span>-</span> <span>user</span> <span>and</span> <span>kernel</span> <span>CPU</span> <span>time</span> <span>consumed,</span> <span>account</span> <span>numbers,</span> <span>limits,</span> <span>etc</span>.</li>
    <li><span></span><strong><span>I/O</span> <span>Status</span> <span>information</span></strong><span></span> <span>-</span> <span>Devices</span> <span>allocated,</span> <span>open</span> <span>file</span> <span>tables,</span> <span>etc</span>.<span></span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_03_PCB.jpg" width="175" height="285"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>3</span> <span>-</span> <span>Process</span> <span>control</span> <span>block</span> <span>(</span> <span>PCB</span> <span>)</span></strong></p>
<p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_04_ProcessSwitch.jpg" width="640" height="523"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>4</span> <span>-</span> <span>Diagram</span> <span>showing</span> <span>CPU</span> <span>switch</span> <span>from</span> <span>process</span> <span>to</span> <span>process</span></strong></p>
<p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_05_LinuxProcesses.jpg" width="738" height="1156"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Unnumbered</span> <span>side</span> <span>bar</span></strong></p>
<h3 align="left"><span>Digging</span> <span>Deeper:</span> <span></span><a href="http://lxr.linux.no/#linux+v3.11/include/linux/sched.h#L1027"><span>The</span> <span>Linux</span> <span>task_struct</span> <span>definition</span> <span>in</span> <span>sched</span>.<span>h</span></a><span></span> <span>(</span> <span>See</span> <span>also</span> <span>the</span> <span>top</span> <span>of</span> <span>that</span> <span>file</span>.<span></span> </h3>
  </blockquote>
  <h4><span></span> <span>3</span>.<span>1</span>.<span>4</span> </h4>
  <ul>
    <li><span>Modern</span> <span>systems</span> <span>allow</span> <span>a</span> <span>single</span> <span>process</span> <span>to</span> <span>have</span> <span>multiple</span> <span>threads</span> <span>of</span> <span>execution,</span> <span>which</span> <span>execute</span> <span>concurrently</span>.<span></span> <span>Threads</span> <span>are</span> <span>covered</span> <span>extensively</span> <span>in</span> <span>the</span> <span>next</span> <span>chapter</span>.<span></span> </li>
  </ul>
</blockquote>
<h3><span>3</span>.<span>2</span> <span>Process</span> </h3>
<ul>
  <li><span>The</span> <span>two</span> <span>main</span> <span>objectives</span> <span>of</span> <span>the</span> <span>process</span> <span>scheduling</span> <span>system</span> <span>are</span> <span>to</span> <span>keep</span> <span>the</span> <span>CPU</span> <span>busy</span> <span>at</span> <span>all</span> <span>times</span> <span>and</span> <span>to</span> <span>deliver</span> <span>"acceptable"</span> <span>response</span> <span>times</span> <span>for</span> <span>all</span> <span>programs,</span> <span>particularly</span> <span>for</span> <span>interactive</span> <span>ones</span>.</li>
  <li><span>The</span> <span>process</span> <span>scheduler</span> <span>must</span> <span></span> <span>meet</span> <span>these</span> <span>objectives</span> <span>by</span> <span>implementing</span> <span>suitable</span> <span>policies</span> <span>for</span> <span>swapping</span> <span>processes</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU</span>.<span></span> </li>
  <li><span>(</span> <span>Note</span> <span>that</span> <span>these</span> <span>objectives</span> <span>can</span> <span>be</span> <span>conflicting</span>.<span></span> <span>In</span> <span>particular,</span> <span>every</span> <span>time</span> <span>the</span> <span>system</span> <span>steps</span> <span>in</span> <span>to</span> <span>swap</span> <span>processes</span> <span>it</span> <span>takes</span> <span>up</span> <span>time</span> <span>on</span> <span>the</span> <span>CPU</span> <span>to</span> <span>do</span> <span>so,</span> <span>which</span> <span>is</span> <span>thereby</span> <span>"lost"</span> <span>from</span> <span>doing</span> <span>any</span> <span>useful</span> <span>productive</span> <span>work</span>.<span></span> <span>)</span> </li>
</ul>
<blockquote>
  <h4><span>3</span>.<span>2</span>.<span>1</span> <span>Scheduling</span> </h4>
  <ul>
    <li><span>All</span> <span>processes</span> <span>are</span> <span>stored</span> <span>in</span> <span>the</span> <span></span><strong><span>job</span> <span>queue</span>.<span></span></strong></li>
    <li><span>Processes</span> <span>in</span> <span>the</span> <span>Ready</span> <span>state</span> <span>are</span> <span>placed</span> <span>in</span> <span>the</span> <span></span><strong><span>ready</span> <span>queue</span>.<span></span></strong></li>
    <li><span>Processes</span> <span>waiting</span> <span>for</span> <span>a</span> <span>device</span> <span>to</span> <span>become</span> <span>available</span> <span>or</span> <span>to</span> <span>deliver</span> <span>data</span> <span>are</span> <span>placed</span> <span>in</span> <span></span><strong><span>device</span> <span>queues</span></strong><span></span>.<span></span> <span>There</span> <span>is</span> <span>generally</span> <span>a</span> <span>separate</span> <span>device</span> <span>queue</span> <span>for</span> <span>each</span> <span>device</span>.</li>
    <li><span>Other</span> <span>queues</span> <span>may</span> <span>also</span> <span>be</span> <span>created</span> <span>and</span> <span>used</span> <span>as</span> <span>needed</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_05_Queues.jpg" width="682" height="593"><span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>5
</span> <span></span> <span></span> <span></span> <span>-</span> <span>The</span> <span>ready</span> <span>queue</span> <span>and</span> <span>various</span> <span>I/O</span> <span>device</span> <span>queues</span></strong></p>
  </blockquote>
  <h4><span>3</span>.<span>2</span>.<span>2</span> </h4>
  <ul>
    <li><span>A</span> <span></span><strong><span>long-term</span> <span>scheduler</span></strong><span></span> <span>is</span> <span>typical</span> <span>of</span> <span>a</span> <span>batch</span> <span>system</span> <span>or</span> <span>a</span> <span>very</span> <span>heavily</span> <span>loaded</span> <span>system</span>.<span></span> <span>It</span> <span>runs</span> <span>infrequently,</span> <span>(&nbsp;such</span> <span>as</span> <span>when</span> <span>one</span> <span>process</span> <span>ends</span> <span>selecting</span> <span>one</span> <span>more</span> <span>to</span> <span>be</span> <span>loaded</span> <span>in</span> <span>from</span> <span>disk</span> <span>in</span> <span>its</span> <span>place</span> <span>),</span> <span>and</span> <span>can</span> <span>afford</span> <span>to</span> <span>take</span> <span>the</span> <span>time</span> <span>to</span> <span>implement</span> <span>intelligent</span> <span>and</span> <span>advanced</span> <span>scheduling</span> <span>algorithms</span>.</li>
    <li><span>The</span> <span></span><strong><span>short-term</span> <span>scheduler</span></strong><span>,</span> <span>or</span> <span>CPU</span> <span>Scheduler,</span> <span>runs</span> <span>very</span> <span>frequently,</span> <span>on</span> <span>the</span> <span>order</span> <span>of</span> <span>100</span> <span>milliseconds,</span> <span>and</span> <span>must</span> <span>very</span> <span>quickly</span> <span>swap</span> <span>one</span> <span>process</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU</span> <span>and</span> <span>swap</span> <span>in</span> <span>another</span> <span>one</span>.</li>
    <li><span>Some</span> <span>systems</span> <span>also</span> <span>employ</span> <span>a</span><strong><span></span> <span>medium-term</span> <span>scheduler</span></strong><span></span>.<span></span> <span>When</span> <span>system</span> <span>loads</span> <span>get</span> <span>high,</span> <span>this</span> <span>scheduler</span> <span>will</span> <span>swap</span> <span>one</span> <span>or</span> <span>more</span> <span>processes</span> <span>out</span> <span>of</span> <span>the</span> <span>ready</span> <span>queue</span> <span>system</span> <span>for</span> <span>a</span> <span>few</span> <span>seconds,</span> <span>in</span> <span>order</span> <span>to</span> <span>allow</span> <span>smaller</span> <span>faster</span> <span>jobs</span> <span>to</span> <span>finish</span> <span>up</span> <span>quickly</span> <span>and</span> <span>clear</span> <span>the</span> <span>system</span>.<span></span> <span>See</span> <span>the</span> <span>differences</span> <span>in</span> <span>Figures</span> <span>3</span>.<span>7</span> <span>and</span> <span>3</span>.<span>8</span> <span>below</span>.</li>
    <li><span>An</span> <span>efficient</span> <span>scheduling</span> <span>system</span> <span>will</span> <span>select</span> <span>a</span> <span>good</span> <span></span><strong><span>process</span> <span>mix</span></strong><span></span> <span>of</span> <span></span><strong><span>CPU-bound</span></strong><span></span> <span>processes</span> <span>and</span> <span></span><strong><span>I/O</span> <span>bound</span></strong><span></span> <span>processes</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_06_QueueingDiagram.jpg" width="657" height="379"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>6</span> <span>-</span> <span>Queueing-diagram</span> <span>representation</span> <span>of</span> <span>process</span> <span>scheduling</span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_07_QueuingDiagram2.jpg" width="681" height="242"><span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>7</span> <span>-</span> <span>Addition</span> <span>of</span> <span>a</span> <span>medium-term</span> <span>scheduling</span> <span>to</span> <span>the</span> <span>queueing</span> <span>diagram</span></strong></p>
  </blockquote>
  <h4><span>3</span>.<span>2</span>.<span>3</span> <span>Context</span> </h4>
  <ul>
    <li><span>Whenever</span> <span>an</span> <span>interrupt</span> <span>arrives,</span> <span>the</span> <span>CPU</span> <span>must</span> <span>do</span> <span>a</span> <span></span><strong><span>state-save</span></strong><span></span> <span>of</span> <span>the</span> <span>currently</span> <span>running</span> <span>process,</span> <span>then</span> <span>switch</span> <span>into</span> <span>kernel</span> <span>mode</span> <span>to</span> <span>handle</span> <span>the</span> <span>interrupt,</span> <span>and</span> <span>then</span> <span>do</span> <span>a</span> <span></span><strong><span>state-restore</span></strong><span></span> <span>of</span> <span>the</span> <span>interrupted</span> <span>process</span>.</li>
    <li><span>Similarly,</span> <span>a</span> <span></span><strong><span>context</span> <span>switch</span></strong><span></span> <span>occurs</span> <span>when</span> <span>the</span> <span>time</span> <span>slice</span> <span>for</span> <span>one</span> <span>process</span> <span>has</span> <span>expired</span> <span>and</span> <span>a</span> <span>new</span> <span>process</span> <span>is</span> <span>to</span> <span>be</span> <span>loaded</span> <span>from</span> <span>the</span> <span>ready</span> <span>queue</span>.<span></span> <span>This</span> <span>will</span> <span>be</span> <span>instigated</span> <span>by</span> <span>a</span> <span>timer</span> <span>interrupt,</span> <span>which</span> <span>will</span> <span>then</span> <span>cause</span> <span>the</span> <span>current</span> <span>process's</span> <span>state</span> <span>to</span> <span>be</span> <span>saved</span> <span>and</span> <span>the</span> <span>new</span> <span>process's</span> <span></span> <span>state</span> <span>to</span> <span>be</span> <span>restored</span>.</li>
    <li><span>Saving</span> <span>and</span> <span>restoring</span> <span>states</span> <span>involves</span> <span>saving</span> <span>and</span> <span>restoring</span> <span>all</span> <span>of</span> <span>the</span> <span>registers</span> <span>and</span> <span>program</span> <span>counter(s),</span> <span>as</span> <span>well</span> <span>as</span> <span>the</span> <span>process</span> <span>control</span> <span>blocks</span> <span>described</span> <span>above</span>.</li>
    <li><span>Context</span> <span>switching</span> <span>happens</span> <span>VERY</span> <span>VERY</span> <span>frequently,</span> <span>and</span> <span>the</span> <span>overhead</span> <span>of</span> <span>doing</span> <span>the</span> <span>switching</span> <span>is</span> <span>just</span> <span>lost</span> <span>CPU</span> <span>time,</span> <span>so</span> <span>context</span> <span>switches</span> <span>(</span> <span>state</span> <span>saves</span> <span>&amp;</span> <span>restores</span> <span>)</span> <span>need</span> <span>to</span> <span>be</span> <span>as</span> <span>fast</span> <span>as</span> <span>possible</span>.<span></span> <span>Some</span> <span>hardware</span> <span>has</span> <span>special</span> <span>provisions</span> <span>for</span> <span>speeding</span> <span>this</span> <span>up,</span> <span>such</span> <span>as</span> <span>a</span> <span>single</span> <span>machine</span> <span>instruction</span> <span>for</span> <span>saving</span> <span>or</span> <span>restoring</span> <span>all</span> <span>registers</span> <span>at</span> <span>once</span>.<span></span> </li>
    <li><span>Some</span> <span>Sun</span> <span>hardware</span> <span>actually</span> <span>has</span> <span>multiple</span> <span>sets</span> <span>of</span> <span>registers,</span> <span>so</span> <span>the</span> <span>context</span> <span>switching</span> <span>can</span> <span>be</span> <span>speeded</span> <span>up</span> <span>by</span> <span>merely</span> <span>switching</span> <span>which</span> <span>set</span> <span>of</span> <span>registers</span> <span>are</span> <span>currently</span> <span>in</span> <span>use</span>.<span></span> <span>Obviously</span> <span>there</span> <span>is</span> <span>a</span> <span>limit</span> <span>as</span> <span>to</span> <span>how</span> <span>many</span> <span>processes</span> <span>can</span> <span>be</span> <span>switched</span> <span>between</span> <span>in</span> <span>this</span> <span>manner,</span> <span>making</span> <span>it</span> <span>attractive</span> <span>to</span> <span>implement</span> <span>the</span> <span>medium-term</span> <span>scheduler</span> <span>to</span> <span>swap</span> <span>some</span> <span>processes</span> <span>out</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>3</span>.<span>8</span> <span>above</span>.<span></span> <span></span> </li></ul>
  <div align="center"><img src="./Operating Systems_ Processes_files/3_MultitaskingMobileSystems.jpg" width="772" height="994"></div>
</blockquote>
<h3><span>3</span>.<span>3</span> <span>Operations</span> <span>on</span> </h3>
<blockquote>
  <h4><span>3</span>.<span>3</span>.<span>1</span> <span>Process</span> </h4>
  <ul>
    <li><span>Processes</span> <span>may</span> <span>create</span> <span>other</span> <span>processes</span> <span>through</span> <span>appropriate</span> <span>system</span> <span>calls,</span> <span>such</span> <span>as</span> <span></span><strong><span>fork</span></strong><span></span> <span>or</span> <span></span><strong><span>spawn</span></strong><span></span>.<span></span> <span>The</span> <span>process</span> <span>which</span> <span>does</span> <span>the</span> <span>creating</span> <span>is</span> <span>termed</span> <span>the</span> <span></span><strong><span>parent</span></strong><span></span> <span>of</span> <span>the</span> <span>other</span> <span>process,</span> <span>which</span> <span>is</span> <span>termed</span> <span>its</span> <span></span><strong><span>child</span></strong><span></span>.</li>
    <li><span>Each</span> <span>process</span> <span>is</span> <span>given</span> <span>an</span> <span>integer</span> <span>identifier,</span> <span>termed</span> <span>its</span><strong><span></span> <span>process</span> <span>identifier</span></strong><span>,</span> <span>or</span> <span>PID</span>.<span></span> <span>The</span> <span>parent</span> <span>PID</span> <span>(</span> <span>PPID</span> <span>)</span> <span>is</span> <span>also</span> <span>stored</span> <span>for</span> <span>each</span> <span>process</span>.<span></span> <span></span> </li>
    <li><span>On</span> <span>typical</span> <span>UNIX</span> <span>systems</span> <span>the</span> <span>process</span> <span>scheduler</span> <span>is</span> <span>termed</span> <span></span><strong><span>sched</span></strong><span>,</span> <span>and</span> <span>is</span> <span>given</span> <span>PID</span> <span>0</span>.<span></span> <span>The</span> <span>first</span> <span>thing</span> <span>it</span> <span>does</span> <span>at</span> <span>system</span> <span>startup</span> <span>time</span> <span>is</span> <span>to</span> <span>launch</span> <span></span><strong><span>init</span></strong><span>,</span> <span>which</span> <span>gives</span> <span>that</span> <span>process</span> <span>PID</span> <span>1</span>.<span></span> <span></span> <span></span> <span>Init</span> <span>then</span> <span>launches</span> <span>all</span> <span>system</span> <span>daemons</span> <span>and</span> <span>user</span> <span>logins,</span> <span>and</span> <span>becomes</span> <span>the</span> <span>ultimate</span> <span>parent</span> <span>of</span> <span>all</span> <span>other</span> <span>processes</span>.<span></span> <span>Figure</span> <span>3</span>.<span>9</span> <span>shows</span> <span>a</span> <span>typical</span> <span>process</span> <span>tree</span> <span>for</span> <span>a</span> <span>Linux</span> <span>system,</span> <span>and</span> <span>other</span> <span>systems</span> <span>will</span> <span>have</span> <span>similar</span> <span>though</span> <span>not</span> <span>identical</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_08_ProcessTree.jpg" width="865" height="408"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>8</span> <span>-</span> <span>A</span> <span>tree</span> <span>of</span> <span>processes</span> <span>on</span> <span>a</span> <span>typical</span> <span>Linux</span> <span>system</span></strong></p>
</blockquote>
  <ul>
    <li><span>Depending</span> <span>on</span> <span>system</span> <span>implementation,</span> <span>a</span> <span>child</span> <span>process</span> <span>may</span> <span>receive</span> <span>some</span> <span>amount</span> <span>of</span> <span>shared</span> <span>resources</span> <span>with</span> <span>its</span> <span>parent</span>.<span></span> <span>Child</span> <span>processes</span> <span>may</span> <span>or</span> <span>may</span> <span>not</span> <span>be</span> <span>limited</span> <span>to</span> <span>a</span> <span>subset</span> <span>of</span> <span>the</span> <span>resources</span> <span>originally</span> <span>allocated</span> <span>to</span> <span>the</span> <span>parent,</span> <span>preventing</span> <span>runaway</span> <span>children</span> <span>from</span> <span>consuming</span> <span>all</span> <span>of</span> <span>a</span> <span>certain</span> <span>system</span> <span>resource</span>.</li>
    <li><span>There</span> <span>are</span> <span>two</span> <span>options</span> <span>for</span> <span>the</span> <span>parent</span> <span>process</span> <span>after</span> <span>creating</span> <span>the</span> <span>child:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Wait</span> <span>for</span> <span>the</span> <span>child</span> <span>process</span> <span>to</span> <span>terminate</span> <span>before</span> <span>proceeding</span>.<span></span> <span>The</span> <span>parent</span> <span>makes</span> <span>a</span> <span></span> <span>wait(</span> <span>)</span> <span>system</span> <span>call,</span> <span>for</span> <span>either</span> <span>a</span> <span>specific</span> <span>child</span> <span>or</span> <span>for</span> <span>any</span> <span></span> <span></span> <span>child,</span> <span>which</span> <span>causes</span> <span>the</span> <span>parent</span> <span>process</span> <span>to</span> <span>block</span> <span>until</span> <span>the</span> <span>wait(</span> <span>)</span> <span>returns</span>.<span></span> <span>UNIX</span> <span>shells</span> <span>normally</span> <span>wait</span> <span>for</span> <span>their</span> <span>children</span> <span>to</span> <span>complete</span> <span>before</span> <span>issuing</span> <span>a</span> <span>new</span> <span>prompt</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Run</span> <span>concurrently</span> <span>with</span> <span>the</span> <span>child,</span> <span>continuing</span> <span>to</span> <span>process</span> <span>without</span> <span>waiting</span>.<span></span> <span>This</span> <span>is</span> <span>the</span> <span>operation</span> <span>seen</span> <span>when</span> <span>a</span> <span>UNIX</span> <span>shell</span> <span>runs</span> <span>a</span> <span>process</span> <span>as</span> <span>a</span> <span>background</span> <span>task</span>.<span></span> <span>It</span> <span>is</span> <span>also</span> <span>possible</span> <span>for</span> <span>the</span> <span>parent</span> <span>to</span> <span>run</span> <span>for</span> <span>a</span> <span>while,</span> <span>and</span> <span>then</span> <span>wait</span> <span>for</span> <span>the</span> <span>child</span> <span>later,</span> <span>which</span> <span>might</span> <span>occur</span> <span>in</span> <span>a</span> <span>sort</span> <span>of</span> <span>a</span> <span>parallel</span> <span>processing</span> <span>operation</span>.<span></span> <span>(</span> <span>E</span>.<span>g</span>.<span></span> <span>the</span> <span>parent</span> <span>may</span> <span>fork</span> <span>off</span> <span>a</span> <span>number</span> <span>of</span> <span>children</span> <span>without</span> <span>waiting</span> <span>for</span> <span>any</span> <span>of</span> <span>them,</span> <span>then</span> <span>do</span> <span>a</span> <span>little</span> <span>work</span> <span>of</span> <span>its</span> <span>own,</span> <span>and</span> <span>then</span> <span>wait</span> <span>for</span> <span>the</span> <span>children</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Two</span> <span>possibilities</span> <span>for</span> <span>the</span> <span>address</span> <span>space</span> <span>of</span> <span>the</span> <span>child</span> <span>relative</span> <span>to</span> <span>the</span> <span>parent:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>child</span> <span>may</span> <span>be</span> <span>an</span> <span>exact</span> <span>duplicate</span> <span>of</span> <span>the</span> <span>parent,</span> <span>sharing</span> <span>the</span> <span>same</span> <span>program</span> <span>and</span> <span>data</span> <span>segments</span> <span>in</span> <span>memory</span>.<span></span> <span>Each</span> <span>will</span> <span>have</span> <span>their</span> <span>own</span> <span>PCB,</span> <span>including</span> <span>program</span> <span>counter,</span> <span>registers,</span> <span>and</span> <span>PID</span>.<span></span> <span>This</span> <span>is</span> <span>the</span> <span>behavior</span> <span>of</span> <span>the</span> <span></span><strong><span>fork</span></strong><span></span> <span>system</span> <span>call</span> <span>in</span> <span>UNIX</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>child</span> <span>process</span> <span>may</span> <span>have</span> <span>a</span> <span>new</span> <span>program</span> <span></span> <span></span> <span>loaded</span> <span>into</span> <span>its</span> <span>address</span> <span>space,</span> <span>with</span> <span>all</span> <span>new</span> <span>code</span> <span>and</span> <span>data</span> <span>segments</span>.<span></span> <span>This</span> <span>is</span> <span>the</span> <span>behavior</span> <span>of</span> <span>the</span> <span></span><strong><span>spawn</span></strong><span></span> <span>system</span> <span>calls</span> <span>in</span> <span>Windows</span>.<span></span> <span>UNIX</span> <span>systems</span> <span>implement</span> <span>this</span> <span>as</span> <span>a</span> <span>second</span> <span>step,</span> <span>using</span> <span>the</span> <span></span><strong><span>exec</span></strong><span></span> <span>system</span> <span>call</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Figures</span> <span>3</span>.<span>10</span> <span>and</span> <span>3</span>.<span>11</span> <span>below</span> <span>shows</span> <span>the</span> <span>fork</span> <span>and</span> <span>exec</span> <span>process</span> <span>on</span> <span>a</span> <span>UNIX</span> <span>system</span>.<span></span> <span></span> <span>Note</span> <span>that</span> <span>the</span> <span></span><strong><span>fork</span></strong><span></span> <span>system</span> <span>call</span> <span>returns</span> <span>the</span> <span>PID</span> <span>of</span> <span>the</span> <span>processes</span> <span>child</span> <span>to</span> <span>each</span> <span>process</span> <span>-</span> <span>It</span> <span>returns</span> <span>a</span> <span>zero</span> <span>to</span> <span>the</span> <span>child</span> <span>process</span> <span>and</span> <span>a</span> <span>non-zero</span> <span>child</span> <span>PID</span> <span>to</span> <span>the</span> <span>parent,</span> <span>so</span> <span>the</span> <span>return</span> <span>value</span> <span>indicates</span> <span>which</span> <span>process</span> <span>is</span> <span>which</span>.<span></span> <span>Process</span> <span>IDs</span> <span>can</span> <span>be</span> <span>looked</span> <span>up</span> <span>any</span> <span>time</span> <span>for</span> <span>the</span> <span>current</span> <span>process</span> <span>or</span> <span>its</span> <span>direct</span> <span>parent</span> <span>using</span> <span>the</span> <span>getpid(</span> <span>)</span> <span>and</span> <span>getppid(</span> <span>)</span> <span>system</span> <span>calls</span> <span>respectively</span>.</li>
    <blockquote>
      <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_10_C_fork.jpg" width="732" height="746"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>9</span> <span>Creating</span> <span>a</span> <span>separate</span> <span>process</span> <span>using</span> <span>the</span> <span>UNIX</span> <span>fork(</span> <span>)</span> <span>system</span> <span>call</span>.<span></span></strong><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> </p>
      <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_10_ProcessCreation.jpg" width="720" height="118"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>10</span> <span>-</span> <span>Process</span> <span>creation</span> <span>using</span> <span>the</span> <span>fork(</span> <span>)</span> <span>system</span> <span>call</span></strong></p>
    </blockquote>
    <li><span>Related</span> <span>man</span> <span>pages:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><a href="http://linuxmanpages.com/man2/fork.2.php"><span>fork(</span> <span>2</span> <span>)</span></a><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><a href="http://linuxmanpages.com/man3/exec.3.php"><span>exec(</span> <span>3</span> <span>)</span></a><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><a href="http://linuxmanpages.com/man2/wait.2.php"><span>wait(</span> <span>2</span> <span>)</span></a><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <blockquote>
      <p></p>
    </blockquote>
    <li><span>Figure</span> <span>3</span>.<span>12</span> <span>shows</span> <span>the</span> <span>more</span> <span>complicated</span> <span>process</span> <span>for</span> <span>Windows,</span> <span>which</span> <span>must</span> <span>provide</span> <span>all</span> <span>of</span> <span>the</span> <span>parameter</span> <span>information</span> <span>for</span> <span>the</span> <span>new</span> <span>process</span> <span>as</span> <span>part</span> <span>of</span> <span>the</span> <span>forking</span> <span>process</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_12_Win32Fork.jpg" width="744" height="994"><span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>11</span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
  </blockquote>
  <h4><span>3</span>.<span>3</span>.<span>2</span> <span>Process</span> </h4>
  <ul>
    <li><span>Processes</span> <span>may</span> <span>request</span> <span>their</span> <span>own</span> <span>termination</span> <span>by</span> <span>making</span> <span>the</span> <span></span><strong><span>exit(</span> <span>)</span> <span></span></strong><span></span> <span>system</span> <span>call,</span> <span>typically</span> <span>returning</span> <span>an</span> <span>int</span>.<span></span> <span>This</span> <span>int</span> <span>is</span> <span>passed</span> <span>along</span> <span>to</span> <span>the</span> <span>parent</span> <span>if</span> <span>it</span> <span>is</span> <span>doing</span> <span>a</span> <span></span><strong><span>wait(</span> <span>)</span></strong><span>,</span> <span>and</span> <span>is</span> <span>typically</span> <span>zero</span> <span>on</span> <span>successful</span> <span>completion</span> <span>and</span> <span>some</span> <span>non-zero</span> <span>code</span> <span>in</span> <span>the</span> <span>event</span> <span>of</span> <span>problems</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>child</span> <span>code:</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><pre><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>int</span> <span>exitCode;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>exit(</span> <span>exitCode</span> <span>);</span> <span></span> <span>//</span> <span>return</span> <span>exitCode;</span> <span>has</span> <span>the</span> <span>same</span> <span>effect</span> <span>when</span> <span>executed</span> <span>from</span> <span>main(</span> <span>)</span></pre><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>parent</span> <span>code:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><pre><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>pid_t</span> <span>pid;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>int</span> <span>status
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>pid</span> <span>=</span> <span>wait(</span> <span>&amp;status</span> <span>);</span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>//</span> <span>pid</span> <span>indicates</span> <span>which</span> <span>child</span> <span>exited</span>.<span></span> <span>exitCode</span> <span>in</span> <span>low-order</span> <span>bits</span> <span>of</span> <span>status
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>//</span> <span>macros</span> <span>can</span> <span>test</span> <span>the</span> <span>high-order</span> <span>bits</span> <span>of</span> <span>status</span> <span>for</span> <span>why</span> <span>it</span> <span>stopped</span></pre><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Processes</span> <span>may</span> <span>also</span> <span>be</span> <span>terminated</span> <span>by</span> <span>the</span> <span>system</span> <span>for</span> <span>a</span> <span>variety</span> <span>of</span> <span>reasons,</span> <span>including:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>inability</span> <span>of</span> <span>the</span> <span>system</span> <span>to</span> <span>deliver</span> <span>necessary</span> <span>system</span> <span>resources</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>In</span> <span>response</span> <span>to</span> <span>a</span> <span>KILL</span> <span>command,</span> <span>or</span> <span>other</span> <span>un</span> <span>handled</span> <span>process</span> <span>interrupt</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>parent</span> <span>may</span> <span>kill</span> <span>its</span> <span>children</span> <span>if</span> <span>the</span> <span>task</span> <span>assigned</span> <span>to</span> <span>them</span> <span>is</span> <span>no</span> <span>longer</span> <span>needed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>the</span> <span>parent</span> <span>exits,</span> <span>the</span> <span>system</span> <span>may</span> <span>or</span> <span>may</span> <span>not</span> <span>allow</span> <span>the</span> <span>child</span> <span>to</span> <span>continue</span> <span>without</span> <span>a</span> <span>parent</span>.<span></span> <span>(</span> <span>On</span> <span>UNIX</span> <span>systems,</span> <span>orphaned</span> <span>processes</span> <span>are</span> <span>generally</span> <span>inherited</span> <span>by</span> <span>init,</span> <span>which</span> <span>then</span> <span>proceeds</span> <span>to</span> <span>kill</span> <span>them</span>.<span></span> <span>The</span> <span>UNIX</span> <span></span><em><span></span><strong><span>nohup</span></strong><span></span></em><span></span> <span>command</span> <span>allows</span> <span>a</span> <span>child</span> <span>to</span> <span>continue</span> <span>executing</span> <span>after</span> <span>its</span> <span>parent</span> <span>has</span> <span>exited</span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>When</span> <span>a</span> <span>process</span> <span>terminates,</span> <span>all</span> <span>of</span> <span>its</span> <span>system</span> <span>resources</span> <span>are</span> <span>freed</span> <span>up,</span> <span>open</span> <span>files</span> <span>flushed</span> <span>and</span> <span>closed,</span> <span>etc</span>.<span></span> <span>The</span> <span>process</span> <span>termination</span> <span>status</span> <span>and</span> <span>execution</span> <span>times</span> <span>are</span> <span>returned</span> <span>to</span> <span>the</span> <span>parent</span> <span>if</span> <span>the</span> <span>parent</span> <span>is</span> <span>waiting</span> <span>for</span> <span>the</span> <span>child</span> <span>to</span> <span>terminate,</span> <span>or</span> <span>eventually</span> <span>returned</span> <span>to</span> <span>init</span> <span>if</span> <span>the</span> <span>process</span> <span>becomes</span> <span>an</span> <span>orphan</span>.<span></span> <span>(</span> <span>Processes</span> <span>which</span> <span>are</span> <span>trying</span> <span>to</span> <span>terminate</span> <span>but</span> <span>which</span> <span>cannot</span> <span>because</span> <span>their</span> <span>parent</span> <span>is</span> <span>not</span> <span>waiting</span> <span>for</span> <span>them</span> <span>are</span> <span>termed</span> <span></span><strong><span>zombies</span></strong><span></span>.<span></span> <span>These</span> <span>are</span> <span>eventually</span> <span>inherited</span> <span>by</span> <span>init</span> <span>as</span> <span>orphans</span> <span>and</span> <span>killed</span> <span>off</span>.<span></span> <span>Note</span> <span>that</span> <span>modern</span> <span>UNIX</span> <span>shells</span> <span>do</span> <span>not</span> <span>produce</span> <span>as</span> <span>many</span> <span>orphans</span> <span>and</span> <span>zombies</span> <span>as</span> <span>older</span> <span>systems</span> <span>used</span> <span>to</span>.<span></span> <span>)</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
  </ul>
</blockquote>
<h3><span>3</span>.<span>4</span> <span>Interprocess</span> </h3>
<ul>
  <li><span></span><strong><span>Independent</span> <span>Processes</span></strong><span></span> <span>operating</span> <span>concurrently</span> <span>on</span> <span>a</span> <span>systems</span> <span>are</span> <span>those</span> <span>that</span> <span>can</span> <span>neither</span> <span>affect</span> <span>other</span> <span>processes</span> <span>or</span> <span>be</span> <span>affected</span> <span>by</span> <span>other</span> <span>processes</span>.</li>
  <li><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Cooperating</span> <span>Processes</span></strong><span></span> <span>are</span> <span>those</span> <span>that</span> <span>can</span> <span>affect</span> <span>or</span> <span>be</span> <span>affected</span> <span>by</span> <span>other</span> <span>processes</span>.<span></span> <span>There</span> <span>are</span> <span>several</span> <span>reasons</span> <span>why</span> <span>cooperating</span> <span>processes</span> <span>are</span> <span>allowed:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Information</span> <span>Sharing</span> <span>-</span> <span>There</span> <span>may</span> <span>be</span> <span>several</span> <span>processes</span> <span>which</span> <span>need</span> <span>access</span> <span>to</span> <span>the</span> <span>same</span> <span>file</span> <span>for</span> <span>example</span>.<span></span> <span>(&nbsp;e</span>.<span>g</span>.<span>&nbsp;pipelines</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Computation</span> <span>speedup</span> <span>-</span> <span>Often</span> <span>a</span> <span>solution</span> <span>to</span> <span>a</span> <span>problem</span> <span>can</span> <span>be</span> <span>solved</span> <span>faster</span> <span>if</span> <span>the</span> <span>problem</span> <span>can</span> <span>be</span> <span>broken</span> <span>down</span> <span>into</span> <span>sub-tasks</span> <span>to</span> <span>be</span> <span>solved</span> <span>simultaneously</span> <span>(</span> <span>particularly</span> <span>when</span> <span>multiple</span> <span>processors</span> <span>are</span> <span>involved</span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Modularity</span> <span>-</span> <span>The</span> <span>most</span> <span>efficient</span> <span>architecture</span> <span>may</span> <span>be</span> <span>to</span> <span>break</span> <span>a</span> <span>system</span> <span>down</span> <span>into</span> <span>cooperating</span> <span>modules</span>.<span></span> <span>(&nbsp;E</span>.<span>g</span>.<span></span> <span>databases</span> <span>with</span> <span>a</span> <span>client-server</span> <span>architecture</span>.<span>&nbsp;)</span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Convenience</span> <span>-</span> <span>Even</span> <span>a</span> <span>single</span> <span>user</span> <span>may</span> <span>be</span> <span>multi-tasking,</span> <span>such</span> <span>as</span> <span>editing,</span> <span>compiling,</span> <span>printing,</span> <span>and</span> <span>running</span> <span>the</span> <span>same</span> <span>code</span> <span>in</span> <span>different</span> <span>windows</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span>
</span> <span></span> </li>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_ChromeBrowserArchitecture.jpg" width="770" height="1172"></p>
  </blockquote>
  <li><span>Cooperating</span> <span>processes</span> <span>require</span> <span>some</span> <span>type</span> <span>of</span> <span>inter-process</span> <span>communication,</span> <span>which</span> <span>is</span> <span>most</span> <span>commonly</span> <span>one</span> <span>of</span> <span>two</span> <span>types:</span> <span>Shared</span> <span>Memory</span> <span>systems</span> <span>or</span> <span>Message</span> <span>Passing</span> <span>systems</span>.<span></span> <span>Figure</span> <span>3</span>.<span>13</span> <span>illustrates</span> <span>the</span> <span>difference</span> <span>between</span> <span>the</span> <span>two</span> </li>
</ul>

  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_12_CommunicationsModels.jpg" width="511" height="322"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>12</span> <span>-</span> <span>Communications</span> <span>models:</span> <span>(a)</span> <span>Message</span> <span>passing</span>.<span></span> <span>(b)</span> <span>Shared</span> <span>memory</span>.<span></span></strong></p>

<ul>
  <li><span>Shared</span> <span>Memory</span> <span>is</span> <span>faster</span> <span>once</span> <span>it</span> <span>is</span> <span>set</span> <span>up,</span> <span>because</span> <span>no</span> <span>system</span> <span>calls</span> <span>are</span> <span>required</span> <span>and</span> <span>access</span> <span>occurs</span> <span>at</span> <span>normal</span> <span>memory</span> <span>speeds</span>.<span></span> <span>However</span> <span>it</span> <span>is</span> <span>more</span> <span>complicated</span> <span>to</span> <span>set</span> <span>up,</span> <span>and</span> <span>doesn't</span> <span>work</span> <span>as</span> <span>well</span> <span>across</span> <span>multiple</span> <span>computers</span>.<span></span> <span>Shared</span> <span>memory</span> <span>is</span> <span>generally</span> <span>preferable</span> <span>when</span> <span>large</span> <span>amounts</span> <span>of</span> <span>information</span> <span>must</span> <span>be</span> <span>shared</span> <span>quickly</span> <span>on</span> <span>the</span> <span>same</span> <span>computer</span>.<span></span> </li>
  <li><span>Message</span> <span>Passing</span> <span>requires</span> <span>system</span> <span>calls</span> <span>for</span> <span>every</span> <span>message</span> <span>transfer,</span> <span>and</span> <span>is</span> <span>therefore</span> <span>slower,</span> <span>but</span> <span>it</span> <span>is</span> <span>simpler</span> <span>to</span> <span>set</span> <span>up</span> <span>and</span> <span>works</span> <span>well</span> <span>across</span> <span>multiple</span> <span>computers</span>.<span></span> <span>Message</span> <span>passing</span> <span>is</span> <span>generally</span> <span>preferable</span> <span>when</span> <span>the</span> <span>amount</span> <span>and/or</span> <span>frequency</span> <span>of</span> <span>data</span> <span>transfers</span> <span>is</span> <span>small,</span> <span>or</span> <span>when</span> <span>multiple</span> <span>computers</span> <span>are</span> <span>involved</span>.<span></span> </li>
</ul>
<blockquote>
  <h4><span>3</span>.<span>4</span>.<span>1</span> <span>Shared-Memory</span> </h4>
  <ul>
    <li><span>In</span> <span>general</span> <span>the</span> <span>memory</span> <span>to</span> <span>be</span> <span>shared</span> <span>in</span> <span>a</span> <span>shared-memory</span> <span>system</span> <span>is</span> <span>initially</span> <span>within</span> <span>the</span> <span>address</span> <span>space</span> <span>of</span> <span>a</span> <span>particular</span> <span>process,</span> <span>which</span> <span>needs</span> <span>to</span> <span>make</span> <span>system</span> <span>calls</span> <span>in</span> <span>order</span> <span>to</span> <span>make</span> <span>that</span> <span>memory</span> <span>publicly</span> <span>available</span> <span>to</span> <span>one</span> <span>or</span> <span>more</span> <span>other</span> <span>processes</span>.</li>
    <li><span>Other</span> <span>processes</span> <span>which</span> <span>wish</span> <span>to</span> <span>use</span> <span>the</span> <span>shared</span> <span>memory</span> <span>must</span> <span>then</span> <span>make</span> <span>their</span> <span>own</span> <span>system</span> <span>calls</span> <span>to</span> <span>attach</span> <span>the</span> <span>shared</span> <span>memory</span> <span>area</span> <span>onto</span> <span>their</span> <span>address</span> <span>space</span>.</li>
    <li><span>Generally</span> <span>a</span> <span>few</span> <span>messages</span> <span>must</span> <span>be</span> <span>passed</span> <span>back</span> <span>and</span> <span>forth</span> <span>between</span> <span>the</span> <span>cooperating</span> <span>processes</span> <span>first</span> <span>in</span> <span>order</span> <span>to</span> <span>set</span> <span>up</span> <span>and</span> <span>coordinate</span> <span>the</span> <span>shared</span> <span>memory</span> <span>access</span>.<span></span> </li>
  </ul>
  <h4><span>Producer-Consumer</span> <span>Example</span> <span>Using</span> <span>Shared</span> </h4>
  <ul>
    <li><span>This</span> <span>is</span> <span>a</span> <span>classic</span> <span>example,</span> <span>in</span> <span>which</span> <span>one</span> <span>process</span> <span>is</span> <span>producing</span> <span>data</span> <span>and</span> <span>another</span> <span>process</span> <span>is</span> <span>consuming</span> <span>the</span> <span>data</span>.<span></span> <span>(&nbsp;In</span> <span>this</span> <span>example</span> <span>in</span> <span>the</span> <span>order</span> <span>in</span> <span>which</span> <span>it</span> <span>is</span> <span>produced,</span> <span>although</span> <span>that</span> <span>could</span> <span>vary</span>.</li>
    <li><span>The</span> <span>data</span> <span>is</span> <span>passed</span> <span>via</span> <span>an</span> <span>intermediary</span> <span>buffer,</span> <span>which</span> <span>may</span> <span>be</span> <span>either</span> <span>unbounded</span> <span>or</span> <span>bounded</span>.<span></span> <span>With</span> <span>a</span> <span>bounded</span> <span>buffer</span> <span>the</span> <span>producer</span> <span>may</span> <span>have</span> <span>to</span> <span>wait</span> <span>until</span> <span>there</span> <span>is</span> <span>space</span> <span>available</span> <span>in</span> <span>the</span> <span>buffer,</span> <span>but</span> <span>with</span> <span>an</span> <span>unbounded</span> <span>buffer</span> <span>the</span> <span>producer</span> <span>will</span> <span>never</span> <span>need</span> <span>to</span> <span>wait</span>.<span></span> <span>The</span> <span>consumer</span> <span>may</span> <span>need</span> <span>to</span> <span>wait</span> <span>in</span> <span>either</span> <span>case</span> <span>until</span> <span>there</span> <span>is</span> <span>data</span> <span>available</span>.</li>
    <li><span>This</span> <span>example</span> <span>uses</span> <span>shared</span> <span>memory</span> <span>and</span> <span>a</span> <span>circular</span> <span>queue</span>.<span></span> <span>Note</span> <span>in</span> <span>the</span> <span>code</span> <span>below</span> <span>that</span> <span>only</span> <span>the</span> <span>producer</span> <span>changes</span> <span>"in",</span> <span>and</span> <span>only</span> <span>the</span> <span>consumer</span> <span>changes</span> <span>"out",</span> <span>and</span> <span>that</span> <span>they</span> <span>can</span> <span>never</span> <span>be</span> <span>accessing</span> <span>the</span> <span>same</span> <span>array</span> <span>location</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.</li>
  
    <li><span>First</span> <span>the</span> <span>following</span> <span>data</span> <span>is</span> <span>set</span> <span>up</span> <span>in</span> <span>the</span> <span>shared</span> <span>memory</span> <span>area:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="style1"><span>#define</span> <span>BUFFER_SIZE</span> <span>10</span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="style1"><span>typedef</span> <span>struct</span> <span>{</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>.<span></span> <span></span>.<span></span> <span></span>.<span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>}</span> <span>item;</span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="style1"><span>item</span> <span>buffer[</span> <span>BUFFER_SIZE</span> <span>];</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>int</span> <span>in</span> <span>=</span> <span>0;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>int</span> <span>out</span> <span>=</span> <span>0;</span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Then</span> <span>the</span> <span>producer</span> <span>process</span>.<span></span> <span>Note</span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>that</span> <span>the</span> <span>buffer</span> <span>is</span> <span>full</span> <span>when</span> <span>"in"</span> <span>is</span> <span>one</span> <span>less</span> <span>than</span> <span>"out"</span> <span>in</span> <span>a</span> <span>circular</span> <span>sense:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="style1"><span>//</span> <span>Code</span> <span>from</span> <span>Figure</span> <span>3</span>.<span>13</span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><span class="style1"><span>item</span> <span>nextProduced;</span> <span></span></span><span>
</span><p class="style1"><span>while(</span> <span>true</span> <span>)</span> <span>{</span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> </li>
    <blockquote>
      <blockquote>
        <p class="style1"><span>/*</span> <span>Produce</span> <span>an</span> <span>item</span> <span>and</span> <span>store</span> <span>it</span> <span>in</span> <span>nextProduced</span> <span>*/</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>nextProduced</span> <span>=</span> <span>makeNewItem(</span> <span></span>.<span></span> <span></span>.<span></span> <span></span>.<span></span> <span>);</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>Wait</span> <span>for</span> <span>space</span> <span>to</span> <span>become</span> <span>available</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>while(</span> <span>(</span> <span>(</span> <span>in</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> <span>BUFFER_SIZE</span> <span>)</span> <span>==</span> <span>out</span> <span>)</span><br><span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>;</span> <span>/*</span> <span>Do</span> <span>nothing</span> <span>*/</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>And</span> <span>then</span> <span>store</span> <span>the</span> <span>item</span> <span>and</span> <span>repeat</span> <span>the</span> <span>loop</span>.<span></span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>buffer[</span> <span>in</span> <span>]</span> <span>=</span> <span>nextProduced;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>in</span> <span>=</span> <span>(</span> <span>in</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> </p>
      </blockquote>
      <p class="style1"><span>	}</span> </p>
    </blockquote>
    <li><span>Then</span> <span>the</span> <span>consumer</span> <span>process</span>.<span></span> <span>Note</span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>that</span> <span>the</span> <span>buffer</span> <span>is</span> <span>empty</span> <span>when</span> <span>"in"</span> <span>is</span> <span>equal</span> <span>to</span> <span></span> <span>"out":</span> </li>
    <blockquote>
      <p class="style1"><span>//</span> <span>Code</span> <span>from</span> <span>Figure</span> <span>3</span>.</p>
      <p class="style1"><span>item</span> <span>nextConsumed;</span> </p>
      <p class="style1"><span>while(</span> <span>true</span> <span>)</span> </p>
      <blockquote>
        <p class="style1"><span>/*</span> <span>Wait</span> <span>for</span> <span>an</span> <span>item</span> <span>to</span> <span>become</span> <span>available</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>while(</span> <span>in</span> <span>==</span> <span>out</span> <span>)</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>;</span> <span>/*</span> <span>Do</span> <span>nothing</span> </p>
        <p class="style1"><span>/*</span> <span>Get</span> <span>the</span> <span>next</span> <span>available</span> <span>item</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>nextConsumed</span> <span>=</span> <span>buffer[</span> <span>out</span> <span>];</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>out</span> <span>=</span> <span>(</span> <span>out</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> <span>BUFFER_SIZE;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>Consume</span> <span>the</span> <span>item</span> <span>in</span> <span>nextConsumed</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span> <span>Do</span> <span>something</span> <span>with</span> <span>it</span> <span>)</span> <span>*/</span> </p>
      </blockquote>
      <p class="style1"></p> 
    </blockquote>
  </ul>
  <h4><span>3</span>.<span>4</span>.<span>2</span> <span>Message-Passing</span> </h4>
  <ul>
    <li><span>Message</span> <span>passing</span> <span>systems</span> <span>must</span> <span>support</span> <span>at</span> <span>a</span> <span>minimum</span> <span>system</span> <span>calls</span> <span>for</span> <span>"send</span> <span>message"</span> <span>and</span> <span>"receive</span> <span>message"</span>.</li>
    <li><span>A</span> <span>communication</span> <span>link</span> <span>must</span> <span>be</span> <span>established</span> <span>between</span> <span>the</span> <span>cooperating</span> <span>processes</span> <span>before</span> <span>messages</span> <span>can</span> <span>be</span> <span>sent</span>.</li>
    <li><span>There</span> <span>are</span> <span>three</span> <span>key</span> <span>issues</span> <span>to</span> <span>be</span> <span>resolved</span> <span>in</span> <span>message</span> <span>passing</span> <span>systems</span> <span>as</span> <span>further</span> <span>explored</span> <span>in</span> <span>the</span> <span>next</span> <span>three</span> <span>subsections:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Direct</span> <span>or</span> <span>indirect</span> <span>communication</span> <span>(</span> <span>naming</span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Synchronous</span> <span>or</span> <span>asynchronous</span> <span>communication</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Automatic</span> <span>or</span> <span>explicit</span> <span>buffering</span>.<span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <blockquote>
    <h5><span>3</span>.<span>4</span>.<span>2</span>.<span>1</span> </h5>
    <ul>
      <li><span>With</span> <span></span><strong><span>direct</span> <span>communication</span></strong><span></span> <span>the</span> <span>sender</span> <span>must</span> <span>know</span> <span>the</span> <span>name</span> <span>of</span> <span>the</span> <span>receiver</span> <span>to</span> <span>which</span> <span>it</span> <span>wishes</span> <span>to</span> <span>send</span> <span>a</span> <span>message</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>There</span> <span>is</span> <span>a</span> <span>one-to-one</span> <span>link</span> <span>between</span> <span>every</span> <span>sender-receiver</span> <span>pair</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>For</span> <span></span><strong><span>symmetric</span> <span></span></strong><span>communication,</span> <span>the</span> <span>receiver</span> <span>must</span> <span>also</span> <span>know</span> <span>the</span> <span>specific</span> <span>name</span> <span>of</span> <span>the</span> <span>sender</span> <span>from</span> <span>which</span> <span>it</span> <span>wishes</span> <span>to</span> <span>receive</span> <span>messages</span>.<span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>For</span> <span></span><strong><span>asymmetric</span></strong><span></span> <span>communications,</span> <span>this</span> <span>is</span> <span>not</span> <span>necessary</span>.<span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span></span><strong><span>Indirect</span> <span>communication</span></strong><span></span> <span>uses</span> <span>shared</span> <span>mailboxes,</span> <span>or</span> <span>ports</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Multiple</span> <span>processes</span> <span>can</span> <span>share</span> <span>the</span> <span>same</span> <span>mailbox</span> <span>or</span> <span>boxes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Only</span> <span>one</span> <span>process</span> <span>can</span> <span>read</span> <span>any</span> <span>given</span> <span>message</span> <span>in</span> <span>a</span> <span>mailbox</span>.<span></span> <span>Initially</span> <span>the</span> <span>process</span> <span>that</span> <span>creates</span> <span>the</span> <span>mailbox</span> <span>is</span> <span>the</span> <span>owner,</span> <span>and</span> <span>is</span> <span>the</span> <span>only</span> <span>one</span> <span>allowed</span> <span>to</span> <span>read</span> <span>mail</span> <span>in</span> <span>the</span> <span>mailbox,</span> <span>although</span> <span>this</span> <span>privilege</span> <span>may</span> <span>be</span> <span>transferred</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>(</span> <span>Of</span> <span>course</span> <span>the</span> <span>process</span> <span>that</span> <span>reads</span> <span>the</span> <span>message</span> <span>can</span> <span>immediately</span> <span>turn</span> <span>around</span> <span>and</span> <span>place</span> <span>an</span> <span>identical</span> <span>message</span> <span>back</span> <span>in</span> <span>the</span> <span>box</span> <span>for</span> <span>someone</span> <span>else</span> <span>to</span> <span>read,</span> <span>but</span> <span>that</span> <span>may</span> <span>put</span> <span>it</span> <span>at</span> <span>the</span> <span>back</span> <span>end</span> <span>of</span> <span>a</span> <span>queue</span> <span>of</span> <span>messages</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>OS</span> <span>must</span> <span>provide</span> <span>system</span> <span>calls</span> <span>to</span> <span>create</span> <span>and</span> <span>delete</span> <span>mailboxes,</span> <span>and</span> <span>to</span> <span>send</span> <span>and</span> <span>receive</span> <span>messages</span> <span>to/from</span> <span>mailboxes</span>.<span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
    </ul>
    <h5><span>3</span>.<span>4</span>.<span>2</span>.<span>2</span> </h5>
    <ul>
      <li><span>Either</span> <span>the</span> <span>sending</span> <span>or</span> <span>receiving</span> <span>of</span> <span>messages</span> <span>(</span> <span>or</span> <span>neither</span> <span>or</span> <span>both</span> <span>)</span> <span>may</span> <span>be</span> <span>either</span> <span></span><strong><span>blocking</span></strong><span></span> <span>or</span> <span></span><strong><span>non-blocking</span></strong><span></span>.</li>
    </ul>
    <h5><span>3</span>.<span>4</span>.<span>2</span>.<span>3</span> </h5>
    <ul>
      <li><span>Messages</span> <span>are</span> <span>passed</span> <span>via</span> <span>queues,</span> <span>which</span> <span>may</span> <span>have</span> <span>one</span> <span>of</span> <span>three</span> <span>capacity</span> <span>configurations:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Zero</span> <span>capacity</span></strong><span></span> <span>-</span> <span>Messages</span> <span>cannot</span> <span>be</span> <span>stored</span> <span>in</span> <span>the</span> <span>queue,</span> <span>so</span> <span>senders</span> <span>must</span> <span>block</span> <span>until</span> <span>receivers</span> <span>accept</span> <span>the</span> <span>messages</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Bounded</span> <span>capacity</span></strong><span>-</span> <span>There</span> <span>is</span> <span>a</span> <span>certain</span> <span>pre-determined</span> <span>finite</span> <span>capacity</span> <span>in</span> <span>the</span> <span>queue</span>.<span></span> <span>Senders</span> <span>must</span> <span>block</span> <span>if</span> <span>the</span> <span>queue</span> <span>is</span> <span>full,</span> <span>until</span> <span>space</span> <span>becomes</span> <span>available</span> <span>in</span> <span>the</span> <span>queue,</span> <span>but</span> <span>may</span> <span>be</span> <span>either</span> <span>blocking</span> <span>or</span> <span>non-blocking</span> <span>otherwise</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Unbounded</span> <span>capacity</span></strong><span></span> <span>-</span> <span>The</span> <span>queue</span> <span>has</span> <span>a</span> <span>theoretical</span> <span>infinite</span> <span>capacity,</span> <span>so</span> <span>senders</span> <span>are</span> <span>never</span> <span>forced</span> <span>to</span> <span>block</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
    </ul>
  </blockquote>
</blockquote>
<p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_15_16_MessagePassing.jpg" width="582" height="514"></p>
<h3><span>3</span>.<span>5</span> <span>Examples</span> <span>of</span> <span>IPC</span> </h3>
<blockquote>
  <h4><span>3</span>.<span>5</span>.<span>1</span> <span>An</span> <span>Example:</span> <span>POSIX</span> <span>Shared</span> <span>Memory</span> <span>(</span> <span>Eighth</span> <span>Edition</span> <span>Version</span> </h4>
  <ol>
    <li><span>The</span> <span>first</span> <span>step</span> <span>in</span> <span>using</span> <span>shared</span> <span>memory</span> <span>is</span> <span>for</span> <span>one</span> <span>of</span> <span>the</span> <span>processes</span> <span>involved</span> <span>to</span> <span>allocate</span> <span>some</span> <span>shared</span> <span>memory,</span> <span>using</span> <span>shmget:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p><span></span><span class="style1"><span>int</span> <span>segment_id</span> <span>=</span> <span>shmget(</span> <span>IPC_PRIVATE,</span> <span>size,</span> <span>S_IRUSR</span> <span>|</span> <span>S_IWUSR</span> <span>);</span> <span></span></span><span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>first</span> <span>parameter</span> <span>specifies</span> <span>the</span> <span>key</span> <span>(</span> <span>identifier</span> <span>)</span> <span>of</span> <span>the</span> <span>segment</span>.<span></span> <span>IPC_PRIVATE</span> <span>creates</span> <span>a</span> <span>new</span> <span>shared</span> <span>memory</span> <span>segment</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>second</span> <span>parameter</span> <span>indicates</span> <span>how</span> <span>big</span> <span>the</span> <span>shared</span> <span>memory</span> <span>segment</span> <span>is</span> <span>to</span> <span>be,</span> <span>in</span> <span>bytes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>third</span> <span>parameter</span> <span>is</span> <span>a</span> <span>set</span> <span>of</span> <span>bitwise</span> <span>ORed</span> <span>flags</span>.<span></span> <span>In</span> <span>this</span> <span>case</span> <span>the</span> <span>segment</span> <span>is</span> <span>being</span> <span>created</span> <span>for</span> <span>reading</span> <span>and</span> <span>writing</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>return</span> <span>value</span> <span>of</span> <span>shmget</span> <span>is</span> <span>an</span> <span>integer</span> <span>identifier</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> </li>
  
    <li><span>Any</span> <span>process</span> <span>which</span> <span>wishes</span> <span>to</span> <span>use</span> <span>the</span> <span>shared</span> <span>memory</span> <span>must</span> <span></span><em><span>attach</span></em><span></span> <span>the</span> <span>shared</span> <span>memory</span> <span>to</span> <span>their</span> <span>address</span> <span>space,</span> <span>using</span> <span>shmat:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p><span></span><span class="style1"><span>char</span> <span>*</span> <span>shared_memory</span> <span>=</span> <span>(</span> <span>char</span> <span>*</span> <span>)</span> <span>shmat(</span> <span>segment_id,</span> <span>NULL,</span> <span>0</span> <span></span> <span>);</span> <span></span></span><span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>first</span> <span>parameter</span> <span>specifies</span> <span>the</span> <span>key</span> <span>(</span> <span>identifier</span> <span>)</span> <span>of</span> <span>the</span> <span>segment</span> <span>that</span> <span>the</span> <span>process</span> <span>wishes</span> <span>to</span> <span>attach</span> <span>to</span> <span>its</span> <span>address</span> <span>space</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>second</span> <span>parameter</span> <span>indicates</span> <span>where</span> <span>the</span> <span>process</span> <span>wishes</span> <span>to</span> <span>have</span> <span>the</span> <span>segment</span> <span>attached</span>.<span></span> <span>NULL</span> <span>indicates</span> <span>that</span> <span>the</span> <span>system</span> <span>should</span> <span>decide</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>third</span> <span>parameter</span> <span>is</span> <span>a</span> <span>flag</span> <span>for</span> <span>read-only</span> <span>operation</span>.<span></span> <span>Zero</span> <span>indicates</span> <span>read-write;</span> <span>One</span> <span>indicates</span> <span>readonly</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>return</span> <span>value</span> <span>of</span> <span>shmat</span> <span>is</span> <span>a</span> <span>void</span> <span>*,</span> <span>which</span> <span>the</span> <span>process</span> <span>can</span> <span>use</span> <span>(</span> <span>type</span> <span>cast</span> <span>)</span> <span>as</span> <span>appropriate</span>.<span></span> <span>In</span> <span>this</span> <span>example</span> <span>it</span> <span>is</span> <span>being</span> <span>used</span> <span>as</span> <span>a</span> <span>character</span> <span>pointer</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Then</span> <span>processes</span> <span>may</span> <span>access</span> <span>the</span> <span>memory</span> <span>using</span> <span>the</span> <span>pointer</span> <span>returned</span> <span>by</span> <span>shmat,</span> <span>for</span> <span>example</span> <span>using</span> <span>sprintf:</span> <span></span> <span></span> <span></span> </li>
    <blockquote>
      <p><span></span><span class="style1"><span>sprintf(</span> <span></span> <span>shared_memory,</span> <span>"Writing</span> <span>to</span> <span>shared</span> <span>memory\n"</span> <span>);</span> <span></span></span></p>
    </blockquote>
    <li><span>When</span> <span>a</span> <span>process</span> <span>no</span> <span>longer</span> <span>needs</span> <span>a</span> <span>piece</span> <span>of</span> <span>shared</span> <span>memory,</span> <span>it</span> <span>can</span> <span>be</span> <span>detached</span> <span>using</span> <span>shmdt:</span> <span></span> <span></span> <span></span> </li>
    <blockquote>
      <p><span></span><span class="style1"><span>shmdt(</span> <span></span> <span>shared_memory</span> <span>);</span> <span></span></span></p>
    </blockquote>
    <li><span>And</span> <span>finally</span> <span>the</span> <span>process</span> <span>that</span> <span>originally</span> <span>allocated</span> <span>the</span> <span>shared</span> <span>memory</span> <span>can</span> <span>remove</span> <span>it</span> <span>from</span> <span>the</span> <span>system</span> <span>suing</span> <span>shmctl</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p><span></span><span class="style1"><span>shmctl(</span> <span></span> <span>segment_id,</span> <span>IPC_RMID</span> <span>);</span> <span></span></span><span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Figure</span> <span>3</span>.<span>16</span> <span>from</span> <span>the</span> <span>eighth</span> <span>edition</span> <span>illustrates</span> <span>a</span> <span>complete</span> <span>program</span> <span>implementing</span> <span>shared</span> <span>memory</span> <span>on</span> <span>a</span> <span>POSIX</span> </li>
  </ol>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_16_POSIX_SharedMemory.jpg" width="778" height="908"></p>
    <h4><span>3</span>.<span>5</span>.<span>1</span> <span>An</span> <span>Example:</span> <span>POSIX</span> <span>Shared</span> <span>Memory</span> <span>(</span> <span>Ninth</span> <span>Edition</span> <span>Version</span> </h4>
    <ol>
      <li><span>The</span> <span>ninth</span> <span>edition</span> <span>shows</span> <span>an</span> <span>alternate</span> <span>approach</span> <span>to</span> <span>shared</span> <span>memory</span> <span>in</span> <span>POSIX</span> <span>systems</span>.<span></span> <span>Under</span> <span>this</span> <span>approach,</span> <span>the</span> <span>first</span> <span>step</span> <span>in</span> <span>using</span> <span>shared</span> <span>memory</span> <span>is</span> <span>to</span> <span>create</span> <span>a</span> <span>shared-memory</span> <span>object</span> <span>using</span> <span>shm_open(</span> <span>),in</span> <span>a</span> <span>fashion</span> <span>similar</span> <span>to</span> <span>other</span> <span>file</span> <span>opening</span> <span>commands</span>.<span></span> <span></span> <span>The</span> <span>name</span> <span>provided</span> <span>will</span> <span>be</span> <span>the</span> <span>name</span> <span>of</span> <span>the</span> <span>memory-mapped</span> <span>file</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote class="style1"><span>shm_fd</span> <span>=</span> <span>shm_open(</span> <span>name,O_CREAT</span> <span>|</span> <span>O_RDRW,0666</span> <span>);</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>The</span> <span>next</span> <span>step</span> <span>is</span> <span>to</span> <span>set</span> <span>the</span> <span>size</span> <span>of</span> <span>the</span> <span>file</span> <span>using</span> <span>ftruncate:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote class="style1"><span>ftruncate(</span> <span>shm_fd,</span> <span>4096</span> <span>);</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>Finally</span> <span>the</span> <span>mmap</span> <span>system</span> <span>call</span> <span>maps</span> <span>the</span> <span>file</span> <span>to</span> <span>a</span> <span>memory</span> <span>address</span> <span>in</span> <span>the</span> <span>user</span> <span>program</span> <span>space</span>.<span>and</span> <span>makes</span> <span>it</span> <span>shared</span>.<span></span> <span></span> <span>In</span> <span>this</span> <span>example</span> <span>the</span> <span>process</span> <span>that</span> <span>created</span> <span>the</span> <span>shared</span> <span>memory</span> <span>will</span> <span>be</span> <span>writing</span> <span>to</span> <span>it:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote class="style1"><span>ptr</span> <span>=</span> <span>mmap(</span> <span>0,</span> <span>SIZE,PROT_WRITE,</span> <span>MAP_SHARED,</span> <span>shm_fd,</span> <span>0</span> <span>);</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>The</span> <span>"borrower"</span> <span>of</span> <span>the</span> <span>shared</span> <span>memory,</span> <span>(</span> <span>not</span> <span>the</span> <span>one</span> <span>who</span> <span>created</span> <span>it</span> <span>),</span> <span>calls</span> <span></span><span class="style1"><span>shm_open(</span> <span>)</span></span><span></span> <span>and</span> <span></span><span class="style1"><span>mmap(</span> <span>)</span></span><span></span> <span>with</span> <span>different</span> <span>arguments,</span> <span>skips</span> <span>the</span> <span></span><span class="style1"><span>ftruncate(</span> <span>)</span></span><span></span> <span>step</span> <span>and</span> <span>unlinks</span> <span>(</span> <span>removes</span> <span>)</span> <span>the</span> <span>file</span> <span>name</span> <span>when</span> <span>it</span> <span>is</span> <span>done</span> <span>with</span> <span>it</span>.<span></span> <span></span> <span></span> <span></span> <span>Note</span> <span>that</span> <span>the</span> <span>"borrower"</span> <span>must</span> <span>use</span> <span>the</span> <span>same</span> <span>file</span> <span>name</span> <span>as</span> <span>the</span> <span>"lender"</span> <span>who</span> <span>created</span> <span>it</span>.<span></span> <span></span> <span>(</span> <span>This</span> <span>information</span> <span>could</span> <span>have</span> <span>been</span> <span>passed</span> <span>using</span> <span>messages</span>.<span></span> <span>)
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote class="style1"><span>shm_unlink(</span> <span>name</span> <span>);</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>Note</span> <span>that</span> <span>writing</span> <span>to</span> <span>and</span> <span>reading</span> <span>from</span> <span>the</span> <span>shared</span> <span>memory</span> <span>is</span> <span>done</span> <span>with</span> <span>pointers</span> <span>and</span> <span>memory</span> <span>addresses</span> <span>(</span> <span>sprintf</span> <span>)</span> <span>in</span> <span>both</span> <span>the</span> <span>9th</span> <span>and</span> <span>8th</span> <span>edition</span> <span>versions,</span> <span>even</span> <span>though</span> <span>the</span> <span>9th</span> <span>edition</span> <span>is</span> <span>illustrating</span> <span>memory</span> <span>mapping</span> <span>of</span> <span>a</span> <span>file</span>.</li>
      <li><span>Figures</span> <span>3</span>.<span>17</span> <span>and</span> <span>3</span>.<span>18</span> <span>from</span> <span>the</span> <span>ninth</span> <span>edition</span> <span>illustrate</span> <span>a</span> <span>complete</span> <span>program</span> <span>implementing</span> <span>shared</span> <span>memory</span> <span>on</span> <span>a</span> <span>POSIX</span> </li>
    </ol>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_17_POSIX_ProducerSharedMemory.jpg" width="720" height="1036"></p>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_18_POSIX_ConsumerSharedMemory.jpg" width="714" height="844"></p>
  </blockquote>
  <h4><span>3</span>.<span>5</span>.<span>2</span> <span>An</span> <span>Example:</span> </h4>
  <ul>
    <li><span>Recall</span> <span>that</span> <span>the</span> <span>Mach</span> <span>kernel</span> <span>is</span> <span>a</span> <span>micro</span> <span>kernel,</span> <span>which</span> <span>performs</span> <span>few</span> <span>services</span> <span>besides</span> <span>delivering</span> <span>messages</span> <span>between</span> <span>other</span> <span>tasks</span> <span>(</span> <span>both</span> <span>system</span> <span>tasks</span> <span>and</span> <span>user</span> <span>tasks</span>.<span></span> </li>
    <li><span>Most</span> <span>communication</span> <span>in</span> <span>Mach,</span> <span>including</span> <span>all</span> <span>system</span> <span>calls</span> <span>and</span> <span>inter-process</span> <span>communication</span> <span>is</span> <span>done</span> <span>via</span> <span>messages</span> <span>sent</span> <span>to</span> <span>mailboxes,</span> <span>also</span> <span>known</span> <span>as</span> <span>ports</span>.<span></span> </li>
    <li><span>Whenever</span> <span>a</span> <span>task</span> <span>(</span> <span>process</span> <span>)</span> <span>is</span> <span>created,</span> <span>it</span> <span>automatically</span> <span>gets</span> <span>two</span> <span>special</span> <span>mailboxes:</span> <span>a</span> <span>Kernel</span> <span>mailbox,</span> <span>and</span> <span>a</span> <span>Notify</span> <span>mailbox</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>kernel</span> <span>communicates</span> <span>with</span> <span>the</span> <span>task</span> <span>using</span> <span>the</span> <span>Kernel</span> <span>mailbox</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>kernel</span> <span>sends</span> <span>notification</span> <span>of</span> <span>events</span> <span>to</span> <span>the</span> <span>Notify</span> <span>mailbox</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Three</span> <span>system</span> <span>calls</span> <span>are</span> <span>used</span> <span>for</span> <span>message</span> <span>transfer:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>msg_send(</span> <span>)</span> <span>sends</span> <span>a</span> <span>message</span> <span>to</span> <span>a</span> <span>mailbox</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>msg_receive(</span> <span>)</span> <span>receives</span> <span>a</span> <span>message</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>msg_rpc(</span> <span>)</span> <span>sends</span> <span>a</span> <span>message</span> <span>and</span> <span>waits</span> <span>for</span> <span>exactly</span> <span>one</span> <span>message</span> <span>in</span> <span>response</span> <span>from</span> <span>the</span> <span>sender</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Port_allocate(</span> <span>)</span> <span>creates</span> <span>a</span> <span>new</span> <span>mailbox</span> <span>and</span> <span>the</span> <span>associated</span> <span>queue</span> <span>for</span> <span>holding</span> <span>messages</span> <span>(</span> <span>size</span> <span>8</span> <span>by</span> <span>default</span>.<span></span> </li>
    <li><span>Only</span> <span>one</span> <span>task</span> <span>at</span> <span>a</span> <span>time</span> <span>can</span> <span>own</span> <span>or</span> <span>receive</span> <span>messages</span> <span>from</span> <span>any</span> <span>given</span> <span>mailbox,</span> <span>but</span> <span>these</span> <span>are</span> <span>transferable</span>.</li>
    <li><span>Messages</span> <span>from</span> <span>the</span> <span>same</span> <span>sender</span> <span>to</span> <span>the</span> <span>same</span> <span>receiver</span> <span>are</span> <span>guaranteed</span> <span>to</span> <span>arrive</span> <span>in</span> <span>FIFO</span> <span>order,</span> <span>but</span> <span>no</span> <span>guarantees</span> <span>are</span> <span>made</span> <span>regarding</span> <span>messages</span> <span>from</span> <span>multiple</span> <span>senders</span>.</li>
    <li><span>Messages</span> <span>consist</span> <span>of</span> <span>a</span> <span>fixed-length</span> <span>header</span> <span>followed</span> <span>by</span> <span>variable</span> <span>length</span> <span>data</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>header</span> <span>contains</span> <span>the</span> <span>mailbox</span> <span>number</span> <span>(</span> <span>address</span> <span>)</span> <span>of</span> <span>the</span> <span>receiver</span> <span>and</span> <span>the</span> <span>sender</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>data</span> <span>section</span> <span>consists</span> <span>of</span> <span>a</span> <span>list</span> <span>of</span> <span>typed</span> <span>data</span> <span>items,</span> <span>each</span> <span>containing</span> <span>a</span> <span>type,</span> <span>size,</span> <span>and</span> <span>value</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>If</span> <span>the</span> <span>receiver's</span> <span>mailbox</span> <span>is</span> <span>full,</span> <span>the</span> <span>sender</span> <span>has</span> <span>four</span> <span>choices:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Wait</span> <span>indefinitely</span> <span>until</span> <span>there</span> <span>is</span> <span>room</span> <span>in</span> <span>the</span> <span>mailbox</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Wait</span> <span>at</span> <span>most</span> <span>N</span> <span>milliseconds</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Do</span> <span>not</span> <span>wait</span> <span>at</span> <span>all</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Temporarily</span> <span>cache</span> <span>the</span> <span>message</span> <span>with</span> <span>the</span> <span>kernel,</span> <span>for</span> <span>delivery</span> <span>when</span> <span>the</span> <span>mailbox</span> <span>becomes</span> <span>available</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Only</span> <span>one</span> <span>such</span> <span>message</span> <span>can</span> <span>be</span> <span>pending</span> <span>at</span> <span>any</span> <span>given</span> <span>time</span> <span>from</span> <span>any</span> <span>given</span> <span>sender</span> <span>to</span> <span>any</span> <span>given</span> <span>receiver</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Normally</span> <span>only</span> <span>used</span> <span>by</span> <span>certain</span> <span>system</span> <span>tasks,</span> <span>such</span> <span>as</span> <span>the</span> <span>print</span> <span>spooler,</span> <span>which</span> <span>must</span> <span>notify</span> <span>the</span> <span>"client"</span> <span>of</span> <span>the</span> <span>completion</span> <span>of</span> <span>their</span> <span>job,</span> <span>but</span> <span>cannot</span> <span>wait</span> <span>around</span> <span>for</span> <span>the</span> <span>mailbox</span> <span>to</span> <span>become</span> <span>available</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Receive</span> <span>calls</span> <span>must</span> <span>specify</span> <span>the</span> <span>mailbox</span> <span>or</span> <span>mailbox</span> <span>set</span> <span>from</span> <span>which</span> <span>they</span> <span>wish</span> <span>to</span> <span>receive</span> <span>messages</span>.</li>
    <li><span>Port_status(</span> <span>)</span> <span>reports</span> <span>the</span> <span>number</span> <span>of</span> <span>messages</span> <span>waiting</span> <span>in</span> <span>any</span> <span>given</span> <span>mailbox</span>.</li>
    <li><span>If</span> <span>there</span> <span>are</span> <span>no</span> <span>messages</span> <span>available</span> <span>in</span> <span>a</span> <span>mailbox</span> <span>(</span> <span>set</span> <span>),</span> <span>the</span> <span>receiver</span> <span>can</span> <span>either</span> <span>block</span> <span>for</span> <span>N</span> <span>milliseconds,</span> <span>or</span> <span>not</span> <span>block</span> <span>at</span> <span>all</span>.</li>
    <li><span>In</span> <span>order</span> <span>to</span> <span>avoid</span> <span>delays</span> <span>caused</span> <span>by</span> <span>copying</span> <span>messages</span> <span>(</span> <span>multiple</span> <span>times</span> <span>),</span> <span>Mach</span> <span>re-maps</span> <span>the</span> <span>memory</span> <span>space</span> <span>for</span> <span>the</span> <span>message</span> <span>from</span> <span>the</span> <span>sender's</span> <span>address</span> <span>space</span> <span>to</span> <span>the</span> <span>receiver's</span> <span>address</span> <span>space</span> <span>(</span> <span>using</span> <span>virtual</span> <span>memory</span> <span>techniques</span> <span>to</span> <span>be</span> <span>covered</span> <span>later</span> <span>),</span> <span>and</span> <span>does</span> <span>not</span> <span>actually</span> <span>move</span> <span>the</span> <span>message</span> <span>anywhere</span> <span>at</span> <span>all</span>.<span></span> <span>(</span> <span>When</span> <span>the</span> <span>sending</span> <span>and</span> <span>receiving</span> <span>task</span> <span>are</span> <span>both</span> <span>on</span> <span>the</span> <span>same</span> <span>computer</span>.<span></span> <span>)</span> </li>
  </ul>
  <h4><span>3</span>.<span>5</span>.<span>3</span> <span>An</span> <span>Example:</span> <span>Windows</span> </h4>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_19_ALPC_Windows.jpg" width="750" height="386"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>19</span> <span>-</span> <span>Advanced</span> <span>local</span> <span>procedure</span> <span>calls</span> <span>in</span> <span>Windows</span></strong></p>
</blockquote>
<h3><span>3</span>.<span>6</span> <span>Communication</span> <span>in</span> <span>Client-Server</span> </h3>
<blockquote>
  <h4><span>3</span>.<span>6</span>.<span>1</span> </h4>
  <ul>
    <li><span>A</span> <span></span><strong><span>socket</span></strong><span></span> <span>is</span> <span>an</span> <span>endpoint</span> <span>for</span> <span>communication</span>.<span></span> </li>
    <li><span>Two</span> <span>processes</span> <span>communicating</span> <span>over</span> <span>a</span> <span>network</span> <span>often</span> <span>use</span> <span>a</span> <span>pair</span> <span>of</span> <span>connected</span> <span>sockets</span> <span>as</span> <span>a</span> <span>communication</span> <span>channel</span>.<span></span> <span>Software</span> <span>that</span> <span>is</span> <span>designed</span> <span>for</span> <span>client-server</span> <span>operation</span> <span>may</span> <span>also</span> <span>use</span> <span>sockets</span> <span>for</span> <span>communication</span> <span>between</span> <span>two</span> <span>processes</span> <span>running</span> <span>on</span> <span>the</span> <span>same</span> <span>computer</span> <span>-</span> <span>For</span> <span>example</span> <span>the</span> <span>UI</span> <span>for</span> <span>a</span> <span>database</span> <span>program</span> <span>may</span> <span>communicate</span> <span>with</span> <span>the</span> <span>back-end</span> <span>database</span> <span>manager</span> <span>using</span> <span>sockets</span>.<span></span> <span>(</span> <span>If</span> <span>the</span> <span>program</span> <span>were</span> <span>developed</span> <span>this</span> <span>way</span> <span>from</span> <span>the</span> <span>beginning,</span> <span>it</span> <span>makes</span> <span>it</span> <span>very</span> <span>easy</span> <span>to</span> <span>port</span> <span>it</span> <span>from</span> <span>a</span> <span>single-computer</span> <span>system</span> <span>to</span> <span>a</span> <span>networked</span> <span>application</span>.<span></span> </li>
    <li><span>A</span> <span>socket</span> <span>is</span> <span>identified</span> <span>by</span> <span>an</span> <span>IP</span> <span>address</span> <span>concatenated</span> <span>with</span> <span>a</span> <span>port</span> <span>number,</span> <span>e</span>.<span>g</span>.<span></span> <span>200</span>.<span>100</span>.<span>50</span>.<span>5:80</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_20_Sockets.jpg" width="465" height="319"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>20</span> <span>-</span> <span>Communication</span> <span>using</span> <span>sockets</span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
  </blockquote>
  <ul>
    <li><span>Port</span> <span>numbers</span> <span>below</span> <span>1024</span> <span>are</span> <span>considered</span> <span>to</span> <span>be</span> <span></span><em><span>well-known</span></em><span>,</span> <span>and</span> <span>are</span> <span>generally</span> <span>reserved</span> <span>for</span> <span>common</span> <span>Internet</span> <span>services</span>.<span></span> <span>For</span> <span>example,</span> <span>telnet</span> <span>servers</span> <span>listen</span> <span>to</span> <span>port</span> <span>23,</span> <span>ftp</span> <span>servers</span> <span>to</span> <span>port</span> <span>21,</span> <span>and</span> <span>web</span> <span>servers</span> <span>to</span> <span>port</span> <span>80</span>.</li>
    <li><span>General</span> <span>purpose</span> <span>user</span> <span>sockets</span> <span>are</span> <span>assigned</span> <span>unused</span> <span>ports</span> <span>over</span> <span>1024</span> <span>by</span> <span>the</span> <span>operating</span> <span>system</span> <span>in</span> <span>response</span> <span>to</span> <span>system</span> <span>calls</span> <span>such</span> <span>as</span> <span>socket(</span> <span>)</span> <span>or</span> <span>soctkepair(</span> <span>)</span>.</li>
    <li><span>Communication</span> <span>channels</span> <span>via</span> <span>sockets</span> <span>may</span> <span>be</span> <span>of</span> <span>one</span> <span>of</span> <span>two</span> <span>major</span> <span>forms:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Connection-oriented</span> <span>(</span> <span>TCP,</span> <span>Transmission</span> <span>Control</span> <span>Protocol</span> <span>)</span></strong><span></span> <span>connections</span> <span>emulate</span> <span>a</span> <span>telephone</span> <span>connection</span>.<span></span> <span>All</span> <span>packets</span> <span>sent</span> <span>down</span> <span>the</span> <span>connection</span> <span>are</span> <span>guaranteed</span> <span>to</span> <span>arrive</span> <span>in</span> <span>good</span> <span>condition</span> <span>at</span> <span>the</span> <span>other</span> <span>end,</span> <span>and</span> <span>to</span> <span>be</span> <span>delivered</span> <span>to</span> <span>the</span> <span>receiving</span> <span>process</span> <span>in</span> <span>the</span> <span>order</span> <span>in</span> <span>which</span> <span>they</span> <span>were</span> <span>sent</span>.<span></span> <span>The</span> <span>TCP</span> <span>layer</span> <span>of</span> <span>the</span> <span>network</span> <span>protocol</span> <span>takes</span> <span>steps</span> <span>to</span> <span>verify</span> <span>all</span> <span>packets</span> <span>sent,</span> <span>re-send</span> <span>packets</span> <span>if</span> <span>necessary,</span> <span>and</span> <span>arrange</span> <span>the</span> <span>received</span> <span>packets</span> <span>in</span> <span>the</span> <span>proper</span> <span>order</span> <span>before</span> <span>delivering</span> <span>them</span> <span>to</span> <span>the</span> <span>receiving</span> <span>process</span>.<span></span> <span>There</span> <span>is</span> <span>a</span> <span>certain</span> <span>amount</span> <span>of</span> <span>overhead</span> <span>involved</span> <span>in</span> <span>this</span> <span>procedure,</span> <span>and</span> <span>if</span> <span>one</span> <span>packet</span> <span>is</span> <span>missing</span> <span>or</span> <span>delayed,</span> <span>then</span> <span>any</span> <span>packets</span> <span>which</span> <span>follow</span> <span>will</span> <span>have</span> <span>to</span> <span>wait</span> <span>until</span> <span>the</span> <span>errant</span> <span>packet</span> <span>is</span> <span>delivered</span> <span>before</span> <span>they</span> <span>can</span> <span>continue</span> <span>their</span> <span>journey</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Connectionless</span> <span>(</span> <span>UDP,</span> <span>User</span> <span>Datagram</span> <span>Protocol</span> <span>)</span> <span></span></strong><span>emulate</span> <span>individual</span> <span>telegrams</span>.<span></span> <span>There</span> <span>is</span> <span>no</span> <span>guarantee</span> <span>that</span> <span>any</span> <span>particular</span> <span>packet</span> <span>will</span> <span>get</span> <span>through</span> <span>undamaged</span> <span>(</span> <span>or</span> <span>at</span> <span>all</span> <span>),</span> <span>and</span> <span>no</span> <span>guarantee</span> <span>that</span> <span>the</span> <span>packets</span> <span>will</span> <span>get</span> <span>delivered</span> <span>in</span> <span>any</span> <span>particular</span> <span>order</span>.<span></span> <span>There</span> <span>may</span> <span>even</span> <span>be</span> <span>duplicate</span> <span>packets</span> <span>delivered,</span> <span>depending</span> <span>on</span> <span>how</span> <span>the</span> <span>intermediary</span> <span>connections</span> <span>are</span> <span>configured</span>.<span></span> <span>UDP</span> <span>transmissions</span> <span>are</span> <span>much</span> <span>faster</span> <span>than</span> <span>TCP,</span> <span>but</span> <span>applications</span> <span>must</span> <span>implement</span> <span>their</span> <span>own</span> <span>error</span> <span>checking</span> <span>and</span> <span>recovery</span> <span>procedures</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Sockets</span> <span>are</span> <span>considered</span> <span>a</span> <span>low-level</span> <span>communications</span> <span>channel,</span> <span>and</span> <span>processes</span> <span>may</span> <span>often</span> <span>choose</span> <span>to</span> <span>use</span> <span>something</span> <span>at</span> <span>a</span> <span>higher</span> <span>level,</span> <span>such</span> <span>as</span> <span>those</span> <span>covered</span> <span>in</span> <span>the</span> <span>next</span> <span>two</span> <span>sections</span>.<span></span> </li>
    <li><span>Figure</span> <span>3</span>.<span>19</span> <span>and</span> <span>3</span>.<span>20</span> <span>illustrate</span> <span>a</span> <span>client-server</span> <span>system</span> <span>for</span> <span>determining</span> <span>the</span> <span>current</span> <span>date</span> <span>using</span> <span>sockets</span> <span>in</span> <span>Java</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_19_20_JavaClientServer.jpg" width="754" height="1571"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>21</span> <span>and</span> <span>Figure</span> <span>3</span>.<span>22</span></strong></p>
  </blockquote>
  <h4><span>3</span>.<span>6</span>.<span>2</span> <span>Remote</span> <span>Procedure</span> <span>Calls,</span> <span>RPC</span> </h4>
  <ul>
    <li><span>The</span> <span>general</span> <span>concept</span> <span>of</span> <span>RPC</span> <span>is</span> <span>to</span> <span>make</span> <span>procedure</span> <span>calls</span> <span>similarly</span> <span>to</span> <span>calling</span> <span>on</span> <span>ordinary</span> <span>local</span> <span>procedures,</span> <span>except</span> <span>the</span> <span>procedure</span> <span>being</span> <span>called</span> <span>lies</span> <span>on</span> <span>a</span> <span>remote</span> <span>machine</span>.</li>
    <li><span>Implementation</span> <span>involves</span> <span></span><em><span></span><strong><span>stubs</span></strong><span></span></em><span></span> <span>on</span> <span>either</span> <span>end</span> <span>of</span> <span>the</span> <span>connection</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>local</span> <span>process</span> <span>calls</span> <span>on</span> <span>the</span> <span>stub,</span> <span>much</span> <span>as</span> <span>it</span> <span>would</span> <span>call</span> <span>upon</span> <span>a</span> <span>local</span> <span>procedure</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>RPC</span> <span>system</span> <span>packages</span> <span>up</span> <span>(</span> <span>marshals</span> <span>)</span> <span>the</span> <span>parameters</span> <span>to</span> <span>the</span> <span>procedure</span> <span>call,</span> <span>and</span> <span>transmits</span> <span>them</span> <span>to</span> <span>the</span> <span>remote</span> <span>system</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>On</span> <span>the</span> <span>remote</span> <span>side,</span> <span>the</span> <span>RPC</span> <span>daemon</span> <span>accepts</span> <span>the</span> <span>parameters</span> <span>and</span> <span>calls</span> <span>upon</span> <span>the</span> <span>appropriate</span> <span>remote</span> <span>procedure</span> <span>to</span> <span>perform</span> <span>the</span> <span>requested</span> <span>work</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Any</span> <span>results</span> <span>to</span> <span>be</span> <span>returned</span> <span>are</span> <span>then</span> <span>packaged</span> <span>up</span> <span>and</span> <span>sent</span> <span>back</span> <span>by</span> <span>the</span> <span>RPC</span> <span>system</span> <span>to</span> <span>the</span> <span>local</span> <span>system,</span> <span>which</span> <span>then</span> <span>unpackages</span> <span>them</span> <span>and</span> <span>returns</span> <span>the</span> <span>results</span> <span>to</span> <span>the</span> <span>local</span> <span>calling</span> <span>procedure</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>One</span> <span>potential</span> <span>difficulty</span> <span>is</span> <span>the</span> <span>formatting</span> <span>of</span> <span>data</span> <span>on</span> <span>local</span> <span>versus</span> <span>remote</span> <span>systems</span>.<span></span> <span>(</span> <span>e</span>.<span>g</span>.<span></span> <span>big-endian</span> <span>versus</span> <span>little-endian</span>.<span></span> <span>)</span> <span>The</span> <span>resolution</span> <span>of</span> <span>this</span> <span>problem</span> <span>generally</span> <span>involves</span> <span>an</span> <span>agreed-upon</span> <span>intermediary</span> <span>format,</span> <span>such</span> <span>as</span> <span>XDR</span> <span>(</span> <span>external</span> <span>data</span> <span>representation</span>.<span></span> </li>
    <li><span>Another</span> <span>issue</span> <span>is</span> <span>identifying</span> <span>which</span> <span>procedure</span> <span>on</span> <span>the</span> <span>remote</span> <span>system</span> <span>a</span> <span>particular</span> <span>RPC</span> <span>is</span> <span>destined</span> <span>for</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Remote</span> <span>procedures</span> <span>are</span> <span>identified</span> <span>by</span> <span></span><em><span>ports</span></em><span>,</span> <span>though</span> <span>not</span> <span>the</span> <span>same</span> <span>ports</span> <span>as</span> <span>the</span> <span>socket</span> <span>ports</span> <span>described</span> <span>earlier</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>One</span> <span>solution</span> <span>is</span> <span>for</span> <span>the</span> <span>calling</span> <span>procedure</span> <span>to</span> <span>know</span> <span>the</span> <span>port</span> <span>number</span> <span>they</span> <span>wish</span> <span>to</span> <span>communicate</span> <span>with</span> <span>on</span> <span>the</span> <span>remote</span> <span>system</span>.<span></span> <span>This</span> <span>is</span> <span>problematic,</span> <span>as</span> <span>the</span> <span>port</span> <span>number</span> <span>would</span> <span>be</span> <span>compiled</span> <span>into</span> <span>the</span> <span>code,</span> <span>and</span> <span>it</span> <span>makes</span> <span>it</span> <span>break</span> <span>down</span> <span>if</span> <span>the</span> <span>remote</span> <span>system</span> <span>changes</span> <span>their</span> <span>port</span> <span>numbers</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>More</span> <span>commonly</span> <span>a</span> <span></span><em><span>matchmaker</span></em><span></span> <span>process</span> <span>is</span> <span>employed,</span> <span>which</span> <span>acts</span> <span>like</span> <span>a</span> <span>telephone</span> <span>directory</span> <span>service</span>.<span></span> <span>The</span> <span>local</span> <span>process</span> <span>must</span> <span>first</span> <span>contact</span> <span>the</span> <span>matchmaker</span> <span>on</span> <span>the</span> <span>remote</span> <span>system</span> <span>(</span> <span>at</span> <span>a</span> <span>well-known</span> <span>port</span> <span>number</span> <span>),</span> <span>which</span> <span>looks</span> <span>up</span> <span>the</span> <span>desired</span> <span>port</span> <span>number</span> <span>and</span> <span>returns</span> <span>it</span>.<span></span> <span>The</span> <span>local</span> <span>process</span> <span>can</span> <span>then</span> <span>use</span> <span>that</span> <span>information</span> <span>to</span> <span>contact</span> <span>the</span> <span>desired</span> <span>remote</span> <span>procedure</span>.<span></span> <span>This</span> <span>operation</span> <span>involves</span> <span>an</span> <span>extra</span> <span>step,</span> <span>but</span> <span>is</span> <span>much</span> <span>more</span> <span>flexible</span>.<span></span> <span>An</span> <span>example</span> <span>of</span> <span>the</span> <span>matchmaker</span> <span>process</span> <span>is</span> <span>illustrated</span> <span>in</span> <span>Figure</span> <span>3</span>.<span>21</span> <span>below</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>One</span> <span>common</span> <span>example</span> <span>of</span> <span>a</span> <span>system</span> <span>based</span> <span>on</span> <span>RPC</span> <span>calls</span> <span>is</span> <span>a</span> <span>networked</span> <span>file</span> <span>system</span>.<span></span> <span>Messages</span> <span>are</span> <span>passed</span> <span>to</span> <span>read,</span> <span>write,</span> <span>delete,</span> <span>rename,</span> <span>or</span> <span>check</span> <span>status,</span> <span>as</span> <span>might</span> <span>be</span> <span>made</span> <span>for</span> <span>ordinary</span> <span>local</span> <span>disk</span> <span>access</span> <span>requests</span>.</li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_23_RPC.jpg" width="725" height="872"><span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>23</span> <span>-</span> <span>Execution</span> <span>of</span> <span>a</span> <span>remote</span> <span>procedure</span> <span>call</span> <span>(</span> <span>RPC</span> <span>)</span>.<span></span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
  </blockquote>
  <h4><span>3</span>.<span>6</span>.<span>3</span> </h4>
  <ul>
    <li><span></span><em><span></span><strong><span>Pipes</span></strong><span></span></em><span></span> <span>are</span> <span>one</span> <span>of</span> <span>the</span> <span>earliest</span> <span>and</span> <span>simplest</span> <span>channels</span> <span>of</span> <span>communications</span> <span>between</span> <span>(</span> <span>UNIX</span> <span>)</span> <span>processes</span>.</li>
    <li><span>There</span> <span>are</span> <span>four</span> <span>key</span> <span>considerations</span> <span>in</span> <span>implementing</span> <span>pipes:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Unidirectional</span> <span>or</span> <span>Bidirectional</span> <span>communication?</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Is</span> <span>bidirectional</span> <span>communication</span> <span>half-duplex</span> <span>or</span> <span>full-duplex?</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Must</span> <span>a</span> <span>relationship</span> <span>such</span> <span>as</span> <span>parent-child</span> <span>exist</span> <span>between</span> <span>the</span> <span>processes?</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Can</span> <span>pipes</span> <span>communicate</span> <span>over</span> <span>a</span> <span>network,</span> <span>or</span> <span>only</span> <span>on</span> <span>the</span> <span>same</span> <span>machine?</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>following</span> <span>sections</span> <span>examine</span> <span>these</span> <span>issues</span> <span>on</span> <span>UNIX</span> <span>and</span> </li>
  </ul>
  <h5><span>3</span>.<span>6</span>.<span>3</span>.<span>1</span> <span>Ordinary</span> </h5>
  <ul>
    <li><span>Ordinary</span> <span>pipes</span> <span>are</span> <span>uni-directional,</span> <span>with</span> <span>a</span> <span>reading</span> <span>end</span> <span>and</span> <span>a</span> <span>writing</span> <span>end</span>.<span></span> <span>(</span> <span>If</span> <span>bidirectional</span> <span>communications</span> <span>are</span> <span>needed,</span> <span>then</span> <span>a</span> <span>second</span> <span>pipe</span> <span>is</span> <span>required</span>.<span></span> </li>
    <li><span>In</span> <span>UNIX</span> <span>ordinary</span> <span>pipes</span> <span>are</span> <span>created</span> <span>with</span> <span>the</span> <span>system</span> <span>call</span> <span>"</span><span class="codetext"><span>int</span> <span>pipe(</span> <span>int</span> <span>fd</span> <span>[</span> <span>]</span> <span>)</span></span><span>"</span>.<span>
</span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>return</span> <span>value</span> <span>is</span> <span>0</span> <span>on</span> <span>success,</span> <span>-1</span> <span>if</span> <span>an</span> <span>error</span> <span>occurs</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>int</span> <span>array</span> <span>must</span> <span>be</span> <span>allocated</span> <span>before</span> <span>the</span> <span>call,</span> <span>and</span> <span>the</span> <span>values</span> <span>are</span> <span>filled</span> <span>in</span> <span>by</span> <span>the</span> <span>pipe</span> <span>system</span> <span>call:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span><li><span>fd[</span> <span>0</span> <span>]</span> <span>is</span> <span>filled</span> <span>in</span> <span>with</span> <span>a</span> <span>file</span> <span>descriptor</span> <span>for</span> <span>the</span> <span>reading</span> <span>end</span> <span>of</span> <span>the</span> <span>pipe</span></li><span>

</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>fd[</span> <span>1</span> <span>]</span> <span>is</span> <span>filled</span> <span>in</span> <span>with</span> <span>a</span> <span>file</span> <span>descriptor</span> <span>for</span> <span>the</span> <span>writing</span> <span>end</span> <span>of</span> <span>the</span> <span>pipe</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>UNIX</span> <span>pipes</span> <span>are</span> <span>accessible</span> <span>as</span> <span>files,</span> <span>using</span> <span>standard</span> <span>read(</span> <span>)</span> <span>and</span> <span>write(</span> <span>)</span> <span>system</span> <span>calls</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Ordinary</span> <span>pipes</span> <span>are</span> <span>only</span> <span>accessible</span> <span>within</span> <span>the</span> <span>process</span> <span>that</span> <span>created</span> <span>them</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Typically</span> <span>a</span> <span>parent</span> <span>creates</span> <span>the</span> <span>pipe</span> <span>before</span> <span>forking</span> <span>off</span> <span>a</span> <span>child</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>When</span> <span>the</span> <span>child</span> <span>inherits</span> <span>open</span> <span>files</span> <span>from</span> <span>its</span> <span>parent,</span> <span>including</span> <span>the</span> <span>pipe</span> <span>file(s),</span> <span>a</span> <span>channel</span> <span>of</span> <span>communication</span> <span>is</span> <span>established</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Each</span> <span>process</span> <span>(</span> <span>parent</span> <span>and</span> <span>child</span> <span>)</span> <span>should</span> <span>first</span> <span>close</span> <span>the</span> <span>ends</span> <span>of</span> <span>the</span> <span>pipe</span> <span>that</span> <span>they</span> <span>are</span> <span>not</span> <span>using</span>.<span></span> <span>For</span> <span>example,</span> <span>if</span> <span>the</span> <span>parent</span> <span>is</span> <span>writing</span> <span>to</span> <span>the</span> <span>pipe</span> <span>and</span> <span>the</span> <span>child</span> <span>is</span> <span>reading,</span> <span>then</span> <span>the</span> <span>parent</span> <span>should</span> <span>close</span> <span>the</span> <span>reading</span> <span>end</span> <span>of</span> <span>its</span> <span>pipe</span> <span>after</span> <span>the</span> <span>fork</span> <span>and</span> <span>the</span> <span>child</span> <span>should</span> <span>close</span> <span>the</span> <span>writing</span> <span>end</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Figure</span> <span>3</span>.<span>22</span> <span>shows</span> <span>an</span> <span>ordinary</span> <span>pipe</span> <span>in</span> <span>UNIX,</span> <span>and</span> <span>Figure</span> <span>3</span>.<span>23</span> <span>shows</span> <span>code</span> <span>in</span> <span>which</span> <span>it</span> <span>is</span> <span>used</span>.</li>
  </ul>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_22_PipeFileDescriptors.jpg" width="715" height="266"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>24</span></strong><span>
</span> <span></span> </p>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_2324_OrdinaryPipes.jpg" width="740" height="1500"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>25</span> <span>and</span> <span>Figure</span> <span>3</span>.<span>26</span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>Ordinary</span> <span>pipes</span> <span>in</span> <span>Windows</span> <span>are</span> <span>very</span> <span>similar
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Windows</span> <span>terms</span> <span>them</span> <span></span><em><span></span><strong><span>anonymous</span></strong><span></span></em><span></span> <span>pipes</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>They</span> <span>are</span> <span>still</span> <span>limited</span> <span>to</span> <span>parent-child</span> <span>relationships</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>They</span> <span>are</span> <span>read</span> <span>from</span> <span>and</span> <span>written</span> <span>to</span> <span>as</span> <span>files</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>They</span> <span>are</span> <span>created</span> <span>with</span> <span></span><span class="codetext"><span>CreatePipe(</span> <span>)</span></span><span></span> <span>function,</span> <span>which</span> <span>takes</span> <span>additional</span> <span>arguments</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>In</span> <span>Windows</span> <span>it</span> <span>is</span> <span>necessary</span> <span>to</span> <span>specify</span> <span>what</span> <span>resources</span> <span>a</span> <span>child</span> <span>inherits,</span> <span>such</span> <span>as</span> <span>pipes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_2526AnonymousPipesParent.jpg" width="792" height="1567"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>27</span> <span>and</span> <span>Figure</span> <span>3</span>.<span>28</span></strong><span>
</span> <span></span> </p>
  <p align="center"><span></span><img src="./Operating Systems_ Processes_files/3_27_AnonymousPipesChild.jpg" width="805" height="644"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>3</span>.<span>29</span></strong><span>
</span> <span></span> </p>
  <h5><span>3</span>.<span>6</span>.<span>3</span>.<span>2</span> <span>Named</span> </h5>
  <ul>
    <li><span>Named</span> <span>pipes</span> <span>support</span> <span>bidirectional</span> <span>communication,</span> <span>communication</span> <span>between</span> <span>non</span> <span>parent-child</span> <span>related</span> <span>processes,</span> <span>and</span> <span>persistence</span> <span>after</span> <span>the</span> <span>process</span> <span>which</span> <span>created</span> <span>them</span> <span>exits</span>.<span></span> <span>Multiple</span> <span>processes</span> <span>can</span> <span>also</span> <span>share</span> <span>a</span> <span>named</span> <span>pipe,</span> <span>typically</span> <span>one</span> <span>reader</span> <span>and</span> <span>multiple</span> <span>writers</span>.</li>
    <li><span>In</span> <span>UNIX,</span> <span>named</span> <span>pipes</span> <span>are</span> <span>termed</span> <span>fifos,</span> <span>and</span> <span>appear</span> <span>as</span> <span>ordinary</span> <span>files</span> <span>in</span> <span>the</span> <span>file</span> <span>system</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>(</span> <span>Recognizable</span> <span>by</span> <span>a</span> <span>"p"</span> <span>as</span> <span>the</span> <span>first</span> <span>character</span> <span>of</span> <span>a</span> <span>long</span> <span>listing,</span> <span>e</span>.<span>g</span>.<span></span> <span>/dev/initctl</span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Created</span> <span>with</span> <span></span><span class="codetext"><span>mkfifo(</span> <span>)</span></span><span></span> <span>and</span> <span>manipulated</span> <span>with</span> <span></span><span class="codetext"><span>read(</span> <span>),</span> <span>write(</span> <span>),</span> <span>open(</span> <span>),</span> <span>close(</span> <span>)</span></span><span>,</span> <span>etc</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>UNIX</span> <span>named</span> <span>pipes</span> <span>are</span> <span>bidirectional,</span> <span>but</span> <span>half-duplex,</span> <span>so</span> <span>two</span> <span>pipes</span> <span>are</span> <span>still</span> <span>typically</span> <span>used</span> <span>for</span> <span>bidirectional</span> <span>communications</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>UNIX</span> <span>named</span> <span>pipes</span> <span>still</span> <span>require</span> <span>that</span> <span>all</span> <span>processes</span> <span>be</span> <span>running</span> <span>on</span> <span>the</span> <span>same</span> <span>machine</span>.<span></span> <span>Otherwise</span> <span>sockets</span> <span>are</span> <span>used</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Windows</span> <span>named</span> <span>pipes</span> <span>provide</span> <span>richer</span> <span>communications</span>.</li>
    <li><span>Full-duplex</span> <span>is</span> <span>supported</span>.</li>
    <li><span>Processes</span> <span>may</span> <span>reside</span> <span>on</span> <span>the</span> <span>same</span> <span>or</span> <span>different</span> </li>
    <li><span>Created</span> <span>and</span> <span>manipulated</span> <span>using</span> <span></span><span class="codetext"><span>CreateNamedPipe(&nbsp;),</span> <span>ConnectNamedPipe(&nbsp;),</span> <span>ReadFile(&nbsp;),and</span> <span>WriteFile(&nbsp;)</span>.<span></span></span></li>
  </ul>
  <h4><span></span><a name="raceCondition"><span></span></a><span>Race</span> <span>Conditions</span> <span>(</span> <span>Not</span> <span>from</span> <span>the</span> <span>book</span> </h4>
  <blockquote>
    <p><span>Any</span> <span>time</span> <span>there</span> <span>are</span> <span>two</span> <span>or</span> <span>more</span> <span>processes</span> <span>or</span> <span>threads</span> <span>operating</span> <span>concurrently,</span> <span>there</span> <span>is</span> <span>potential</span> <span>for</span> <span>a</span> <span>particularly</span> <span>difficult</span> <span>class</span> <span>of</span> <span>problems</span> <span>known</span> <span>as</span> <span></span><em><span></span><strong><span>race</span> <span>conditions</span>.<span></span></strong><span></span></em><span></span> <span>The</span> <span>identifying</span> <span>characteristic</span> <span>of</span> <span>race</span> <span>conditions</span> <span>is</span> <span>that</span> <span>the</span> <span>performance</span> <span>varies</span> <span>depending</span> <span>on</span> <span>which</span> <span>process</span> <span>or</span> <span>thread</span> <span>executes</span> <span>their</span> <span>instructions</span> <span>before</span> <span>the</span> <span>other</span> <span>one,</span> <span>and</span> <span>this</span> <span>becomes</span> <span>a</span> <span>problem</span> <span>when</span> <span>the</span> <span>program</span> <span>runs</span> <span>correctly</span> <span>in</span> <span>some</span> <span>instances</span> <span>and</span> <span>incorrectly</span> <span>in</span> <span>others</span>.<span></span> <span>Race</span> <span>conditions</span> <span>are</span> <span>notoriously</span> <span>difficult</span> <span>to</span> <span>debug,</span> <span>because</span> <span>they</span> <span>are</span> <span>unpredictable,</span> <span>unrepeatable,</span> <span>and</span> <span>may</span> <span>not</span> <span>exhibit</span> <span>themselves</span> <span>for</span> <span>years</span>.</p>
    <p><span>Here</span> <span>is</span> <span>an</span> <span>example</span> <span>involving</span> <span>a</span> <span>server</span> <span>and</span> <span>a</span> <span>client</span> <span>communicating</span> <span>via</span> </p>
    <p><span>1</span>.<span></span> <span>First</span> <span>the</span> <span>server</span> <span>writes</span> <span>a</span> <span>greeting</span> <span>message</span> <span>to</span> <span>the</span> <span>client</span> <span>via</span> <span>the</span> </p>
    <pre>     const int BUFFLENGTH = 100;
     char buffer[ BUFFLENGTH ];
     sprintf( buffer, "Hello Client %d!", i );
     write( clientSockets[ i ], buffer, strlen( buffer ) + 1 );</pre>
<p><span>2</span>.<span></span> <span>The</span> <span>client</span> <span>then</span> <span>reads</span> <span>the</span> <span>greeting</span> <span>into</span> <span>its</span> <span>own</span> <span>buffer</span>.<span></span> <span>The</span> <span>client</span> <span>does</span> <span>not</span> <span>know</span> <span>for</span> <span>sure</span> <span>how</span> <span>long</span> <span>the</span> <span>message</span> <span>is,</span> <span>so</span> <span>it</span> <span>allocates</span> <span>a</span> <span>buffer</span> <span>bigger</span> <span>than</span> <span>it</span> <span>needs</span> <span>to</span> <span>be</span>.<span></span> <span>The</span> <span>following</span> <span>will</span> <span>read</span> <span>all</span> <span>available</span> <span>characters</span> <span>in</span> <span>the</span> <span>socket,</span> <span>up</span> <span>to</span> <span>a</span> <span>maximum</span> <span>of</span> <span>BUFFLENGTH</span> </p>
    <pre>     const int BUFFLENGTH = 100;
     char buffer[ BUFFLENGTH ];
     read( mysocket, buffer, BUFFLENGTH );
     cout &lt;&lt; "Client received: " &lt;&lt; buffer &lt;&lt; "\n"; </pre>
    <p><span>3</span>.<span></span> <span>Now</span> <span>the</span> <span>server</span> <span>prepares</span> <span>a</span> <span>packet</span> <span>of</span> <span>work</span> <span>and</span> <span>writes</span> <span>that</span> <span>to</span> <span>the</span> </p>
    <pre>     write( clientSockets[ i ], &amp; wPacket, sizeof( wPacket ) );</pre>
    <p><span>4</span>.<span></span> <span>And</span> <span>finally</span> <span>the</span> <span>client</span> <span>reads</span> <span>in</span> <span>the</span> <span>work</span> <span>packet</span> <span>and</span> <span>processes</span> </p>
    <pre>     read( mysocket, &amp; wPacket, sizeof( wPacket ) );</pre>
    <p><span></span><strong><span>The</span> <span>Problem:</span> <span></span></strong><span>The</span> <span>problem</span> <span>arises</span> <span>if</span> <span>the</span> <span>server</span> <span>executes</span> <span>step</span> <span>3</span> <span>before</span> <span>the</span> <span>client</span> <span>has</span> <span>had</span> <span>a</span> <span>chance</span> <span>to</span> <span>execute</span> <span>step</span> <span>2,</span> <span>which</span> <span>can</span> <span>easily</span> <span>happen</span> <span>depending</span> <span>on</span> <span>process</span> <span>scheduling</span>.<span></span> <span>In</span> <span>this</span> <span>case,</span> <span>when</span> <span>the</span> <span>client</span> <span>finally</span> <span>gets</span> <span>around</span> <span>to</span> <span>executing</span> <span>step</span> <span>2,</span> <span>it</span> <span>will</span> <span>read</span> <span>in</span> <span>not</span> <span>only</span> <span>the</span> <span>original</span> <span>greeting,</span> <span>but</span> <span>also</span> <span>the</span> <span>first</span> <span>part</span> <span>of</span> <span>the</span> <span>work</span> <span>packet</span>.<span></span> <span>And</span> <span>just</span> <span>to</span> <span>make</span> <span>things</span> <span>harder</span> <span>to</span> <span>figure</span> <span>out,</span> <span>the</span> <span>cout</span> <span>&lt;&lt;</span> <span>statement</span> <span>in</span> <span>step</span> <span>2</span> <span>will</span> <span>only</span> <span>print</span> <span>out</span> <span>the</span> <span>greeting</span> <span>message,</span> <span>since</span> <span>there</span> <span>is</span> <span>a</span> <span>null</span> <span>byte</span> <span>at</span> <span>the</span> <span>end</span> <span>of</span> <span>the</span> <span>greeting</span>.<span></span> <span>This</span> <span>actually</span> <span>isn't</span> <span>even</span> <span>a</span> <span>problem</span> <span>at</span> <span>this</span> <span>point,</span> <span>but</span> <span>then</span> <span>later</span> <span>when</span> <span>the</span> <span>client</span> <span>executes</span> <span>step</span> <span>4,</span> <span>it</span> <span>does</span> <span>not</span> <span>accurately</span> <span>read</span> <span>in</span> <span>the</span> <span>work</span> <span>packet</span> <span>because</span> <span>part</span> <span>of</span> <span>it</span> <span>has</span> <span>already</span> <span>been</span> <span>read</span> <span>into</span> <span>the</span> <span>buffer</span> <span>in</span> <span>step</span> <span>2</span>.</p>
    <p><span></span><strong><span>Solution</span> <span>I:</span> <span></span></strong><span>The</span> <span>easiest</span> <span>solution</span> <span>is</span> <span>to</span> <span>have</span> <span>the</span> <span>server</span> <span>write</span> <span>the</span> <span>entire</span> <span>buffer</span> <span>in</span> <span>step</span> <span>1,</span> <span>rather</span> <span>than</span> <span>just</span> <span>the</span> <span>part</span> <span>filled</span> <span>with</span> <span>the</span> <span>greeting,</span> </p>
    <pre>     write( clientSockets[ i ], buffer, BUFFLENGTH );</pre>
    <p><span>Unfortunately</span> <span>this</span> <span>solution</span> <span>has</span> <span>two</span> <span>problems:</span> <span>(1)</span> <span>It</span> <span>wastes</span> <span>bandwidth</span> <span>and</span> <span>time</span> <span>by</span> <span>writing</span> <span>more</span> <span>than</span> <span>is</span> <span>needed,</span> <span>and</span> <span>more</span> <span>importantly,</span> <span>(2)</span> <span>It</span> <span>leaves</span> <span>the</span> <span>code</span> <span>open</span> <span>to</span> <span>future</span> <span>problems</span> <span>if</span> <span>the</span> <span>BUFFLENGTH</span> <span>is</span> <span>not</span> <span>the</span> <span>same</span> <span>in</span> <span>the</span> <span>client</span> <span>and</span> <span>in</span> <span>the</span> <span>server</span>.</p>
    <p><span></span><strong><span>Solution</span> <span>II:</span> <span></span></strong><span>A</span> <span>better</span> <span>approach</span> <span>for</span> <span>handling</span> <span>variable-length</span> <span>strings</span> <span>is</span> <span>to</span> <span>first</span> <span>write</span> <span>the</span> <span>length</span> <span>of</span> <span>the</span> <span>string,</span> <span>followed</span> <span>by</span> <span>the</span> <span>string</span> <span>itself</span> <span>as</span> <span>a</span> <span>separate</span> <span>write</span>.<span></span> <span>Under</span> <span>this</span> <span>solution</span> <span>the</span> <span>server</span> <span>code</span> <span>changes</span> </p>
    <pre>     sprintf( buffer, "Hello Client %d!", i );
     int length = strlen( buffer ) + 1;
     write( clientSockets[ i ], &amp;length, sizeof( int ) );
     write( clientSockets[ i ], buffer, length );</pre>
    <br>
    and the client code changes to:
    <pre>     int length;
     if( read( mysocket, &amp;length, sizeof( int ) ) != sizeof( int ) ) {
          perror( "client read error: " );
          exit( -1 );
     }

     if( length &lt; 1 || length &gt; BUFFLENGTH ) {
          cerr &lt;&lt; "Client read invalid length = " &lt;&lt; length &lt;&lt; endl;
          exit( -1 );
     }

     if( read( mysocket, buffer, length ) != length ) {
     perror( "client read error: " );
     exit( -1 );
     }

     cout &lt;&lt; "Client received: " &lt;&lt; buffer &lt;&lt; "\n";</pre>
    <p><span>Note</span> <span>that</span> <span>the</span> <span>above</span> <span>solution</span> <span>also</span> <span>checks</span> <span>the</span> <span>return</span> <span>value</span> <span>from</span> <span>the</span> <span>read</span> <span>system</span> <span>call,</span> <span>to</span> <span>verify</span> <span>that</span> <span>the</span> <span>number</span> <span>of</span> <span>characters</span> <span>read</span> <span>is</span> <span>equal</span> <span>to</span> <span>the</span> <span>number</span> <span>expected</span>.<span></span> <span>(</span> <span>Some</span> <span>of</span> <span>those</span> <span>checks</span> <span>were</span> <span>actually</span> <span>in</span> <span>the</span> <span>original</span> <span>code,</span> <span>but</span> <span>were</span> <span>omitted</span> <span>from</span> <span>the</span> <span>notes</span> <span>for</span> <span>clarity</span>.<span></span> <span>The</span> <span>real</span> <span>code</span> <span>also</span> <span>uses</span> <span>select(</span> <span>)</span> <span>before</span> <span>reading,</span> <span>to</span> <span>verify</span> <span>that</span> <span>there</span> <span>are</span> <span>characters</span> <span>present</span> <span>to</span> <span>read</span> <span>and</span> <span>to</span> <span>delay</span> <span>if</span> <span>not</span>.<span></span> </p>
    <p><span>Note</span> <span>also</span> <span>that</span> <span>this</span> <span>problem</span> <span>could</span> <span>not</span> <span>be</span> <span>(</span> <span>easily</span> <span>)</span> <span>solved</span> <span>using</span> <span>the</span> <span>synchronization</span> <span>tools</span> <span>covered</span> <span>in</span> <span>chapter</span> <span>6,</span> <span>because</span> <span>the</span> <span>problem</span> <span>is</span> <span>not</span> <span>really</span> <span>one</span> <span>of</span> <span>two</span> <span>processes</span> <span>accessing</span> <span>the</span> <span>same</span> <span>data</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.<span></span><br><span>
</span> <span></span> <span></span> <span></span> </p>
  </blockquote>
</blockquote>
<h3><span>3</span>.<span>7</span> </h3>
<blockquote>
  <blockquote>
    <hr>
  </blockquote>
  <h4><span>OLD</span> <span>3</span>.<span>6</span>.<span>3</span> <span>Remote</span> <span>Method</span> <span>Invocation,</span> <span>RMI</span> <span>(</span> <span>Optional,</span> <span>Removed</span> <span>from</span> <span>8th</span> <span>edition</span> </h4>
  <ul>
    <li><span>RMI</span> <span>is</span> <span>the</span> <span>Java</span> <span>implementation</span> <span>of</span> <span>RPC</span> <span>for</span> <span>contacting</span> <span>processes</span> <span>operating</span> <span>on</span> <span>a</span> <span>different</span> <span>Java</span> <span>Virtual</span> <span>Machine,</span> <span>JVM,</span> <span>which</span> <span>may</span> <span>or</span> <span>may</span> <span>not</span> <span>be</span> <span>running</span> <span>on</span> <span>a</span> <span>different</span> <span>physical</span> <span>machine</span>.<span></span> </li>
    
    <li><span>There</span> <span>are</span> <span>two</span> <span>key</span> <span>differences</span> <span>between</span> <span>RPC</span> <span>and</span> <span>RMI,</span> <span>both</span> <span>based</span> <span>on</span> <span>the</span> <span>object-oriented</span> <span>nature</span> <span>of</span> <span>Java:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>RPC</span> <span>accesses</span> <span>remote</span> <span>procedures</span> <span>or</span> <span>functions,</span> <span>in</span> <span>a</span> <span>procedural-programming</span> <span>paradigm</span>.<span></span> <span>RMI</span> <span>accesses</span> <span>methods</span> <span>within</span> <span>remote</span> <span>Objects</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>data</span> <span>passed</span> <span>by</span> <span>RPC</span> <span>as</span> <span>function</span> <span>parameters</span> <span>are</span> <span>ordinary</span> <span>data</span> <span>only,</span> <span>i</span>.<span>e</span>.<span></span> <span>ints,</span> <span>floats,</span> <span>doubles,</span> <span>etc</span>.<span></span> <span>RMI</span> <span>also</span> <span>supports</span> <span>the</span> <span>passing</span> <span>of</span> <span>Objects</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>RMI</span> <span>is</span> <span>implemented</span> <span>using</span> <span>stubs</span> <span>(</span> <span>on</span> <span>the</span> <span>client</span> <span>side</span> <span>)</span> <span>and</span> <span>skeletons</span> <span>(</span> <span>on</span> <span>the</span> <span>servers</span> <span>side</span> <span>),</span> <span>whose</span> <span>responsibility</span> <span>is</span> <span>to</span> <span>package</span> <span>(</span> <span>marshall</span> <span>)</span> <span>and</span> <span>unpack</span> <span>the</span> <span>parameters</span> <span>and</span> <span>return</span> <span>values</span> <span>being</span> <span>passed</span> <span>back</span> <span>and</span> <span>forth,</span> <span>as</span> <span>illustrated</span> <span>in</span> <span>Figures</span> <span>3</span>.<span>22</span> <span>and</span> <span>3</span>.</li>
    <li><span>See</span> <span>the</span> <span></span><a href="http://java.sun.com/j2se/1.5.0/docs/tooldocs/index.html#rmi"><span>Java</span> <span>online</span> <span>documentation</span></a><span></span> <span>for</span> <span>more</span> <span>details</span> <span>on</span> <span>RMI,</span> <span>including</span> <span>issues</span> <span>with</span> <span>value</span> <span>vs</span>.<span></span> <span>reference</span> <span>parameter</span> <span>passing,</span> <span>and</span> <span>the</span> <span>requirements</span> <span>that</span> <span>certain</span> <span>passed</span> <span>data</span> <span>items</span> <span>be</span> <span></span><em><span>Serializable</span>.<span></span></em></li>
  </ul>
  <div align="center">
    <p><span></span><img src="./Operating Systems_ Processes_files/3_22_RMI.jpg" width="582" height="304"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>Figure</span> <span>omitted</span> <span>in</span> <span>8th</span> <span>edition
</span> <span></span> <span></span> <span></span> </p>
    <p><span></span><img src="./Operating Systems_ Processes_files/3_23_MarshallingParameters.jpg" width="734" height="488"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>Figure</span> <span>omitted</span> <span>in</span> <span>8th</span> <span>edition
</span> <span></span> <span></span> <span></span> </p>
  </div>
</blockquote>
<h4></h4>


</body><script src="./Operating Systems_ Processes_files/jquery.min.js.download"></script><script>function makeSpans(){$("h1, h2, h3, h4, h5, h6, p, li, td, img").each(function(){var s=splitText($(this).html());$(this).empty();for(var a="",h=0;h<s.length;h++)a+=s[h];$(this).html(a)})}function splitText(s){for(var a=[],h="",e=0;e<s.length;e++)if("<"===s.charAt(e)){a.push("<span>"+h+"</span>"),h="<";var i=1;do e++,"<"===s.charAt(e)&&i++,">"===s.charAt(e)&&i--,h+=s.charAt(e);while(i>0);console.log(h),a.push(h),h=""}else" "!=s.charAt(e)&&"."!=s.charAt(e)?h+=s.charAt(e):(console.log(h),a.push("<span>"+h+"</span>"),h="",a.push(""+s.charAt(e)));return a}$(document).ready(function(){makeSpans(),$("BODY").addClass("whiteBG"),$("span").on("click",function(){$(this).hasClass("hideWord")?($(this).removeClass("hideWord hoverOver"),$(this).addClass("hideWord2")):$(this).hasClass("hideWord2")?$(this).removeClass("hideWord2"):$(this).addClass("hideWord")}),$("span").hover(function(){$(this).hasClass("hideWord")&&$(this).addClass("hoverOver")},function(){$(this).removeClass("hoverOver")}),$("img").on("click",function(){$(this).hasClass("imageHide")?($(this).removeClass("imageHide"),$(this).addClass("imageReveal")):$(this).addClass("imageHide")}),$("img").hover(function(){$(this).hasClass("imageHide")&&$(this).addClass("imageReveal")},function(){$(this).removeClass("imageReveal")})});</script></html>