
<!-- saved from url=(0073)https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/4_Threads.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Adobe PageMill 3.0 Win">
  <title>Operating Systems: Threads</title><style type="text/css">
<!--
.style1 {
	font-family: "Courier New", Courier, monospace;
	font-weight: bold;
}
-->
  .hideWord{color:blue;background-color:blue}.hideWord2{color:white;background-color:white}.hoverOver{color:red;opacity:1;background-color:white}.whiteBG{background-color:white!important}.imageHide{opacity:0.02!important}.imageReveal{opacity:1.0!important}.imageReveal:parent{background-color:white!important}.imageHide:parent{background-color:blue!important}</style></head>
<body bgcolor="#ffff80" class="whiteBG">

<h1><span></span><center><span>
</span> <span></span> <span>Threads
</span></center></h1>

<h3></h3>

<ol>
  <li><span>Abraham</span> <span>Silberschatz,</span> <span>Greg</span> <span>Gagne,</span> <span>and</span> <span class="">Peter</span> <span>Baer</span> <span>Galvin,</span> <span>"Operating</span> <span>System</span> <span>Concepts,</span> <span>Ninth</span> <span>Edition</span> <span>",</span> <span>Chapter</span> </li></ol>

<h3><span>4</span>.<span>1</span> </h3>
<ul>
  <li><span>A</span> <span></span><em><span></span><strong><span>thread</span></strong><span></span></em><span></span> <span>is</span> <span>a</span> <span>basic</span> <span>unit</span> <span>of</span> <span>CPU</span> <span>utilization,</span> <span>consisting</span> <span>of</span> <span>a</span> <span>program</span> <span>counter,</span> <span>a</span> <span>stack,</span> <span>and</span> <span>a</span> <span>set</span> <span>of</span> <span>registers,</span> <span>(</span> <span>and</span> <span>a</span> <span>thread</span> <span>ID</span>.<span></span> <span>)</span> </li>
  <li><span>Traditional</span> <span>(</span> <span>heavyweight</span> <span>)</span> <span>processes</span> <span>have</span> <span>a</span> <span>single</span> <span>thread</span> <span>of</span> <span>control</span> <span>-</span> <span>There</span> <span>is</span> <span>one</span> <span>program</span> <span>counter,</span> <span>and</span> <span>one</span> <span>sequence</span> <span>of</span> <span>instructions</span> <span>that</span> <span>can</span> <span>be</span> <span>carried</span> <span>out</span> <span>at</span> <span>any</span> <span>given</span> <span>time</span>.</li>
  <li><span>As</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>4</span>.<span>1,</span> <span>multi-threaded</span> <span>applications</span> <span>have</span> <span>multiple</span> <span>threads</span> <span>within</span> <span>a</span> <span>single</span> <span>process,</span> <span>each</span> <span>having</span> <span>their</span> <span>own</span> <span>program</span> <span>counter,</span> <span>stack</span> <span>and</span> <span>set</span> <span>of</span> <span>registers,</span> <span>but</span> <span>sharing</span> <span>common</span> <span>code,</span> <span>data,</span> <span>and</span> <span>certain</span> <span>structures</span> <span class="hideWord">such</span> <span>as</span> <span>open</span> <span>files</span>.<span></span> </li>
</ul>
<p align="center"><span></span><img src="./2_Threads_files/4_01_ThreadDiagram.jpg" width="704" height="406"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>1</span> <span>-</span> <span>Single-threaded</span> <span>and</span> <span>multithreaded</span> <span>processes</span></strong></p>
<blockquote>
  <h4><span>4</span>.<span>1</span>.<span>1</span> </h4>
  <ul>
    <li><span>Threads</span> <span>are</span> <span>very</span> <span>useful</span> <span>in</span> <span>modern</span> <span>programming</span> <span>whenever</span> <span>a</span> <span>process</span> <span>has</span> <span>multiple</span> <span>tasks</span> <span>to</span> <span>perform</span> <span>independently</span> <span>of</span> <span>the</span> <span>others</span>.</li>
    <li><span>This</span> <span>is</span> <span>particularly</span> <span>true</span> <span>when</span> <span>one</span> <span>of</span> <span>the</span> <span>tasks</span> <span>may</span> <span>block,</span> <span>and</span> <span>it</span> <span>is</span> <span>desired</span> <span>to</span> <span>allow</span> <span>the</span> <span>other</span> <span>tasks</span> <span>to</span> <span>proceed</span> <span>without</span> <span>blocking</span>.</li>
    <li><span>For</span> <span>example</span> <span>in</span> <span>a</span> <span>word</span> <span>processor,</span> <span>a</span> <span>background</span> <span>thread</span> <span>may</span> <span>check</span> <span>spelling</span> <span>and</span> <span>grammar</span> <span>while</span> <span>a</span> <span>foreground</span> <span>thread</span> <span>processes</span> <span>user</span> <span>input</span> <span>(</span> <span>keystrokes</span> <span>),</span> <span>while</span> <span>yet</span> <span>a</span> <span>third</span> <span></span> <span></span> <span>thread</span> <span>loads</span> <span>images</span> <span>from</span> <span>the</span> <span>hard</span> <span>drive,</span> <span>and</span> <span>a</span> <span>fourth</span> <span>does</span> <span>periodic</span> <span>automatic</span> <span>backups</span> <span>of</span> <span>the</span> <span>file</span> <span>being</span> <span>edited</span>.</li>
    <li><span>Another</span> <span>example</span> <span>is</span> <span>a</span> <span>web</span> <span>server</span> <span>-</span> <span>Multiple</span> <span>threads</span> <span>allow</span> <span>for</span> <span>multiple</span> <span>requests</span> <span>to</span> <span>be</span> <span>satisfied</span> <span>simultaneously,</span> <span>without</span> <span>having</span> <span>to</span> <span>service</span> <span>requests</span> <span>sequentially</span> <span>or</span> <span>to</span> <span>fork</span> <span>off</span> <span>separate</span> <span>processes</span> <span>for</span> <span>every</span> <span>incoming</span> <span>request</span>.<span></span> <span>(</span> <span>The</span> <span>latter</span> <span>is</span> <span>how</span> <span>this</span> <span>sort</span> <span>of</span> <span>thing</span> <span>was</span> <span>done</span> <span>before</span> <span>the</span> <span>concept</span> <span>of</span> <span>threads</span> <span>was</span> <span>developed</span>.<span></span> <span>A</span> <span>daemon</span> <span>would</span> <span>listen</span> <span>at</span> <span>a</span> <span>port,</span> <span>fork</span> <span>off</span> <span>a</span> <span>child</span> <span>for</span> <span>every</span> <span>incoming</span> <span>request</span> <span>to</span> <span>be</span> <span>processed,</span> <span>and</span> <span>then</span> <span>go</span> <span>back</span> <span>to</span> <span>listening</span> <span>to</span> <span>the</span> <span>port</span>.<span></span> <span>)</span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_02_MultithreadedArchitecture.jpg" width="632" height="227"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>2</span> <span>-</span> <span>Multithreaded</span> <span>server</span> <span>architecture</span></strong><span>
</span> <span></span> </p>
  <h4><span>4</span>.<span>1</span>.<span>2</span> </h4>
  <ul>
    <li><span>There</span> <span>are</span> <span>four</span> <span>major</span> <span>categories</span> <span>of</span> <span>benefits</span> <span>to</span> <span>multi-threading:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Responsiveness</span> <span>-</span> <span>One</span> <span>thread</span> <span>may</span> <span>provide</span> <span>rapid</span> <span>response</span> <span>while</span> <span>other</span> <span>threads</span> <span>are</span> <span>blocked</span> <span>or</span> <span>slowed</span> <span>down</span> <span>doing</span> <span>intensive</span> <span>calculations</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Resource</span> <span>sharing</span> <span>-</span> <span>By</span> <span>default</span> <span>threads</span> <span>share</span> <span>common</span> <span>code,</span> <span>data,</span> <span>and</span> <span>other</span> <span>resources,</span> <span>which</span> <span>allows</span> <span>multiple</span> <span>tasks</span> <span>to</span> <span>be</span> <span>performed</span> <span>simultaneously</span> <span>in</span> <span>a</span> <span>single</span> <span>address</span> <span>space</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Economy</span> <span>-</span> <span>Creating</span> <span>and</span> <span>managing</span> <span>threads</span> <span>(</span> <span>and</span> <span>context</span> <span>switches</span> <span>between</span> <span>them</span> <span>)</span> <span>is</span> <span>much</span> <span>faster</span> <span>than</span> <span>performing</span> <span>the</span> <span>same</span> <span>tasks</span> <span>for</span> <span>processes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Scalability,</span> <span>i</span>.<span>e</span>.<span></span> <span>Utilization</span> <span>of</span> <span>multiprocessor</span> <span>architectures</span> <span>-</span> <span>A</span> <span>single</span> <span>threaded</span> <span>process</span> <span>can</span> <span>only</span> <span>run</span> <span>on</span> <span>one</span> <span>CPU,</span> <span>no</span> <span>matter</span> <span>how</span> <span>many</span> <span>may</span> <span>be</span> <span>available,</span> <span>whereas</span> <span>the</span> <span>execution</span> <span>of</span> <span>a</span> <span>multi-threaded</span> <span>application</span> <span>may</span> <span>be</span> <span>split</span> <span>amongst</span> <span>available</span> <span>processors</span>.<span></span> <span>(</span> <span>Note</span> <span>that</span> <span>single</span> <span>threaded</span> <span>processes</span> <span>can</span> <span>still</span> <span>benefit</span> <span>from</span> <span>multi-processor</span> <span>architectures</span> <span>when</span> <span>there</span> <span>are</span> <span>multiple</span> <span>processes</span> <span>contending</span> <span>for</span> <span>the</span> <span>CPU,</span> <span>i</span>.<span>e</span>.<span></span> <span>when</span> <span>the</span> <span>load</span> <span>average</span> <span>is</span> <span>above</span> <span>some</span> <span>certain</span> <span>threshold</span>.<span></span> <span>)</span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
</blockquote>
<h3><span>4</span>.<span>2</span> <span>Multicore</span> <span>Programming</span> </h3>
<ul>
  <li><span>A</span> <span>recent</span> <span>trend</span> <span>in</span> <span>computer</span> <span>architecture</span> <span>is</span> <span>to</span> <span>produce</span> <span>chips</span> <span>with</span> <span>multiple</span> <span></span><em><span></span><strong><span>cores</span></strong><span></span></em><span>,</span> <span>or</span> <span>CPUs</span> <span>on</span> <span>a</span> <span>single</span> <span>chip</span>.</li>
  <li><span>A</span> <span>multi-threaded</span> <span>application</span> <span>running</span> <span>on</span> <span>a</span> <span>traditional</span> <span>single-core</span> <span>chip</span> <span>would</span> <span>have</span> <span>to</span> <span>interleave</span> <span>the</span> <span>threads,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>4</span>.<span>3</span>.<span></span> <span>On</span> <span>a</span> <span>multi-core</span> <span>chip,</span> <span>however,</span> <span>the</span> <span>threads</span> <span>could</span> <span>be</span> <span>spread</span> <span>across</span> <span>the</span> <span>available</span> <span>cores,</span> <span>allowing</span> <span>true</span> <span>parallel</span> <span>processing,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>4</span>.<span>4</span>.</li>
</ul>
<p align="center"><span></span><img src="./2_Threads_files/4_03_ConcurrentSingleCore.jpg" width="825" height="93"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>3</span> <span>-</span> <span>Concurrent</span> <span>execution</span> <span>on</span> <span>a</span> <span>single-core</span> <span>system</span>.<span></span></strong></p>
<p align="center"><span></span><img src="./2_Threads_files/4_04_ParralelMulticore.jpg" width="500" height="174"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>4</span> <span>-</span> <span>Parallel</span> <span>execution</span> <span>on</span> <span>a</span> <span>multicore</span> <span>system</span></strong></p>
<ul>
  <li><span>For</span> <span>operating</span> <span>systems,</span> <span>multi-core</span> <span>chips</span> <span>require</span> <span>new</span> <span>scheduling</span> <span>algorithms</span> <span>to</span> <span>make</span> <span>better</span> <span>use</span> <span>of</span> <span>the</span> <span>multiple</span> <span>cores</span> <span>available</span>.</li>
  <li><span>As</span> <span>multi-threading</span> <span>becomes</span> <span>more</span> <span>pervasive</span> <span>and</span> <span>more</span> <span>important</span> <span>(</span> <span>thousands</span> <span>instead</span> <span>of</span> <span>tens</span> <span>of</span> <span>threads</span> <span>),</span> <span>CPUs</span> <span>have</span> <span>been</span> <span>developed</span> <span>to</span> <span>support</span> <span>more</span> <span>simultaneous</span> <span>threads</span> <span>per</span> <span>core</span> <span>in</span> <span>hardware</span>.</li>
</ul>
<blockquote>
  <h4><span>4</span>.<span>2</span>.<span>1</span> <span>Programming</span> <span>Challenges</span> <span>(</span> <span>New</span> <span>section,</span> <span>same</span> <span>content</span> <span>?</span> </h4>
  <ul>
    <li><span>For</span> <span>application</span> <span>programmers,</span> <span>there</span> <span>are</span> <span>five</span> <span>areas</span> <span>where</span> <span>multi-core</span> <span>chips</span> <span>present</span> <span>new</span> <span>challenges:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Identifying</span> <span>tasks</span></strong><span></span> <span>-</span> <span>Examining</span> <span>applications</span> <span>to</span> <span>find</span> <span>activities</span> <span>that</span> <span>can</span> <span>be</span> <span>performed</span> <span>concurrently</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Balance</span></strong><span></span> <span>-</span> <span>Finding</span> <span>tasks</span> <span>to</span> <span>run</span> <span>concurrently</span> <span>that</span> <span>provide</span> <span>equal</span> <span>value</span>.<span></span> <span>I</span>.<span>e</span>.<span></span> <span>don't</span> <span>waste</span> <span>a</span> <span>thread</span> <span>on</span> <span>trivial</span> <span>tasks</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Data</span> <span>splitting</span></strong><span></span> <span>-</span> <span>To</span> <span>prevent</span> <span>the</span> <span>threads</span> <span>from</span> <span>interfering</span> <span>with</span> <span>one</span> <span>another</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Data</span> <span>dependency</span></strong><span></span> <span>-</span> <span>If</span> <span>one</span> <span>task</span> <span>is</span> <span>dependent</span> <span>upon</span> <span>the</span> <span>results</span> <span>of</span> <span>another,</span> <span>then</span> <span>the</span> <span>tasks</span> <span>need</span> <span>to</span> <span>be</span> <span>synchronized</span> <span>to</span> <span>assure</span> <span>access</span> <span>in</span> <span>the</span> <span>proper</span> <span>order</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Testing</span> <span>and</span> <span>debugging</span></strong><span></span> <span>-</span> <span>Inherently</span> <span>more</span> <span>difficult</span> <span>in</span> <span>parallel</span> <span>processing</span> <span>situations,</span> <span>as</span> <span>the</span> <span>race</span> <span>conditions</span> <span>become</span> <span>much</span> <span>more</span> <span>complex</span> <span>and</span> <span>difficult</span> <span>to</span> <span>identify</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
<h4><span>4</span>.<span>2</span>.<span>2</span> <span>Types</span> <span>of</span> <span>Parallelism</span> <span>(</span> <span>new</span> </h4>
<blockquote>
  <p><span>In</span> <span>theory</span> <span>there</span> <span>are</span> <span>two</span> <span>different</span> <span>ways</span> <span>to</span> <span>parallelize</span> <span>the</span> </p>
  <ol>
    <li><span></span><strong><span>Data</span> <span>parallelism</span></strong><span></span> <span>divides</span> <span>the</span> <span>data</span> <span>up</span> <span>amongst</span> <span>multiple</span> <span>cores</span> <span>(</span> <span>threads</span> <span>),</span> <span>and</span> <span>performs</span> <span>the</span> <span>same</span> <span>task</span> <span>on</span> <span>each</span> <span>subset</span> <span>of</span> <span>the</span> <span>data</span>.<span></span> <span>For</span> <span>example</span> <span>dividing</span> <span>a</span> <span>large</span> <span>image</span> <span>up</span> <span>into</span> <span>pieces</span> <span>and</span> <span>performing</span> <span>the</span> <span>same</span> <span>digital</span> <span>image</span> <span>processing</span> <span>on</span> <span>each</span> <span>piece</span> <span>on</span> <span>different</span> <span>cores</span>.</li>
    <li><span></span><strong><span>Task</span> <span>parallelism</span></strong><span></span> <span>divides</span> <span>the</span> <span>different</span> <span>tasks</span> <span>to</span> <span>be</span> <span>performed</span> <span>among</span> <span>the</span> <span>different</span> <span>cores</span> <span>and</span> <span>performs</span> <span>them</span> <span>simultaneously</span>.</li>
  </ol>
  <p><span>In</span> <span>practice</span> <span>no</span> <span>program</span> <span>is</span> <span>ever</span> <span>divided</span> <span>up</span> <span>solely</span> <span>by</span> <span>one</span> <span>or</span> <span>the</span> <span>other</span> <span>of</span> <span>these,</span> <span>but</span> <span>instead</span> <span>by</span> <span>some</span> <span>sort</span> <span>of</span> <span>hybrid</span> <span>combination</span>.</p>
</blockquote>
</blockquote>
<h3><span>4</span>.<span>3</span> <span>Multithreading</span> <span>Models</span> </h3>
<ul>
  <li><span>There</span> <span>are</span> <span>two</span> <span>types</span> <span>of</span> <span>threads</span> <span>to</span> <span>be</span> <span>managed</span> <span>in</span> <span>a</span> <span>modern</span> <span>system:</span> <span>User</span> <span>threads</span> <span>and</span> <span>kernel</span> <span>threads</span>.</li>
  <li><span>User</span> <span>threads</span> <span>are</span> <span>supported</span> <span>above</span> <span>the</span> <span>kernel,</span> <span>without</span> <span>kernel</span> <span>support</span>.<span></span> <span>These</span> <span>are</span> <span>the</span> <span>threads</span> <span>that</span> <span></span> <span>application</span> <span>programmers</span> <span>would</span> <span>put</span> <span>into</span> <span>their</span> <span>programs</span>.<span></span> </li>
  <li><span>Kernel</span> <span>threads</span> <span>are</span> <span>supported</span> <span>within</span> <span>the</span> <span>kernel</span> <span>of</span> <span>the</span> <span>OS</span> <span>itself</span>.<span></span> <span>All</span> <span>modern</span> <span>OSes</span> <span>support</span> <span>kernel</span> <span>level</span> <span>threads,</span> <span>allowing</span> <span>the</span> <span>kernel</span> <span>to</span> <span>perform</span> <span>multiple</span> <span>simultaneous</span> <span>tasks</span> <span>and/or</span> <span>to</span> <span>service</span> <span>multiple</span> <span>kernel</span> <span>system</span> <span>calls</span> <span>simultaneously</span>.</li>
  <li><span>In</span> <span>a</span> <span>specific</span> <span>implementation,</span> <span>the</span> <span>user</span> <span>threads</span> <span>must</span> <span>be</span> <span>mapped</span> <span>to</span> <span>kernel</span> <span>threads,</span> <span>using</span> <span>one</span> <span>of</span> <span>the</span> <span>following</span> <span>strategies</span>.<span></span> <span></span> <span></span> <span></span> </li>
</ul>
<blockquote>
  <h4><span>4</span>.<span>3</span>.<span>1</span> <span>Many-To-One</span> </h4>
  <ul>
    <li><span>In</span> <span>the</span> <span>many-to-one</span> <span>model,</span> <span>many</span> <span>user-level</span> <span>threads</span> <span>are</span> <span>all</span> <span>mapped</span> <span>onto</span> <span>a</span> <span>single</span> <span>kernel</span> <span>thread</span>.</li>
    <li><span>Thread</span> <span>management</span> <span>is</span> <span>handled</span> <span>by</span> <span>the</span> <span>thread</span> <span>library</span> <span>in</span> <span>user</span> <span>space,</span> <span>which</span> <span>is</span> <span>very</span> <span>efficient</span>.</li>
    <li><span>However,</span> <span>if</span> <span>a</span> <span>blocking</span> <span>system</span> <span>call</span> <span>is</span> <span>made,</span> <span>then</span> <span>the</span> <span>entire</span> <span>process</span> <span>blocks,</span> <span>even</span> <span>if</span> <span>the</span> <span>other</span> <span>user</span> <span>threads</span> <span>would</span> <span>otherwise</span> <span>be</span> <span>able</span> <span>to</span> <span>continue</span>.<span></span> <span></span> <span></span> </li>
    <li><span>Because</span> <span>a</span> <span>single</span> <span>kernel</span> <span>thread</span> <span>can</span> <span>operate</span> <span>only</span> <span>on</span> <span>a</span> <span>single</span> <span>CPU,</span> <span>the</span> <span>many-to-one</span> <span>model</span> <span>does</span> <span>not</span> <span>allow</span> <span>individual</span> <span>processes</span> <span>to</span> <span>be</span> <span>split</span> <span>across</span> <span>multiple</span> <span>CPUs</span>.<span></span> </li>
    <li><span>Green</span> <span>threads</span> <span>for</span> <span>Solaris</span> <span>and</span> <span>GNU</span> <span>Portable</span> <span>Threads</span> <span>implement</span> <span>the</span> <span>many-to-one</span> <span>model</span> <span>in</span> <span>the</span> <span>past,</span> <span>but</span> <span>few</span> <span>systems</span> <span>continue</span> <span>to</span> <span>do</span> <span>so</span> <span>today</span>.</li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_05_ManyToOne.jpg" width="403" height="398"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>5</span> <span>-</span> <span>Many-to-one</span> <span>model</span></strong></p>
  <h4><span>4</span>.<span>3</span>.<span>2</span> <span>One-To-One</span> </h4>
  <ul>
    <li><span>The</span> <span>one-to-one</span> <span>model</span> <span>creates</span> <span>a</span> <span>separate</span> <span>kernel</span> <span>thread</span> <span>to</span> <span>handle</span> <span>each</span> <span>user</span> <span>thread</span>.</li>
    <li><span>One-to-one</span> <span>model</span> <span>overcomes</span> <span>the</span> <span>problems</span> <span>listed</span> <span>above</span> <span>involving</span> <span>blocking</span> <span>system</span> <span>calls</span> <span>and</span> <span>the</span> <span>splitting</span> <span>of</span> <span>processes</span> <span>across</span> <span>multiple</span> <span>CPUs</span>.</li>
    <li><span>However</span> <span>the</span> <span>overhead</span> <span>of</span> <span>managing</span> <span>the</span> <span>one-to-one</span> <span></span> <span></span> <span>model</span> <span>is</span> <span>more</span> <span>significant,</span> <span>involving</span> <span>more</span> <span>overhead</span> <span>and</span> <span>slowing</span> <span>down</span> <span>the</span> <span>system</span>.</li>
    <li><span>Most</span> <span>implementations</span> <span>of</span> <span>this</span> <span>model</span> <span>place</span> <span>a</span> <span>limit</span> <span>on</span> <span>how</span> <span>many</span> <span>threads</span> <span>can</span> <span>be</span> <span>created</span>.</li>
    <li><span>Linux</span> <span>and</span> <span>Windows</span> <span>from</span> <span>95</span> <span>to</span> <span>XP</span> <span>implement</span> <span>the</span> <span>one-to-one</span> <span>model</span> <span>for</span> <span>threads</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_06_OneToOne.jpg" width="494" height="187"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>6</span> <span>-</span> <span>One-to-one</span> <span>model</span></strong></p>
  <h4><span>4</span>.<span>3</span>.<span>3</span> <span>Many-To-Many</span> </h4>
  <ul>
    <li><span>The</span> <span>many-to-many</span> <span>model</span> <span>multiplexes</span> <span>any</span> <span>number</span> <span>of</span> <span>user</span> <span>threads</span> <span>onto</span> <span>an</span> <span>equal</span> <span>or</span> <span>smaller</span> <span>number</span> <span>of</span> <span>kernel</span> <span>threads,</span> <span>combining</span> <span>the</span> <span>best</span> <span>features</span> <span>of</span> <span>the</span> <span>one-to-one</span> <span>and</span> <span>many-to-one</span> <span>models</span>.</li>
    <li><span>Users</span> <span>have</span> <span>no</span> <span>restrictions</span> <span>on</span> <span>the</span> <span>number</span> <span>of</span> <span>threads</span> <span>created</span>.</li>
    <li><span>Blocking</span> <span>kernel</span> <span>system</span> <span>calls</span> <span>do</span> <span>not</span> <span>block</span> <span>the</span> <span>entire</span> <span>process</span>.</li>
    <li><span>Processes</span> <span>can</span> <span>be</span> <span>split</span> <span>across</span> <span>multiple</span> <span>processors</span>.</li>
    <li><span>Individual</span> <span>processes</span> <span>may</span> <span>be</span> <span>allocated</span> <span>variable</span> <span>numbers</span> <span>of</span> <span>kernel</span> <span>threads,</span> <span>depending</span> <span>on</span> <span>the</span> <span>number</span> <span>of</span> <span>CPUs</span> <span>present</span> <span>and</span> <span>other</span> <span>factors</span>.<span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_07_ManyToMany.jpg" width="469" height="399"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>7</span> <span>-</span> <span>Many-to-many</span> <span>model</span></strong></p>
  <ul>
    <li><span>One</span> <span>popular</span> <span>variation</span> <span>of</span> <span>the</span> <span>many-to-many</span> <span>model</span> <span>is</span> <span>the</span> <span>two-tier</span> <span>model,</span> <span>which</span> <span>allows</span> <span>either</span> <span>many-to-many</span> <span>or</span> <span>one-to-one</span> <span>operation</span>.</li>
    <li><span>IRIX,</span> <span>HP-UX,</span> <span>and</span> <span>Tru64</span> <span>UNIX</span> <span>use</span> <span>the</span> <span>two-tier</span> <span>model,</span> <span>as</span> <span>did</span> <span>Solaris</span> <span>prior</span> <span>to</span> <span>Solaris</span> <span>9</span>.<span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_08_TwoLevel.jpg" width="597" height="401"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>8</span> <span>-</span> <span>Two-level</span> <span>model</span></strong></p>
</blockquote>
<h3><span>4</span>.<span>4</span> <span>Thread</span> <span>Libraries</span> </h3>
<ul>
  <li><span>Thread</span> <span>libraries</span> <span>provide</span> <span>programmers</span> <span>with</span> <span>an</span> <span>API</span> <span>for</span> <span>creating</span> <span>and</span> <span>managing</span> <span>threads</span>.</li>
  <li><span>Thread</span> <span>libraries</span> <span>may</span> <span>be</span> <span>implemented</span> <span>either</span> <span>in</span> <span>user</span> <span>space</span> <span>or</span> <span>in</span> <span>kernel</span> <span>space</span>.<span></span> <span>The</span> <span>former</span> <span>involves</span> <span>API</span> <span>functions</span> <span>implemented</span> <span>solely</span> <span>within</span> <span>user</span> <span>space,</span> <span>with</span> <span>no</span> <span>kernel</span> <span>support</span>.<span></span> <span>The</span> <span>latter</span> <span>involves</span> <span>system</span> <span>calls,</span> <span>and</span> <span>requires</span> <span>a</span> <span>kernel</span> <span>with</span> <span>thread</span> <span>library</span> <span>support</span>.</li>
  <li><span>There</span> <span>are</span> <span>three</span> <span>main</span> <span>thread</span> <span>libraries</span> <span>in</span> <span>use</span> <span>today:
</span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>POSIX</span> <span>Pthreads</span> <span>-</span> <span>may</span> <span>be</span> <span>provided</span> <span>as</span> <span>either</span> <span>a</span> <span>user</span> <span>or</span> <span>kernel</span> <span>library,</span> <span>as</span> <span>an</span> <span>extension</span> <span>to</span> <span>the</span> <span>POSIX</span> <span>standard</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Win32</span> <span>threads</span> <span>-</span> <span>provided</span> <span>as</span> <span>a</span> <span>kernel-level</span> <span>library</span> <span>on</span> <span>Windows</span> <span>systems</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Java</span> <span>threads</span> <span></span> <span></span> <span></span> <span></span> <span>-</span> <span>Since</span> <span>Java</span> <span>generally</span> <span>runs</span> <span>on</span> <span>a</span> <span>Java</span> <span>Virtual</span> <span>Machine,</span> <span>the</span> <span>implementation</span> <span>of</span> <span>threads</span> <span>is</span> <span>based</span> <span>upon</span> <span>whatever</span> <span>OS</span> <span>and</span> <span>hardware</span> <span>the</span> <span>JVM</span> <span>is</span> <span>running</span> <span>on,</span> <span>i</span>.<span>e</span>.<span></span> <span>either</span> <span>Pthreads</span> <span>or</span> <span>Win32</span> <span>threads</span> <span>depending</span> <span>on</span> <span>the</span> <span>system</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> </li>
  <li><span>The</span> <span>following</span> <span>sections</span> <span>will</span> <span>demonstrate</span> <span>the</span> <span>use</span> <span>of</span> <span>threads</span> <span>in</span> <span>all</span> <span>three</span> <span>systems</span> <span>for</span> <span>calculating</span> <span>the</span> <span>sum</span> <span>of</span> <span>integers</span> <span>from</span> <span>0</span> <span>to</span> <span>N</span> <span>in</span> <span>a</span> <span>separate</span> <span>thread,</span> <span>and</span> <span>storing</span> <span>the</span> <span>result</span> <span>in</span> <span>a</span> <span>variable</span> <span>"sum"</span>.<span></span> <span></span> </li>
</ul>
<blockquote>
  <h4><span>4</span>.<span>4</span>.<span>1</span> </h4>
  <ul>
    <li><span>The</span> <span>POSIX</span> <span>standard</span> <span>(</span> <span>IEEE</span> <span>1003</span>.<span>1c</span> <span>)</span> <span>defines</span> <span>the</span> <span></span><em><span>specification</span></em><span></span> <span>for</span> <span>pThreads,</span> <span>not</span> <span>the</span> <span></span><em><span>implementation</span></em><span></span>.</li>
    <li><span>pThreads</span> <span>are</span> <span>available</span> <span>on</span> <span>Solaris,</span> <span>Linux,</span> <span>Mac</span> <span>OSX,</span> <span>Tru64,</span> <span>and</span> <span>via</span> <span>public</span> <span>domain</span> <span>shareware</span> <span>for</span> <span>Windows</span>.</li>
    <li><span>Global</span> <span>variables</span> <span>are</span> <span>shared</span> <span>amongst</span> <span>all</span> <span>threads</span>.</li>
    <li><span>One</span> <span>thread</span> <span>can</span> <span>wait</span> <span>for</span> <span>the</span> <span>others</span> <span>to</span> <span>rejoin</span> <span>before</span> <span>continuing</span>.<span></span> <span></span> </li>
    <li><span>pThreads</span> <span>begin</span> <span>execution</span> <span>in</span> <span>a</span> <span>specified</span> <span>function,</span> <span>in</span> <span>this</span> <span>example</span> <span>the</span> <span>runner(</span> <span>)</span> <span>function:</span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_09_PThreadsAPI.jpg" width="724" height="1113"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>9</span></strong></p>
  <p align="center"><span></span><img src="./2_Threads_files/4_10_JoiningPThreads.jpg" width="560" height="254"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>New</span></strong><span>
</span> <span></span> </p>
  <h4><span>4</span>.<span>4</span>.<span>2</span> <span>Windows</span> </h4>
  <ul>
    <li><span>Similar</span> <span>to</span> <span>pThreads</span>.<span></span> <span>Examine</span> <span>the</span> <span>code</span> <span>example</span> <span>to</span> <span>see</span> <span>the</span> <span>differences,</span> <span>which</span> <span>are</span> <span>mostly</span> <span>syntactic</span> <span>&amp;</span> <span>nomenclature:</span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_10_Win32API.jpg" width="764" height="1290"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>11</span> <span></span></strong></p>
  <h4><span>4</span>.<span>4</span>.<span>3</span> <span>Java</span> </h4>
  <ul>
    <li><span>ALL</span> <span>Java</span> <span>programs</span> <span>use</span> <span>Threads</span> <span>-</span> <span>even</span> <span>"common"</span> <span>single-threaded</span> <span>ones</span>.<span></span> </li>
    <li><span>The</span> <span>creation</span> <span>of</span> <span>new</span> <span>Threads</span> <span>requires</span> <span>Objects</span> <span>that</span> <span>implement</span> <span>the</span> <span>Runnable</span> <span>Interface,</span> <span>which</span> <span>means</span> <span>they</span> <span>contain</span> <span>a</span> <span>method</span> <span>"public</span> <span>void</span> <span>run(</span> <span>)"</span> <span></span>.<span></span> <span>Any</span> <span>descendant</span> <span>of</span> <span>the</span> <span>Thread</span> <span>class</span> <span>will</span> <span>naturally</span> <span>contain</span> <span>such</span> <span>a</span> <span>method</span>.<span></span> <span>(</span> <span>In</span> <span>practice</span> <span>the</span> <span>run(</span> <span>)</span> <span>method</span> <span>must</span> <span>be</span> <span>overridden</span> <span>/</span> <span>provided</span> <span>for</span> <span>the</span> <span>thread</span> <span>to</span> <span>have</span> <span>any</span> <span>practical</span> <span>functionality</span>.<span></span> </li>
    <li><span>Creating</span> <span>a</span> <span>Thread</span> <span>Object</span> <span>does</span> <span>not</span> <span>start</span> <span>the</span> <span>thread</span> <span>running</span> <span>-</span> <span>To</span> <span>do</span> <span>that</span> <span>the</span> <span>program</span> <span>must</span> <span>call</span> <span>the</span> <span>Thread's</span> <span>"start(</span> <span>)"</span> <span>method</span>.<span></span> <span>Start(</span> <span>)</span> <span>allocates</span> <span>and</span> <span>initializes</span> <span>memory</span> <span>for</span> <span>the</span> <span>Thread,</span> <span>and</span> <span>then</span> <span>calls</span> <span>the</span> <span>run(</span> <span>)</span> <span>method</span>.<span></span> <span>(</span> <span>Programmers</span> <span>do</span> <span>not</span> <span>call</span> <span>run(</span> <span>)</span> <span>directly</span>.<span></span> </li>
    <li><span>Because</span> <span>Java</span> <span>does</span> <span>not</span> <span>support</span> <span>global</span> <span>variables,</span> <span>Threads</span> <span>must</span> <span>be</span> <span>passed</span> <span>a</span> <span>reference</span> <span>to</span> <span>a</span> <span>shared</span> <span>Object</span> <span>in</span> <span>order</span> <span>to</span> <span>share</span> <span>data,</span> <span>in</span> <span>this</span> <span>example</span> <span>the</span> <span>"Sum"</span> <span>Object</span>.</li>
    <li><span>Note</span> <span>that</span> <span>the</span> <span>JVM</span> <span>runs</span> <span>on</span> <span>top</span> <span>of</span> <span>a</span> <span>native</span> <span>OS,</span> <span>and</span> <span>that</span> <span>the</span> <span>JVM</span> <span>specification</span> <span>does</span> <span>not</span> <span>specify</span> <span>what</span> <span>model</span> <span>to</span> <span>use</span> <span>for</span> <span>mapping</span> <span>Java</span> <span>threads</span> <span>to</span> <span>kernel</span> <span>threads</span>.<span></span> <span>This</span> <span>decision</span> <span>is</span> <span>JVM</span> <span>implementation</span> <span>dependant,</span> <span>and</span> <span>may</span> <span>be</span> <span>one-to-one,</span> <span>many-to-many,</span> <span>or</span> <span>many</span> <span>to</span> <span>one</span>.<span></span>.<span></span> <span>(</span> <span>On</span> <span>a</span> <span>UNIX</span> <span>system</span> <span>the</span> <span>JVM</span> <span>normally</span> <span>uses</span> <span>PThreads</span> <span>and</span> <span>on</span> <span>a</span> <span>Windows</span> <span>system</span> <span>it</span> <span>normally</span> <span>uses</span> <span>windows</span> <span>threads</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_11_JavaThreads.jpg" width="784" height="1304"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>12</span></strong><span>
</span> <span></span> </p>
</blockquote>
<h3><span>4</span>.<span>5</span> <span>Implicit</span> <span>Threading</span> <span>(</span> <span>Optional</span> </h3>
<blockquote>
  <p><span>Shifts</span> <span>the</span> <span>burden</span> <span>of</span> <span>addressing</span> <span>the</span> <span>programming</span> <span>challenges</span> <span>outlined</span> <span>in</span> <span>section</span> <span>4</span>.<span>2</span>.<span>1</span> <span>above</span> <span>from</span> <span>the</span> <span>application</span> <span>programmer</span> <span>to</span> <span>the</span> <span>compiler</span> <span>and</span> <span>run-time</span> <span>libraries</span>.</p>
  <h4><span>4</span>.<span>5</span>.<span>1</span> <span>Thread</span> <span>Pools</span> </h4>
  <ul>
    <li><span>Creating</span> <span>new</span> <span>threads</span> <span>every</span> <span>time</span> <span>one</span> <span>is</span> <span>needed</span> <span>and</span> <span>then</span> <span>deleting</span> <span>it</span> <span>when</span> <span>it</span> <span>is</span> <span>done</span> <span>can</span> <span>be</span> <span>inefficient,</span> <span>and</span> <span>can</span> <span>also</span> <span>lead</span> <span>to</span> <span>a</span> <span>very</span> <span>large</span> <span>(</span> <span>unlimited</span> <span>)</span> <span>number</span> <span>of</span> <span>threads</span> <span>being</span> <span>created</span>.</li>
    <li><span>An</span> <span>alternative</span> <span>solution</span> <span>is</span> <span>to</span> <span>create</span> <span>a</span> <span>number</span> <span>of</span> <span>threads</span> <span>when</span> <span>the</span> <span>process</span> <span>first</span> <span>starts,</span> <span>and</span> <span>put</span> <span>those</span> <span>threads</span> <span>into</span> <span>a</span> <span></span><em><span></span><strong><span>thread</span> <span>pool</span></strong><span></span></em><span></span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Threads</span> <span>are</span> <span>allocated</span> <span>from</span> <span>the</span> <span>pool</span> <span>as</span> <span>needed,</span> <span>and</span> <span>returned</span> <span>to</span> <span>the</span> <span>pool</span> <span>when</span> <span>no</span> <span>longer</span> <span>needed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>When</span> <span>no</span> <span>threads</span> <span>are</span> <span>available</span> <span>in</span> <span>the</span> <span>pool,</span> <span>the</span> <span>process</span> <span>may</span> <span>have</span> <span>to</span> <span>wait</span> <span>until</span> <span>one</span> <span>becomes</span> <span>available</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>(</span> <span>maximum</span> <span>)</span> <span>number</span> <span>of</span> <span>threads</span> <span>available</span> <span>in</span> <span>a</span> <span>thread</span> <span>pool</span> <span>may</span> <span>be</span> <span>determined</span> <span>by</span> <span>adjustable</span> <span>parameters,</span> <span>possibly</span> <span>dynamically</span> <span>in</span> <span>response</span> <span>to</span> <span>changing</span> <span>system</span> <span>loads</span>.<span></span> </li>
    <li><span>Win32</span> <span>provides</span> <span>thread</span> <span>pools</span> <span>through</span> <span>the</span> <span>"PoolFunction"</span> <span>function</span>.<span></span> <span>Java</span> <span>also</span> <span>provides</span> <span>support</span> <span>for</span> <span>thread</span> <span>pools</span> <span>through</span> <span>the</span> <span>java</span>.<span>util</span>.<span>concurrent</span> <span>package,</span> <span>and</span> <span>Apple</span> <span>supports</span> <span>thread</span> <span>pools</span> <span>under</span> <span>the</span> <span>Grand</span> <span>Central</span> <span>Dispatch</span> <span>architecture</span>.<span></span>.<span></span> </li>
  </ul>
  <h4><span>4</span>.<span>5</span>.<span>2</span> </h4>
  <ul>
    <li><span>OpenMP</span> <span>is</span> <span>a</span> <span>set</span> <span>of</span> <span>compiler</span> <span>directives</span> <span>available</span> <span>for</span> <span>C,</span> <span>C++,</span> <span>or</span> <span>FORTRAN</span> <span>programs</span> <span>that</span> <span>instruct</span> <span>the</span> <span>compiler</span> <span>to</span> <span>automatically</span> <span>generate</span> <span>parallel</span> <span>code</span> <span>where</span> <span>appropriate</span>.</li>
    <li><span>For</span> <span>example,</span> <span>the</span> </li>
  </ul>
  <blockquote>
    <pre>      #pragma omp parallel 
       {
             /* some parallel code here */
       }</pre>
    <p><span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>would</span> <span>cause</span> <span>the</span> <span>compiler</span> <span>to</span> <span>create</span> <span>as</span> <span>many</span> <span>threads</span> <span>as</span> <span>the</span> <span>machine</span> <span>has</span> <span>cores</span> <span>available,</span> <span>(</span> <span>e</span>.<span>g</span>.<span></span> <span>4</span> <span>on</span> <span>a</span> <span>quad-core</span> <span>machine</span> <span>),</span> <span>and</span> <span>to</span> <span>run</span> <span>the</span> <span>parallel</span> <span>block</span> <span>of</span> <span>code,</span> <span>(</span> <span>known</span> <span>as</span> <span>a</span> <span></span><strong><span>parallel</span> <span>region</span></strong><span></span> <span>)</span> <span>on</span> <span>each</span> <span>of</span> <span>the</span> <span>threads</span>.</p>
  </blockquote>
  <ul>
    <li><span>Another</span> <span>sample</span> <span>directive</span> <span>is</span> <span>"</span><span class="style1"><span>#pragma</span> <span>omp</span> <span>parallel</span> <span>for</span></span><span>",</span> <span>which</span> <span>causes</span> <span>the</span> <span>for</span> <span>loop</span> <span>immediately</span> <span>following</span> <span>it</span> <span>to</span> <span>be</span> <span>parallelized,</span> <span>dividing</span> <span>the</span> <span>iterations</span> <span>up</span> <span>amongst</span> <span>the</span> <span>available</span> <span>cores</span>.</li>
  </ul>
  <h4><span>4</span>.<span>5</span>.<span>3</span> <span>Grand</span> <span>Central</span> <span>Dispatch,</span> </h4>
  <ul>
    <li><span>GCD</span> <span>is</span> <span>an</span> <span>extension</span> <span>to</span> <span>C</span> <span>and</span> <span>C++</span> <span>available</span> <span>on</span> <span>Apple's</span> <span>OSX</span> <span>and</span> <span>iOS</span> <span>operating</span> <span>systems</span> <span>to</span> <span>support</span> <span>parallelism</span>.</li>
    <li><span>Similar</span> <span>to</span> <span>OpenMP,</span> <span>users</span> <span>of</span> <span>GCD</span> <span>define</span> <span></span><strong><span>blocks</span></strong><span></span> <span>of</span> <span>code</span> <span>to</span> <span>be</span> <span>executed</span> <span>either</span> <span>serially</span> <span>or</span> <span>in</span> <span>parallel</span> <span>by</span> <span>placing</span> <span>a</span> <span>carat</span> <span>just</span> <span>before</span> <span>an</span> <span>opening</span> <span>curly</span> <span>brace,</span> <span>i</span>.<span>e</span>.<span></span><span class="style1"><span></span> <span>^{</span> <span>printf(</span> <span>"I</span> <span>am</span> <span>a</span> <span>block</span>.<span>\n"</span> <span>);</span> <span>}</span></span></li>
    <li><span>GCD</span> <span>schedules</span> <span>blocks</span> <span>by</span> <span>placing</span> <span>them</span> <span>on</span> <span>one</span> <span>of</span> <span>several</span> <span></span><strong><span>dispatch</span> <span>queues</span></strong><span></span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Blocks</span> <span>placed</span> <span>on</span> <span>a</span> <span>serial</span> <span>queue</span> <span>are</span> <span>removed</span> <span>one</span> <span>by</span> <span>one</span>.<span></span> <span>The</span> <span>next</span> <span>block</span> <span>cannot</span> <span>be</span> <span>removed</span> <span>for</span> <span>scheduling</span> <span>until</span> <span>the</span> <span>previous</span> <span>block</span> <span>has</span> <span>completed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>There</span> <span>are</span> <span>three</span> <span>concurrent</span> <span>queues,</span> <span>corresponding</span> <span>roughly</span> <span>to</span> <span>low,</span> <span>medium,</span> <span>or</span> <span>high</span> <span>priority</span>.<span></span> <span>Blocks</span> <span>are</span> <span>also</span> <span>removed</span> <span>from</span> <span>these</span> <span>queues</span> <span>one</span> <span>by</span> <span>one,</span> <span>but</span> <span>several</span> <span>may</span> <span>be</span> <span>removed</span> <span>and</span> <span>dispatched</span> <span>without</span> <span>waiting</span> <span>for</span> <span>others</span> <span>to</span> <span>finish</span> <span>first,</span> <span>depending</span> <span>on</span> <span>the</span> <span>availability</span> <span>of</span> <span>threads</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Internally</span> <span>GCD</span> <span>manages</span> <span>a</span> <span>pool</span> <span>of</span> <span>POSIX</span> <span>threads</span> <span>which</span> <span>may</span> <span>fluctuate</span> <span>in</span> <span>size</span> <span>depending</span> <span>on</span> <span>load</span> <span>conditions</span>.</li>
  </ul>
  <h4><span>4</span>.<span>5</span>.<span>4</span> <span>Other</span> </h4>
  <blockquote>
    <p><span>There</span> <span>are</span> <span>several</span> <span>other</span> <span>approaches</span> <span>available,</span> <span>including</span> <span>Microsoft's</span> <span>Threading</span> <span>Building</span> <span>Blocks</span> <span>(</span> <span>TBB</span> <span>)</span> <span>and</span> <span>other</span> <span>products,</span> <span>and</span> <span>Java's</span> <span>util</span>.<span>concurrent</span> <span>package</span>.</p>
  </blockquote>
</blockquote>
<h3><span>4</span>.<span>6</span> <span>Threading</span> <span>Issues</span> </h3>
<blockquote>
  <h4><span>4</span>.<span>6</span>.<span>1</span> <span>The</span> <span>fork(</span> <span>)</span> <span>and</span> <span>exec(</span> <span>)</span> <span>System</span> </h4>
  <ul>
    <li><span>Q:</span> <span>If</span> <span>one</span> <span>thread</span> <span>forks,</span> <span>is</span> <span>the</span> <span>entire</span> <span>process</span> <span>copied,</span> <span>or</span> <span>is</span> <span>the</span> <span>new</span> <span>process</span> <span>single-threaded?</span> </li>
    <li><span>A:</span> <span>System</span> <span>dependant</span>.</li>
    <li><span>A:</span> <span>If</span> <span>the</span> <span>new</span> <span>process</span> <span>execs</span> <span>right</span> <span>away,</span> <span>there</span> <span>is</span> <span>no</span> <span>need</span> <span>to</span> <span>copy</span> <span>all</span> <span>the</span> <span>other</span> <span>threads</span>.<span></span> <span>If</span> <span>it</span> <span>doesn't,</span> <span>then</span> <span>the</span> <span>entire</span> <span>process</span> <span>should</span> <span>be</span> <span>copied</span>.</li>
    <li><span>A:</span> <span>Many</span> <span>versions</span> <span>of</span> <span>UNIX</span> <span>provide</span> <span>multiple</span> <span>versions</span> <span>of</span> <span>the</span> <span>fork</span> <span>call</span> <span>for</span> <span>this</span> <span>purpose</span>.<span></span> </li>
  </ul>
  <h4><span>4</span>.<span>6</span>.<span>2</span> <span>Signal</span> </h4>
  <ul>
    <li><span>Q:</span> <span>When</span> <span>a</span> <span>multi-threaded</span> <span>process</span> <span>receives</span> <span>a</span> <span>signal,</span> <span>to</span> <span>what</span> <span>thread</span> <span>should</span> <span>that</span> <span>signal</span> <span>be</span> </li>
    <li><span>A:</span> <span>There</span> <span>are</span> <span>four</span> <span>major</span> <span>options:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Deliver</span> <span>the</span> <span>signal</span> <span>to</span> <span>the</span> <span>thread</span> <span>to</span> <span>which</span> <span>the</span> <span>signal</span> <span>applies</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Deliver</span> <span>the</span> <span>signal</span> <span>to</span> <span>every</span> <span>thread</span> <span>in</span> <span>the</span> <span>process</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Deliver</span> <span>the</span> <span>signal</span> <span>to</span> <span>certain</span> <span>threads</span> <span>in</span> <span>the</span> <span>process</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Assign</span> <span>a</span> <span>specific</span> <span>thread</span> <span>to</span> <span>receive</span> <span>all</span> <span>signals</span> <span>in</span> <span>a</span> <span>process</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>best</span> <span>choice</span> <span>may</span> <span>depend</span> <span>on</span> <span>which</span> <span>specific</span> <span>signal</span> <span>is</span> <span>involved</span>.</li>
    <li><span>UNIX</span> <span>allows</span> <span>individual</span> <span>threads</span> <span>to</span> <span>indicate</span> <span>which</span> <span>signals</span> <span>they</span> <span>are</span> <span>accepting</span> <span>and</span> <span>which</span> <span>they</span> <span>are</span> <span>ignoring</span>.<span></span> <span>However</span> <span>the</span> <span>signal</span> <span>can</span> <span>only</span> <span>be</span> <span>delivered</span> <span>to</span> <span>one</span> <span>thread,</span> <span>which</span> <span>is</span> <span>generally</span> <span>the</span> <span>first</span> <span>thread</span> <span>that</span> <span>is</span> <span>accepting</span> <span>that</span> <span>particular</span> <span>signal</span>.</li>
    <li><span>UNIX</span> <span>provides</span> <span>two</span> <span>separate</span> <span>system</span> <span>calls,</span> <span></span><span class="style1"><span>kill(</span> <span>pid,</span> <span>signal</span> <span>)</span></span><span></span> <span>and</span> <span></span><span class="style1"><span>pthread_kill(</span> <span>tid,</span> <span>signal</span> <span>)</span></span><span>,</span> <span>for</span> <span>delivering</span> <span>signals</span> <span>to</span> <span>processes</span> <span>or</span> <span>specific</span> <span>threads</span> <span>respectively</span>.</li>
    <li><span>Windows</span> <span>does</span> <span>not</span> <span>support</span> <span>signals,</span> <span>but</span> <span>they</span> <span>can</span> <span>be</span> <span>emulated</span> <span>using</span> <span>Asynchronous</span> <span>Procedure</span> <span>Calls</span> <span>(</span> <span>APCs</span> <span>)</span>.<span></span> <span>APCs</span> <span>are</span> <span>delivered</span> <span>to</span> <span>specific</span> <span>threads,</span> <span>not</span> <span>processes</span>.<span></span> </li>
  </ul>
  <h4><span>4</span>.<span>6</span>.<span>3</span> <span>Thread</span> </h4>
  <ul>
    <li><span>Threads</span> <span>that</span> <span>are</span> <span>no</span> <span>longer</span> <span>needed</span> <span>may</span> <span>be</span> <span>cancelled</span> <span>by</span> <span>another</span> <span>thread</span> <span>in</span> <span>one</span> <span>of</span> <span>two</span> <span>ways:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Asynchronous</span> <span>Cancellation</span></strong><span></span> <span>cancels</span> <span>the</span> <span>thread</span> <span>immediately</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Deferred</span> <span>Cancellation</span></strong><span></span> <span>sets</span> <span>a</span> <span>flag</span> <span>indicating</span> <span>the</span> <span>thread</span> <span>should</span> <span>cancel</span> <span>itself</span> <span>when</span> <span>it</span> <span>is</span> <span>convenient</span>.<span></span> <span>It</span> <span>is</span> <span>then</span> <span>up</span> <span>to</span> <span>the</span> <span>cancelled</span> <span>thread</span> <span>to</span> <span>check</span> <span>this</span> <span>flag</span> <span>periodically</span> <span>and</span> <span>exit</span> <span>nicely</span> <span>when</span> <span>it</span> <span>sees</span> <span>the</span> <span>flag</span> <span>set</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>(</span> <span>Shared</span> <span>)</span> <span>resource</span> <span>allocation</span> <span>and</span> <span>inter-thread</span> <span>data</span> <span>transfers</span> <span>can</span> <span>be</span> <span>problematic</span> <span>with</span> <span>asynchronous</span> <span>cancellation</span>.<span></span> </li>
  </ul>
<h4><span>4</span>.<span>6</span>.<span>4</span> <span>Thread-Local</span> <span>Storage</span> <span>(</span> <span>was</span> <span>4</span>.<span>4</span>.<span>5</span> <span>Thread-Specific</span> <span>Data</span> </h4>
  <ul>
    <li><span>Most</span> <span>data</span> <span>is</span> <span>shared</span> <span>among</span> <span>threads,</span> <span>and</span> <span>this</span> <span>is</span> <span>one</span> <span>of</span> <span>the</span> <span>major</span> <span>benefits</span> <span>of</span> <span>using</span> <span>threads</span> <span>in</span> <span>the</span> <span>first</span> <span>place</span>.</li>
    <li><span>However</span> <span>sometimes</span> <span>threads</span> <span>need</span> <span>thread-specific</span> <span>data</span> <span>also</span>.</li>
    <li><span>Most</span> <span>major</span> <span>thread</span> <span>libraries</span> <span>(</span> <span>pThreads,</span> <span>Win32,</span> <span>Java</span> <span>)</span> <span>provide</span> <span>support</span> <span>for</span> <span>thread-specific</span> <span>data,</span> <span>known</span> <span>as</span> <span></span><strong><span>thread-local</span> <span>storage</span></strong><span></span> <span>or</span> <span></span><strong><span>TLS</span>.<span></span></strong><span></span> <span>Note</span> <span>that</span> <span>this</span> <span>is</span> <span>more</span> <span>like</span> <span>static</span> <span>data</span> <span>than</span> <span>local</span> <span>variables,because</span> <span>it</span> <span>does</span> <span>not</span> <span>cease</span> <span>to</span> <span>exist</span> <span>when</span> <span>the</span> <span>function</span> <span>ends</span>.<span></span> <span></span> </li>
  </ul>
  <h4><span>4</span>.<span>6</span>.<span>5</span> <span>Scheduler</span> </h4>
  <ul>
    <li><span>Many</span> <span>implementations</span> <span>of</span> <span>threads</span> <span>provide</span> <span>a</span> <span>virtual</span> <span>processor</span> <span>as</span> <span>an</span> <span>interface</span> <span>between</span> <span>the</span> <span>user</span> <span>thread</span> <span>and</span> <span>the</span> <span>kernel</span> <span>thread,</span> <span>particularly</span> <span>for</span> <span>the</span> <span>many-to-many</span> <span>or</span> <span>two-tier</span> <span>models</span>.</li>
    <li><span>This</span> <span>virtual</span> <span>processor</span> <span>is</span> <span>known</span> <span>as</span> <span>a</span> <span>"Lightweight</span> <span>Process",</span> <span>LWP</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>There</span> <span>is</span> <span>a</span> <span>one-to-one</span> <span>correspondence</span> <span>between</span> <span>LWPs</span> <span>and</span> <span>kernel</span> <span>threads</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>number</span> <span>of</span> <span>kernel</span> <span>threads</span> <span>available,</span> <span>(</span> <span>and</span> <span>hence</span> <span>the</span> <span>number</span> <span>of</span> <span>LWPs</span> <span>)</span> <span>may</span> <span>change</span> <span>dynamically</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>application</span> <span>(</span> <span>user</span> <span>level</span> <span>thread</span> <span>library</span> <span>)</span> <span>maps</span> <span>user</span> <span>threads</span> <span>onto</span> <span>available</span> <span>LWPs</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>kernel</span> <span>threads</span> <span>are</span> <span>scheduled</span> <span>onto</span> <span>the</span> <span>real</span> <span>processor(s)</span> <span>by</span> <span>the</span> <span>OS</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>kernel</span> <span>communicates</span> <span>to</span> <span>the</span> <span>user-level</span> <span>thread</span> <span>library</span> <span>when</span> <span>certain</span> <span>events</span> <span>occur</span> <span>(</span> <span>such</span> <span>as</span> <span>a</span> <span>thread</span> <span>about</span> <span>to</span> <span>block</span> <span>)</span> <span>via</span> <span>an</span> <span></span><em><span></span><strong><span>upcall</span></strong><span></span></em><span>,</span> <span>which</span> <span>is</span> <span>handled</span> <span>in</span> <span>the</span> <span>thread</span> <span>library</span> <span>by</span> <span>an</span> <span></span><em><span></span><strong><span>upcall</span> <span>handler</span></strong><span></span></em><span></span>.<span></span> <span>The</span> <span>upcall</span> <span>also</span> <span>provides</span> <span>a</span> <span>new</span> <span>LWP</span> <span>for</span> <span>the</span> <span>upcall</span> <span>handler</span> <span>to</span> <span>run</span> <span>on,</span> <span>which</span> <span>it</span> <span>can</span> <span>then</span> <span>use</span> <span>to</span> <span>reschedule</span> <span>the</span> <span>user</span> <span>thread</span> <span>that</span> <span>is</span> <span>about</span> <span>to</span> <span>become</span> <span>blocked</span>.<span></span> <span>The</span> <span>OS</span> <span>will</span> <span>also</span> <span>issue</span> <span>upcalls</span> <span>when</span> <span>a</span> <span>thread</span> <span>becomes</span> <span>unblocked,</span> <span>so</span> <span>the</span> <span>thread</span> <span>library</span> <span>can</span> <span>make</span> <span>appropriate</span> <span>adjustments</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>If</span> <span>the</span> <span>kernel</span> <span>thread</span> <span>blocks,</span> <span>then</span> <span>the</span> <span>LWP</span> <span>blocks,</span> <span>which</span> <span>blocks</span> <span>the</span> <span>user</span> <span>thread</span>.</li>
    <li><span>Ideally</span> <span>there</span> <span>should</span> <span>be</span> <span>at</span> <span>least</span> <span>as</span> <span>many</span> <span>LWPs</span> <span>available</span> <span>as</span> <span>there</span> <span>could</span> <span>be</span> <span>concurrently</span> <span>blocked</span> <span>kernel</span> <span>threads</span>.<span></span> <span></span> <span>Otherwise</span> <span>if</span> <span>all</span> <span>LWPs</span> <span>are</span> <span>blocked,</span> <span>then</span> <span>user</span> <span>threads</span> <span>will</span> <span>have</span> <span>to</span> <span>wait</span> <span>for</span> <span>one</span> <span>to</span> <span>become</span> <span>available</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_13_Lightweight.jpg" width="304" height="275"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>13</span> <span>-</span> <span>Lightweight</span> <span>process</span> <span>(</span> <span>LWP</span> <span>)</span></strong></p>
</blockquote>
<h3><span>4</span>.<span>7</span> <span>Operating-System</span> <span>Examples</span> <span>(</span> <span>Optional</span> </h3>
<blockquote>
  <h4><span>4</span>.<span>7</span>.<span>1</span> <span>Windows</span> <span>XP</span> </h4>
  <ul>
    <li><span>The</span> <span>Win32</span> <span>API</span> <span>thread</span> <span>library</span> <span>supports</span> <span>the</span> <span>one-to-one</span> <span>thread</span> </li>
    <li><span>Win32</span> <span>also</span> <span>provides</span> <span>the</span> <span></span><em><span></span><strong><span>fiber</span></strong><span></span></em><span></span> <span>library,</span> <span>which</span> <span>supports</span> <span>the</span> <span>many-to-many</span> <span>model</span>.</li>
    <li><span>Win32</span> <span>thread</span> <span>components</span> <span>include:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Thread</span> <span>ID</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Registers</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>user</span> <span>stack</span> <span>used</span> <span>in</span> <span>user</span> <span>mode,</span> <span>and</span> <span>a</span> <span>kernel</span> <span>stack</span> <span>used</span> <span>in</span> <span>kernel</span> <span>mode</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>private</span> <span>storage</span> <span>area</span> <span>used</span> <span>by</span> <span>various</span> <span>run-time</span> <span>libraries</span> <span>and</span> <span>dynamic</span> <span>link</span> <span>libraries</span> <span>(</span> <span>DLLs</span> <span>)</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>key</span> <span>data</span> <span>structures</span> <span>for</span> <span>Windows</span> <span>threads</span> <span>are</span> <span>the</span> <span>ETHREAD</span> <span>(</span> <span>executive</span> <span>thread</span> <span>block</span> <span></span> <span>),</span> <span>KTHREAD</span> <span>(</span> <span>kernel</span> <span>thread</span> <span>block</span> <span>),</span> <span>and</span> <span>the</span> <span>TEB</span> <span>(</span> <span>thread</span> <span>environment</span> <span>block</span> <span>)</span>.<span></span> <span>The</span> <span>ETHREAD</span> <span>and</span> <span>KTHREAD</span> <span>structures</span> <span>exist</span> <span>entirely</span> <span>within</span> <span>kernel</span> <span>space,</span> <span>and</span> <span>hence</span> <span>are</span> <span>only</span> <span>accessible</span> <span>by</span> <span>the</span> <span>kernel,</span> <span>whereas</span> <span>the</span> <span>TEB</span> <span>lies</span> <span>within</span> <span>user</span> <span>space,</span> <span>as</span> <span>illustrated</span> <span>in</span> <span>Figure</span> <span>4</span>.<span>10:</span> </li>
  </ul>
  <p align="center"><span></span><img src="./2_Threads_files/4_14_WindowsThreadStructures.jpg" width="652" height="633"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>4</span>.<span>14</span> <span>-</span> <span>Data</span> <span>structures</span> <span>of</span> <span>a</span> <span>Windows</span> <span>thread</span></strong></p>
  <h4><span>4</span>.<span>7</span>.<span>2</span> <span>Linux</span> <span>Threads</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> </h4>
  <ul>
    <li><span>Linux</span> <span>does</span> <span>not</span> <span>distinguish</span> <span>between</span> <span>processes</span> <span>and</span> <span>threads</span> <span>-</span> <span>It</span> <span>uses</span> <span>the</span> <span>more</span> <span>generic</span> <span>term</span> <span>"tasks"</span>.</li>
    <li><span>The</span> <span>traditional</span> <span>fork(</span> <span>)</span> <span>system</span> <span>call</span> <span>completely</span> <span>duplicates</span> <span>a</span> <span>process</span> <span>(</span> <span>task</span> <span>),</span> <span>as</span> <span>described</span> <span>earlier</span>.</li>
    <li><span>An</span> <span>alternative</span> <span>system</span> <span>call,</span> <span>clone(</span> <span>)</span> <span></span> <span></span> <span>allows</span> <span>for</span> <span>varying</span> <span>degrees</span> <span>of</span> <span>sharing</span> <span>between</span> <span>the</span> <span>parent</span> <span>and</span> <span>child</span> <span>tasks,</span> <span>controlled</span> <span>by</span> <span>flags</span> <span>such</span> <span>as</span> <span>those</span> <span>shown</span> <span>in</span> <span>the</span> <span>following</span> </li>
  </ul>
  <blockquote>
  <center>
    <table width="400" border="1" cellspacing="5" cellpadding="2">
      <caption>&nbsp;
      </caption>
      <tbody><tr>
        <th scope="col">flag</th>
        <th scope="col">Meaning</th>
      </tr>
      <tr>
        <td></td>
        <td><span>File-system</span> <span>information</span> <span>is</span> <span>shared</span> </td>
      </tr>
      <tr>
        <td></td>
        <td><span>The</span> <span>same</span> <span>memory</span> <span>space</span> <span>is</span> <span>shared</span> </td>
      </tr>
      <tr>
        <td></td>
        <td><span>Signal</span> <span>handlers</span> <span>are</span> <span>shared</span> </td>
      </tr>
      <tr>
        <td></td>
        <td><span>The</span> <span>set</span> <span>of</span> <span>open</span> <span>files</span> <span>is</span> <span>shared</span> </td>
      </tr>
    </tbody></table>
    </center>
  </blockquote>
  <ul>
    <li><span>Calling</span> <span>clone(</span> <span>)with</span> <span>no</span> <span>flags</span> <span>set</span> <span>is</span> <span>equivalent</span> <span>to</span> <span>fork(</span> <span>)</span>.<span></span> <span>Calling</span> <span>clone(</span> <span>)</span> <span></span> <span>with</span> <span>CLONE_FS,</span> <span>CLONE_VM,</span> <span>CLONE_SIGHAND,</span> <span>and</span> <span>CLONE_FILES</span> <span>is</span> <span>equivalent</span> <span>to</span> <span>creating</span> <span>a</span> <span>thread,</span> <span>as</span> <span>all</span> <span>of</span> <span>these</span> <span>data</span> <span>structures</span> <span>will</span> <span>be</span> <span>shared</span>.</li>
    <li><span>Linux</span> <span>implements</span> <span>this</span> <span>using</span> <span>a</span> <span>structure</span> <span></span><span class="style1"><span>task_struct</span></span><span>,</span> <span>which</span> <span>essentially</span> <span>provides</span> <span>a</span> <span>level</span> <span>of</span> <span>indirection</span> <span>to</span> <span>task</span> <span>resources</span>.<span></span> <span>When</span> <span>the</span> <span>flags</span> <span>are</span> <span>not</span> <span>set,</span> <span>then</span> <span>the</span> <span>resources</span> <span>pointed</span> <span>to</span> <span>by</span> <span>the</span> <span>structure</span> <span>are</span> <span>copied,</span> <span>but</span> <span>if</span> <span>the</span> <span>flags</span> <span>are</span> <span>set,</span> <span>then</span> <span>only</span> <span>the</span> <span>pointers</span> <span>to</span> <span>the</span> <span>resources</span> <span>are</span> <span>copied,</span> <span>and</span> <span>hence</span> <span>the</span> <span>resources</span> <span>are</span> <span>shared</span>.<span></span> <span>(</span> <span>Think</span> <span>of</span> <span>a</span> <span>deep</span> <span>copy</span> <span>versus</span> <span>a</span> <span>shallow</span> <span>copy</span> <span>in</span> <span>OO</span> <span>programming</span>.<span></span> </li>
    <li><span></span><strong><span>(</span> <span>Removed</span> <span>from</span> <span>9th</span> <span>edition</span> <span>)</span></strong><span></span> <span>Several</span> <span>distributions</span> <span>of</span> <span>Linux</span> <span>now</span> <span>support</span> <span>the</span> <span>NPTL</span> <span>(</span> <span>Native</span> <span>POXIS</span> <span>Thread</span> <span>Library</span> <span>)
</span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>POSIX</span> <span>compliant</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Support</span> <span>for</span> <span>SMP</span> <span>(</span> <span>symmetric</span> <span>multiprocessing</span> <span>),</span> <span>NUMA</span> <span>(</span> <span>non-uniform</span> <span>memory</span> <span>access</span> <span>),</span> <span>and</span> <span>multicore</span> <span>processors</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Support</span> <span>for</span> <span>hundreds</span> <span>to</span> <span>thousands</span> <span>of</span> <span>threads</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
</blockquote>
<h3><span>4</span>.<span>8</span> <span>Summary</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> </h3>


</body><script src="./2_Threads_files/jquery.min.js.download"></script><script>function makeSpans(){$("h1, h2, h3, h4, h5, h6, p, li, td, img").each(function(){var s=splitText($(this).html());$(this).empty();for(var a="",h=0;h<s.length;h++)a+=s[h];$(this).html(a)})}function splitText(s){for(var a=[],h="",e=0;e<s.length;e++)if("<"===s.charAt(e)){a.push("<span>"+h+"</span>"),h="<";var i=1;do e++,"<"===s.charAt(e)&&i++,">"===s.charAt(e)&&i--,h+=s.charAt(e);while(i>0);console.log(h),a.push(h),h=""}else" "!=s.charAt(e)&&"."!=s.charAt(e)?h+=s.charAt(e):(console.log(h),a.push("<span>"+h+"</span>"),h="",a.push(""+s.charAt(e)));return a}$(document).ready(function(){makeSpans(),$("BODY").addClass("whiteBG"),$("span").on("click",function(){$(this).hasClass("hideWord")?($(this).removeClass("hideWord hoverOver"),$(this).addClass("hideWord2")):$(this).hasClass("hideWord2")?$(this).removeClass("hideWord2"):$(this).addClass("hideWord")}),$("span").hover(function(){$(this).hasClass("hideWord")&&$(this).addClass("hoverOver")},function(){$(this).removeClass("hoverOver")}),$("img").on("click",function(){$(this).hasClass("imageHide")?($(this).removeClass("imageHide"),$(this).addClass("imageReveal")):$(this).addClass("imageHide")}),$("img").hover(function(){$(this).hasClass("imageHide")&&$(this).addClass("imageReveal")},function(){$(this).removeClass("imageReveal")})});</script></html>