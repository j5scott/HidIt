
<!-- saved from url=(0076)https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/8_MainMemory.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Adobe PageMill 3.0 Win">
  <title>Operating Systems: Main Memory</title>
<style>.hideWord{color:blue;background-color:blue}.hideWord2{color:white;background-color:white}.hoverOver{color:red;opacity:1;background-color:white}.whiteBG{background-color:white!important}.imageHide{opacity:0.02!important}.imageReveal{opacity:1.0!important}.imageReveal:parent{background-color:white!important}.imageHide:parent{background-color:blue!important}</style></head>
<body bgcolor="#ffff80" class="whiteBG">

<h1><span></span><center><span>
</span> <span></span> <span>Main</span> <span>Memory</span> <span>
</span></center></h1>

<h3></h3>

<ol>
  <li><span>Abraham</span> <span>Silberschatz,</span> <span>Greg</span> <span>Gagne,</span> <span>and</span> <span>Peter</span> <span>Baer</span> <span>Galvin,</span> <span>"Operating</span> <span>System</span> <span>Concepts,</span> <span>Ninth</span> <span>Edition</span> <span>",</span> <span>Chapter</span> </li></ol>

<h3><span>8</span>.<span>1</span> </h3>
<ul>
  <li><span>Obviously</span> <span>memory</span> <span>accesses</span> <span>and</span> <span>memory</span> <span>management</span> <span>are</span> <span>a</span> <span>very</span> <span>important</span> <span>part</span> <span>of</span> <span>modern</span> <span>computer</span> <span>operation</span>.<span></span> <span>Every</span> <span>instruction</span> <span>has</span> <span>to</span> <span>be</span> <span>fetched</span> <span>from</span> <span>memory</span> <span>before</span> <span>it</span> <span>can</span> <span>be</span> <span>executed,</span> <span>and</span> <span>most</span> <span>instructions</span> <span>involve</span> <span>retrieving</span> <span>data</span> <span>from</span> <span>memory</span> <span>or</span> <span>storing</span> <span>data</span> <span>in</span> <span>memory</span> <span>or</span> <span>both</span>.</li>
  <li><span>The</span> <span>advent</span> <span>of</span> <span>multi-tasking</span> <span>OSes</span> <span>compounds</span> <span>the</span> <span>complexity</span> <span>of</span> <span>memory</span> <span>management,</span> <span>because</span> <span>because</span> <span>as</span> <span>processes</span> <span>are</span> <span>swapped</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU,</span> <span>so</span> <span>must</span> <span>their</span> <span>code</span> <span>and</span> <span>data</span> <span>be</span> <span>swapped</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>memory,</span> <span>all</span> <span>at</span> <span>high</span> <span>speeds</span> <span>and</span> <span>without</span> <span>interfering</span> <span>with</span> <span>any</span> <span>other</span> <span>processes</span>.</li>
  <li><span>Shared</span> <span>memory,</span> <span>virtual</span> <span>memory,</span> <span></span> <span>the</span> <span>classification</span> <span>of</span> <span>memory</span> <span>as</span> <span>read-only</span> <span>versus</span> <span>read-write,</span> <span>and</span> <span>concepts</span> <span>like</span> <span>copy-on-write</span> <span>forking</span> <span>all</span> <span>further</span> <span>complicate</span> <span>the</span> <span>issue</span>.<span></span> </li>
</ul>
<blockquote>
  <h4><span>8</span>.<span>1</span>.<span>1</span> <span>Basic</span> <span>Hardware</span> </h4>
  <ul>
    <li><span>It</span> <span>should</span> <span>be</span> <span>noted</span> <span>that</span> <span>from</span> <span>the</span> <span>memory</span> <span>chips</span> <span>point</span> <span>of</span> <span>view,</span> <span>all</span> <span>memory</span> <span>accesses</span> <span>are</span> <span>equivalent</span>.<span></span> <span>The</span> <span>memory</span> <span>hardware</span> <span>doesn't</span> <span>know</span> <span>what</span> <span>a</span> <span>particular</span> <span>part</span> <span>of</span> <span>memory</span> <span>is</span> <span>being</span> <span>used</span> <span>for,</span> <span>nor</span> <span>does</span> <span>it</span> <span>care</span>.<span></span> <span>This</span> <span>is</span> <span>almost</span> <span>true</span> <span>of</span> <span>the</span> <span>OS</span> <span>as</span> <span>well,</span> <span>although</span> <span>not</span> <span>entirely</span>.</li>
    <li><span>The</span> <span>CPU</span> <span>can</span> <span>only</span> <span>access</span> <span>its</span> <span>registers</span> <span>and</span> <span>main</span> <span>memory</span>.<span></span> <span>It</span> <span>cannot,</span> <span>for</span> <span>example,</span> <span>make</span> <span>direct</span> <span>access</span> <span>to</span> <span>the</span> <span>hard</span> <span>drive,</span> <span>so</span> <span>any</span> <span>data</span> <span>stored</span> <span>there</span> <span>must</span> <span>first</span> <span>be</span> <span>transferred</span> <span>into</span> <span>the</span> <span>main</span> <span>memory</span> <span>chips</span> <span>before</span> <span>the</span> <span>CPU</span> <span>can</span> <span>work</span> <span>with</span> <span>it</span>.<span></span> <span>(&nbsp;Device</span> <span>drivers</span> <span>communicate</span> <span>with</span> <span>their</span> <span>hardware</span> <span>via</span> <span>interrupts</span> <span>and</span> <span>"memory"</span> <span>accesses,</span> <span>sending</span> <span>short</span> <span>instructions</span> <span>for</span> <span>example</span> <span>to</span> <span>transfer</span> <span>data</span> <span>from</span> <span>the</span> <span>hard</span> <span>drive</span> <span>to</span> <span>a</span> <span>specified</span> <span>location</span> <span>in</span> <span>main</span> <span>memory</span>.<span></span> <span>The</span> <span>disk</span> <span>controller</span> <span>monitors</span> <span>the</span> <span>bus</span> <span>for</span> <span>such</span> <span>instructions,</span> <span>transfers</span> <span>the</span> <span>data,</span> <span>and</span> <span>then</span> <span>notifies</span> <span>the</span> <span>CPU</span> <span>that</span> <span>the</span> <span>data</span> <span>is</span> <span>there</span> <span>with</span> <span>another</span> <span>interrupt,</span> <span>but</span> <span>the</span> <span>CPU</span> <span>never</span> <span>gets</span> <span>direct</span> <span>access</span> <span>to</span> <span>the</span> <span>disk</span>.<span>&nbsp;)</span> </li>
    <li><span>Memory</span> <span>accesses</span> <span>to</span> <span>registers</span> <span>are</span> <span>very</span> <span>fast,</span> <span>generally</span> <span>one</span> <span>clock</span> <span>tick,</span> <span>and</span> <span>a</span> <span>CPU</span> <span>may</span> <span>be</span> <span>able</span> <span>to</span> <span>execute</span> <span>more</span> <span>than</span> <span>one</span> <span>machine</span> <span>instruction</span> <span>per</span> <span>clock</span> <span>tick</span>.</li>
    <li><span>Memory</span> <span>accesses</span> <span>to</span> <span>main</span> <span>memory</span> <span>are</span> <span>comparatively</span> <span>slow,</span> <span>and</span> <span>may</span> <span>take</span> <span>a</span> <span>number</span> <span>of</span> <span>clock</span> <span>ticks</span> <span>to</span> <span>complete</span>.<span></span> <span>This</span> <span>would</span> <span>require</span> <span>intolerable</span> <span>waiting</span> <span>by</span> <span>the</span> <span>CPU</span> <span>if</span> <span>it</span> <span>were</span> <span>not</span> <span>for</span> <span>an</span> <span>intermediary</span> <span>fast</span> <span>memory</span> <span></span><em><span></span><strong><span>cache</span></strong><span></span></em><span></span> <span>built</span> <span>into</span> <span>most</span> <span>modern</span> <span>CPUs</span>.<span></span> <span>The</span> <span>basic</span> <span>idea</span> <span>of</span> <span>the</span> <span>cache</span> <span>is</span> <span>to</span> <span>transfer</span> <span>chunks</span> <span>of</span> <span>memory</span> <span>at</span> <span>a</span> <span>time</span> <span>from</span> <span>the</span> <span>main</span> <span>memory</span> <span>to</span> <span>the</span> <span>cache,</span> <span>and</span> <span>then</span> <span>to</span> <span>access</span> <span>individual</span> <span>memory</span> <span>locations</span> <span>one</span> <span>at</span> <span>a</span> <span>time</span> <span>from</span> <span>the</span> <span>cache</span>.</li>
    <li><span>User</span> <span>processes</span> <span>must</span> <span>be</span> <span>restricted</span> <span>so</span> <span>that</span> <span>they</span> <span>only</span> <span>access</span> <span>memory</span> <span>locations</span> <span>that</span> <span>"belong"</span> <span>to</span> <span>that</span> <span>particular</span> <span>process</span>.<span></span> <span>This</span> <span>is</span> <span>usually</span> <span>implemented</span> <span>using</span> <span>a</span> <span>base</span> <span>register</span> <span>and</span> <span>a</span> <span>limit</span> <span>register</span> <span>for</span> <span>each</span> <span>process,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figures</span> <span>8</span>.<span>1</span> <span>and</span> <span>8</span>.<span>2</span> <span>below</span>.<span></span> <span></span><em><span></span><strong><span>Every</span></strong><span></span></em><span></span> <span>memory</span> <span>access</span> <span>made</span> <span>by</span> <span>a</span> <span>user</span> <span>process</span> <span>is</span> <span>checked</span> <span>against</span> <span>these</span> <span>two</span> <span>registers,</span> <span>and</span> <span>if</span> <span>a</span> <span>memory</span> <span>access</span> <span>is</span> <span>attempted</span> <span>outside</span> <span>the</span> <span>valid</span> <span>range,</span> <span>then</span> <span>a</span> <span>fatal</span> <span>error</span> <span>is</span> <span>generated</span>.<span></span> <span>The</span> <span>OS</span> <span>obviously</span> <span>has</span> <span>access</span> <span>to</span> <span>all</span> <span>existing</span> <span>memory</span> <span>locations,</span> <span>as</span> <span>this</span> <span>is</span> <span>necessary</span> <span>to</span> <span>swap</span> <span>users'</span> <span>code</span> <span>and</span> <span>data</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>memory</span>.<span></span> <span>It</span> <span>should</span> <span>also</span> <span>be</span> <span>obvious</span> <span>that</span> <span>changing</span> <span>the</span> <span>contents</span> <span>of</span> <span>the</span> <span>base</span> <span>and</span> <span>limit</span> <span>registers</span> <span>is</span> <span>a</span> <span>privileged</span> <span>activity,</span> <span>allowed</span> <span>only</span> <span>to</span> <span>the</span> <span>OS</span> <span>kernel</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_01_LogicalAddressSpace.jpg" width="392" height="427"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>1</span> <span>-</span> <span>A</span> <span>base</span> <span>and</span> <span>a</span> <span>limit</span> <span>register</span> <span>define</span> <span>a</span> <span>logical</span> <span>addresss</span> <span>space</span></strong><span>
</span> <span></span> </p>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_02_HardwareAddressProtection.jpg" width="746" height="337"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>2</span> <span>-</span> <span>Hardware</span> <span>address</span> <span>protection</span> <span>with</span> <span>base</span> <span>and</span> <span>limit</span> <span>registers</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>1</span>.<span>2</span> <span>Address</span> </h4>
  <ul>
    <li><span>User</span> <span>programs</span> <span>typically</span> <span>refer</span> <span>to</span> <span>memory</span> <span>addresses</span> <span>with</span> <span>symbolic</span> <span>names</span> <span>such</span> <span>as</span> <span>"i",</span> <span>"count",</span> <span>and</span> <span>"averageTemperature"</span>.<span></span> <span>These</span> <span>symbolic</span> <span>names</span> <span>must</span> <span>be</span> <span>mapped</span> <span>or</span> <span></span><em><span></span><strong><span>bound</span></strong><span></span></em><span></span> <span>to</span> <span>physical</span> <span>memory</span> <span>addresses,</span> <span>which</span> <span>typically</span> <span>occurs</span> <span>in</span> <span>several</span> <span>stages:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Compile</span> <span>Time</span></strong><span></span> <span>-</span> <span>If</span> <span>it</span> <span>is</span> <span>known</span> <span>at</span> <span>compile</span> <span>time</span> <span>where</span> <span>a</span> <span>program</span> <span>will</span> <span>reside</span> <span>in</span> <span>physical</span> <span>memory,</span> <span>then</span><em><span></span><strong><span></span> <span>absolute</span> <span>code</span></strong><span></span></em><span></span> <span>can</span> <span>be</span> <span>generated</span> <span>by</span> <span>the</span> <span>compiler,</span> <span>containing</span> <span>actual</span> <span>physical</span> <span>addresses</span>.<span></span> <span>However</span> <span>if</span> <span>the</span> <span>load</span> <span>address</span> <span>changes</span> <span>at</span> <span>some</span> <span>later</span> <span>time,</span> <span>then</span> <span>the</span> <span>program</span> <span>will</span> <span>have</span> <span>to</span> <span>be</span> <span>recompiled</span>.<span></span> <span>DOS</span> <span></span>.<span>COM</span> <span>programs</span> <span>use</span> <span>compile</span> <span>time</span> <span>binding</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Load</span> <span>Time</span></strong><span></span> <span>-</span> <span>If</span> <span>the</span> <span>location</span> <span>at</span> <span>which</span> <span>a</span> <span>program</span> <span>will</span> <span>be</span> <span>loaded</span> <span>is</span> <span>not</span> <span>known</span> <span>at</span> <span>compile</span> <span>time,</span> <span>then</span> <span>the</span> <span>compiler</span> <span>must</span> <span>generate</span> <span></span><em><span></span><strong><span>relocatable</span> <span>code</span></strong><span></span></em><span>,</span> <span>which</span> <span>references</span> <span>addresses</span> <span>relative</span> <span>to</span> <span>the</span> <span>start</span> <span>of</span> <span>the</span> <span>program</span>.<span></span> <span>If</span> <span>that</span> <span>starting</span> <span>address</span> <span>changes,</span> <span>then</span> <span>the</span> <span>program</span> <span>must</span> <span>be</span> <span>reloaded</span> <span>but</span> <span>not</span> <span>recompiled</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Execution</span> <span>Time</span></strong><span></span> <span>-</span> <span>If</span> <span>a</span> <span>program</span> <span>can</span> <span>be</span> <span>moved</span> <span>around</span> <span>in</span> <span>memory</span> <span>during</span> <span>the</span> <span>course</span> <span>of</span> <span>its</span> <span>execution,</span> <span>then</span> <span>binding</span> <span>must</span> <span>be</span> <span>delayed</span> <span>until</span> <span>execution</span> <span>time</span>.<span></span> <span>This</span> <span>requires</span> <span>special</span> <span>hardware,</span> <span>and</span> <span>is</span> <span>the</span> <span>method</span> <span>implemented</span> <span>by</span> <span>most</span> <span>modern</span> <span>OSes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Figure</span> <span>8</span>.<span>3</span> <span>shows</span> <span>the</span> <span>various</span> <span>stages</span> <span>of</span> <span>the</span> <span>binding</span> <span>processes</span> <span>and</span> <span>the</span> <span>units</span> <span>involved</span> <span>in</span> <span>each</span> <span>stage:</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_03_MultistepProcessing.jpg" width="460" height="837"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>3</span> <span>-</span> <span>Multistep</span> <span>processing</span> <span>of</span> <span>a</span> <span>user</span> <span>program</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>1</span>.<span>3</span> <span>Logical</span> <span>Versus</span> <span>Physical</span> <span>Address</span> </h4>
  <ul>
    <li><span>The</span> <span>address</span> <span>generated</span> <span>by</span> <span>the</span> <span>CPU</span> <span>is</span> <span>a</span> <span></span><em><span></span><strong><span>logical</span> <span>address</span></strong><span></span></em><span>,</span> <span>whereas</span> <span>the</span> <span>address</span> <span>actually</span> <span>seen</span> <span>by</span> <span>the</span> <span>memory</span> <span>hardware</span> <span>is</span> <span>a</span> <span></span><em><span></span><strong><span>physical</span> <span>address</span></strong><span></span></em><span></span>.</li>
    <li><span>Addresses</span> <span>bound</span> <span>at</span> <span>compile</span> <span>time</span> <span>or</span> <span>load</span> <span>time</span> <span>have</span> <span>identical</span> <span>logical</span> <span>and</span> <span>physical</span> <span>addresses</span>.</li>
    <li><span>Addresses</span> <span>created</span> <span>at</span> <span>execution</span> <span>time,</span> <span>however,</span> <span>have</span> <span>different</span> <span>logical</span> <span>and</span> <span>physical</span> <span>addresses</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>In</span> <span>this</span> <span>case</span> <span>the</span> <span>logical</span> <span>address</span> <span>is</span> <span>also</span> <span>known</span> <span>as</span> <span>a</span> <span></span><em><span></span><strong><span>virtual</span> <span>address</span></strong><span></span></em><span>,</span> <span>and</span> <span>the</span> <span>two</span> <span>terms</span> <span>are</span> <span>used</span> <span>interchangeably</span> <span>by</span> <span>our</span> <span>text</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>set</span> <span>of</span> <span>all</span> <span>logical</span> <span>addresses</span> <span>used</span> <span>by</span> <span>a</span> <span>program</span> <span>composes</span> <span>the</span> <span></span><em><span></span><strong><span>logical</span> <span>address</span> <span>space</span></strong><span></span></em><span>,</span> <span>and</span> <span>the</span> <span>set</span> <span>of</span> <span>all</span> <span>corresponding</span> <span>physical</span> <span>addresses</span> <span>composes</span> <span>the</span> <span></span><em><span></span><strong><span>physical</span> <span>address</span> <span>space</span>.<span></span> <span></span></strong><span></span></em><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>run</span> <span>time</span> <span>mapping</span> <span>of</span> <span>logical</span> <span>to</span> <span>physical</span> <span>addresses</span> <span>is</span> <span>handled</span> <span>by</span> <span>the</span> <span></span><em><span></span><strong><span>memory-management</span> <span>unit,</span> <span>MMU</span></strong><span></span></em><span></span>.<span></span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>MMU</span> <span>can</span> <span>take</span> <span>on</span> <span>many</span> <span>forms</span>.<span></span> <span>One</span> <span>of</span> <span>the</span> <span>simplest</span> <span>is</span> <span>a</span> <span>modification</span> <span>of</span> <span>the</span> <span>base-register</span> <span>scheme</span> <span>described</span> <span>earlier</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>base</span> <span>register</span> <span>is</span> <span>now</span> <span>termed</span> <span>a</span> <span></span><em><span></span><strong><span>relocation</span> <span>register</span></strong><span></span></em><span>,</span> <span>whose</span> <span>value</span> <span>is</span> <span>added</span> <span>to</span> <span>every</span> <span>memory</span> <span>request</span> <span>at</span> <span>the</span> <span>hardware</span> <span>level</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Note</span> <span>that</span> <span>user</span> <span>programs</span> <span>never</span> <span>see</span> <span>physical</span> <span>addresses</span>.<span></span> <span>User</span> <span>programs</span> <span>work</span> <span>entirely</span> <span>in</span> <span>logical</span> <span>address</span> <span>space,</span> <span>and</span> <span>any</span> <span>memory</span> <span>references</span> <span>or</span> <span>manipulations</span> <span>are</span> <span>done</span> <span>using</span> <span></span> <span></span> <span></span> <span>purely</span> <span>logical</span> <span>addresses</span>.<span></span> <span>Only</span> <span>when</span> <span>the</span> <span>address</span> <span>gets</span> <span>sent</span> <span>to</span> <span>the</span> <span>physical</span> <span>memory</span> <span>chips</span> <span>is</span> <span>the</span> <span>physical</span> <span>memory</span> <span>address</span> <span>generated</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_04_DynamicRelocation.jpg" width="586" height="419"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>4</span> <span>-</span> <span>Dynamic</span> <span>relocation</span> <span>using</span> <span>a</span> <span>relocation</span> <span>register</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>1</span>.<span>4</span> <span>Dynamic</span> </h4>
  <ul>
    <li><span>Rather</span> <span>than</span> <span>loading</span> <span>an</span> <span>entire</span> <span>program</span> <span>into</span> <span>memory</span> <span>at</span> <span>once,</span> <span>dynamic</span> <span>loading</span> <span>loads</span> <span>up</span> <span>each</span> <span>routine</span> <span>as</span> <span>it</span> <span>is</span> <span>called</span>.<span></span> <span>The</span> <span>advantage</span> <span>is</span> <span>that</span> <span>unused</span> <span>routines</span> <span>need</span> <span>never</span> <span>be</span> <span>loaded,</span> <span>reducing</span> <span>total</span> <span>memory</span> <span>usage</span> <span>and</span> <span>generating</span> <span>faster</span> <span>program</span> <span>startup</span> <span>times</span>.<span></span> <span>The</span> <span>downside</span> <span>is</span> <span>the</span> <span>added</span> <span>complexity</span> <span>and</span> <span>overhead</span> <span>of</span> <span>checking</span> <span>to</span> <span>see</span> <span>if</span> <span>a</span> <span>routine</span> <span>is</span> <span>loaded</span> <span>every</span> <span>time</span> <span>it</span> <span>is</span> <span>called</span> <span>and</span> <span>then</span> <span>then</span> <span>loading</span> <span>it</span> <span>up</span> <span>if</span> <span>it</span> <span>is</span> <span>not</span> <span>already</span> <span>loaded</span>.<span></span> </li>
  </ul>
  <h4><span>8</span>.<span>1</span>.<span>5</span> <span>Dynamic</span> <span>Linking</span> <span>and</span> <span>Shared</span> </h4>
  <ul>
    <li><span>With</span> <span></span><em><span></span><strong><span>static</span> <span>linking</span></strong><span></span></em><span></span> <span>library</span> <span>modules</span> <span>get</span> <span>fully</span> <span>included</span> <span>in</span> <span>executable</span> <span>modules,</span> <span>wasting</span> <span>both</span> <span>disk</span> <span>space</span> <span>and</span> <span>main</span> <span>memory</span> <span>usage,</span> <span>because</span> <span>every</span> <span>program</span> <span>that</span> <span>included</span> <span>a</span> <span>certain</span> <span>routine</span> <span>from</span> <span>the</span> <span>library</span> <span>would</span> <span>have</span> <span>to</span> <span>have</span> <span>their</span> <span>own</span> <span>copy</span> <span>of</span> <span>that</span> <span>routine</span> <span>linked</span> <span>into</span> <span>their</span> <span>executable</span> <span>code</span>.</li>
    <li><span>With</span> <span></span><em><span></span><strong><span>dynamic</span> <span>linking</span></strong><span></span></em><span>,</span> <span>however,</span> <span>only</span> <span>a</span> <span>stub</span> <span>is</span> <span>linked</span> <span>into</span> <span>the</span> <span>executable</span> <span>module,</span> <span>containing</span> <span>references</span> <span>to</span> <span>the</span> <span>actual</span> <span>library</span> <span>module</span> <span>linked</span> <span>in</span> <span>at</span> <span>run</span> <span>time</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>This</span> <span>method</span> <span>saves</span> <span>disk</span> <span>space,</span> <span>because</span> <span>the</span> <span>library</span> <span>routines</span> <span>do</span> <span>not</span> <span>need</span> <span>to</span> <span>be</span> <span>fully</span> <span>included</span> <span>in</span> <span>the</span> <span>executable</span> <span>modules,</span> <span>only</span> <span>the</span> <span>stubs</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>We</span> <span>will</span> <span>also</span> <span>learn</span> <span>that</span> <span>if</span> <span>the</span> <span>code</span> <span>section</span> <span>of</span> <span>the</span> <span>library</span> <span>routines</span> <span>is</span> <span></span><em><span></span><strong><span>reentrant</span></strong><span></span></em><span>,</span> <span>(&nbsp;meaning</span> <span>it</span> <span>does</span> <span>not</span> <span>modify</span> <span>the</span> <span>code</span> <span>while</span> <span>it</span> <span>runs,</span> <span>making</span> <span>it</span> <span>safe</span> <span>to</span> <span>re-enter</span> <span>it&nbsp;),</span> <span>then</span> <span>main</span> <span>memory</span> <span>can</span> <span>be</span> <span>saved</span> <span>by</span> <span>loading</span> <span>only</span> <span>one</span> <span>copy</span> <span>of</span> <span>dynamically</span> <span>linked</span> <span>routines</span> <span>into</span> <span>memory</span> <span>and</span> <span>sharing</span> <span>the</span> <span>code</span> <span>amongst</span> <span>all</span> <span>processes</span> <span>that</span> <span>are</span> <span>concurrently</span> <span>using</span> <span>it</span>.<span></span> <span>(&nbsp;Each</span> <span>process</span> <span>would</span> <span>have</span> <span>their</span> <span>own</span> <span>copy</span> <span>of</span> <span>the</span> <span></span><em><span></span><strong><span>data</span></strong><span></span></em><span></span> <span>section</span> <span>of</span> <span>the</span> <span>routines,</span> <span>but</span> <span>that</span> <span>may</span> <span>be</span> <span>small</span> <span>relative</span> <span>to</span> <span>the</span> <span>code</span> <span>segments</span>.<span>&nbsp;)</span> <span></span> <span>Obviously</span> <span>the</span> <span>OS</span> <span>must</span> <span>manage</span> <span>shared</span> <span>routines</span> <span>in</span> <span>memory</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>An</span> <span>added</span> <span>benefit</span> <span>of</span> <span></span><em><span></span><strong><span>dynamically</span> <span>linked</span> <span>libraries</span></strong><span></span></em><span></span> <span></span> <span></span> <span>(&nbsp;</span><em><span></span><strong><span>DLLs</span></strong><span></span></em><span>,</span> <span>also</span> <span>known</span> <span>as</span> <span></span><em><span></span><strong><span>shared</span> <span>libraries</span></strong><span></span></em><span></span> <span>or</span> <span></span><em><span></span><strong><span>shared</span> <span>objects</span></strong><span></span></em><span></span> <span>on</span> <span>UNIX</span> <span>systems&nbsp;)</span> <span>involves</span> <span>easy</span> <span>upgrades</span> <span>and</span> <span>updates</span>.<span></span> <span>When</span> <span>a</span> <span>program</span> <span>uses</span> <span>a</span> <span>routine</span> <span>from</span> <span>a</span> <span>standard</span> <span>library</span> <span>and</span> <span>the</span> <span>routine</span> <span>changes,</span> <span>then</span> <span>the</span> <span>program</span> <span>must</span> <span>be</span> <span>re-built</span> <span>(&nbsp;re-linked&nbsp;)</span> <span>in</span> <span>order</span> <span>to</span> <span>incorporate</span> <span>the</span> <span>changes</span>.<span></span> <span>However</span> <span>if</span> <span>DLLs</span> <span>are</span> <span>used,</span> <span>then</span> <span>as</span> <span>long</span> <span>as</span> <span>the</span> <span>stub</span> <span>doesn't</span> <span>change,</span> <span>the</span> <span>program</span> <span>can</span> <span>be</span> <span>updated</span> <span>merely</span> <span>by</span> <span>loading</span> <span>new</span> <span>versions</span> <span>of</span> <span>the</span> <span>DLLs</span> <span>onto</span> <span>the</span> <span>system</span>.<span></span> <span>Version</span> <span>information</span> <span>is</span> <span>maintained</span> <span>in</span> <span>both</span> <span>the</span> <span>program</span> <span>and</span> <span>the</span> <span>DLLs,</span> <span>so</span> <span>that</span> <span>a</span> <span>program</span> <span>can</span> <span>specify</span> <span>a</span> <span>particular</span> <span>version</span> <span>of</span> <span>the</span> <span>DLL</span> <span>if</span> <span>necessary</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>In</span> <span>practice,</span> <span>the</span> <span>first</span> <span>time</span> <span>a</span> <span>program</span> <span>calls</span> <span>a</span> <span>DLL</span> <span>routine,</span> <span>the</span> <span>stub</span> <span>will</span> <span>recognize</span> <span>the</span> <span>fact</span> <span>and</span> <span>will</span> <span>replace</span> <span>itself</span> <span>with</span> <span>the</span> <span>actual</span> <span>routine</span> <span>from</span> <span>the</span> <span>DLL</span> <span>library</span>.<span></span> <span>Further</span> <span>calls</span> <span>to</span> <span>the</span> <span>same</span> <span>routine</span> <span>will</span> <span>access</span> <span>the</span> <span>routine</span> <span>directly</span> <span>and</span> <span>not</span> <span>incur</span> <span>the</span> <span>overhead</span> <span>of</span> <span>the</span> <span>stub</span> <span>access</span>.<span></span> <span>(&nbsp;Following</span> <span>the</span> <span>UML</span> <span></span><em><span></span><strong><span>Proxy</span> <span>Pattern</span></strong><span></span></em><span></span>.<span>&nbsp;)</span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>(&nbsp;Additional</span> <span>information</span> <span>regarding</span> <span>dynamic</span> <span>linking</span> <span>is</span> <span>available</span> <span>at</span> <span></span><a href="http://www.iecc.com/linker/linker10.html"><span>http://www</span>.<span>iecc</span>.<span>com/linker/linker10</span>.<span>html</span></a><span>&nbsp;)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
</blockquote>
<h3><span>8</span>.<span>2</span> </h3>
<ul>
  <li><span>A</span> <span>process</span> <span>must</span> <span>be</span> <span>loaded</span> <span>into</span> <span>memory</span> <span>in</span> <span>order</span> <span>to</span> <span>execute</span>.</li>
  <li><span>If</span> <span>there</span> <span>is</span> <span>not</span> <span>enough</span> <span>memory</span> <span>available</span> <span>to</span> <span>keep</span> <span>all</span> <span>running</span> <span>processes</span> <span>in</span> <span>memory</span> <span>at</span> <span>the</span> <span>same</span> <span>time,</span> <span>then</span> <span>some</span> <span>processes</span> <span>who</span> <span>are</span> <span>not</span> <span>currently</span> <span>using</span> <span>the</span> <span>CPU</span> <span>may</span> <span>have</span> <span>their</span> <span>memory</span> <span>swapped</span> <span>out</span> <span>to</span> <span>a</span> <span>fast</span> <span>local</span> <span>disk</span> <span>called</span> <span>the</span> <span></span><em><span></span><strong><span>backing</span> <span>store</span>.<span></span></strong><span></span></em></li>
</ul>
<blockquote>
  <h4><span>8</span>.<span>2</span>.<span>1</span> <span>Standard</span> </h4>
  <ul>
    <li><span>If</span> <span>compile-time</span> <span>or</span> <span>load-time</span> <span>address</span> <span>binding</span> <span>is</span> <span>used,</span> <span>then</span> <span>processes</span> <span>must</span> <span>be</span> <span>swapped</span> <span>back</span> <span>into</span> <span>the</span> <span>same</span> <span>memory</span> <span>location</span> <span>from</span> <span>which</span> <span>they</span> <span>were</span> <span>swapped</span> <span>out</span>.<span></span> <span>If</span> <span>execution</span> <span>time</span> <span>binding</span> <span>is</span> <span>used,</span> <span>then</span> <span>the</span> <span>processes</span> <span>can</span> <span>be</span> <span>swapped</span> <span>back</span> <span>into</span> <span>any</span> <span>available</span> <span>location</span>.<span></span> </li>
    <li><span>Swapping</span> <span>is</span> <span>a</span> <span>very</span> <span>slow</span> <span>process</span> <span>compared</span> <span>to</span> <span>other</span> <span>operations</span>.<span></span> <span>For</span> <span>example,</span> <span>if</span> <span>a</span> <span>user</span> <span>process</span> <span>occupied</span> <span>10&nbsp;MB</span> <span>and</span> <span>the</span> <span>transfer</span> <span>rate</span> <span>for</span> <span>the</span> <span>backing</span> <span>store</span> <span>were</span> <span>40</span> <span>MB</span> <span>per</span> <span>second,</span> <span>then</span> <span>it</span> <span>would</span> <span>take</span> <span>1/4</span> <span>second</span> <span>(&nbsp;250</span> <span>milliseconds&nbsp;)</span> <span>just</span> <span>to</span> <span>do</span> <span>the</span> <span>data</span> <span>transfer</span>.<span></span> <span>Adding</span> <span>in</span> <span>a</span> <span>latency</span> <span>lag</span> <span>of</span> <span>8</span> <span>milliseconds</span> <span>and</span> <span>ignoring</span> <span>head</span> <span>seek</span> <span>time</span> <span>for</span> <span>the</span> <span>moment,</span> <span>and</span> <span>further</span> <span>recognizing</span> <span>that</span> <span>swapping</span> <span>involves</span> <span>moving</span> <span>old</span> <span>data</span> <span>out</span> <span>as</span> <span>well</span> <span>as</span> <span>new</span> <span>data</span> <span>in,</span> <span>the</span> <span>overall</span> <span>transfer</span> <span>time</span> <span>required</span> <span>for</span> <span>this</span> <span>swap</span> <span>is</span> <span>512</span> <span>milliseconds,</span> <span>or</span> <span>over</span> <span>half</span> <span>a</span> <span>second</span>.<span></span> <span>For</span> <span>efficient</span> <span>processor</span> <span>scheduling</span> <span>the</span> <span>CPU</span> <span>time</span> <span>slice</span> <span>should</span> <span>be</span> <span>significantly</span> <span>longer</span> <span>than</span> <span>this</span> <span>lost</span> <span>transfer</span> <span>time</span>.</li>
    <li><span>To</span> <span>reduce</span> <span>swapping</span> <span>transfer</span> <span>overhead,</span> <span>it</span> <span>is</span> <span>desired</span> <span>to</span> <span>transfer</span> <span>as</span> <span>little</span> <span>information</span> <span>as</span> <span>possible,</span> <span>which</span> <span>requires</span> <span>that</span> <span>the</span> <span>system</span> <span>know</span> <span>how</span> <span>much</span> <span>memory</span> <span>a</span> <span>process</span> <span></span><em><span></span><strong><span>is</span></strong><span></span></em><span></span> <span>using,</span> <span>as</span> <span>opposed</span> <span>to</span> <span>how</span> <span>much</span> <span>it</span> <span></span><em><span></span><strong><span>might</span></strong><span></span></em><span></span> <span>use</span>.<span></span> <span>Programmers</span> <span>can</span> <span>help</span> <span>with</span> <span>this</span> <span>by</span> <span>freeing</span> <span>up</span> <span>dynamic</span> <span>memory</span> <span>that</span> <span>they</span> <span>are</span> <span>no</span> <span>longer</span> <span>using</span>.</li>
    <li><span>It</span> <span>is</span> <span>important</span> <span></span> <span>to</span> <span>swap</span> <span>processes</span> <span>out</span> <span>of</span> <span>memory</span> <span>only</span> <span>when</span> <span>they</span> <span>are</span> <span>idle,</span> <span>or</span> <span>more</span> <span>to</span> <span>the</span> <span>point,</span> <span>only</span> <span>when</span> <span>there</span> <span>are</span> <span>no</span> <span>pending</span> <span>I/O</span> <span>operations</span>.<span></span> <span>(&nbsp;Otherwise</span> <span>the</span> <span>pending</span> <span>I/O</span> <span>operation</span> <span>could</span> <span>write</span> <span>into</span> <span>the</span> <span>wrong</span> <span>process's</span> <span>memory</span> <span>space</span>.<span>&nbsp;)</span> <span>The</span> <span>solution</span> <span>is</span> <span>to</span> <span>either</span> <span>swap</span> <span>only</span> <span>totally</span> <span>idle</span> <span>processes,</span> <span>or</span> <span>do</span> <span>I/O</span> <span>operations</span> <span>only</span> <span>into</span> <span>and</span> <span>out</span> <span>of</span> <span>OS</span> <span>buffers,</span> <span>which</span> <span>are</span> <span>then</span> <span>transferred</span> <span>to</span> <span>or</span> <span>from</span> <span>process's</span> <span>main</span> <span>memory</span> <span>as</span> <span>a</span> <span>second</span> <span>step</span>.<span></span> </li>
    <li><span>Most</span> <span>modern</span> <span>OSes</span> <span>no</span> <span>longer</span> <span>use</span> <span>swapping,</span> <span>because</span> <span>it</span> <span>is</span> <span>too</span> <span>slow</span> <span>and</span> <span>there</span> <span>are</span> <span>faster</span> <span>alternatives</span> <span>available</span>.<span></span> <span>(&nbsp;e</span>.<span>g</span>.<span></span> <span>Paging</span>.<span>&nbsp;)</span> <span>However</span> <span>some</span> <span>UNIX</span> <span>systems</span> <span>will</span> <span>still</span> <span>invoke</span> <span>swapping</span> <span>if</span> <span>the</span> <span>system</span> <span>gets</span> <span>extremely</span> <span>full,</span> <span>and</span> <span>then</span> <span>discontinue</span> <span>swapping</span> <span>when</span> <span>the</span> <span>load</span> <span>reduces</span> <span>again</span>.<span></span> <span>Windows</span> <span>3</span>.<span>1</span> <span>would</span> <span>use</span> <span>a</span> <span>modified</span> <span>version</span> <span>of</span> <span>swapping</span> <span>that</span> <span>was</span> <span>somewhat</span> <span>controlled</span> <span>by</span> <span>the</span> <span>user,</span> <span>swapping</span> <span>process's</span> <span>out</span> <span>if</span> <span>necessary</span> <span>and</span> <span>then</span> <span>only</span> <span>swapping</span> <span>them</span> <span>back</span> <span>in</span> <span>when</span> <span>the</span> <span>user</span> <span>focused</span> <span>on</span> <span>that</span> <span>particular</span> <span>window</span>.<span></span> </li>
  </ul>
</blockquote>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_05_ProcessSwapping.jpg" width="562" height="425"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>5</span> <span>-</span> <span>Swapping</span> <span>of</span> <span>two</span> <span>processes</span> <span>using</span> <span>a</span> <span>disk</span> <span>as</span> <span>a</span> <span>backing</span> <span>store</span></strong></p>
<blockquote>
  <h4 align="left"><span>8</span>.<span>2</span>.<span>2</span> <span>Swapping</span> <span>on</span> <span>Mobile</span> <span>Systems</span> <span>(</span> <span>New</span> <span>Section</span> <span>in</span> <span>9th</span> <span>Edition</span> </h4>
  <ul>
    <li><span>Swapping</span> <span>is</span> <span>typically</span> <span>not</span> <span>supported</span> <span>on</span> <span>mobile</span> <span>platforms,</span> <span>for</span> <span>several</span> <span>reasons:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Mobile</span> <span>devices</span> <span>typically</span> <span>use</span> <span>flash</span> <span>memory</span> <span>in</span> <span>place</span> <span>of</span> <span>more</span> <span>spacious</span> <span>hard</span> <span>drives</span> <span>for</span> <span>persistent</span> <span>storage,</span> <span>so</span> <span>there</span> <span>is</span> <span>not</span> <span>as</span> <span>much</span> <span>space</span> <span>available</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Flash</span> <span>memory</span> <span>can</span> <span>only</span> <span>be</span> <span>written</span> <span>to</span> <span>a</span> <span>limited</span> <span>number</span> <span>of</span> <span>times</span> <span>before</span> <span>it</span> <span>becomes</span> <span>unreliable</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>bandwidth</span> <span>to</span> <span>flash</span> <span>memory</span> <span>is</span> <span>also</span> <span>lower</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Apple's</span> <span>IOS</span> <span>asks</span> <span>applications</span> <span>to</span> <span>voluntarily</span> <span>free</span> <span>up</span> <span>memory
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Read-only</span> <span>data,</span> <span>e</span>.<span>g</span>.<span></span> <span>code,</span> <span>is</span> <span>simply</span> <span>removed,</span> <span>and</span> <span>reloaded</span> <span>later</span> <span>if</span> <span>needed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Modified</span> <span>data,</span> <span>e</span>.<span>g</span>.<span></span> <span>the</span> <span>stack,</span> <span>is</span> <span>never</span> <span>removed,</span> <span>but</span> <span></span>.<span></span> <span></span>.<span></span> <span></span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Apps</span> <span>that</span> <span>fail</span> <span>to</span> <span>free</span> <span>up</span> <span>sufficient</span> <span>memory</span> <span>can</span> <span>be</span> <span>removed</span> <span>by</span> <span>the</span> <span>OS</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Android</span> <span>follows</span> <span>a</span> <span>similar</span> <span>strategy</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Prior</span> <span>to</span> <span>terminating</span> <span>a</span> <span>process,</span> <span>Android</span> <span>writes</span> <span>its</span> <span></span><em><span></span><strong><span>application</span> <span>state</span></strong><span></span></em><span></span> <span>to</span> <span>flash</span> <span>memory</span> <span>for</span> <span>quick</span> <span>restarting</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
</blockquote>
<h3><span>8</span>.<span>3</span> <span>Contiguous</span> <span>Memory</span> </h3>
<ul>
  <li><span>One</span> <span>approach</span> <span>to</span> <span>memory</span> <span>management</span> <span>is</span> <span>to</span> <span>load</span> <span>each</span> <span>process</span> <span>into</span> <span>a</span> <span>contiguous</span> <span>space</span>.<span></span> <span>The</span> <span>operating</span> <span>system</span> <span>is</span> <span>allocated</span> <span>space</span> <span>first,</span> <span>usually</span> <span>at</span> <span>either</span> <span>low</span> <span>or</span> <span>high</span> <span>memory</span> <span>locations,</span> <span>and</span> <span>then</span> <span>the</span> <span>remaining</span> <span>available</span> <span>memory</span> <span>is</span> <span>allocated</span> <span>to</span> <span>processes</span> <span>as</span> <span>needed</span>.<span></span> <span>(&nbsp;The</span> <span>OS</span> <span>is</span> <span>usually</span> <span>loaded</span> <span>low,</span> <span>because</span> <span>that</span> <span>is</span> <span>where</span> <span>the</span> <span>interrupt</span> <span>vectors</span> <span>are</span> <span>located,</span> <span>but</span> <span>on</span> <span>older</span> <span>systems</span> <span>part</span> <span>of</span> <span>the</span> <span>OS</span> <span>was</span> <span>loaded</span> <span>high</span> <span>to</span> <span>make</span> <span>more</span> <span>room</span> <span>in</span> <span>low</span> <span>memory</span> <span>(</span> <span>within</span> <span>the</span> <span>640K</span> <span>barrier</span> <span>)</span> <span>for</span> <span>user</span> <span>processes</span>.<span>&nbsp;)</span> </li>
</ul>
<blockquote>
  <h4><span>8</span>.<span>3</span>.<span>1</span> <span>Memory</span> <span>Protection</span> <span>(</span> <span>was</span> <span>Memory</span> <span>Mapping</span> <span>and</span> <span>Protection</span> </h4>
  <ul>
    <li><span>The</span> <span>system</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.<span>6</span> <span>below</span> <span>allows</span> <span>protection</span> <span>against</span> <span>user</span> <span>programs</span> <span>accessing</span> <span>areas</span> <span>that</span> <span>they</span> <span>should</span> <span>not,</span> <span>allows</span> <span>programs</span> <span>to</span> <span>be</span> <span>relocated</span> <span>to</span> <span>different</span> <span>memory</span> <span>starting</span> <span>addresses</span> <span>as</span> <span>needed,</span> <span>and</span> <span>allows</span> <span>the</span> <span>memory</span> <span>space</span> <span>devoted</span> <span>to</span> <span>the</span> <span>OS</span> <span>to</span> <span>grow</span> <span>or</span> <span>shrink</span> <span>dynamically</span> <span>as</span> <span>needs</span> <span>change</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_06_HardwareSupport.jpg" width="621" height="322"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>6</span> <span>-</span> <span>Hardware</span> <span>support</span> <span>for</span> <span>relocation</span> <span>and</span> <span>limit</span> <span>registers</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>3</span>.<span>2</span> <span>Memory</span> </h4>
  <ul>
    <li><span>One</span> <span>method</span> <span>of</span> <span>allocating</span> <span>contiguous</span> <span>memory</span> <span>is</span> <span>to</span> <span>divide</span> <span>all</span> <span>available</span> <span>memory</span> <span>into</span> <span>equal</span> <span>sized</span> <span>partitions,</span> <span>and</span> <span>to</span> <span>assign</span> <span>each</span> <span>process</span> <span>to</span> <span>their</span> <span>own</span> <span>partition</span>.<span></span> <span>This</span> <span>restricts</span> <span>both</span> <span>the</span> <span>number</span> <span>of</span> <span>simultaneous</span> <span>processes</span> <span>and</span> <span>the</span> <span>maximum</span> <span>size</span> <span>of</span> <span>each</span> <span>process,</span> <span>and</span> <span>is</span> <span>no</span> <span>longer</span> <span>used</span>.</li>
    <li><span>An</span> <span>alternate</span> <span>approach</span> <span>is</span> <span>to</span> <span>keep</span> <span>a</span> <span>list</span> <span>of</span> <span>unused</span> <span>(&nbsp;free&nbsp;)</span> <span>memory</span> <span>blocks</span> <span>(&nbsp;holes&nbsp;),</span> <span>and</span> <span>to</span> <span>find</span> <span>a</span> <span>hole</span> <span>of</span> <span>a</span> <span>suitable</span> <span>size</span> <span>whenever</span> <span>a</span> <span>process</span> <span>needs</span> <span>to</span> <span>be</span> <span>loaded</span> <span>into</span> <span>memory</span>.<span></span> <span>There</span> <span>are</span> <span>many</span> <span>different</span> <span>strategies</span> <span>for</span> <span>finding</span> <span>the</span> <span>"best"</span> <span>allocation</span> <span>of</span> <span>memory</span> <span>to</span> <span>processes,</span> <span>including</span> <span>the</span> <span>three</span> <span>most</span> <span>commonly</span> <span>discussed:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>First</span> <span>fit</span></strong><span></span> <span>-</span> <span>Search</span> <span>the</span> <span>list</span> <span>of</span> <span>holes</span> <span>until</span> <span>one</span> <span>is</span> <span>found</span> <span>that</span> <span>is</span> <span>big</span> <span>enough</span> <span>to</span> <span>satisfy</span> <span>the</span> <span>request,</span> <span>and</span> <span>assign</span> <span>a</span> <span>portion</span> <span>of</span> <span>that</span> <span>hole</span> <span>to</span> <span>that</span> <span>process</span>.<span></span> <span></span> <span>Whatever</span> <span>fraction</span> <span>of</span> <span>the</span> <span>hole</span> <span>not</span> <span>needed</span> <span>by</span> <span>the</span> <span>request</span> <span>is</span> <span>left</span> <span>on</span> <span>the</span> <span>free</span> <span>list</span> <span>as</span> <span>a</span> <span>smaller</span> <span>hole</span>.<span></span> <span>Subsequent</span> <span>requests</span> <span>may</span> <span>start</span> <span>looking</span> <span>either</span> <span>from</span> <span>the</span> <span>beginning</span> <span>of</span> <span>the</span> <span>list</span> <span>or</span> <span>from</span> <span>the</span> <span>point</span> <span>at</span> <span>which</span> <span>this</span> <span>search</span> <span>ended</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Best</span> <span>fit</span></strong><span></span> <span>-</span> <span>Allocate</span> <span>the</span> <span></span><em><span>smallest</span></em><span></span> <span>hole</span> <span>that</span> <span>is</span> <span>big</span> <span>enough</span> <span>to</span> <span>satisfy</span> <span>the</span> <span>request</span>.<span></span> <span>This</span> <span>saves</span> <span>large</span> <span>holes</span> <span>for</span> <span>other</span> <span>process</span> <span>requests</span> <span>that</span> <span>may</span> <span>need</span> <span>them</span> <span>later,</span> <span>but</span> <span>the</span> <span>resulting</span> <span>unused</span> <span>portions</span> <span>of</span> <span>holes</span> <span>may</span> <span>be</span> <span>too</span> <span>small</span> <span>to</span> <span>be</span> <span>of</span> <span>any</span> <span>use,</span> <span>and</span> <span>will</span> <span>therefore</span> <span>be</span> <span>wasted</span>.<span></span> <span>Keeping</span> <span>the</span> <span>free</span> <span>list</span> <span>sorted</span> <span>can</span> <span>speed</span> <span>up</span> <span>the</span> <span>process</span> <span>of</span> <span>finding</span> <span>the</span> <span>right</span> <span>hole</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Worst</span> <span>fit</span> <span></span> <span></span> <span></span> <span></span> <span></span></strong><span>-</span> <span>Allocate</span> <span>the</span> <span>largest</span> <span>hole</span> <span>available,</span> <span>thereby</span> <span>increasing</span> <span>the</span> <span>likelihood</span> <span>that</span> <span>the</span> <span>remaining</span> <span>portion</span> <span>will</span> <span>be</span> <span>usable</span> <span>for</span> <span>satisfying</span> <span>future</span> <span>requests</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Simulations</span> <span>show</span> <span>that</span> <span>either</span> <span>first</span> <span>or</span> <span>best</span> <span>fit</span> <span>are</span> <span>better</span> <span>than</span> <span>worst</span> <span>fit</span> <span>in</span> <span>terms</span> <span>of</span> <span>both</span> <span>time</span> <span>and</span> <span>storage</span> <span>utilization</span>.<span></span> <span></span> <span>First</span> <span>and</span> <span>best</span> <span>fits</span> <span>are</span> <span>about</span> <span>equal</span> <span>in</span> <span>terms</span> <span>of</span> <span>storage</span> <span>utilization,</span> <span>but</span> <span>first</span> <span>fit</span> <span>is</span> <span>faster</span>.<span></span> </li>
  </ul>
  <h4><span>8</span>.<span>3</span>.<span>3</span>.<span></span> </h4>
  <ul>
    <li><span>All</span> <span>the</span> <span>memory</span> <span>allocation</span> <span>strategies</span> <span>suffer</span> <span>from</span> <span></span><em><span></span><strong><span>external</span> <span>fragmentation</span></strong><span></span></em><span>,</span> <span>though</span> <span>first</span> <span>and</span> <span>best</span> <span>fits</span> <span>experience</span> <span>the</span> <span>problems</span> <span>more</span> <span>so</span> <span>than</span> <span>worst</span> <span>fit</span>.<span></span> <span>External</span> <span>fragmentation</span> <span>means</span> <span>that</span> <span>the</span> <span>available</span> <span>memory</span> <span>is</span> <span>broken</span> <span>up</span> <span>into</span> <span>lots</span> <span>of</span> <span>little</span> <span>pieces,</span> <span>none</span> <span>of</span> <span>which</span> <span>is</span> <span>big</span> <span>enough</span> <span>to</span> <span>satisfy</span> <span>the</span> <span>next</span> <span>memory</span> <span>requirement,</span> <span>although</span> <span>the</span> <span>sum</span> <span>total</span> <span>could</span>.</li>
    <li><span>The</span> <span>amount</span> <span>of</span> <span>memory</span> <span>lost</span> <span>to</span> <span>fragmentation</span> <span>may</span> <span>vary</span> <span>with</span> <span>algorithm,</span> <span>usage</span> <span>patterns,</span> <span>and</span> <span>some</span> <span>design</span> <span>decisions</span> <span>such</span> <span>as</span> <span>which</span> <span>end</span> <span>of</span> <span>a</span> <span>hole</span> <span>to</span> <span>allocate</span> <span>and</span> <span>which</span> <span>end</span> <span>to</span> <span>save</span> <span>on</span> <span>the</span> <span>free</span> <span>list</span>.</li>
    <li><span>Statistical</span> <span>analysis</span> <span>of</span> <span>first</span> <span>fit,</span> <span>for</span> <span>example,</span> <span>shows</span> <span>that</span> <span>for</span> <span>N</span> <span>blocks</span> <span>of</span> <span>allocated</span> <span>memory,</span> <span>another</span> <span>0</span>.<span>5</span> <span>N</span> <span>will</span> <span>be</span> <span>lost</span> <span>to</span> <span>fragmentation</span>.</li>
    <li><span></span><em><span></span><strong><span>Internal</span> <span>fragmentation</span></strong><span></span></em><span></span> <span>also</span> <span>occurs,</span> <span>with</span> <span>all</span> <span>memory</span> <span>allocation</span> <span>strategies</span>.<span></span> <span></span> <span>This</span> <span>is</span> <span>caused</span> <span>by</span> <span>the</span> <span>fact</span> <span>that</span> <span>memory</span> <span>is</span> <span>allocated</span> <span>in</span> <span>blocks</span> <span>of</span> <span>a</span> <span>fixed</span> <span>size,</span> <span>whereas</span> <span>the</span> <span>actual</span> <span>memory</span> <span>needed</span> <span>will</span> <span>rarely</span> <span>be</span> <span>that</span> <span>exact</span> <span>size</span>.<span></span> <span>For</span> <span>a</span> <span>random</span> <span>distribution</span> <span>of</span> <span>memory</span> <span>requests,</span> <span>on</span> <span>the</span> <span>average</span> <span>1/2</span> <span>block</span> <span>will</span> <span>be</span> <span>wasted</span> <span>per</span> <span>memory</span> <span>request,</span> <span>because</span> <span>on</span> <span>the</span> <span>average</span> <span>the</span> <span>last</span> <span>allocated</span> <span>block</span> <span>will</span> <span>be</span> <span>only</span> <span>half</span> <span>full</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Note</span> <span>that</span> <span>the</span> <span>same</span> <span>effect</span> <span>happens</span> <span>with</span> <span>hard</span> <span>drives,</span> <span>and</span> <span>that</span> <span>modern</span> <span>hardware</span> <span>gives</span> <span>us</span> <span>increasingly</span> <span>larger</span> <span>drives</span> <span>and</span> <span>memory</span> <span>at</span> <span>the</span> <span>expense</span> <span>of</span> <span>ever</span> <span>larger</span> <span>block</span> <span>sizes,</span> <span>which</span> <span>translates</span> <span>to</span> <span>more</span> <span>memory</span> <span>lost</span> <span>to</span> <span>internal</span> <span>fragmentation</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Some</span> <span>systems</span> <span>use</span> <span>variable</span> <span>size</span> <span>blocks</span> <span>to</span> <span>minimize</span> <span>losses</span> <span>due</span> <span>to</span> <span>internal</span> <span>fragmentation</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>If</span> <span>the</span> <span>programs</span> <span>in</span> <span>memory</span> <span>are</span> <span>relocatable,</span> <span>(&nbsp;using</span> <span>execution-time</span> <span>address</span> <span>binding&nbsp;),</span> <span>then</span> <span>the</span> <span>external</span> <span>fragmentation</span> <span>problem</span> <span>can</span> <span>be</span> <span>reduced</span> <span>via</span> <span></span><em><span></span><strong><span>compaction</span></strong><span></span></em><span>,</span> <span>i</span>.<span>e</span>.<span></span> <span>moving</span> <span>all</span> <span>processes</span> <span>down</span> <span>to</span> <span>one</span> <span>end</span> <span>of</span> <span>physical</span> <span>memory</span>.<span></span> <span>This</span> <span>only</span> <span>involves</span> <span>updating</span> <span>the</span> <span>relocation</span> <span>register</span> <span>for</span> <span>each</span> <span>process,</span> <span>as</span> <span>all</span> <span>internal</span> <span>work</span> <span>is</span> <span>done</span> <span>using</span> <span>logical</span> <span>addresses</span>.<span></span> </li>
    <li><span>Another</span> <span>solution</span> <span>as</span> <span>we</span> <span>will</span> <span>see</span> <span>in</span> <span>upcoming</span> <span>sections</span> <span>is</span> <span>to</span> <span>allow</span> <span>processes</span> <span>to</span> <span>use</span> <span>non-contiguous</span> <span>blocks</span> <span>of</span> <span>physical</span> <span>memory,</span> <span>with</span> <span>a</span> <span>separate</span> <span>relocation</span> <span>register</span> <span>for</span> <span>each</span> <span>block</span>.<span></span> </li></ul></blockquote>
<h3><span>8</span>.<span>4</span> <span>Segmentation</span> </h3>
<blockquote>
  <h4><span>8</span>.<span>4</span>.<span>1</span> <span>Basic</span> </h4>
  <ul>
    <li><span>Most</span> <span>users</span> <span>(&nbsp;programmers&nbsp;)</span> <span>do</span> <span>not</span> <span>think</span> <span>of</span> <span>their</span> <span>programs</span> <span>as</span> <span>existing</span> <span>in</span> <span>one</span> <span>continuous</span> <span>linear</span> <span>address</span> <span>space</span>.</li>
    <li><span>Rather</span> <span>they</span> <span>tend</span> <span>to</span> <span>think</span> <span>of</span> <span>their</span> <span>memory</span> <span>in</span> <span>multiple</span> <span></span><em><span></span><strong><span>segments</span></strong><span></span></em><span>,</span> <span>each</span> <span>dedicated</span> <span>to</span> <span>a</span> <span>particular</span> <span>use,</span> <span>such</span> <span>as</span> <span>code,</span> <span>data,</span> <span>the</span> <span>stack,</span> <span>the</span> <span>heap,</span> <span>etc</span>.</li>
    <li><span>Memory</span> <span></span><em><span></span><strong><span>segmentation</span></strong><span></span></em><span></span> <span>supports</span> <span>this</span> <span>view</span> <span>by</span> <span>providing</span> <span>addresses</span> <span>with</span> <span>a</span> <span>segment</span> <span>number</span> <span>(&nbsp;mapped</span> <span>to</span> <span>a</span> <span>segment</span> <span>base</span> <span>address&nbsp;)</span> <span>and</span> <span>an</span> <span>offset</span> <span>from</span> <span>the</span> <span>beginning</span> <span>of</span> <span>that</span> <span>segment</span>.</li>
    <li><span>For</span> <span>example,</span> <span>a</span> <span>C</span> <span>compiler</span> <span>might</span> <span>generate</span> <span>5</span> <span>segments</span> <span>for</span> <span>the</span> <span>user</span> <span>code,</span> <span></span> <span>library</span> <span>code,</span> <span></span> <span>global</span> <span>(&nbsp;static&nbsp;)</span> <span>variables,</span> <span>the</span> <span>stack,</span> <span>and</span> <span>the</span> <span>heap,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.<span>7:</span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_07_UsersView.jpg" width="396" height="510"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>7</span> <span>Programmer's</span> <span>view</span> <span>of</span> <span>a</span> <span>program</span>.<span></span></strong><span>
</span> <span></span> </p>
  <br>
<h4><span>8</span>.<span>4</span>.<span>2</span> <span>Segmentation</span> </h4>
  <ul>
    <li><span>A</span> <span></span><em><span></span><strong><span>segment</span> <span>table</span></strong><span></span></em><span></span> <span>maps</span> <span>segment-offset</span> <span>addresses</span> <span>to</span> <span>physical</span> <span>addresses,</span> <span>and</span> <span>simultaneously</span> <span>checks</span> <span>for</span> <span>invalid</span> <span>addresses,</span> <span>using</span> <span>a</span> <span>system</span> <span>similar</span> <span>to</span> <span>the</span> <span>page</span> <span>tables</span> <span>and</span> <span>relocation</span> <span>base</span> <span>registers</span> <span>discussed</span> <span>previously</span>.<span></span> <span>(&nbsp;Note</span> <span>that</span> <span>at</span> <span>this</span> <span>point</span> <span>in</span> <span>the</span> <span>discussion</span> <span>of</span> <span>segmentation,</span> <span>each</span> <span>segment</span> <span>is</span> <span>kept</span> <span>in</span> <span>contiguous</span> <span>memory</span> <span>and</span> <span>may</span> <span>be</span> <span>of</span> <span>different</span> <span>sizes,</span> <span>but</span> <span>that</span> <span>segmentation</span> <span>can</span> <span>also</span> <span>be</span> <span>combined</span> <span>with</span> <span>paging</span> <span>as</span> <span>we</span> <span>shall</span> <span>see</span> <span>shortly</span>.<span>&nbsp;)</span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_08_SegmentationHardware.jpg" width="666" height="474"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>8</span> <span>-</span> <span>Segmentation</span> <span>hardware</span></strong></p>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_09_Segmentation.jpg" width="749" height="657"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>9</span> <span>-</span> <span>Example</span> <span>of</span> <span>segmentation</span></strong><span>
</span> <span></span> </p>
</blockquote>
<h3><span>8</span>.<span>5</span> <span>Paging</span> </h3>
<ul>
<li><span>Paging</span> <span>is</span> <span>a</span> <span>memory</span> <span>management</span> <span>scheme</span> <span>that</span> <span>allows</span> <span>processes</span> <span>physical</span> <span>memory</span> <span>to</span> <span>be</span> <span>discontinuous,</span> <span>and</span> <span>which</span> <span>eliminates</span> <span>problems</span> <span>with</span> <span>fragmentation</span> <span>by</span> <span>allocating</span> <span>memory</span> <span>in</span> <span>equal</span> <span>sized</span> <span>blocks</span> <span>known</span> <span>as</span> <span></span><em><span></span><strong><span>pages</span></strong><span></span></em><span></span>.</li>
  <li><span>Paging</span> <span>eliminates</span> <span>most</span> <span>of</span> <span>the</span> <span>problems</span> <span>of</span> <span>the</span> <span>other</span> <span>methods</span> <span>discussed</span> <span>previously,</span> <span>and</span> <span>is</span> <span>the</span> <span>predominant</span> <span>memory</span> <span>management</span> <span>technique</span> <span>used</span> <span>today</span>.<span></span> <span></span> </li>
</ul>
<h4><span>8</span>.<span>5</span>.<span>1</span> <span>Basic</span> </h4>
<ul>
  <li><span>The</span> <span>basic</span> <span>idea</span> <span>behind</span> <span>paging</span> <span>is</span> <span>to</span> <span>divide</span> <span>physical</span> <span>memory</span> <span>into</span> <span>a</span> <span>number</span> <span>of</span> <span>equal</span> <span>sized</span> <span>blocks</span> <span>called</span> <span></span><em><span></span><strong><span>frames</span></strong><span></span></em><span>,</span> <span>and</span> <span>to</span> <span>divide</span> <span>a</span> <span>programs</span> <span>logical</span> <span>memory</span> <span>space</span> <span>into</span> <span>blocks</span> <span>of</span> <span>the</span> <span>same</span> <span>size</span> <span>called</span> <span></span><em><span></span><strong><span>pages</span>.<span></span></strong><span></span></em></li>
  <li><span>Any</span> <span>page</span> <span>(&nbsp;from</span> <span>any</span> <span>process&nbsp;)</span> <span>can</span> <span>be</span> <span>placed</span> <span>into</span> <span>any</span> <span>available</span> <span>frame</span>.</li>
  <li><span>The</span> <span></span><em><span></span><strong><span>page</span> <span>table</span></strong><span></span></em><span></span> <span>is</span> <span>used</span> <span>to</span> <span>look</span> <span>up</span> <span>what</span> <span>frame</span> <span>a</span> <span>particular</span> <span>page</span> <span>is</span> <span>stored</span> <span>in</span> <span>at</span> <span>the</span> <span>moment</span>.<span></span> <span>In</span> <span>the</span> <span>following</span> <span>example,</span> <span>for</span> <span>instance,</span> <span>page</span> <span>2</span> <span>of</span> <span>the</span> <span>program's</span> <span>logical</span> <span>memory</span> <span>is</span> <span>currently</span> <span>stored</span> <span>in</span> <span>frame</span> <span>3</span> <span>of</span> <span>physical</span> <span>memory:</span> <span></span> <span></span> </li>
</ul>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_10_PagingHardware.jpg" width="797" height="483"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>10</span> <span>-</span> <span>Paging</span> <span>hardware</span></strong></p>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_11_PagingModel.jpg" width="533" height="496"><span></span><br><span>
</span><strong><span>Figure</span> <span>8</span>.<span>11</span> <span>-</span> <span>Paging</span> <span>model</span> <span>of</span> <span>logical</span> <span>and</span> <span>physical</span> <span>memory</span></strong></p>
<ul>
  <li><span>A</span> <span>logical</span> <span>address</span> <span>consists</span> <span>of</span> <span>two</span> <span>parts:</span> <span>A</span> <span>page</span> <span>number</span> <span>in</span> <span>which</span> <span>the</span> <span>address</span> <span>resides,</span> <span>and</span> <span>an</span> <span>offset</span> <span>from</span> <span>the</span> <span>beginning</span> <span>of</span> <span>that</span> <span>page</span>.<span></span> <span>(&nbsp;The</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>page</span> <span>number</span> <span>limits</span> <span>how</span> <span>many</span> <span>pages</span> <span>a</span> <span>single</span> <span>process</span> <span>can</span> <span>address</span>.<span></span> <span>The</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>offset</span> <span>determines</span> <span>the</span> <span>maximum</span> <span>size</span> <span>of</span> <span>each</span> <span>page,</span> <span>and</span> <span>should</span> <span>correspond</span> <span>to</span> <span>the</span> <span>system</span> <span>frame</span> <span>size</span>.</li>
  <li><span>The</span> <span>page</span> <span>table</span> <span>maps</span> <span>the</span> <span>page</span> <span>number</span> <span>to</span> <span>a</span> <span>frame</span> <span>number,</span> <span>to</span> <span>yield</span> <span>a</span> <span>physical</span> <span>address</span> <span>which</span> <span>also</span> <span>has</span> <span>two</span> <span>parts:</span> <span>The</span> <span>frame</span> <span>number</span> <span>and</span> <span>the</span> <span>offset</span> <span>within</span> <span>that</span> <span>frame</span>.<span></span> <span>The</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>frame</span> <span>number</span> <span>determines</span> <span>how</span> <span>many</span> <span>frames</span> <span>the</span> <span>system</span> <span>can</span> <span>address,</span> <span>and</span> <span>the</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>offset</span> <span>determines</span> <span>the</span> <span>size</span> <span>of</span> <span>each</span> <span>frame</span>.</li>
  <li><span>Page</span> <span>numbers,</span> <span>frame</span> <span>numbers,</span> <span>and</span> <span>frame</span> <span>sizes</span> <span>are</span> <span>determined</span> <span>by</span> <span>the</span> <span>architecture,</span> <span>but</span> <span>are</span> <span>typically</span> <span>powers</span> <span>of</span> <span>two,</span> <span>allowing</span> <span>addresses</span> <span>to</span> <span>be</span> <span>split</span> <span>at</span> <span>a</span> <span>certain</span> <span>number</span> <span>of</span> <span>bits</span>.<span></span> <span></span> <span>For</span> <span>example,</span> <span>if</span> <span>the</span> <span>logical</span> <span>address</span> <span>size</span> <span>is</span> <span>2^m</span> <span>and</span> <span>the</span> <span>page</span> <span>size</span> <span>is</span> <span>2^n,</span> <span>then</span> <span>the</span> <span>high-order</span> <span>m-n</span> <span>bits</span> <span>of</span> <span>a</span> <span>logical</span> <span>address</span> <span>designate</span> <span>the</span> <span>page</span> <span>number</span> <span>and</span> <span>the</span> <span>remaining</span> <span>n</span> <span>bits</span> <span>represent</span> <span>the</span> <span>offset</span>.<span></span> </li>
  <li><span>Note</span> <span>also</span> <span>that</span> <span>the</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>page</span> <span>number</span> <span>and</span> <span>the</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>the</span> <span>frame</span> <span>number</span> <span>do</span> <span>not</span> <span>have</span> <span>to</span> <span>be</span> <span>identical</span>.<span></span> <span>The</span> <span>former</span> <span>determines</span> <span>the</span> <span>address</span> <span>range</span> <span>of</span> <span>the</span> <span>logical</span> <span>address</span> <span>space,</span> <span>and</span> <span>the</span> <span>latter</span> <span>relates</span> <span>to</span> <span>the</span> <span>physical</span> <span>address</span> <span>space</span>.</li>
</ul>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_11A_PageNumberOffset.jpg" width="396" height="105"></p>
<ul>
  <li><span>(&nbsp;DOS</span> <span>used</span> <span>to</span> <span>use</span> <span>an</span> <span>addressing</span> <span>scheme</span> <span>with</span> <span>16</span> <span>bit</span> <span>frame</span> <span>numbers</span> <span>and</span> <span>16-bit</span> <span>offsets,</span> <span>on</span> <span>hardware</span> <span>that</span> <span>only</span> <span>supported</span> <span>24-bit</span> <span>hardware</span> <span>addresses</span>.<span></span> <span>The</span> <span>result</span> <span>was</span> <span>a</span> <span>resolution</span> <span>of</span> <span>starting</span> <span>frame</span> <span>addresses</span> <span>finer</span> <span>than</span> <span>the</span> <span>size</span> <span>of</span> <span>a</span> <span>single</span> <span>frame,</span> <span>and</span> <span>multiple</span> <span>frame-offset</span> <span>combinations</span> <span>that</span> <span>mapped</span> <span>to</span> <span>the</span> <span>same</span> <span>physical</span> <span>hardware</span> <span>address</span>.<span>&nbsp;)</span> </li>
<li><span>Consider</span> <span>the</span> <span>following</span> <span>micro</span> <span>example,</span> <span>in</span> <span>which</span> <span>a</span> <span>process</span> <span>has</span> <span>16</span> <span>bytes</span> <span>of</span> <span>logical</span> <span>memory,</span> <span>mapped</span> <span>in</span> <span>4</span> <span>byte</span> <span>pages</span> <span>into</span> <span>32</span> <span>bytes</span> <span>of</span> <span>physical</span> <span>memory</span>.<span></span> <span>(&nbsp;Presumably</span> <span>some</span> <span>other</span> <span>processes</span> <span>would</span> <span>be</span> <span>consuming</span> <span>the</span> <span>remaining</span> <span>16</span> <span>bytes</span> <span>of</span> <span>physical</span> <span>memory</span>.</li>
</ul>
<blockquote>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_12_PagingExample.jpg" width="581" height="723"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>12</span> <span>-</span> <span>Paging</span> <span>example</span> <span>for</span> <span>a</span> <span>32-byte</span> <span>memory</span> <span>with</span> <span>4-byte</span> <span>pages</span></strong><span>
</span> <span></span> </p>
</blockquote>
<ul>
  <li><span>Note</span> <span>that</span> <span>paging</span> <span>is</span> <span>like</span> <span>having</span> <span>a</span> <span>table</span> <span>of</span> <span>relocation</span> <span>registers,</span> <span>one</span> <span>for</span> <span>each</span> <span>page</span> <span>of</span> <span>the</span> <span>logical</span> <span>memory</span>.</li>
  <li><span>There</span> <span>is</span> <span>no</span> <span>external</span> <span>fragmentation</span> <span>with</span> <span>paging</span>.<span></span> <span>All</span> <span>blocks</span> <span>of</span> <span>physical</span> <span>memory</span> <span>are</span> <span>used,</span> <span>and</span> <span>there</span> <span>are</span> <span>no</span> <span>gaps</span> <span>in</span> <span>between</span> <span>and</span> <span>no</span> <span>problems</span> <span>with</span> <span>finding</span> <span>the</span> <span>right</span> <span>sized</span> <span>hole</span> <span>for</span> <span>a</span> <span>particular</span> <span>chunk</span> <span>of</span> <span>memory</span>.</li>
  <li><span>There</span> <span>is,</span> <span>however,</span> <span>internal</span> <span>fragmentation</span>.<span></span> <span>Memory</span> <span>is</span> <span>allocated</span> <span>in</span> <span>chunks</span> <span>the</span> <span>size</span> <span>of</span> <span>a</span> <span>page,</span> <span>and</span> <span>on</span> <span>the</span> <span>average,</span> <span>the</span> <span>last</span> <span>page</span> <span>will</span> <span>only</span> <span>be</span> <span>half</span> <span>full,</span> <span>wasting</span> <span>on</span> <span>the</span> <span>average</span> <span>half</span> <span>a</span> <span>page</span> <span>of</span> <span>memory</span> <span>per</span> <span>process</span>.<span></span> <span>(&nbsp;Possibly</span> <span>more,</span> <span>if</span> <span>processes</span> <span>keep</span> <span>their</span> <span>code</span> <span>and</span> <span>data</span> <span>in</span> <span>separate</span> <span>pages</span>.</li>
  <li><span>Larger</span> <span>page</span> <span>sizes</span> <span>waste</span> <span>more</span> <span>memory,</span> <span>but</span> <span>are</span> <span>more</span> <span>efficient</span> <span>in</span> <span>terms</span> <span>of</span> <span>overhead</span>.<span></span> <span>Modern</span> <span>trends</span> <span>have</span> <span>been</span> <span>to</span> <span>increase</span> <span>page</span> <span>sizes,</span> <span>and</span> <span>some</span> <span>systems</span> <span>even</span> <span>have</span> <span>multiple</span> <span>size</span> <span>pages</span> <span>to</span> <span>try</span> <span>and</span> <span>make</span> <span>the</span> <span>best</span> <span>of</span> <span>both</span> <span>worlds</span>.</li>
  <li><span>Page</span> <span>table</span> <span>entries</span> <span>(&nbsp;frame</span> <span>numbers&nbsp;)</span> <span>are</span> <span>typically</span> <span>32</span> <span>bit</span> <span>numbers,</span> <span>allowing</span> <span>access</span> <span>to</span> <span>2^32</span> <span>physical</span> <span>page</span> <span>frames</span>.<span></span> <span>If</span> <span>those</span> <span>frames</span> <span>are</span> <span>4</span> <span>KB</span> <span>in</span> <span>size</span> <span>each,</span> <span>that</span> <span>translates</span> <span>to</span> <span>16</span> <span>TB</span> <span>of</span> <span>addressable</span> <span>physical</span> <span>memory</span>.<span></span> <span>(</span> <span>32</span> <span>+</span> <span>12</span> <span>=</span> <span>44</span> <span>bits</span> <span>of</span> <span>physical</span> <span>address</span> <span>space</span>.<span></span> </li>
  <li><span>When</span> <span>a</span> <span>process</span> <span>requests</span> <span>memory</span> <span>(&nbsp;e</span>.<span>g</span>.<span></span> <span>when</span> <span>its</span> <span>code</span> <span>is</span> <span>loaded</span> <span>in</span> <span>from</span> <span>disk&nbsp;),</span> <span>free</span> <span>frames</span> <span>are</span> <span>allocated</span> <span>from</span> <span>a</span> <span>free-frame</span> <span>list,</span> <span>and</span> <span>inserted</span> <span>into</span> <span>that</span> <span>process's</span> <span>page</span> <span>table</span>.</li>
  <li><span>Processes</span> <span>are</span> <span>blocked</span> <span>from</span> <span>accessing</span> <span>anyone</span> <span>else's</span> <span>memory</span> <span>because</span> <span>all</span> <span>of</span> <span>their</span> <span>memory</span> <span>requests</span> <span>are</span> <span>mapped</span> <span>through</span> <span>their</span> <span>page</span> <span>table</span>.<span></span> <span>There</span> <span>is</span> <span>no</span> <span>way</span> <span>for</span> <span>them</span> <span>to</span> <span>generate</span> <span>an</span> <span>address</span> <span>that</span> <span>maps</span> <span>into</span> <span>any</span> <span>other</span> <span>process's</span> <span>memory</span> <span>space</span>.</li>
  <li><span>The</span> <span>operating</span> <span>system</span> <span>must</span> <span>keep</span> <span>track</span> <span>of</span> <span>each</span> <span>individual</span> <span>process's</span> <span>page</span> <span>table,</span> <span>updating</span> <span>it</span> <span>whenever</span> <span>the</span> <span>process's</span> <span>pages</span> <span>get</span> <span>moved</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>memory,</span> <span>and</span> <span>applying</span> <span>the</span> <span>correct</span> <span>page</span> <span>table</span> <span>when</span> <span>processing</span> <span>system</span> <span>calls</span> <span>for</span> <span>a</span> <span>particular</span> <span>process</span>.<span></span> <span>This</span> <span>all</span> <span>increases</span> <span>the</span> <span>overhead</span> <span>involved</span> <span>when</span> <span>swapping</span> <span>processes</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU</span>.<span></span> <span>(&nbsp;The</span> <span>currently</span> <span>active</span> <span>page</span> <span>table</span> <span>must</span> <span>be</span> <span>updated</span> <span>to</span> <span>reflect</span> <span>the</span> <span>process</span> <span>that</span> <span>is</span> <span>currently</span> <span>running</span>.<span>&nbsp;)</span> </li>
</ul>
<blockquote>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_13_FreeFrames.jpg" width="690" height="501"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>13</span> <span>-</span> <span>Free</span> <span>frames</span> <span>(a)</span> <span>before</span> <span>allocation</span> <span>and</span> <span>(b)</span> <span>after</span> <span>allocation</span></strong></p>
  <h4><span>8</span>.<span>5</span>.<span>2</span> <span>Hardware</span> </h4>
  <ul>
    <li><span>Page</span> <span>lookups</span> <span>must</span> <span>be</span> <span>done</span> <span>for</span> <span>every</span> <span>memory</span> <span>reference,</span> <span>and</span> <span>whenever</span> <span>a</span> <span>process</span> <span>gets</span> <span>swapped</span> <span>in</span> <span>or</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU,</span> <span>its</span> <span>page</span> <span>table</span> <span>must</span> <span>be</span> <span>swapped</span> <span>in</span> <span>and</span> <span>out</span> <span>too,</span> <span>along</span> <span>with</span> <span>the</span> <span>instruction</span> <span>registers,</span> <span>etc</span>.<span></span> <span>It</span> <span>is</span> <span>therefore</span> <span>appropriate</span> <span>to</span> <span>provide</span> <span>hardware</span> <span>support</span> <span>for</span> <span>this</span> <span>operation,</span> <span>in</span> <span>order</span> <span>to</span> <span>make</span> <span>it</span> <span>as</span> <span>fast</span> <span>as</span> <span>possible</span> <span>and</span> <span>to</span> <span>make</span> <span>process</span> <span>switches</span> <span>as</span> <span>fast</span> <span>as</span> <span>possible</span> <span>also</span>.</li>
    <li><span>One</span> <span>option</span> <span>is</span> <span>to</span> <span>use</span> <span>a</span> <span>set</span> <span>of</span> <span>registers</span> <span>for</span> <span>the</span> <span>page</span> <span>table</span>.<span></span> <span>For</span> <span>example,</span> <span>the</span> <span>DEC</span> <span>PDP-11</span> <span>uses</span> <span>16-bit</span> <span>addressing</span> <span>and</span> <span>8</span> <span>KB</span> <span>pages,</span> <span>resulting</span> <span>in</span> <span>only</span> <span>8</span> <span>pages</span> <span>per</span> <span>process</span>.<span></span> <span>(&nbsp;It</span> <span>takes</span> <span>13</span> <span>bits</span> <span>to</span> <span>address</span> <span>8</span> <span>KB</span> <span>of</span> <span>offset,</span> <span>leaving</span> <span>only</span> <span>3</span> <span>bits</span> <span>to</span> <span>define</span> <span>a</span> <span>page</span> <span>number</span>.</li>
    <li><span>An</span> <span>alternate</span> <span>option</span> <span>is</span> <span>to</span> <span>store</span> <span>the</span> <span>page</span> <span>table</span> <span>in</span> <span>main</span> <span>memory,</span> <span>and</span> <span>to</span> <span>use</span> <span>a</span> <span>single</span> <span>register</span> <span>(&nbsp;called</span> <span>the</span> <span></span><em><span></span><strong><span>page-table</span> <span>base</span> <span>register,</span> <span>PTBR&nbsp;</span></strong><span></span></em><span>)</span> <span>to</span> <span>record</span> <span>where</span> <span>in</span> <span>memory</span> <span>the</span> <span>page</span> <span>table</span> <span>is</span> <span>located</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Process</span> <span>switching</span> <span>is</span> <span>fast,</span> <span>because</span> <span>only</span> <span>the</span> <span>single</span> <span>register</span> <span>needs</span> <span>to</span> <span>be</span> <span>changed</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>However</span> <span>memory</span> <span>access</span> <span>just</span> <span>got</span> <span>half</span> <span>as</span> <span>fast,</span> <span>because</span> <span>every</span> <span>memory</span> <span>access</span> <span>now</span> <span>requires</span> <span></span><em><span></span><strong><span>two</span></strong><span></span></em><span></span> <span>memory</span> <span>accesses</span> <span>-</span> <span>One</span> <span>to</span> <span>fetch</span> <span>the</span> <span>frame</span> <span>number</span> <span>from</span> <span>memory</span> <span>and</span> <span>then</span> <span>another</span> <span>one</span> <span>to</span> <span>access</span> <span>the</span> <span>desired</span> <span>memory</span> <span>location</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>solution</span> <span>to</span> <span>this</span> <span>problem</span> <span>is</span> <span>to</span> <span>use</span> <span>a</span> <span>very</span> <span>special</span> <span>high-speed</span> <span>memory</span> <span>device</span> <span>called</span> <span>the</span><em><span></span><strong><span></span> <span>translation</span> <span>look-aside</span> <span>buffer,</span> <span>TLB</span>.<span></span></strong><span></span></em><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>benefit</span> <span>of</span> <span>the</span> <span>TLB</span> <span>is</span> <span>that</span> <span>it</span> <span>can</span> <span>search</span> <span>an</span> <span>entire</span> <span>table</span> <span>for</span> <span>a</span> <span>key</span> <span>value</span> <span>in</span> <span>parallel,</span> <span>and</span> <span>if</span> <span>it</span> <span>is</span> <span>found</span> <span>anywhere</span> <span>in</span> <span>the</span> <span>table,</span> <span>then</span> <span>the</span> <span>corresponding</span> <span>lookup</span> <span>value</span> <span>is</span> <span>returned</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="center"><span></span><img src="./6_ Main Memory_files/8_14_PagingHardware.jpg" width="704" height="540"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>14</span> <span>-</span> <span>Paging</span> <span>hardware</span> <span>with</span> <span>TLB</span></strong><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>TLB</span> <span>is</span> <span>very</span> <span>expensive,</span> <span>however,</span> <span>and</span> <span>therefore</span> <span>very</span> <span>small</span>.<span></span> <span>(&nbsp;Not</span> <span>large</span> <span>enough</span> <span>to</span> <span>hold</span> <span>the</span> <span>entire</span> <span>page</span> <span>table</span>.<span>&nbsp;)</span> <span>It</span> <span>is</span> <span>therefore</span> <span>used</span> <span>as</span> <span>a</span> <span>cache</span> <span>device</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Addresses</span> <span>are</span> <span>first</span> <span>checked</span> <span>against</span> <span>the</span> <span>TLB,</span> <span>and</span> <span>if</span> <span>the</span> <span>info</span> <span>is</span> <span>not</span> <span>there</span> <span>(&nbsp;a</span> <span>TLB</span> <span>miss&nbsp;),</span> <span>then</span> <span>the</span> <span>frame</span> <span>is</span> <span>looked</span> <span>up</span> <span>from</span> <span>main</span> <span>memory</span> <span>and</span> <span>the</span> <span>TLB</span> <span>is</span> <span>updated</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>the</span> <span>TLB</span> <span>is</span> <span>full,</span> <span>then</span> <span>replacement</span> <span>strategies</span> <span>range</span> <span>from</span> <span></span><em><span></span><strong><span>least-recently</span> <span>used,</span> <span>LRU</span></strong><span></span></em><span></span> <span>to</span> <span>random</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Some</span> <span>TLBs</span> <span>allow</span> <span>some</span> <span>entries</span> <span>to</span> <span>be</span> <span></span><em><span></span><strong><span>wired</span> <span>down</span></strong><span></span></em><span>,</span> <span>which</span> <span>means</span> <span>that</span> <span>they</span> <span>cannot</span> <span>be</span> <span>removed</span> <span>from</span> <span>the</span> <span>TLB</span>.<span></span> <span>Typically</span> <span>these</span> <span>would</span> <span>be</span> <span>kernel</span> <span>frames</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Some</span> <span>TLBs</span> <span>store</span> <span></span><em><span></span><strong><span>address-space</span> <span>identifiers,</span> <span>ASIDs</span></strong><span></span></em><span>,</span> <span>to</span> <span>keep</span> <span>track</span> <span>of</span> <span>which</span> <span>process</span> <span>"owns"</span> <span>a</span> <span>particular</span> <span>entry</span> <span>in</span> <span>the</span> <span>TLB</span>.<span></span> <span>This</span> <span>allows</span> <span>entries</span> <span>from</span> <span>multiple</span> <span>processes</span> <span>to</span> <span>be</span> <span>stored</span> <span>simultaneously</span> <span>in</span> <span>the</span> <span>TLB</span> <span>without</span> <span>granting</span> <span>one</span> <span>process</span> <span>access</span> <span>to</span> <span>some</span> <span>other</span> <span>process's</span> <span>memory</span> <span>location</span>.<span></span> <span>Without</span> <span>this</span> <span>feature</span> <span>the</span> <span>TLB</span> <span>has</span> <span>to</span> <span>be</span> <span>flushed</span> <span>clean</span> <span>with</span> <span>every</span> <span>process</span> <span>switch</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>percentage</span> <span>of</span> <span>time</span> <span>that</span> <span>the</span> <span>desired</span> <span>information</span> <span>is</span> <span>found</span> <span>in</span> <span>the</span> <span>TLB</span> <span>is</span> <span>termed</span> <span>the</span> <span></span><em><span></span><strong><span>hit</span> <span>ratio</span></strong><span></span></em><span></span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>(</span> <span>Eighth</span> <span>Edition</span> <span>Version:</span> <span>)</span> <span></span></strong><span>For</span> <span>example,</span> <span>suppose</span> <span>that</span> <span>it</span> <span>takes</span> <span>100</span> <span>nanoseconds</span> <span>to</span> <span>access</span> <span>main</span> <span>memory,</span> <span>and</span> <span>only</span> <span>20</span> <span>nanoseconds</span> <span>to</span> <span>search</span> <span>the</span> <span>TLB</span>.<span></span> <span>So</span> <span>a</span> <span>TLB</span> <span>hit</span> <span>takes</span> <span>120</span> <span>nanoseconds</span> <span>total</span> <span>(&nbsp;20</span> <span>to</span> <span>find</span> <span>the</span> <span>frame</span> <span>number</span> <span>and</span> <span>then</span> <span>another</span> <span>100</span> <span>to</span> <span>go</span> <span>get</span> <span>the</span> <span>data&nbsp;),</span> <span>and</span> <span>a</span> <span>TLB</span> <span>miss</span> <span>takes</span> <span>220</span> <span>(&nbsp;20</span> <span>to</span> <span>search</span> <span>the</span> <span>TLB,</span> <span>100</span> <span>to</span> <span>go</span> <span>get</span> <span>the</span> <span>frame</span> <span>number,</span> <span>and</span> <span>then</span> <span>another</span> <span>100</span> <span>to</span> <span>go</span> <span>get</span> <span>the</span> <span>data</span>.<span>&nbsp;)</span> <span>So</span> <span>with</span> <span>an</span> <span>80%</span> <span>TLB</span> <span>hit</span> <span>ratio,</span> <span>the</span> <span>average</span> <span>memory</span> <span>access</span> <span>time</span> <span>would</span> <span>be:</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="center"><span>0</span>.<span>80</span> <span>*</span> <span>120</span> <span>+</span> <span>0</span>.<span>20</span> <span>*</span> <span>220</span> <span>=</span> <span>140</span> <span>nanoseconds</span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="left"><span>for</span> <span>a</span> <span>40%</span> <span>slowdown</span> <span>to</span> <span>get</span> <span>the</span> <span>frame</span> <span>number</span>.<span></span> <span>A</span> <span>98%</span> <span>hit</span> <span>rate</span> <span>would</span> <span>yield</span> <span>122</span> <span>nanoseconds</span> <span>average</span> <span>access</span> <span>time</span> <span>(&nbsp;you</span> <span>should</span> <span>verify</span> <span>this&nbsp;),</span> <span>for</span> <span>a</span> <span>22%</span> <span>slowdown</span>.<span></span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>(</span> <span>Ninth</span> <span>Edition</span> <span>Version:</span> <span>)</span> <span></span></strong><span>The</span> <span>ninth</span> <span>edition</span> <span>ignores</span> <span>the</span> <span>20</span> <span>nanoseconds</span> <span>required</span> <span>to</span> <span>search</span> <span>the</span> <span>TLB,</span> <span>yielding</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="center"><span>0</span>.<span>80</span> <span>*</span> <span>100</span> <span>+</span> <span>0</span>.<span>20</span> <span>*</span> <span>200</span> <span>=</span> <span>120</span> <span>nanoseconds</span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="left"><span>for</span> <span>a</span> <span>20%</span> <span>slowdown</span> <span>to</span> <span>get</span> <span>the</span> <span>frame</span> <span>number</span>.<span></span> <span>A</span> <span>99%</span> <span>hit</span> <span>rate</span> <span>would</span> <span>yield</span> <span>101</span> <span>nanoseconds</span> <span>average</span> <span>access</span> <span>time</span> <span>(&nbsp;you</span> <span>should</span> <span>verify</span> <span>this&nbsp;),</span> <span>for</span> <span>a</span> <span>1%</span> <span>slowdown</span>.<span></span> <span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <h4><span>8</span>.<span>5</span>.<span>3</span> </h4>
  <ul>
    <li><span>The</span> <span>page</span> <span>table</span> <span>can</span> <span>also</span> <span>help</span> <span>to</span> <span>protect</span> <span>processes</span> <span>from</span> <span>accessing</span> <span>memory</span> <span>that</span> <span>they</span> <span>shouldn't,</span> <span>or</span> <span>their</span> <span>own</span> <span>memory</span> <span>in</span> <span>ways</span> <span>that</span> <span>they</span> <span>shouldn't</span>.</li>
    <li><span>A</span> <span>bit</span> <span>or</span> <span>bits</span> <span>can</span> <span>be</span> <span>added</span> <span>to</span> <span>the</span> <span>page</span> <span>table</span> <span>to</span> <span>classify</span> <span>a</span> <span>page</span> <span>as</span> <span>read-write,</span> <span>read-only,</span> <span>read-write-execute,</span> <span>or</span> <span>some</span> <span>combination</span> <span>of</span> <span>these</span> <span>sorts</span> <span>of</span> <span>things</span>.<span></span> <span>Then</span> <span>each</span> <span>memory</span> <span>reference</span> <span>can</span> <span>be</span> <span>checked</span> <span>to</span> <span>ensure</span> <span>it</span> <span>is</span> <span>accessing</span> <span>the</span> <span>memory</span> <span>in</span> <span>the</span> <span>appropriate</span> <span>mode</span>.</li>
    <li><span>Valid</span> <span>/</span> <span>invalid</span> <span>bits</span> <span>can</span> <span>be</span> <span>added</span> <span>to</span> <span>"mask</span> <span>off"</span> <span>entries</span> <span>in</span> <span>the</span> <span>page</span> <span>table</span> <span>that</span> <span>are</span> <span>not</span> <span>in</span> <span>use</span> <span>by</span> <span>the</span> <span>current</span> <span>process,</span> <span>as</span> <span>shown</span> <span>by</span> <span>example</span> <span>in</span> <span>Figure</span> <span>8</span>.<span>12</span> <span>below</span>.</li>
    <li><span>Note</span> <span>that</span> <span>the</span> <span>valid</span> <span>/</span> <span>invalid</span> <span>bits</span> <span>described</span> <span>above</span> <span>cannot</span> <span>block</span> <span>all</span> <span>illegal</span> <span>memory</span> <span>accesses,</span> <span>due</span> <span>to</span> <span>the</span> <span>internal</span> <span>fragmentation</span>.<span></span> <span>(</span> <span>Areas</span> <span>of</span> <span>memory</span> <span>in</span> <span>the</span> <span>last</span> <span>page</span> <span>that</span> <span>are</span> <span>not</span> <span>entirely</span> <span>filled</span> <span>by</span> <span>the</span> <span>process,</span> <span>and</span> <span>may</span> <span>contain</span> <span>data</span> <span>left</span> <span>over</span> <span>by</span> <span>whoever</span> <span>used</span> <span>that</span> <span>frame</span> <span>last</span>.<span></span> </li>
    <li><span>Many</span> <span>processes</span> <span>do</span> <span>not</span> <span>use</span> <span>all</span> <span>of</span> <span>the</span> <span>page</span> <span>table</span> <span>available</span> <span>to</span> <span>them,</span> <span>particularly</span> <span>in</span> <span>modern</span> <span>systems</span> <span>with</span> <span>very</span> <span>large</span> <span>potential</span> <span>page</span> <span>tables</span>.<span></span> <span>Rather</span> <span>than</span> <span>waste</span> <span>memory</span> <span>by</span> <span>creating</span> <span>a</span> <span>full-size</span> <span>page</span> <span>table</span> <span>for</span> <span>every</span> <span>process,</span> <span>some</span> <span>systems</span> <span>use</span> <span>a</span> <span></span><em><span></span><strong><span>page-table</span> <span>length</span> <span>register,</span> <span>PTLR</span></strong><span></span></em><span>,</span> <span>to</span> <span>specify</span> <span>the</span> <span>length</span> <span>of</span> <span>the</span> <span>page</span> <span>table</span>.<span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_15_ValidBits.jpg" width="667" height="582"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>15</span> <span>-</span> <span>Valid</span> <span>(v)</span> <span>or</span> <span>invalid</span> <span>(i)</span> <span>bit</span> <span>in</span> <span>page</span> <span>table</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>5</span>.<span>4</span> <span>Shared</span> </h4>
  <ul>
    <li><span>Paging</span> <span>systems</span> <span>can</span> <span>make</span> <span>it</span> <span>very</span> <span>easy</span> <span>to</span> <span>share</span> <span>blocks</span> <span>of</span> <span>memory,</span> <span>by</span> <span>simply</span> <span>duplicating</span> <span>page</span> <span>numbers</span> <span>in</span> <span>multiple</span> <span>page</span> <span>frames</span>.<span></span> <span>This</span> <span>may</span> <span>be</span> <span>done</span> <span>with</span> <span>either</span> <span>code</span> <span>or</span> <span>data</span>.<span></span> </li>
    <li><span>If</span> <span>code</span> <span>is</span> <span></span><em><span></span><strong><span>reentrant</span></strong><span></span></em><span>,</span> <span>that</span> <span>means</span> <span>that</span> <span>it</span> <span>does</span> <span>not</span> <span>write</span> <span>to</span> <span>or</span> <span>change</span> <span>the</span> <span>code</span> <span>in</span> <span>any</span> <span>way</span> <span>(&nbsp;it</span> <span>is</span> <span>non</span> <span>self-modifying&nbsp;),</span> <span>and</span> <span>it</span> <span>is</span> <span>therefore</span> <span>safe</span> <span>to</span> <span>re-enter</span> <span>it</span>.<span></span> <span>More</span> <span>importantly,</span> <span>it</span> <span>means</span> <span>the</span> <span>code</span> <span>can</span> <span>be</span> <span>shared</span> <span>by</span> <span>multiple</span> <span>processes,</span> <span>so</span> <span>long</span> <span>as</span> <span>each</span> <span>has</span> <span>their</span> <span>own</span> <span>copy</span> <span>of</span> <span>the</span> <span>data</span> <span>and</span> <span>registers,</span> <span>including</span> <span>the</span> <span>instruction</span> <span>register</span>.</li>
    <li><span>In</span> <span>the</span> <span>example</span> <span>given</span> <span>below,</span> <span>three</span> <span>different</span> <span>users</span> <span>are</span> <span>running</span> <span>the</span> <span>editor</span> <span>simultaneously,</span> <span>but</span> <span>the</span> <span>code</span> <span>is</span> <span>only</span> <span>loaded</span> <span>into</span> <span>memory</span> <span>(&nbsp;in</span> <span>the</span> <span>page</span> <span>frames&nbsp;)</span> <span>one</span> <span>time</span>.<span></span> <span></span> </li>
    <li><span>Some</span> <span>systems</span> <span>also</span> <span>implement</span> <span>shared</span> <span>memory</span> <span>in</span> <span>this</span> <span>fashion</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_16_CodeSharing.jpg" width="586" height="590"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>16</span> <span>-</span> <span>Sharing</span> <span>of</span> <span>code</span> <span>in</span> <span>a</span> <span>paging</span> <span>environment</span></strong><span>
</span> <span></span> </p>
</blockquote>
<h3><span>8</span>.<span>6</span> <span>Structure</span> <span>of</span> <span>the</span> <span>Page</span> <span>Table</span> </h3>
<blockquote>
  <h4><span>8</span>.<span>6</span>.<span>1</span> <span>Hierarchical</span> </h4>
  <ul>
    <li><span>Most</span> <span>modern</span> <span>computer</span> <span>systems</span> <span>support</span> <span>logical</span> <span>address</span> <span>spaces</span> <span>of</span> <span>2^32</span> <span>to</span> <span>2^64</span>.</li>
    <li><span>With</span> <span>a</span> <span>2^32</span> <span>address</span> <span>space</span> <span>and</span> <span>4K</span> <span>(&nbsp;2^12&nbsp;)</span> <span>page</span> <span>sizes,</span> <span>this</span> <span>leave</span> <span>2^20</span> <span>entries</span> <span>in</span> <span>the</span> <span>page</span> <span>table</span>.<span></span> <span>At</span> <span>4</span> <span>bytes</span> <span>per</span> <span>entry,</span> <span>this</span> <span>amounts</span> <span>to</span> <span>a</span> <span>4</span> <span>MB</span> <span>page</span> <span>table,</span> <span>which</span> <span>is</span> <span>too</span> <span>large</span> <span>to</span> <span>reasonably</span> <span>keep</span> <span>in</span> <span>contiguous</span> <span>memory</span>.<span></span> <span>(&nbsp;And</span> <span>to</span> <span>swap</span> <span>in</span> <span>and</span> <span>out</span> <span>of</span> <span>memory</span> <span>with</span> <span>each</span> <span>process</span> <span>switch</span>.<span>&nbsp;)</span> <span>Note</span> <span>that</span> <span>with</span> <span>4K</span> <span>pages,</span> <span>this</span> <span>would</span> <span>take</span> <span>1024</span> <span>pages</span> <span>just</span> <span>to</span> <span>hold</span> <span>the</span> <span>page</span> </li>
    <li><span>One</span> <span>option</span> <span>is</span> <span>to</span> <span>use</span> <span>a</span> <span>two-tier</span> <span>paging</span> <span>system,</span> <span>i</span>.<span>e</span>.<span></span> <span>to</span> <span>page</span> <span>the</span> <span>page</span> <span>table</span>.</li>
    <li><span>For</span> <span>example,</span> <span>the</span> <span>20</span> <span>bits</span> <span>described</span> <span>above</span> <span>could</span> <span>be</span> <span>broken</span> <span>down</span> <span>into</span> <span>two</span> <span>10-bit</span> <span>page</span> <span>numbers</span>.<span></span> <span>The</span> <span>first</span> <span>identifies</span> <span>an</span> <span>entry</span> <span>in</span> <span>the</span> <span>outer</span> <span>page</span> <span>table,</span> <span>which</span> <span>identifies</span> <span>where</span> <span>in</span> <span>memory</span> <span>to</span> <span>find</span> <span>one</span> <span>page</span> <span>of</span> <span>an</span> <span>inner</span> <span>page</span> <span>table</span>.<span></span> <span>The</span> <span>second</span> <span>10</span> <span>bits</span> <span>finds</span> <span>a</span> <span>specific</span> <span>entry</span> <span>in</span> <span>that</span> <span>inner</span> <span>page</span> <span>table,</span> <span>which</span> <span>in</span> <span>turn</span> <span>identifies</span> <span>a</span> <span>particular</span> <span>frame</span> <span>in</span> <span>physical</span> <span>memory</span>.<span></span> <span>(&nbsp;The</span> <span>remaining</span> <span>12</span> <span>bits</span> <span>of</span> <span>the</span> <span>32</span> <span>bit</span> <span>logical</span> <span>address</span> <span>are</span> <span>the</span> <span>offset</span> <span>within</span> <span>the</span> <span>4K</span> <span>frame</span>.<span>&nbsp;)</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_22A_TwoLevelPageNumberOffset.jpg" width="396" height="104"></p>
  </blockquote>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_17_TwoLevelPageTable.jpg" width="587" height="619"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>17</span> <span>A</span> <span>two-level</span> <span>page-table</span> <span>scheme</span></strong><span>
</span> <span></span> </p>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_18_AddressTranslation.jpg" width="684" height="297"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>18</span> <span>-</span> <span>Address</span> <span>translation</span> <span>for</span> <span>a</span> <span>two-level</span> <span>32-bit</span> <span>paging</span> <span>architecture</span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>VAX</span> <span>Architecture</span> <span>divides</span> <span>32-bit</span> <span>addresses</span> <span>into</span> <span>4</span> <span>equal</span> <span>sized</span> <span>sections,</span> <span>and</span> <span>each</span> <span>page</span> <span>is</span> <span>512</span> <span>bytes,</span> <span>yielding</span> <span>an</span> <span>address</span> <span>form</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_15A_VAX_Address.jpg" width="334" height="104"></p>
  </blockquote>
  <ul>
    <li><span>With</span> <span>a</span> <span>64-bit</span> <span>logical</span> <span>address</span> <span>space</span> <span>and</span> <span>4K</span> <span>pages,</span> <span>there</span> <span>are</span> <span></span> <span>52</span> <span>bits</span> <span>worth</span> <span>of</span> <span>page</span> <span>numbers,</span> <span>which</span> <span>is</span> <span>still</span> <span>too</span> <span>many</span> <span>even</span> <span>for</span> <span>two-level</span> <span>paging</span>.<span></span> <span>One</span> <span>could</span> <span>increase</span> <span>the</span> <span>paging</span> <span>level,</span> <span>but</span> <span>with</span> <span>10-bit</span> <span>page</span> <span>tables</span> <span>it</span> <span>would</span> <span>take</span> <span>7</span> <span>levels</span> <span>of</span> <span>indirection,</span> <span>which</span> <span>would</span> <span>be</span> <span>prohibitively</span> <span>slow</span> <span>memory</span> <span>access</span>.<span></span> <span>So</span> <span>some</span> <span>other</span> <span>approach</span> <span>must</span> <span>be</span> <span>used</span>.<span></span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_15B_64bitAddressProblem.jpg" width="396" height="104"></p>
    <p align="center"><span>64-bits</span> <span>Two-tiered</span> <span>leaves</span> <span>42</span> <span>bits</span> <span>in</span> <span>outer</span> </p>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_15C_ThreeLevelPageTableAddress.jpg" width="479" height="104"></p>
    <p align="center"><span>Going</span> <span>to</span> <span>a</span> <span>fourth</span> <span>level</span> <span>still</span> <span>leaves</span> <span>32</span> <span>bits</span> <span>in</span> <span>the</span> <span>outer</span> <span>table</span>.</p>
  </blockquote>
  <h4><span>8</span>.<span>6</span>.<span>2</span> <span>Hashed</span> <span>Page</span> </h4>
  <ul>
    <li><span>One</span> <span>common</span> <span>data</span> <span>structure</span> <span>for</span> <span>accessing</span> <span>data</span> <span>that</span> <span>is</span> <span>sparsely</span> <span>distributed</span> <span>over</span> <span>a</span> <span>broad</span> <span>range</span> <span>of</span> <span>possible</span> <span>values</span> <span>is</span> <span>with</span> <span></span><em><span></span><strong><span>hash</span> <span>tables</span></strong><span></span></em><span></span>.<span></span> <span>Figure</span> <span>8</span>.<span>16</span> <span>below</span> <span>illustrates</span> <span>a</span> <span></span><em><span></span><strong><span>hashed</span> <span>page</span> <span>table</span></strong><span></span></em><span></span> <span>using</span> <span>chain-and-bucket</span> <span>hashing:</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_19_HashedPageTable.jpg" width="768" height="427"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>19</span> <span>-</span> <span>Hashed</span> <span>page</span> <span>table</span></strong><span>
</span> <span></span> </p>
  <h4><span>8</span>.<span>6</span>.<span>3</span> <span>Inverted</span> <span>Page</span> </h4>
  <ul>
    <li><span>Another</span> <span>approach</span> <span>is</span> <span>to</span> <span>use</span> <span>an</span> <span></span><em><span></span><strong><span>inverted</span> <span>page</span> <span>table</span></strong><span></span></em><span></span>.<span></span> <span>Instead</span> <span>of</span> <span>a</span> <span>table</span> <span>listing</span> <span>all</span> <span>of</span> <span>the</span> <span>pages</span> <span>for</span> <span>a</span> <span>particular</span> <span>process,</span> <span>an</span> <span>inverted</span> <span>page</span> <span>table</span> <span>lists</span> <span>all</span> <span>of</span> <span>the</span> <span>pages</span> <span>currently</span> <span>loaded</span> <span>in</span> <span>memory,</span> <span>for</span> <span>all</span> <span>processes</span>.<span></span> <span>(&nbsp;I</span>.<span>e</span>.<span></span> <span>there</span> <span>is</span> <span>one</span> <span>entry</span> <span>per</span> <span></span><em><span></span><strong><span>frame</span></strong><span></span></em><span></span> <span>instead</span> <span>of</span> <span>one</span> <span>entry</span> <span>per</span> <span></span><em><span></span><strong><span>page</span></strong><span></span></em><span></span>.</li>
    <li><span>Access</span> <span>to</span> <span>an</span> <span>inverted</span> <span>page</span> <span>table</span> <span>can</span> <span>be</span> <span>slow,</span> <span>as</span> <span>it</span> <span>may</span> <span>be</span> <span>necessary</span> <span>to</span> <span>search</span> <span>the</span> <span>entire</span> <span>table</span> <span>in</span> <span>order</span> <span>to</span> <span>find</span> <span>the</span> <span>desired</span> <span>page</span> <span>(&nbsp;or</span> <span>to</span> <span>discover</span> <span>that</span> <span>it</span> <span>is</span> <span>not</span> <span>there</span>.<span>&nbsp;)</span> <span>Hashing</span> <span>the</span> <span>table</span> <span>can</span> <span>help</span> <span>speedup</span> <span>the</span> <span>search</span> <span>process</span>.</li>
    <li><span>Inverted</span> <span>page</span> <span>tables</span> <span>prohibit</span> <span>the</span> <span>normal</span> <span>method</span> <span>of</span> <span>implementing</span> <span>shared</span> <span>memory,</span> <span>which</span> <span>is</span> <span>to</span> <span>map</span> <span>multiple</span> <span>logical</span> <span>pages</span> <span>to</span> <span>a</span> <span>common</span> <span>physical</span> <span>frame</span>.<span></span> <span>(&nbsp;Because</span> <span>each</span> <span>frame</span> <span>is</span> <span>now</span> <span>mapped</span> <span>to</span> <span>one</span> <span>and</span> <span>only</span> <span>one</span> <span>process</span>.<span>&nbsp;)</span> </li>
  </ul>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_20_InvertedPageTable.jpg" width="646" height="452"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>20</span> <span>-</span> <span>Inverted</span> <span>page</span> <span>table</span></strong><span>
</span> <span></span> </p>
</blockquote>
<blockquote>
  <h4><span>8</span>.<span>6</span>.<span>4</span> <span>Oracle</span> <span>SPARC</span> <span>Solaris</span> <span>(</span> <span>Optional,</span> <span>New</span> <span>Section</span> <span>in</span> <span>9th</span> <span>Edition</span> </h4>
</blockquote>
<h3><span>8</span>.<span>7</span> <span>Example:</span> <span>Intel</span> <span>32</span> <span>and</span> <span>64-bit</span> <span>Architectures</span> <span>(</span> <span>Optional</span> </h3>
<blockquote>
  <h4><span>8</span>.<span>7</span>.<span>1</span>.<span>1</span> <span>IA-32</span> </h4>
  <ul>
    <li><span></span> <span></span> <span>The</span> <span>Pentium</span> <span>CPU</span> <span>provides</span> <span>both</span> <span>pure</span> <span>segmentation</span> <span>and</span> <span>segmentation</span> <span>with</span> <span>paging</span>.<span></span> <span>In</span> <span>the</span> <span>latter</span> <span>case,</span> <span>the</span> <span>CPU</span> <span>generates</span> <span>a</span> <span>logical</span> <span>address</span> <span>(&nbsp;segment-offset</span> <span>pair&nbsp;),</span> <span>which</span> <span>the</span> <span>segmentation</span> <span>unit</span> <span>converts</span> <span>into</span> <span>a</span> <span>logical</span> <span>linear</span> <span>address,</span> <span>which</span> <span>in</span> <span>turn</span> <span>is</span> <span>mapped</span> <span>to</span> <span>a</span> <span>physical</span> <span>frame</span> <span>by</span> <span>the</span> <span>paging</span> <span>unit,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.</li>
  </ul>
</blockquote>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_21_AddressTranslation.jpg" width="714" height="94"><span></span> <span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>21</span> <span>-</span> <span>Logical</span> <span>to</span> <span>physical</span> <span>address</span> <span>translation</span> <span>in</span> <span>IA-32</span></strong></p>
<blockquote>
  <blockquote>
    <h4><span>8</span>.<span>7</span>.<span>1</span>.<span>1</span> <span>IA-32</span> </h4>
    <ul>
      <li><span>The</span> <span>Pentium</span> <span>architecture</span> <span>allows</span> <span>segments</span> <span>to</span> <span>be</span> <span>as</span> <span>large</span> <span>as</span> <span>4</span> <span>GB,</span> <span>(&nbsp;24</span> <span>bits</span> <span>of</span> <span>offset&nbsp;)</span>.</li>
      <li><span>Processes</span> <span>can</span> <span>have</span> <span>as</span> <span>many</span> <span>as</span> <span>16K</span> <span>segments,</span> <span>divided</span> <span>into</span> <span>two</span> <span>8K</span> <span>groups:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>8K</span> <span>private</span> <span>to</span> <span>that</span> <span>particular</span> <span>process,</span> <span>stored</span> <span>in</span> <span>the</span><em><span></span><strong><span></span> <span>Local</span> <span>Descriptor</span> <span>Table,</span> <span>LDT</span>.<span></span></strong><span></span></em><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>8K</span> <span>shared</span> <span>among</span> <span>all</span> <span>processes,</span> <span>stored</span> <span>in</span> <span>the</span> <span></span><em><span></span><strong><span>Global</span> <span>Descriptor</span> <span>Table,</span> <span>GDT</span>.<span></span></strong><span></span></em><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>Logical</span> <span>addresses</span> <span>are</span> <span>(&nbsp;selector,</span> <span>offset&nbsp;)</span> <span>pairs,</span> <span>where</span> <span>the</span> <span>selector</span> <span>is</span> <span>made</span> <span>up</span> <span>of</span> <span>16</span> <span>bits:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>13</span> <span>bit</span> <span>segment</span> <span>number</span> <span>(&nbsp;up</span> <span>to</span> <span>8K&nbsp;)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>1</span> <span>bit</span> <span>flag</span> <span>for</span> <span>LDT</span> <span>vs</span>.<span></span> <span>GDT</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>2</span> <span>bits</span> <span>for</span> <span>protection</span> <span>codes</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
    </ul>
  </blockquote>
  <ul>
    <blockquote>
      <p align="center"><span></span><img src="./6_ Main Memory_files/8_21A_SelectorOffset.jpg" width="270" height="76"></p>
    </blockquote>
    <ul>
      <li><span>The</span> <span>descriptor</span> <span>tables</span> <span>contain</span> <span>8-byte</span> <span>descriptions</span> <span>of</span> <span>each</span> <span>segment,</span> <span>including</span> <span>base</span> <span>and</span> <span>limit</span> <span>registers</span>.</li>
      <li><span>Logical</span> <span>linear</span> <span>addresses</span> <span>are</span> <span>generated</span> <span>by</span> <span>looking</span> <span>the</span> <span>selector</span> <span>up</span> <span>in</span> <span>the</span> <span>descriptor</span> <span>table</span> <span>and</span> <span>adding</span> <span>the</span> <span>appropriate</span> <span>base</span> <span>address</span> <span>to</span> <span>the</span> <span>offset,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.</li>
    </ul>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_22_PentiumSegmentation.jpg" width="515" height="324"><span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>22</span> <span>-</span> <span>IA-32</span> <span>segmentation</span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
  <h4><span>8</span>.<span>7</span>.<span>1</span>.<span>2</span> <span>IA-32</span> </h4>
  <ul>
    <li><span>Pentium</span> <span>paging</span> <span>normally</span> <span>uses</span> <span>a</span> <span>two-tier</span> <span>paging</span> <span>scheme,</span> <span>with</span> <span>the</span> <span>first</span> <span>10</span> <span>bits</span> <span>being</span> <span>a</span> <span>page</span> <span>number</span> <span>for</span> <span>an</span> <span>outer</span> <span>page</span> <span>table</span> <span>(&nbsp;a</span>.<span>k</span>.<span>a</span>.<span></span> <span>page</span> <span>directory&nbsp;),</span> <span>and</span> <span>the</span> <span>next</span> <span>10</span> <span>bits</span> <span>being</span> <span>a</span> <span>page</span> <span>number</span> <span>within</span> <span>one</span> <span>of</span> <span>the</span> <span>1024</span> <span>inner</span> <span>page</span> <span>tables,</span> <span>leaving</span> <span>the</span> <span>remaining</span> <span>12</span> <span>bits</span> <span>as</span> <span>an</span> <span>offset</span> <span>into</span> <span>a</span> <span>4K</span> <span>page</span>.</li>
  </ul>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_22A_TwoLevelPageNumberOffset.jpg" width="396" height="104"></p>
    <ul>
      <li><span>A</span> <span>special</span> <span>bit</span> <span>in</span> <span>the</span> <span>page</span> <span>directory</span> <span>can</span> <span>indicate</span> <span>that</span> <span>this</span> <span>page</span> <span>is</span> <span>a</span> <span>4MB</span> <span>page,</span> <span>in</span> <span>which</span> <span>case</span> <span>the</span> <span>remaining</span> <span>22</span> <span>bits</span> <span>are</span> <span>all</span> <span>used</span> <span>as</span> <span>offset</span> <span>and</span> <span>the</span> <span>inner</span> <span>tier</span> <span>of</span> <span>page</span> <span>tables</span> <span>is</span> <span>not</span> <span>used</span>.</li>
      <li><span>The</span> <span>CR3</span> <span>register</span> <span>points</span> <span>to</span> <span>the</span> <span>page</span> <span>directory</span> <span>for</span> <span>the</span> <span>current</span> <span>process,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.<span>23</span> <span>below</span>.</li>
      <li><span>If</span> <span>the</span> <span>inner</span> <span>page</span> <span>table</span> <span>is</span> <span>currently</span> <span>swapped</span> <span>out</span> <span>to</span> <span>disk,</span> <span>then</span> <span>the</span> <span>page</span> <span>directory</span> <span>will</span> <span>have</span> <span>an</span> <span>"invalid</span> <span>bit"</span> <span>set,</span> <span>and</span> <span>the</span> <span>remaining</span> <span>31</span> <span>bits</span> <span>provide</span> <span>information</span> <span>on</span> <span>where</span> <span>to</span> <span>find</span> <span>the</span> <span>swapped</span> <span>out</span> <span>page</span> <span>table</span> <span>on</span> <span>the</span> <span>disk</span>.</li>
    </ul>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_23_PentiumPaging.jpg" width="600" height="603"><span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>23</span> <span>-</span> <span>Paging</span> <span>in</span> <span>the</span> <span>IA-32</span> <span>architecture</span>.<span></span></strong><span>
</span> <span></span> <span></span> <span></span> </p>
  </blockquote>
  <h4 align="center"><span></span><img src="./6_ Main Memory_files/8_24_PageAddressExtensions.jpg" width="798" height="316"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>24</span> <span>-</span> <span>Page</span> <span>address</span> <span>extensions</span>.<span></span></strong><span>
</span> <span></span> </h4>
  <h4><span>8</span>.<span>7</span>.<span>2</span> </h4>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_25_x86-64LinearAddress.jpg" width="786" height="88"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>25</span> <span>-</span> <span>x86-64</span> <span>linear</span> <span>address</span>.<span></span></strong><span>
</span> <span></span> </p>
</blockquote>
<h3><span>8</span>.<span>8</span> <span>Example:</span> <span>ARM</span> <span>Architecture</span> <span>(</span> <span>Optional</span> </h3>
<p align="center"><span></span><img src="./6_ Main Memory_files/8_26_LogicalAddressTranslationARM.jpg" width="793" height="522"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>8</span>.<span>26</span> <span>-</span> <span>Logical</span> <span>address</span> <span>translation</span> <span>in</span> <span>ARM</span>.<span></span></strong></p>
<blockquote>
  <hr>
  <h4><span>Old</span> <span>8</span>.<span>7</span>.<span>3</span> <span>Linux</span> <span>on</span> <span>Pentium</span> <span>Systems</span> <span>-</span> <span>Omitted</span> <span>from</span> <span>the</span> <span>Ninth</span> </h4>
  <ul>
    <li><span>Because</span> <span>Linux</span> <span>is</span> <span>designed</span> <span>for</span> <span>a</span> <span>wide</span> <span>variety</span> <span>of</span> <span>platforms,</span> <span>some</span> <span>of</span> <span>which</span> <span>offer</span> <span>only</span> <span>limited</span> <span>support</span> <span>for</span> <span>segmentation,</span> <span>Linux</span> <span>supports</span> <span>minimal</span> <span>segmentation</span>.<span></span> <span>Specifically</span> <span>Linux</span> <span>uses</span> <span>only</span> <span>6</span> <span>segments:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Kernel</span> <span>code</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Kerned</span> <span>data</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>User</span> <span>code</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>User</span> <span>data</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>task-state</span> <span>segment,</span> <span>TSS</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>default</span> <span>LDT</span> <span>segment</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>All</span> <span>processes</span> <span>share</span> <span>the</span> <span>same</span> <span>user</span> <span>code</span> <span>and</span> <span>data</span> <span>segments,</span> <span>because</span> <span>all</span> <span>process</span> <span>share</span> <span>the</span> <span>same</span> <span>logical</span> <span>address</span> <span>space</span> <span>and</span> <span>all</span> <span>segment</span> <span>descriptors</span> <span>are</span> <span>stored</span> <span>in</span> <span>the</span> <span>Global</span> <span>Descriptor</span> <span>Table</span>.<span></span> <span>(&nbsp;The</span> <span>LDT</span> <span>is</span> <span>generally</span> <span>not</span> <span>used</span>.</li>
    <li><span>Each</span> <span>process</span> <span>has</span> <span>its</span> <span>own</span> <span>TSS,</span> <span>whose</span> <span>descriptor</span> <span>is</span> <span>stored</span> <span>in</span> <span>the</span> <span>GDT</span>.<span></span> <span>The</span> <span>TSS</span> <span>stores</span> <span>the</span> <span>hardware</span> <span>state</span> <span>of</span> <span>a</span> <span>process</span> <span>during</span> <span>context</span> <span>switches</span>.</li>
    <li><span>The</span> <span>default</span> <span>LDT</span> <span>is</span> <span>shared</span> <span>by</span> <span>all</span> <span>processes</span> <span>and</span> <span>generally</span> <span>not</span> <span>used,</span> <span>but</span> <span>if</span> <span>a</span> <span>process</span> <span>needs</span> <span>to</span> <span>create</span> <span>its</span> <span>own</span> <span>LDT,</span> <span>it</span> <span>may</span> <span>do</span> <span>so,</span> <span>and</span> <span>use</span> <span>that</span> <span>instead</span> <span>of</span> <span>the</span> <span>default</span>.</li>
    <li><span>The</span> <span>Pentium</span> <span>architecture</span> <span>provides</span> <span>2</span> <span>bits</span> <span>(</span> <span>4</span> <span>values</span> <span>)</span> <span>for</span> <span>protection</span> <span>in</span> <span>a</span> <span>segment</span> <span>selector,</span> <span>but</span> <span>Linux</span> <span>only</span> <span>uses</span> <span>two</span> <span>values:</span> <span>user</span> <span>mode</span> <span>and</span> <span>kernel</span> <span>mode</span>.</li>
    <li><span>Because</span> <span>Linux</span> <span>is</span> <span>designed</span> <span>to</span> <span>run</span> <span>on</span> <span>64-bit</span> <span>as</span> <span>well</span> <span>as</span> <span>32-bit</span> <span>architectures,</span> <span>it</span> <span>employs</span> <span>a</span> <span>three-level</span> <span>paging</span> <span>strategy</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>8</span>.<span>24,</span> <span>where</span> <span>the</span> <span>number</span> <span>of</span> <span>bits</span> <span>in</span> <span>each</span> <span>portion</span> <span>of</span> <span>the</span> <span>address</span> <span>varies</span> <span>by</span> <span>architecture</span>.<span></span> <span>In</span> <span>the</span> <span>case</span> <span>of</span> <span>the</span> <span>Pentium</span> <span>architecture,</span> <span>the</span> <span>size</span> <span>of</span> <span>the</span> <span>middle</span> <span>directory</span> <span>portion</span> <span>is</span> <span>set</span> <span>to</span> <span>0</span> <span>bits,</span> <span>effectively</span> <span>bypassing</span> <span>the</span> <span>middle</span> <span>directory</span>.<span></span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./6_ Main Memory_files/8_23A_LinuxAddress.jpg" width="479" height="72"></p>
  </blockquote>
  <p align="center"><span></span><img src="./6_ Main Memory_files/8_24_ThreeLevelPaging.jpg" width="710" height="454"></p>
</blockquote>
<h3><span>8</span>.<span>8</span> </h3>
<ul>
  <li><span>
</span> <span></span> <span></span> <span></span> <span></span><p><span>(&nbsp;For</span> <span>a</span> <span>fun</span> <span>and</span> <span>easy</span> <span>explanation</span> <span>of</span> <span>paging,</span> <span>you</span> <span>may</span> <span>want</span> <span>to</span> <span>read</span> <span>about</span> <span></span><a href="https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/ThePagingGame.html"><span>The</span> <span>Paging</span> <span>Game</span></a><span></span>.<span>&nbsp;)</span></p><span>
</span> <span></span> </li>
</ul>


</body><script src="./6_ Main Memory_files/jquery.min.js.download"></script><script>function makeSpans(){$("h1, h2, h3, h4, h5, h6, p, li, td, img").each(function(){var s=splitText($(this).html());$(this).empty();for(var a="",h=0;h<s.length;h++)a+=s[h];$(this).html(a)})}function splitText(s){for(var a=[],h="",e=0;e<s.length;e++)if("<"===s.charAt(e)){a.push("<span>"+h+"</span>"),h="<";var i=1;do e++,"<"===s.charAt(e)&&i++,">"===s.charAt(e)&&i--,h+=s.charAt(e);while(i>0);console.log(h),a.push(h),h=""}else" "!=s.charAt(e)&&"."!=s.charAt(e)?h+=s.charAt(e):(console.log(h),a.push("<span>"+h+"</span>"),h="",a.push(""+s.charAt(e)));return a}$(document).ready(function(){makeSpans(),$("BODY").addClass("whiteBG"),$("span").on("click",function(){$(this).hasClass("hideWord")?($(this).removeClass("hideWord hoverOver"),$(this).addClass("hideWord2")):$(this).hasClass("hideWord2")?$(this).removeClass("hideWord2"):$(this).addClass("hideWord")}),$("span").hover(function(){$(this).hasClass("hideWord")&&$(this).addClass("hoverOver")},function(){$(this).removeClass("hoverOver")}),$("img").on("click",function(){$(this).hasClass("imageHide")?($(this).removeClass("imageHide"),$(this).addClass("imageReveal")):$(this).addClass("imageHide")}),$("img").hover(function(){$(this).hasClass("imageHide")&&$(this).addClass("imageReveal")},function(){$(this).removeClass("imageReveal")})});</script></html>