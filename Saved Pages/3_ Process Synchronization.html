
<!-- saved from url=(0081)https://www.cs.uic.edu/~jbell/CourseNotes/OperatingSystems/5_Synchronization.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Adobe PageMill 3.0 Win">
  <title>Operating Systems: Process Synchronization</title>
  <style type="text/css">
<!--
.style1 {font-family: "Courier New", Courier, monospace}
.style3 {font-family: "Courier New", Courier, monospace; font-weight: bold; }
.courierFont {
	font-family: Courier New, Courier, monospace;
}
-->
  .hideWord{color:blue;background-color:blue}.hideWord2{color:white;background-color:white}.hoverOver{color:red;opacity:1;background-color:white}.whiteBG{background-color:white!important}.imageHide{opacity:0.02!important}.imageReveal{opacity:1.0!important}.imageReveal:parent{background-color:white!important}.imageHide:parent{background-color:blue!important}</style>
</head>
<body bgcolor="#ffff80" class="whiteBG">

<h1><span></span><center><span>
</span> <span></span> <span>Process</span> <span>Synchronization</span> <span>
</span></center></h1>

<h3></h3>

<ol>
  <li><span>Abraham</span> <span>Silberschatz,</span> <span>Greg</span> <span>Gagne,</span> <span>and</span> <span>Peter</span> <span>Baer</span> <span>Galvin,</span> <span>"Operating</span> <span>System</span> <span>Concepts,</span> <span>Ninth</span> <span>Edition</span> <span>",</span> <span>Chapter</span> </li></ol>

<p><span></span><strong><span>Warning:</span></strong><span></span> <span>This</span> <span>chapter</span> <span>requires</span> <span>some</span> <span>heavy</span> <span>thought</span>.<span></span> <span>As</span> <span>you</span> <span>read</span> <span>each</span> <span>of</span> <span>the</span> <span>algorithms</span> <span>below,</span> <span>you</span> <span>need</span> <span>to</span> <span>satisfy</span> <span>yourself</span> <span>that</span> <span>they</span> <span>do</span> <span>indeed</span> <span>work</span> <span>under</span> <span>all</span> <span>conditions</span>.<span></span> <span>Think</span> <span>about</span> <span>it,</span> <span>and</span> <span>don't</span> <span>just</span> <span>accept</span> <span>them</span> <span>at</span> <span>face</span> <span>value</span>.<span></span> </p>
<h3><span>5</span>.<span>1</span> <span>Background</span> </h3>
<ul>
  <li><span>Recall</span> <span>that</span> <span>back</span> <span>in</span> <span>Chapter</span> <span>3</span> <span>we</span> <span>looked</span> <span>at</span> <span class="">cooperating</span> <span>processes</span> <span>(</span> <span>those</span> <span>that</span> <span>can</span> <span>effect</span> <span>or</span> <span>be</span> <span>effected</span> <span>by</span> <span>other</span> <span>simultaneously</span> <span>running</span> <span>processes</span> <span>),</span> <span>and</span> <span>as</span> <span>an</span> <span>example,</span> <span>we</span> <span>used</span> <span>the</span> <span>producer-consumer</span> <span>cooperating</span> <span>processes:
</span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p><span></span><strong><span>Producer</span> <span>code</span> <span>from</span> <span>chapter</span> <span>3:</span></strong><span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> </li>
</ul>
<blockquote>
  <ul>
    <blockquote>
      <p class="style1"><span>item</span> <span>nextProduced;</span> </p>
      <p class="style1"><span>while(</span> <span>true</span> <span>)</span> </p>
      <blockquote>
        <p class="style1"><span>/*</span> <span>Produce</span> <span>an</span> <span>item</span> <span>and</span> <span>store</span> <span>it</span> <span>in</span> <span>nextProduced</span> <span>*/</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>nextProduced</span> <span>=</span> <span>makeNewItem(</span> <span></span>.<span></span> <span></span>.<span></span> <span></span>.<span></span> <span>);</span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>Wait</span> <span>for</span> <span>space</span> <span>to</span> <span>become</span> <span>available</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>while(</span> <span>(</span> <span>(</span> <span>in</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> <span>BUFFER_SIZE</span> <span>)</span> <span>==</span> <span>out</span> <span>)</span><br><span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>;</span> <span>/*</span> <span>Do</span> <span>nothing</span> <span>*/</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>And</span> <span>then</span> <span>store</span> <span>the</span> <span>item</span> <span>and</span> <span>repeat</span> <span>the</span> <span>loop</span>.<span></span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>buffer[</span> <span>in</span> <span>]</span> <span>=</span> <span>nextProduced;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>in</span> <span>=</span> <span>(</span> <span>in</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> </p>
      </blockquote>
      <p class="style1"><span></span> <span>}</span> </p>
    </blockquote>
  </ul>
  <blockquote>
    <p><span></span><strong><span>Consumer</span> <span>code</span> <span>from</span> <span>chapter</span> <span>3:</span> <span></span> <span></span></strong></p>
  </blockquote>
  <ul>
    <blockquote>
      <p class="style1"><span>item</span> <span>nextConsumed;</span> </p>
      <p class="style1"><span>while(</span> <span>true</span> <span>)</span> </p>
      <blockquote>
        <p class="style1"><span>/*</span> <span>Wait</span> <span>for</span> <span>an</span> <span>item</span> <span>to</span> <span>become</span> <span>available</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>while(</span> <span>in</span> <span>==</span> <span>out</span> <span>)</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>;</span> <span>/*</span> <span>Do</span> <span>nothing</span> </p>
        <p class="style1"><span>/*</span> <span>Get</span> <span>the</span> <span>next</span> <span>available</span> <span>item</span> <span>*/</span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>nextConsumed</span> <span>=</span> <span>buffer[</span> <span>out</span> <span>];</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>out</span> <span>=</span> <span>(</span> <span>out</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> <span>BUFFER_SIZE;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>/*</span> <span>Consume</span> <span>the</span> <span>item</span> <span>in</span> <span>nextConsumed</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(</span> <span>Do</span> <span>something</span> <span>with</span> <span>it</span> <span>)</span> <span>*/</span> </p>
      </blockquote>
      <p class="style1"></p>
    </blockquote>
    <li><span>The</span> <span>only</span> <span>problem</span> <span>with</span> <span>the</span> <span>above</span> <span>code</span> <span>is</span> <span>that</span> <span>the</span> <span>maximum</span> <span>number</span> <span>of</span> <span>items</span> <span>which</span> <span>can</span> <span>be</span> <span>placed</span> <span>into</span> <span>the</span> <span>buffer</span> <span>is</span> <span>BUFFER_SIZE</span> <span>-</span> <span>1</span>.<span></span> <span>One</span> <span>slot</span> <span>is</span> <span>unavailable</span> <span>because</span> <span>there</span> <span>always</span> <span>has</span> <span>to</span> <span>be</span> <span>a</span> <span>gap</span> <span>between</span> <span>the</span> <span>producer</span> <span>and</span> <span>the</span> <span>consumer</span>.</li>
    <li><span>We</span> <span>could</span> <span>try</span> <span>to</span> <span>overcome</span> <span>this</span> <span></span> <span>deficiency</span> <span>by</span> <span>introducing</span> <span>a</span> <span>counter</span> <span>variable,</span> <span>as</span> <span>shown</span> <span>in</span> <span>the</span> <span>following</span> <span>code</span> <span>segments:</span> </li>
  </ul>
  <blockquote>
    <p><span></span><img src="./3_ Process Synchronization_files/5_00_ProducerConsumer.jpg" width="618" height="571"></p>
  </blockquote>
  <ul>
    <li><span>Unfortunately</span> <span>we</span> <span>have</span> <span>now</span> <span>introduced</span> <span>a</span> <span>new</span> <span>problem,</span> <span>because</span> <span>both</span> <span>the</span> <span>producer</span> <span>and</span> <span>the</span> <span>consumer</span> <span>are</span> <span>adjusting</span> <span>the</span> <span>value</span> <span>of</span> <span>the</span> <span>variable</span> <span>counter,</span> <span>which</span> <span>can</span> <span>lead</span> <span>to</span> <span>a</span> <span>condition</span> <span>known</span> <span>as</span> <span>a</span> <span></span><em><span></span><strong><span>race</span> <span>condition</span></strong><span></span></em><span></span>.<span></span> <span>In</span> <span>this</span> <span>condition</span> <span>a</span> <span>piece</span> <span>of</span> <span>code</span> <span>may</span> <span>or</span> <span>may</span> <span>not</span> <span>work</span> <span>correctly,</span> <span>depending</span> <span>on</span> <span>which</span> <span>of</span> <span>two</span> <span>simultaneous</span> <span>processes</span> <span>executes</span> <span>first,</span> <span>and</span> <span>more</span> <span>importantly</span> <span>if</span> <span>one</span> <span>of</span> <span>the</span> <span>processes</span> <span>gets</span> <span>interrupted</span> <span>such</span> <span>that</span> <span>the</span> <span>other</span> <span>process</span> <span>runs</span> <span>between</span> <span>important</span> <span>steps</span> <span>of</span> <span>the</span> <span>first</span> <span>process</span>.<span></span> <span>(</span> <span>Bank</span> <span>balance</span> <span>example</span> <span>discussed</span> <span>in</span> <span>class</span>.<span></span> <span>)</span> </li>
    <li><span>The</span> <span>particular</span> <span>problem</span> <span>above</span> <span>comes</span> <span>from</span> <span>the</span> <span>producer</span> <span>executing</span> <span>"counter++"</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span> <span>the</span> <span>consumer</span> <span>is</span> <span>executing</span> <span>"counter--"</span>.<span></span> <span>If</span> <span>one</span> <span>process</span> <span>gets</span> <span>part</span> <span>way</span> <span>through</span> <span>making</span> <span>the</span> <span>update</span> <span>and</span> <span>then</span> <span>the</span> <span>other</span> <span>process</span> <span>butts</span> <span>in,</span> <span>the</span> <span>value</span> <span>of</span> <span>counter</span> <span>can</span> <span>get</span> <span>left</span> <span>in</span> <span>an</span> <span>incorrect</span> <span>state</span>.</li>
    <li><span>But,</span> <span>you</span> <span>might</span> <span>say,</span> <span>"Each</span> <span>of</span> <span>those</span> <span>are</span> <span>single</span> <span>instructions</span> <span>-</span> <span>How</span> <span>can</span> <span>they</span> <span>get</span> <span>interrupted</span> <span>halfway</span> <span>through?"</span> <span>The</span> <span>answer</span> <span>is</span> <span>that</span> <span>although</span> <span>they</span> <span>are</span> <span>single</span> <span>instructions</span> <span>in</span> <span>C++,</span> <span>they</span> <span>are</span> <span>actually</span> <span>three</span> <span>steps</span> <span>each</span> <span>at</span> <span>the</span> <span>hardware</span> <span>level:</span> <span>(1)</span> <span>Fetch</span> <span>counter</span> <span>from</span> <span>memory</span> <span>into</span> <span>a</span> <span>register,</span> <span>(2)</span> <span>increment</span> <span>or</span> <span>decrement</span> <span>the</span> <span>register,</span> <span>and</span> <span>(3)</span> <span>Store</span> <span>the</span> <span>new</span> <span>value</span> <span>of</span> <span>counter</span> <span>back</span> <span>to</span> <span>memory</span>.<span></span> <span>If</span> <span>the</span> <span>instructions</span> <span>from</span> <span>the</span> <span>two</span> <span>processes</span> <span>get</span> <span>interleaved,</span> <span>there</span> <span>could</span> <span>be</span> <span>serious</span> <span>problems,</span> <span>such</span> <span>as</span> <span>illustrated</span> <span>by</span> <span>the</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_RaceCondition.jpg" width="706" height="497"></p>
  </blockquote>
  <ul>
    <li><span></span><strong><span>Exercise:</span> <span></span></strong><span>What</span> <span>would</span> <span>be</span> <span>the</span> <span>resulting</span> <span>value</span> <span>of</span> <span>counter</span> <span>if</span> <span>the</span> <span>order</span> <span>of</span> <span>statements</span> <span>T4</span> <span>and</span> <span>T5</span> <span>were</span> <span>reversed?</span> <span>(</span> <span>What</span> <span></span><strong><span>should</span></strong><span></span> <span>the</span> <span>value</span> <span>of</span> <span>counter</span> <span>be</span> <span>after</span> <span>one</span> <span>producer</span> <span>and</span> <span>one</span> <span>consumer,</span> <span>assuming</span> <span>the</span> <span>original</span> <span>value</span> <span>was</span> <span>5?</span> <span>)</span> </li>
    <li><span>Note</span> <span>that</span> <span>race</span> <span>conditions</span> <span>are</span> <span></span><em><span></span><strong><span>notoriously</span> <span>difficult</span></strong><span></span></em><span></span> <span>to</span> <span>identify</span> <span>and</span> <span>debug,</span> <span>because</span> <span>by</span> <span>their</span> <span>very</span> <span>nature</span> <span>they</span> <span>only</span> <span>occur</span> <span>on</span> <span>rare</span> <span>occasions,</span> <span>and</span> <span>only</span> <span>when</span> <span>the</span> <span>timing</span> <span>is</span> <span>just</span> <span>exactly</span> <span>right</span>.<span></span> <span>(</span> <span>or</span> <span>wrong!</span> <span>:-)</span> <span>)</span> <span>Race</span> <span>conditions</span> <span>are</span> <span>also</span> <span>very</span> <span>difficult</span> <span>to</span> <span>reproduce</span>.<span></span> <span></span> <span>:-(</span> </li>
    <li><span>Obviously</span> <span>the</span> <span>solution</span> <span>is</span> <span>to</span> <span>only</span> <span>allow</span> <span>one</span> <span>process</span> <span>at</span> <span>a</span> <span>time</span> <span>to</span> <span>manipulate</span> <span>the</span> <span>value</span> <span>"counter"</span>.<span></span> <span>This</span> <span>is</span> <span>a</span> <span>very</span> <span>common</span> <span>occurrence</span> <span>among</span> <span>cooperating</span> <span>processes,</span> <span>so</span> <span>lets</span> <span>look</span> <span>at</span> <span>some</span> <span>ways</span> <span>in</span> <span>which</span> <span>this</span> <span>is</span> <span>done,</span> <span>as</span> <span>well</span> <span>as</span> <span>some</span> <span>classic</span> <span>problems</span> <span>in</span> <span>this</span> <span>area</span>.<span></span> </li>
  </ul>
</blockquote>
<h3><span>5</span>.<span>2</span> <span>The</span> <span>Critical-Section</span> <span>Problem</span> </h3>
<ul>
  <li><span>The</span> <span>producer-consumer</span> <span>problem</span> <span>described</span> <span>above</span> <span>is</span> <span>a</span> <span>specific</span> <span>example</span> <span>of</span> <span>a</span> <span>more</span> <span>general</span> <span>situation</span> <span>known</span> <span>as</span> <span>the</span> <span></span><em><span></span><strong><span>critical</span> <span>section</span></strong><span></span></em><span></span> <span>problem</span>.<span></span> <span>The</span> <span>general</span> <span>idea</span> <span>is</span> <span>that</span> <span>in</span> <span>a</span> <span>number</span> <span>of</span> <span>cooperating</span> <span>processes,</span> <span>each</span> <span>has</span> <span>a</span> <span>critical</span> <span>section</span> <span>of</span> <span>code,</span> <span>with</span> <span>the</span> <span>following</span> <span>conditions</span> <span>and</span> <span>terminologies:
</span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Only</span> <span>one</span> <span>process</span> <span>in</span> <span>the</span> <span>group</span> <span>can</span> <span>be</span> <span>allowed</span> <span>to</span> <span>execute</span> <span>in</span> <span>their</span> <span>critical</span> <span>section</span> <span>at</span> <span>any</span> <span>one</span> <span>time</span>.<span></span> <span>If</span> <span>one</span> <span>process</span> <span>is</span> <span>already</span> <span>executing</span> <span>their</span> <span>critical</span> <span>section</span> <span>and</span> <span>another</span> <span>process</span> <span>wishes</span> <span>to</span> <span>do</span> <span>so,</span> <span>then</span> <span>the</span> <span>second</span> <span>process</span> <span>must</span> <span>be</span> <span>made</span> <span>to</span> <span>wait</span> <span>until</span> <span>the</span> <span>first</span> <span>process</span> <span>has</span> <span>completed</span> <span>their</span> <span>critical</span> <span>section</span> <span>work</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>code</span> <span>preceding</span> <span>the</span> <span>critical</span> <span>section,</span> <span>and</span> <span>which</span> <span>controls</span> <span>access</span> <span>to</span> <span>the</span> <span>critical</span> <span>section,</span> <span>is</span> <span>termed</span> <span>the</span> <span>entry</span> <span>section</span>.<span></span> <span>It</span> <span>acts</span> <span>like</span> <span>a</span> <span>carefully</span> <span>controlled</span> <span>locking</span> <span>door</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>code</span> <span>following</span> <span>the</span> <span>critical</span> <span>section</span> <span>is</span> <span>termed</span> <span>the</span> <span>exit</span> <span>section</span>.<span></span> <span>It</span> <span>generally</span> <span>releases</span> <span>the</span> <span>lock</span> <span>on</span> <span>someone</span> <span>else's</span> <span>door,</span> <span>or</span> <span>at</span> <span>least</span> <span>lets</span> <span>the</span> <span>world</span> <span>know</span> <span>that</span> <span>they</span> <span>are</span> <span>no</span> <span>longer</span> <span>in</span> <span>their</span> <span>critical</span> <span>section</span>.<span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>rest</span> <span>of</span> <span>the</span> <span>code</span> <span>not</span> <span>included</span> <span>in</span> <span>either</span> <span>the</span> <span>critical</span> <span>section</span> <span>or</span> <span>the</span> <span>entry</span> <span>or</span> <span>exit</span> <span>sections</span> <span>is</span> <span>termed</span> <span>the</span> <span>remainder</span> <span>section</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> </li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_01_CriticalSection.jpg" width="475" height="324"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>1</span> <span>-</span> <span>General</span> <span>structure</span> <span>of</span> <span>a</span> <span>typical</span> <span>process</span> <span>Pi</span></strong></p>
<ul>
  <li><span>A</span> <span>solution</span> <span>to</span> <span>the</span> <span>critical</span> <span>section</span> <span>problem</span> <span>must</span> <span>satisfy</span> <span>the</span> <span>following</span> <span>three</span> <span>conditions:
</span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Mutual</span> <span>Exclusion</span></strong><span></span> <span>-</span> <span>Only</span> <span>one</span> <span>process</span> <span>at</span> <span>a</span> <span>time</span> <span>can</span> <span>be</span> <span>executing</span> <span>in</span> <span>their</span> <span>critical</span> <span>section</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Progress</span></strong><span></span> <span>-</span> <span></span> <span></span> <span></span> <span>If</span> <span>no</span> <span>process</span> <span>is</span> <span>currently</span> <span>executing</span> <span>in</span> <span>their</span> <span>critical</span> <span>section,</span> <span>and</span> <span>one</span> <span>or</span> <span>more</span> <span>processes</span> <span>want</span> <span>to</span> <span>execute</span> <span>their</span> <span>critical</span> <span>section,</span> <span>then</span> <span>only</span> <span>the</span> <span>processes</span> <span>not</span> <span>in</span> <span>their</span> <span>remainder</span> <span>sections</span> <span>can</span> <span>participate</span> <span>in</span> <span>the</span> <span>decision,</span> <span>and</span> <span>the</span> <span>decision</span> <span>cannot</span> <span>be</span> <span>postponed</span> <span>indefinitely</span>.<span></span> <span>(</span> <span>I</span>.<span>e</span>.<span></span> <span>processes</span> <span>cannot</span> <span>be</span> <span>blocked</span> <span>forever</span> <span>waiting</span> <span>to</span> <span>get</span> <span>into</span> <span>their</span> <span>critical</span> <span>sections</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Bounded</span> <span>Waiting</span></strong><span></span> <span>-</span> <span>There</span> <span>exists</span> <span>a</span> <span>limit</span> <span>as</span> <span>to</span> <span>how</span> <span>many</span> <span>other</span> <span>processes</span> <span>can</span> <span>get</span> <span>into</span> <span>their</span> <span>critical</span> <span>sections</span> <span>after</span> <span>a</span> <span>process</span> <span>requests</span> <span>entry</span> <span>into</span> <span>their</span> <span>critical</span> <span>section</span> <span>and</span> <span>before</span> <span>that</span> <span>request</span> <span>is</span> <span>granted</span>.<span></span> <span>(</span> <span>I</span>.<span>e</span>.<span></span> <span>a</span> <span>process</span> <span>requesting</span> <span>entry</span> <span>into</span> <span>their</span> <span>critical</span> <span>section</span> <span>will</span> <span>get</span> <span>a</span> <span>turn</span> <span>eventually,</span> <span>and</span> <span>there</span> <span>is</span> <span>a</span> <span>limit</span> <span>as</span> <span>to</span> <span>how</span> <span>many</span> <span>other</span> <span>processes</span> <span>get</span> <span>to</span> <span>go</span> <span>first</span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> </li>
  <li><span>We</span> <span>assume</span> <span>that</span> <span>all</span> <span>processes</span> <span>proceed</span> <span>at</span> <span>a</span> <span>non-zero</span> <span>speed,</span> <span>but</span> <span>no</span> <span>assumptions</span> <span>can</span> <span>be</span> <span>made</span> <span>regarding</span> <span>the</span> <span></span><em><span></span><strong><span>relative</span></strong><span></span></em><span></span> <span>speed</span> <span>of</span> <span>one</span> <span>process</span> <span>versus</span> <span>another</span>.</li>
  <li><span>Kernel</span> <span>processes</span> <span>can</span> <span>also</span> <span>be</span> <span>subject</span> <span>to</span> <span>race</span> <span>conditions,</span> <span>which</span> <span>can</span> <span>be</span> <span>especially</span> <span>problematic</span> <span>when</span> <span>updating</span> <span>commonly</span> <span>shared</span> <span>kernel</span> <span>data</span> <span>structures</span> <span>such</span> <span>as</span> <span>open</span> <span>file</span> <span>tables</span> <span>or</span> <span>virtual</span> <span>memory</span> <span>management</span>.<span></span> <span>Accordingly</span> <span>kernels</span> <span>can</span> <span>take</span> <span>on</span> <span>one</span> <span>of</span> <span>two</span> <span>forms:
</span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Non-preemptive</span> <span>kernels</span> <span>do</span> <span>not</span> <span>allow</span> <span>processes</span> <span>to</span> <span>be</span> <span>interrupted</span> <span>while</span> <span>in</span> <span>kernel</span> <span>mode</span>.<span></span> <span>This</span> <span>eliminates</span> <span>the</span> <span>possibility</span> <span>of</span> <span>kernel-mode</span> <span>race</span> <span>conditions,</span> <span>but</span> <span>requires</span> <span>kernel</span> <span>mode</span> <span>operations</span> <span>to</span> <span>complete</span> <span>very</span> <span>quickly,</span> <span>and</span> <span>can</span> <span>be</span> <span>problematic</span> <span>for</span> <span>real-time</span> <span>systems,</span> <span>because</span> <span>timing</span> <span>cannot</span> <span>be</span> <span>guaranteed</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Preemptive</span> <span>kernels</span> <span>allow</span> <span>for</span> <span>real-time</span> <span>operations,</span> <span>but</span> <span>must</span> <span>be</span> <span>carefully</span> <span>written</span> <span>to</span> <span>avoid</span> <span>race</span> <span>conditions</span>.<span></span> <span>This</span> <span>can</span> <span>be</span> <span>especially</span> <span>tricky</span> <span>on</span> <span>SMP</span> <span>systems,</span> <span>in</span> <span>which</span> <span>multiple</span> <span>kernel</span> <span>processes</span> <span>may</span> <span>be</span> <span>running</span> <span>simultaneously</span> <span>on</span> <span>different</span> <span>processors</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> </li>
  <li><span>Non-preemptive</span> <span>kernels</span> <span>include</span> <span>Windows</span> <span>XP,</span> <span>2000,</span> <span>traditional</span> <span>UNIX,</span> <span>and</span> <span>Linux</span> <span>prior</span> <span>to</span> <span>2</span>.<span>6;</span> <span>Preemptive</span> <span>kernels</span> <span>include</span> <span>Linux</span> <span>2</span>.<span>6</span> <span>and</span> <span>later,</span> <span>and</span> <span>some</span> <span>commercial</span> <span>UNIXes</span> <span>such</span> <span>as</span> <span>Solaris</span> <span>and</span> <span>IRIX</span>.<span></span> <span></span><br><span></span> <span>
</span> <span></span> </li>
</ul>
<h3><span>5</span>.<span>3</span> <span>Peterson's</span> <span>Solution</span> </h3>
<ul>
  <li><span>Peterson's</span> <span>Solution</span> <span>is</span> <span>a</span> <span>classic</span> <span>software-based</span> <span>solution</span> <span>to</span> <span>the</span> <span>critical</span> <span>section</span> <span>problem</span>.<span></span> <span>It</span> <span>is</span> <span>unfortunately</span> <span>not</span> <span>guaranteed</span> <span>to</span> <span>work</span> <span>on</span> <span>modern</span> <span>hardware,</span> <span>due</span> <span>to</span> <span>vagaries</span> <span>of</span> <span>load</span> <span>and</span> <span>store</span> <span>operations,</span> <span>but</span> <span>it</span> <span>illustrates</span> <span>a</span> <span>number</span> <span>of</span> <span>important</span> <span>concepts</span>.</li>
  <li><span>Peterson's</span> <span>solution</span> <span>is</span> <span>based</span> <span>on</span> <span>two</span> <span>processes,</span> <span>P0</span> <span>and</span> <span>P1,</span> <span>which</span> <span>alternate</span> <span>between</span> <span>their</span> <span>critical</span> <span>sections</span> <span>and</span> <span>remainder</span> <span>sections</span>.<span></span> <span>For</span> <span>convenience</span> <span>of</span> <span>discussion,</span> <span>"this"</span> <span>process</span> <span>is</span> <span>Pi,</span> <span>and</span> <span>the</span> <span>"other"</span> <span>process</span> <span>is</span> <span>Pj</span>.<span></span> <span>(&nbsp;I</span>.<span>e</span>.</li>
  <li><span>Peterson's</span> <span>solution</span> <span>requires</span> <span>two</span> <span>shared</span> <span>data</span> <span>items:
</span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>int</span> <span>turn</span></strong><span></span> <span>-</span> <span>Indicates</span> <span>whose</span> <span>turn</span> <span>it</span> <span>is</span> <span>to</span> <span>enter</span> <span>into</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span> <span>If</span> <span>turn</span> <span>=</span> <span>=</span> <span>i,</span> <span>then</span> <span>process</span> <span>i</span> <span>is</span> <span>allowed</span> <span>into</span> <span>their</span> <span>critical</span> <span>section</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>boolean</span> <span>flag[</span> <span>2</span> <span>]</span></strong><span></span> <span>-</span> <span>Indicates</span> <span>when</span> <span>a</span> <span>process</span> <span></span><em><span></span><strong><span>wants</span> <span>to</span></strong><span></span></em><span></span> <span>enter</span> <span>into</span> <span>their</span> <span>critical</span> <span>section</span>.<span></span> <span>When</span> <span>process</span> <span>i</span> <span>wants</span> <span>to</span> <span>enter</span> <span>their</span> <span>critical</span> <span>section,</span> <span>it</span> <span>sets</span> <span>flag[</span> <span>i</span> <span>]</span> <span>to</span> <span>true</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> </li>
  <li><span>In</span> <span>the</span> <span>following</span> <span>diagram,</span> <span>the</span> <span>entry</span> <span>and</span> <span>exit</span> <span>sections</span> <span>are</span> <span>enclosed</span> <span>in</span> <span>boxes</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>In</span> <span>the</span> <span>entry</span> <span>section,</span> <span>process</span> <span>i</span> <span>first</span> <span>raises</span> <span>a</span> <span>flag</span> <span>indicating</span> <span>a</span> <span>desire</span> <span>to</span> <span>enter</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Then</span> <span>turn</span> <span>is</span> <span>set</span> <span>to</span><em><span></span><strong><span></span> <span>j</span> <span></span></strong><span></span></em><span>to</span> <span>allow</span> <span>the</span> <span></span><em><span></span><strong><span>other</span></strong><span></span></em><span></span> <span>process</span> <span>to</span> <span>enter</span> <span>their</span> <span>critical</span> <span>section</span><em><span></span><strong><span></span> <span>if</span> <span>process</span> <span>j</span> <span>so</span> <span>desires</span>.<span></span></strong><span></span></em><span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>while</span> <span>loop</span> <span>is</span> <span>a</span> <span>busy</span> <span>loop</span> <span>(</span> <span>notice</span> <span>the</span> <span>semicolon</span> <span>at</span> <span>the</span> <span>end</span> <span>),</span> <span>which</span> <span>makes</span> <span>process</span> <span>i</span> <span>wait</span> <span>as</span> <span>long</span> <span>as</span> <span>process</span> <span>j</span> <span>has</span> <span>the</span> <span>turn</span> <span>and</span> <span>wants</span> <span>to</span> <span>enter</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Process</span> <span>i</span> <span>lowers</span> <span>the</span> <span>flag[</span> <span>i</span> <span>]</span> <span>in</span> <span>the</span> <span>exit</span> <span>section,</span> <span>allowing</span> <span>process</span> <span>j</span> <span>to</span> <span>continue</span> <span>if</span> <span>it</span> <span>has</span> <span>been</span> <span>waiting</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> </li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_02_Petersons.jpg" width="539" height="387"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>2</span> <span>-</span> <span>The</span> <span>structure</span> <span>of</span> <span>process</span> <span>Pi</span> <span>in</span> <span>Peterson's</span> <span>solution</span>.<span></span></strong></p>
<ul>
  <li><span>To</span> <span>prove</span> <span>that</span> <span>the</span> <span>solution</span> <span>is</span> <span>correct,</span> <span>we</span> <span>must</span> <span>examine</span> <span>the</span> <span>three</span> <span>conditions</span> <span>listed</span> <span>above:
</span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Mutual</span> <span>exclusion</span></strong><span></span> <span>-</span> <span>If</span> <span>one</span> <span>process</span> <span>is</span> <span>executing</span> <span>their</span> <span>critical</span> <span>section</span> <span>when</span> <span>the</span> <span>other</span> <span>wishes</span> <span>to</span> <span>do</span> <span>so,</span> <span>the</span> <span>second</span> <span>process</span> <span>will</span> <span>become</span> <span>blocked</span> <span>by</span> <span>the</span> <span>flag</span> <span>of</span> <span>the</span> <span>first</span> <span>process</span>.<span></span> <span>If</span> <span>both</span> <span>processes</span> <span>attempt</span> <span>to</span> <span>enter</span> <span>at</span> <span>the</span> <span>same</span> <span>time,</span> <span>the</span> <span>last</span> <span>process</span> <span>to</span> <span>execute</span> <span>"turn</span> <span>=</span> <span>j"</span> <span>will</span> <span>be</span> <span>blocked</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Progress</span></strong><span></span> <span>-</span> <span>Each</span> <span>process</span> <span>can</span> <span>only</span> <span>be</span> <span>blocked</span> <span>at</span> <span>the</span> <span>while</span> <span>if</span> <span>the</span> <span>other</span> <span>process</span> <span>wants</span> <span>to</span> <span>use</span> <span>the</span> <span>critical</span> <span>section</span> <span>(</span> <span>flag[</span> <span>j</span> <span>]</span> <span>=</span> <span>=</span> <span>true</span> <span>),</span> <span>AND</span> <span>it</span> <span>is</span> <span>the</span> <span>other</span> <span>process's</span> <span>turn</span> <span>to</span> <span>use</span> <span>the</span> <span>critical</span> <span>section</span> <span>(</span> <span>turn</span> <span>=</span> <span>=</span> <span>j</span> <span>)</span>.<span></span> <span>If</span> <span>both</span> <span>of</span> <span>those</span> <span>conditions</span> <span>are</span> <span>true,</span> <span>then</span> <span>the</span> <span>other</span> <span>process</span> <span>(</span> <span>j</span> <span>)</span> <span>will</span> <span>be</span> <span>allowed</span> <span>to</span> <span>enter</span> <span>the</span> <span>critical</span> <span>section,</span> <span>and</span> <span>upon</span> <span>exiting</span> <span>the</span> <span>critical</span> <span>section,</span> <span>will</span> <span>set</span> <span>flag[</span> <span>j</span> <span>]</span> <span>to</span> <span>false,</span> <span>releasing</span> <span>process</span> <span>i</span>.<span></span> <span>The</span> <span>shared</span> <span>variable</span> <span>turn</span> <span>assures</span> <span>that</span> <span>only</span> <span>one</span> <span>process</span> <span>at</span> <span>a</span> <span>time</span> <span>can</span> <span>be</span> <span>blocked,</span> <span>and</span> <span>the</span> <span>flag</span> <span>variable</span> <span>allows</span> <span>one</span> <span>process</span> <span>to</span> <span>release</span> <span>the</span> <span>other</span> <span>when</span> <span>exiting</span> <span>their</span> <span>critical</span> <span>section</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Bounded</span> <span>Waiting</span></strong><span></span> <span>-</span> <span>As</span> <span>each</span> <span>process</span> <span>enters</span> <span>their</span> <span>entry</span> <span>section,</span> <span>they</span> <span>set</span> <span>the</span> <span>turn</span> <span>variable</span> <span>to</span> <span>be</span> <span>the</span> <span>other</span> <span>processes</span> <span>turn</span>.<span></span> <span>Since</span> <span>no</span> <span>process</span> <span>ever</span> <span>sets</span> <span>it</span> <span>back</span> <span>to</span> <span>their</span> <span>own</span> <span>turn,</span> <span>this</span> <span>ensures</span> <span>that</span> <span>each</span> <span>process</span> <span>will</span> <span>have</span> <span>to</span> <span>let</span> <span>the</span> <span>other</span> <span>process</span> <span>go</span> <span>first</span> <span>at</span> <span>most</span> <span>one</span> <span>time</span> <span>before</span> <span>it</span> <span>becomes</span> <span>their</span> <span>turn</span> <span>again</span>.<span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> </li>
  <li><span>Note</span> <span>that</span> <span>the</span> <span>instruction</span> <span>"turn</span> <span>=</span> <span>j"</span> <span>is</span> <span></span><em><span></span><strong><span>atomic,</span> <span></span></strong><span></span></em><span>that</span> <span>is</span> <span>it</span> <span>is</span> <span>a</span> <span>single</span> <span>machine</span> <span>instruction</span> <span>which</span> <span>cannot</span> <span>be</span> <span>interrupted</span>.<span></span> </li>
</ul>
<h3><span>5</span>.<span>4</span> <span>Synchronization</span> <span>Hardware</span> </h3>
<ul>
  <li><span>To</span> <span>generalize</span> <span>the</span> <span>solution(s)</span> <span>expressed</span> <span>above,</span> <span>each</span> <span>process</span> <span>when</span> <span>entering</span> <span>their</span> <span>critical</span> <span>section</span> <span>must</span> <span>set</span> <span>some</span> <span>sort</span> <span>of</span> <span></span><em><span></span><strong><span>lock</span></strong><span></span></em><span>,</span> <span>to</span> <span>prevent</span> <span>other</span> <span>processes</span> <span>from</span> <span>entering</span> <span>their</span> <span>critical</span> <span>sections</span> <span>simultaneously,</span> <span>and</span> <span>must</span> <span>release</span> <span>the</span> <span>lock</span> <span>when</span> <span>exiting</span> <span>their</span> <span>critical</span> <span>section,</span> <span>to</span> <span>allow</span> <span>other</span> <span>processes</span> <span>to</span> <span>proceed</span>.<span></span> <span>Obviously</span> <span>it</span> <span>must</span> <span>be</span> <span>possible</span> <span>to</span> <span>attain</span> <span>the</span> <span>lock</span> <span>only</span> <span>when</span> <span>no</span> <span>other</span> <span>process</span> <span>has</span> <span>already</span> <span>set</span> <span>a</span> <span>lock</span>.<span></span> <span>Specific</span> <span>implementations</span> <span>of</span> <span>this</span> <span>general</span> <span>procedure</span> <span>can</span> <span>get</span> <span>quite</span> <span>complicated,</span> <span>and</span> <span>may</span> <span>include</span> <span>hardware</span> <span>solutions</span> <span>as</span> <span>outlined</span> <span>in</span> <span>this</span> <span>section</span>.<span></span> </li>
  <li><span>One</span> <span>simple</span> <span>solution</span> <span>to</span> <span>the</span> <span>critical</span> <span>section</span> <span>problem</span> <span>is</span> <span>to</span> <span>simply</span> <span>prevent</span> <span>a</span> <span>process</span> <span>from</span> <span>being</span> <span>interrupted</span> <span>while</span> <span>in</span> <span>their</span> <span>critical</span> <span>section,</span> <span>which</span> <span>is</span> <span>the</span> <span>approach</span> <span>taken</span> <span>by</span> <span>non</span> <span>preemptive</span> <span>kernels</span>.<span></span> <span>Unfortunately</span> <span>this</span> <span>does</span> <span>not</span> <span>work</span> <span>well</span> <span>in</span> <span>multiprocessor</span> <span>environments,</span> <span>due</span> <span>to</span> <span>the</span> <span>difficulties</span> <span>in</span> <span>disabling</span> <span>and</span> <span>the</span> <span>re-enabling</span> <span>interrupts</span> <span>on</span> <span>all</span> <span>processors</span>.<span></span> <span>There</span> <span>is</span> <span>also</span> <span>a</span> <span>question</span> <span>as</span> <span>to</span> <span>how</span> <span>this</span> <span>approach</span> <span>affects</span> <span>timing</span> <span>if</span> <span>the</span> <span>clock</span> <span>interrupt</span> <span>is</span> <span>disabled</span>.</li>

  <li><span>Another</span> <span>approach</span> <span>is</span> <span>for</span> <span>hardware</span> <span>to</span> <span>provide</span> <span>certain</span> <span></span><em><span></span><strong><span>atomic</span></strong><span></span></em><span></span> <span>operations</span>.<span></span> <span>These</span> <span>operations</span> <span>are</span> <span>guaranteed</span> <span>to</span> <span>operate</span> <span>as</span> <span>a</span> <span>single</span> <span>instruction,</span> <span>without</span> <span>interruption</span>.<span></span> <span>One</span> <span>such</span> <span>operation</span> <span>is</span> <span>the</span> <span>"Test</span> <span>and</span> <span>Set",</span> <span>which</span> <span>simultaneously</span> <span>sets</span> <span>a</span> <span>boolean</span> <span>lock</span> <span>variable</span> <span>and</span> <span>returns</span> <span>its</span> <span>previous</span> <span>value,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figures</span> <span>5</span>.<span>3</span> <span>and</span> <span>5</span>.<span>4:</span> </li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_0304_TestAndSet.jpg" width="614" height="535"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figures</span> <span>5</span>.<span>3</span> <span>and</span> <span>5</span>.<span>4</span> <span>illustrate</span> <span>"test_and_set(</span> <span>)"</span> <span>function</span></strong></p>
<ul>
  <li><span>Another</span> <span>variation</span> <span>on</span> <span>the</span> <span>test-and-set</span> <span>is</span> <span>an</span> <span>atomic</span> <span>swap</span> <span>of</span> <span>two</span> <span>booleans,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figures</span> <span>5</span>.<span>5</span> <span>and</span> <span>5</span>.</li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_0506_CompareAndSwap.jpg" width="794" height="647"></p>
<ul>
  <li><span></span> <span></span> <span>The</span> <span>above</span> <span>examples</span> <span>satisfy</span> <span>the</span> <span>mutual</span> <span>exclusion</span> <span>requirement,</span> <span>but</span> <span>unfortunately</span> <span>do</span> <span>not</span> <span>guarantee</span> <span>bounded</span> <span>waiting</span>.<span></span> <span>If</span> <span>there</span> <span>are</span> <span>multiple</span> <span>processes</span> <span>trying</span> <span>to</span> <span>get</span> <span>into</span> <span>their</span> <span>critical</span> <span>sections,</span> <span>there</span> <span>is</span> <span>no</span> <span>guarantee</span> <span>of</span> <span>what</span> <span>order</span> <span>they</span> <span>will</span> <span>enter,</span> <span>and</span> <span>any</span> <span>one</span> <span>process</span> <span>could</span> <span>have</span> <span>the</span> <span>bad</span> <span>luck</span> <span>to</span> <span>wait</span> <span>forever</span> <span>until</span> <span>they</span> <span>got</span> <span>their</span> <span>turn</span> <span>in</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span> <span>(&nbsp;Since</span> <span>there</span> <span>is</span> <span>no</span> <span>guarantee</span> <span>as</span> <span>to</span> <span>the</span> <span>relative</span> <span></span><em><span></span><strong><span>rates</span></strong><span></span></em><span></span> <span>of</span> <span>the</span> <span>processes,</span> <span>a</span> <span>very</span> <span>fast</span> <span>process</span> <span>could</span> <span>theoretically</span> <span>release</span> <span>the</span> <span>lock,</span> <span>whip</span> <span>through</span> <span>their</span> <span>remainder</span> <span>section,</span> <span>and</span> <span>re-lock</span> <span>the</span> <span>lock</span> <span>before</span> <span>a</span> <span>slower</span> <span>process</span> <span>got</span> <span>a</span> <span>chance</span>.<span></span> <span>As</span> <span>more</span> <span>and</span> <span>more</span> <span>processes</span> <span>are</span> <span>involved</span> <span>vying</span> <span>for</span> <span>the</span> <span>same</span> <span>resource,</span> <span>the</span> <span>odds</span> <span>of</span> <span>a</span> <span>slow</span> <span>process</span> <span>getting</span> <span>locked</span> <span>out</span> <span>completely</span> <span>increase</span>.</li>
  <li><span></span> <span>Figure</span> <span>5</span>.<span>7</span> <span>illustrates</span> <span>a</span> <span>solution</span> <span>using</span> <span>test-and-set</span> <span>that</span> <span>does</span> <span>satisfy</span> <span>this</span> <span>requirement,</span> <span>using</span> <span>two</span> <span></span> <span>shared</span> <span>data</span> <span>structures,</span> <span></span><span class="courierFont"><span>boolean</span> <span>lock</span></span><span></span> <span>and</span> <span></span><span class="courierFont"><span>boolean</span> <span>waiting[</span> <span>N</span> <span>]</span></span><span>,</span> <span>where</span> <span>N</span> <span>is</span> <span>the</span> <span>number</span> <span>of</span> <span>processes</span> <span>in</span> <span>contention</span> <span>for</span> <span>critical</span> <span>sections:</span> </li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_07_TestAndSet2.jpg" width="628" height="533"><span></span><br><span>
</span><strong><span>Figure</span> <span>5</span>.<span>7</span> <span>Bounded-waiting</span> <span>mutual</span> <span>exclusion</span> <span>with</span> <span>TestAndSet(</span> <span>)</span>.<span></span></strong></p>
<ul>
  <li><span>The</span> <span>key</span> <span>feature</span> <span>of</span> <span>the</span> <span>above</span> <span>algorithm</span> <span>is</span> <span>that</span> <span>a</span> <span>process</span> <span>blocks</span> <span>on</span> <span>the</span> <span>AND</span> <span>of</span> <span>the</span> <span>critical</span> <span>section</span> <span>being</span> <span>locked</span> <span>and</span> <span>that</span> <span>this</span> <span>process</span> <span>is</span> <span>in</span> <span>the</span> <span>waiting</span> <span>state</span>.<span></span> <span>When</span> <span>exiting</span> <span>a</span> <span>critical</span> <span>section,</span> <span>the</span> <span>exiting</span> <span>process</span> <span>does</span> <span>not</span> <span>just</span> <span>unlock</span> <span>the</span> <span>critical</span> <span>section</span> <span>and</span> <span>let</span> <span>the</span> <span>other</span> <span>processes</span> <span>have</span> <span>a</span> <span>free-for-all</span> <span>trying</span> <span>to</span> <span>get</span> <span>in</span>.<span></span> <span>Rather</span> <span>it</span> <span>first</span> <span>looks</span> <span>in</span> <span>an</span> <span>orderly</span> <span>progression</span> <span>(&nbsp;starting</span> <span>with</span> <span>the</span> <span>next</span> <span>process</span> <span>on</span> <span>the</span> <span>list&nbsp;)</span> <span>for</span> <span>a</span> <span>process</span> <span>that</span> <span>has</span> <span>been</span> <span>waiting,</span> <span>and</span> <span>if</span> <span>it</span> <span>finds</span> <span>one,</span> <span>then</span> <span>it</span> <span>releases</span> <span>that</span> <span>particular</span> <span>process</span> <span>from</span> <span>its</span> <span>waiting</span> <span>state,</span> <span>without</span> <span>unlocking</span> <span>the</span> <span>critical</span> <span>section,</span> <span>thereby</span> <span>allowing</span> <span>a</span> <span>specific</span> <span>process</span> <span>into</span> <span>the</span> <span>critical</span> <span>section</span> <span>while</span> <span>continuing</span> <span>to</span> <span>block</span> <span>all</span> <span>the</span> <span>others</span>.<span></span> <span>Only</span> <span>if</span> <span>there</span> <span>are</span> <span>no</span> <span>other</span> <span>processes</span> <span>currently</span> <span>waiting</span> <span>is</span> <span>the</span> <span>general</span> <span>lock</span> <span>removed,</span> <span>allowing</span> <span>the</span> <span>next</span> <span>process</span> <span>to</span> <span>come</span> <span>along</span> <span>access</span> <span>to</span> <span>the</span> <span>critical</span> <span>section</span>.</li>
  <li><span>Unfortunately,</span> <span>hardware</span> <span>level</span> <span>locks</span> <span>are</span> <span>especially</span> <span>difficult</span> <span>to</span> <span>implement</span> <span>in</span> <span>multi-processor</span> <span>architectures</span>.<span></span> <span>Discussion</span> <span>of</span> <span>such</span> <span>issues</span> <span>is</span> <span>left</span> <span>to</span> <span>books</span> <span>on</span> <span>advanced</span> <span>computer</span> <span>architecture</span>.<span></span> </li>
</ul>
<h3><span>5</span>.<span>5</span> <span>Mutex</span> <span>Locks</span> </h3>
<ul>
  <li><span>The</span> <span>hardware</span> <span>solutions</span> <span>presented</span> <span>above</span> <span>are</span> <span>often</span> <span>difficult</span> <span>for</span> <span>ordinary</span> <span>programmers</span> <span>to</span> <span>access,</span> <span>particularly</span> <span>on</span> <span>multi-processor</span> <span>machines,</span> <span>and</span> <span>particularly</span> <span>because</span> <span>they</span> <span>are</span> <span>often</span> <span>platform-dependent</span>.</li>
  <li><span>Therefore</span> <span>most</span> <span>systems</span> <span>offer</span> <span>a</span> <span>software</span> <span>API</span> <span>equivalent</span> <span>called</span> <span></span><em><span></span><strong><span>mutex</span> <span>locks</span></strong><span></span></em><span></span> <span>or</span> <span>simply</span> <span></span><em><span></span><strong><span>mutexes</span>.<span></span></strong><span></span></em><span></span> <span>(</span> <span>For</span> <span>mutual</span> <span>exclusion</span> </li>
  <li><span>The</span> <span>terminology</span> <span>when</span> <span>using</span> <span>mutexes</span> <span>is</span> <span>to</span> <span></span><em><span></span><strong><span>acquire</span></strong><span></span></em><span></span> <span>a</span> <span>lock</span> <span>prior</span> <span>to</span> <span>entering</span> <span>a</span> <span>critical</span> <span>section,</span> <span>and</span> <span>to</span> <span></span><em><span></span><strong><span>release</span></strong><span></span></em><span></span><strong><span></span> <span>it</span> <span>when</span> <span>exiting,</span> <span>as</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>5</span>.<span>8:</span></strong></li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_08_Locks.jpg" width="615" height="327"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>8</span> <span>-</span> <span>Solution</span> <span>to</span> <span>the</span> <span>critical-section</span> <span>problem</span> <span>using</span> <span>mutex</span> <span>locks</span></strong><span></span> </p>
<ul>
  <li><span>Just</span> <span>as</span> <span>with</span> <span>hardware</span> <span>locks,</span> <span>the</span> <span>acquire</span> <span>step</span> <span>will</span> <span>block</span> <span>the</span> <span>process</span> <span>if</span> <span>the</span> <span>lock</span> <span>is</span> <span>in</span> <span>use</span> <span>by</span> <span>another</span> <span>process,</span> <span>and</span> <span>both</span> <span>the</span> <span>acquire</span> <span>and</span> <span>release</span> <span>operations</span> <span>are</span> <span>atomic</span>.</li>
  <li><span>Acquire</span> <span>and</span> <span>release</span> <span>can</span> <span>be</span> <span>implemented</span> <span>as</span> <span>shown</span> <span>here,</span> <span>based</span> <span>on</span> <span>a</span> <span>boolean</span> <span>variable</span> </li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_Acquire_Release.jpg" width="376" height="395"></p>
<ul>
  <li><span>One</span> <span>problem</span> <span>with</span> <span>the</span> <span>implementation</span> <span>shown</span> <span>here,</span> <span>(</span> <span>and</span> <span>in</span> <span>the</span> <span>hardware</span> <span>solutions</span> <span>presented</span> <span>earlier</span> <span>),</span> <span>is</span> <span>the</span> <span>busy</span> <span>loop</span> <span>used</span> <span>to</span> <span>block</span> <span>processes</span> <span>in</span> <span>the</span> <span>acquire</span> <span>phase</span>.<span></span> <span>These</span> <span>types</span> <span>of</span> <span>locks</span> <span>are</span> <span>referred</span> <span>to</span> <span>as</span> <span></span><em><span></span><strong><span>spinlocks</span></strong><span></span></em><span>,</span> <span>because</span> <span>the</span> <span>CPU</span> <span>just</span> <span>sits</span> <span>and</span> <span>spins</span> <span>while</span> <span>blocking</span> <span>the</span> <span>process</span>.</li>
  <li><span>Spinlocks</span> <span>are</span> <span>wasteful</span> <span>of</span> <span>cpu</span> <span>cycles,</span> <span>and</span> <span>are</span> <span>a</span> <span>really</span> <span>bad</span> <span>idea</span> <span>on</span> <span>single-cpu</span> <span>single-threaded</span> <span>machines,</span> <span>because</span> <span>the</span> <span>spinlock</span> <span>blocks</span> <span>the</span> <span>entire</span> <span>computer,</span> <span>and</span> <span>doesn't</span> <span>allow</span> <span>any</span> <span>other</span> <span>process</span> <span>to</span> <span>release</span> <span>the</span> <span>lock</span>.<span></span> <span>(</span> <span>Until</span> <span>the</span> <span>scheduler</span> <span>kicks</span> <span>the</span> <span>spinning</span> <span>process</span> <span>off</span> <span>of</span> <span>the</span> <span>cpu</span>.<span></span> </li>
  <li><span>On</span> <span>the</span> <span>other</span> <span>hand,</span> <span>spinlocks</span> <span>do</span> <span>not</span> <span>incur</span> <span>the</span> <span>overhead</span> <span>of</span> <span>a</span> <span>context</span> <span>switch,</span> <span>so</span> <span>they</span> <span>are</span> <span>effectively</span> <span>used</span> <span>on</span> <span>multi-threaded</span> <span>machines</span> <span>when</span> <span>it</span> <span>is</span> <span>expected</span> <span>that</span> <span>the</span> <span>lock</span> <span>will</span> <span>be</span> <span>released</span> <span>after</span> <span>a</span> <span>short</span> <span>time</span>.</li>
</ul>
<h3><span>5</span>.<span>6</span> </h3>
<ul>
  <li><span>A</span> <span>more</span> <span>robust</span> <span>alternative</span> <span>to</span> <span>simple</span> <span>mutexes</span> <span>is</span> <span>to</span> <span>use</span> <span></span><em><span></span><strong><span>semaphores</span></strong><span></span></em><span>,</span> <span>which</span> <span>are</span> <span>integer</span> <span>variables</span> <span>for</span> <span>which</span> <span>only</span> <span>two</span> <span>(</span> <span>atomic</span> <span>)</span> <span>operations</span> <span>are</span> <span>defined,</span> <span>the</span> <span>wait</span> <span>and</span> <span>signal</span> <span>operations,</span> <span>as</span> <span>shown</span> <span>in</span> <span>the</span> <span>following</span> <span>figure</span>.<span></span> </li>
  <li><span>Note</span> <span>that</span> <span>not</span> <span>only</span> <span>must</span> <span>the</span> <span>variable-changing</span> <span>steps</span> <span>(</span> <span>S--</span> <span>and</span> <span>S++</span> <span>)</span> <span>be</span> <span>indivisible,</span> <span>it</span> <span>is</span> <span>also</span> <span>necessary</span> <span>that</span> <span>for</span> <span>the</span> <span>wait</span> <span>operation</span> <span>when</span> <span>the</span> <span>test</span> <span>proves</span> <span>false</span> <span>that</span> <span>there</span> <span>be</span> <span>no</span> <span>interruptions</span> <span>before</span> <span>S</span> <span>gets</span> <span>decremented</span>.<span></span> <span>It</span> <span>IS</span> <span>okay,</span> <span>however,</span> <span>for</span> <span>the</span> <span>busy</span> <span>loop</span> <span>to</span> <span>be</span> <span>interrupted</span> <span>when</span> <span>the</span> <span>test</span> <span>is</span> <span>true,</span> <span>which</span> <span>prevents</span> <span>the</span> <span>system</span> <span>from</span> <span>hanging</span> <span>forever</span>.</li>
</ul>
<p align="center"><span></span><img src="./3_ Process Synchronization_files/5_Semaphores.jpg" width="258" height="316"></p>
<blockquote>
  <h4><span>5</span>.<span>6</span>.<span>1</span> <span>Semaphore</span> </h4>
  <ul>
    <li><span>In</span> <span>practice,</span> <span>semaphores</span> <span>can</span> <span>take</span> <span>on</span> <span>one</span> <span>of</span> <span>two</span> <span>forms:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Binary</span> <span>semaphores</span></strong><span></span> <span>can</span> <span>take</span> <span>on</span> <span>one</span> <span>of</span> <span>two</span> <span>values,</span> <span>0</span> <span>or</span> <span>1</span>.<span></span> <span>They</span> <span>can</span> <span>be</span> <span>used</span> <span>to</span> <span>solve</span> <span>the</span> <span>critical</span> <span>section</span> <span>problem</span> <span>as</span> <span>described</span> <span>above,</span> <span>and</span> <span>can</span> <span>be</span> <span>used</span> <span>as</span> <span>mutexes</span> <span>on</span> <span>systems</span> <span>that</span> <span>do</span> <span>not</span> <span>provide</span> <span>a</span> <span>separate</span> <span>mutex</span> <span>mechanism</span>.<span></span>.<span></span> <span>The</span> <span>use</span> <span>of</span> <span>mutexes</span> <span>for</span> <span>this</span> <span>purpose</span> <span>is</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>6</span>.<span>9</span> <span>(</span> <span>from</span> <span>the</span> <span>8th</span> <span>edition</span> <span>)</span> <span>below</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p align="center"><span></span><img src="./3_ Process Synchronization_files/6_09_Semaphores.jpg" width="581" height="265"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><strong><span>Mutual-exclusion</span> <span>implementation</span> <span>with</span> <span>semaphores</span>.<span></span> <span>(</span> <span>From</span> <span>8th</span> <span>edition</span>.<span></span> <span>)</span></strong><span></span></p><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><strong><span>Counting</span> <span>semaphores</span></strong><span></span> <span>can</span> <span>take</span> <span>on</span> <span>any</span> <span>integer</span> <span>value,</span> <span>and</span> <span>are</span> <span>usually</span> <span>used</span> <span>to</span> <span>count</span> <span>the</span> <span>number</span> <span>remaining</span> <span>of</span> <span>some</span> <span>limited</span> <span>resource</span>.<span></span> <span>The</span> <span>counter</span> <span>is</span> <span>initialized</span> <span>to</span> <span>the</span> <span>number</span> <span>of</span> <span>such</span> <span>resources</span> <span>available</span> <span>in</span> <span>the</span> <span>system,</span> <span>and</span> <span>whenever</span> <span>the</span> <span>counting</span> <span>semaphore</span> <span>is</span> <span>greater</span> <span>than</span> <span>zero,</span> <span>then</span> <span>a</span> <span>process</span> <span>can</span> <span>enter</span> <span>a</span> <span>critical</span> <span>section</span> <span>and</span> <span>use</span> <span>one</span> <span>of</span> <span>the</span> <span>resources</span>.<span></span> <span>When</span> <span>the</span> <span>counter</span> <span>gets</span> <span>to</span> <span>zero</span> <span>(</span> <span>or</span> <span>negative</span> <span>in</span> <span>some</span> <span>implementations</span> <span>),</span> <span>then</span> <span>the</span> <span>process</span> <span>blocks</span> <span>until</span> <span>another</span> <span>process</span> <span>frees</span> <span>up</span> <span>a</span> <span>resource</span> <span>and</span> <span>increments</span> <span>the</span> <span>counting</span> <span>semaphore</span> <span>with</span> <span>a</span> <span>signal</span> <span>call</span>.<span></span> <span>(</span> <span>The</span> <span>binary</span> <span>semaphore</span> <span>can</span> <span>be</span> <span>seen</span> <span>as</span> <span>just</span> <span>a</span> <span>special</span> <span>case</span> <span>where</span> <span>the</span> <span>number</span> <span>of</span> <span>resources</span> <span>initially</span> <span>available</span> <span>is</span> <span>just</span> <span>one</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Semaphores</span> <span>can</span> <span>also</span> <span>be</span> <span>used</span> <span>to</span> <span>synchronize</span> <span>certain</span> <span>operations</span> <span>between</span> <span>processes</span>.<span></span> <span>For</span> <span>example,</span> <span>suppose</span> <span>it</span> <span>is</span> <span>important</span> <span>that</span> <span>process</span> <span>P1</span> <span>execute</span> <span>statement</span> <span>S1</span> <span>before</span> <span>process</span> <span>P2</span> <span>executes</span> <span>statement</span> <span>S2</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>First</span> <span>we</span> <span>create</span> <span>a</span> <span>semaphore</span> <span>named</span> <span>synch</span> <span>that</span> <span>is</span> <span>shared</span> <span>by</span> <span>the</span> <span>two</span> <span>processes,</span> <span>and</span> <span>initialize</span> <span>it</span> <span>to</span> <span>zero</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Then</span> <span>in</span> <span></span> <span>process</span> <span>P1</span> <span>we</span> <span>insert</span> <span>the</span> <span>code:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="courierFont"><span>S1;</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>signal(</span> <span>synch</span> <span>);</span></p><span>
</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>and</span> <span>in</span> <span>process</span> <span>P2</span> <span>we</span> <span>insert</span> <span>the</span> <span>code:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><p class="courierFont"><span>wait(</span> <span>synch</span> <span>);</span><br><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span>S2;</span></p><span>
</span></blockquote><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Because</span> <span>synch</span> <span>was</span> <span>initialized</span> <span>to</span> <span>0,</span> <span>process</span> <span>P2</span> <span>will</span> <span>block</span> <span>on</span> <span>the</span> <span>wait</span> <span>until</span> <span>after</span> <span>P1</span> <span>executes</span> <span>the</span> <span>call</span> <span>to</span> <span>signal</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <h4><span>5</span>.<span>6</span>.<span>2</span> <span>Semaphore</span> </h4>
  <ul>
    <li><span>The</span> <span>big</span> <span>problem</span> <span>with</span> <span>semaphores</span> <span>as</span> <span>described</span> <span>above</span> <span>is</span> <span>the</span> <span>busy</span> <span>loop</span> <span>in</span> <span>the</span> <span>wait</span> <span>call,</span> <span>which</span> <span>consumes</span> <span>CPU</span> <span>cycles</span> <span>without</span> <span>doing</span> <span>any</span> <span>useful</span> <span>work</span>.<span></span> <span>This</span> <span>type</span> <span>of</span> <span>lock</span> <span>is</span> <span>known</span> <span>as</span> <span>a</span> <span></span><em><span></span><strong><span>spinlock</span></strong><span></span></em><span>,</span> <span>because</span> <span>the</span> <span>lock</span> <span>just</span> <span>sits</span> <span>there</span> <span>and</span> <span>spins</span> <span>while</span> <span>it</span> <span>waits</span>.<span></span> <span>While</span> <span>this</span> <span>is</span> <span>generally</span> <span>a</span> <span>bad</span> <span>thing,</span> <span>it</span> <span>does</span> <span>have</span> <span>the</span> <span>advantage</span> <span>of</span> <span>not</span> <span>invoking</span> <span>context</span> <span>switches,</span> <span>and</span> <span>so</span> <span>it</span> <span>is</span> <span>sometimes</span> <span>used</span> <span>in</span> <span>multi-processing</span> <span>systems</span> <span>when</span> <span>the</span> <span>wait</span> <span>time</span> <span>is</span> <span>expected</span> <span>to</span> <span>be</span> <span>short</span> <span>-</span> <span>One</span> <span>thread</span> <span>spins</span> <span>on</span> <span>one</span> <span>processor</span> <span>while</span> <span>another</span> <span>completes</span> <span>their</span> <span>critical</span> <span>section</span> <span>on</span> <span>another</span> <span>processor</span>.</li>
    <li><span>An</span> <span>alternative</span> <span>approach</span> <span>is</span> <span>to</span> <span>block</span> <span>a</span> <span>process</span> <span>when</span> <span>it</span> <span>is</span> <span>forced</span> <span>to</span> <span>wait</span> <span>for</span> <span>an</span> <span>available</span> <span>semaphore,</span> <span>and</span> <span>swap</span> <span>it</span> <span>out</span> <span>of</span> <span>the</span> <span>CPU</span>.<span></span> <span>In</span> <span>this</span> <span>implementation</span> <span>each</span> <span>semaphore</span> <span>needs</span> <span>to</span> <span>maintain</span> <span>a</span> <span>list</span> <span>of</span> <span>processes</span> <span>that</span> <span>are</span> <span>blocked</span> <span>waiting</span> <span>for</span> <span>it,</span> <span>so</span> <span>that</span> <span>one</span> <span>of</span> <span>the</span> <span>processes</span> <span>can</span> <span>be</span> <span>woken</span> <span>up</span> <span>and</span> <span>swapped</span> <span>back</span> <span>in</span> <span>when</span> <span>the</span> <span>semaphore</span> <span>becomes</span> <span>available</span>.<span></span> <span>(</span> <span>Whether</span> <span>it</span> <span>gets</span> <span>swapped</span> <span>back</span> <span>into</span> <span>the</span> <span>CPU</span> <span>immediately</span> <span>or</span> <span>whether</span> <span>it</span> <span>needs</span> <span>to</span> <span>hang</span> <span>out</span> <span>in</span> <span>the</span> <span>ready</span> <span>queue</span> <span>for</span> <span>a</span> <span>while</span> <span>is</span> <span>a</span> <span>scheduling</span> <span>problem</span>.<span></span> <span>)</span> </li>
    <li><span>The</span> <span>new</span> <span>definition</span> <span>of</span> <span>a</span> <span>semaphore</span> <span>and</span> <span>the</span> <span>corresponding</span> <span>wait</span> <span>and</span> <span>signal</span> <span>operations</span> <span>are</span> <span>shown</span> <span>as</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_Semaphore2.jpg" width="570" height="648"><span></span> </p>
  </blockquote>
  <ul>
    <li><span>Note</span> <span>that</span> <span>in</span> <span>this</span> <span>implementation</span> <span>the</span> <span>value</span> <span>of</span> <span>the</span> <span>semaphore</span> <span>can</span> <span>actually</span> <span>become</span> <span>negative,</span> <span>in</span> <span>which</span> <span>case</span> <span>its</span> <span>magnitude</span> <span>is</span> <span>the</span> <span>number</span> <span>of</span> <span>processes</span> <span>waiting</span> <span>for</span> <span>that</span> <span>semaphore</span>.<span></span> <span>This</span> <span>is</span> <span>a</span> <span>result</span> <span>of</span> <span>decrementing</span> <span>the</span> <span>counter</span> <span>before</span> <span>checking</span> <span>its</span> <span>value</span>.</li>
    <li><span>Key</span> <span>to</span> <span>the</span> <span>success</span> <span>of</span> <span>semaphores</span> <span>is</span> <span>that</span> <span>the</span> <span>wait</span> <span>and</span> <span>signal</span> <span>operations</span> <span>be</span> <span>atomic,</span> <span>that</span> <span>is</span> <span>no</span> <span>other</span> <span>process</span> <span>can</span> <span>execute</span> <span>a</span> <span>wait</span> <span>or</span> <span>signal</span> <span>on</span> <span>the</span> <span>same</span> <span>semaphore</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.<span></span> <span>(</span> <span>Other</span> <span>processes</span> <span>could</span> <span>be</span> <span>allowed</span> <span>to</span> <span>do</span> <span>other</span> <span>things,</span> <span>including</span> <span>working</span> <span>with</span> <span>other</span> <span>semaphores,</span> <span>they</span> <span>just</span> <span>can't</span> <span>have</span> <span>access</span> <span>to</span> <span></span><strong><span>this</span> <span></span></strong><span></span> <span>semaphore</span>.<span></span> <span>)</span> <span>On</span> <span>single</span> <span>processors</span> <span>this</span> <span>can</span> <span>be</span> <span>implemented</span> <span>by</span> <span>disabling</span> <span>interrupts</span> <span>during</span> <span>the</span> <span>execution</span> <span>of</span> <span>wait</span> <span>and</span> <span>signal;</span> <span>Multiprocessor</span> <span>systems</span> <span>have</span> <span>to</span> <span>use</span> <span>more</span> <span>complex</span> <span>methods,</span> <span>including</span> <span>the</span> <span>use</span> <span>of</span> <span>spinlocking</span>.<span></span> </li>
  </ul>
  <h4><span>5</span>.<span>6</span>.<span>3</span> <span>Deadlocks</span> <span>and</span> </h4>
  <ul>
    <li><span>One</span> <span>important</span> <span>problem</span> <span>that</span> <span>can</span> <span>arise</span> <span>when</span> <span>using</span> <span>semaphores</span> <span>to</span> <span>block</span> <span>processes</span> <span>waiting</span> <span>for</span> <span>a</span> <span>limited</span> <span>resource</span> <span>is</span> <span>the</span> <span>problem</span> <span>of</span> <span></span><em><span></span><strong><span>deadlocks</span></strong><span></span></em><span>,</span> <span>which</span> <span>occur</span> <span>when</span> <span>multiple</span> <span>processes</span> <span>are</span> <span>blocked,</span> <span>each</span> <span>waiting</span> <span>for</span> <span>a</span> <span>resource</span> <span>that</span> <span>can</span> <span>only</span> <span>be</span> <span>freed</span> <span>by</span> <span>one</span> <span>of</span> <span>the</span> <span>other</span> <span>(</span> <span>blocked</span> <span>)</span> <span>processes,</span> <span>as</span> <span>illustrated</span> <span>in</span> <span>the</span> <span>following</span> <span>example</span>.<span></span> <span>(</span> <span>Deadlocks</span> <span>are</span> <span>covered</span> <span>more</span> <span>completely</span> <span>in</span> <span>chapter</span> <span>7</span>.<span></span> <span>)</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_Deadlocks.jpg" width="325" height="261"></p>
  </blockquote>
  <ul>
    <li><span>Another</span> <span>problem</span> <span>to</span> <span>consider</span> <span>is</span> <span>that</span> <span>of</span> <span></span><em><span></span><strong><span>starvation</span></strong><span></span></em><span>,</span> <span>in</span> <span>which</span> <span>one</span> <span>or</span> <span>more</span> <span>processes</span> <span>gets</span> <span>blocked</span> <span>forever,</span> <span>and</span> <span>never</span> <span>get</span> <span>a</span> <span>chance</span> <span>to</span> <span>take</span> <span>their</span> <span>turn</span> <span>in</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span> <span>For</span> <span>example,</span> <span>in</span> <span>the</span> <span>semaphores</span> <span>above,</span> <span>we</span> <span>did</span> <span>not</span> <span>specify</span> <span>the</span> <span>algorithms</span> <span>for</span> <span>adding</span> <span>processes</span> <span>to</span> <span>the</span> <span>waiting</span> <span>queue</span> <span></span> <span>in</span> <span>the</span> <span>semaphore</span> <span>in</span> <span>the</span> <span>wait(&nbsp;)</span> <span>call,</span> <span>or</span> <span>selecting</span> <span>one</span> <span>to</span> <span>be</span> <span>removed</span> <span>from</span> <span>the</span> <span>queue</span> <span>in</span> <span>the</span> <span>signal(</span> <span>)</span> <span>call</span>.<span></span> <span>If</span> <span>the</span> <span>method</span> <span>chosen</span> <span>is</span> <span>a</span> <span>FIFO</span> <span>queue,</span> <span>then</span> <span>every</span> <span>process</span> <span>will</span> <span>eventually</span> <span>get</span> <span>their</span> <span>turn,</span> <span>but</span> <span>if</span> <span>a</span> <span>LIFO</span> <span>queue</span> <span>is</span> <span>implemented</span> <span>instead,</span> <span>then</span> <span>the</span> <span>first</span> <span>process</span> <span>to</span> <span>start</span> <span>waiting</span> <span>could</span> <span>starve</span>.</li>
  </ul>
  <h4><span>5</span>.<span>6</span>.<span>4</span> <span>Priority</span> </h4>
  <ul>
    <li><span>A</span> <span>challenging</span> <span>scheduling</span> <span>problem</span> <span>arises</span> <span>when</span> <span>a</span> <span>high-priority</span> <span>process</span> <span>gets</span> <span>blocked</span> <span>waiting</span> <span>for</span> <span>a</span> <span>resource</span> <span>that</span> <span>is</span> <span>currently</span> <span>held</span> <span>by</span> <span>a</span> <span>low-priority</span> <span>process</span>.</li>
    <li><span>If</span> <span>the</span> <span>low-priority</span> <span>process</span> <span>gets</span> <span>pre-empted</span> <span>by</span> <span>one</span> <span>or</span> <span>more</span> <span>medium-priority</span> <span>processes,</span> <span>then</span> <span>the</span> <span>high-priority</span> <span>process</span> <span>is</span> <span>essentially</span> <span>made</span> <span>to</span> <span>wait</span> <span>for</span> <span>the</span> <span>medium</span> <span>priority</span> <span>processes</span> <span>to</span> <span>finish</span> <span>before</span> <span>the</span> <span>low-priority</span> <span>process</span> <span>can</span> <span>release</span> <span>the</span> <span>needed</span> <span>resource,</span> <span>causing</span> <span>a</span> <span></span><em><span></span><strong><span>priority</span> <span>inversion</span>.<span></span></strong><span></span></em><span></span> <span>If</span> <span>there</span> <span>are</span> <span>enough</span> <span>medium-priority</span> <span>processes,</span> <span>then</span> <span>the</span> <span>high-priority</span> <span>process</span> <span>may</span> <span>be</span> <span>forced</span> <span>to</span> <span>wait</span> <span>for</span> <span>a</span> <span>very</span> <span>long</span> <span>time</span>.</li>
    <li><span>One</span> <span>solution</span> <span>is</span> <span>a</span> <span></span><em><span></span><strong><span>priority-inheritance</span> <span>protocol,</span> <span></span></strong><span></span></em><span>in</span> <span>which</span> <span>a</span> <span>low-priority</span> <span>process</span> <span>holding</span> <span>a</span> <span>resource</span> <span>for</span> <span>which</span> <span>a</span> <span>high-priority</span> <span>process</span> <span>is</span> <span>waiting</span> <span>will</span> <span>temporarily</span> <span>inherit</span> <span>the</span> <span>high</span> <span>priority</span> <span>from</span> <span>the</span> <span>waiting</span> <span>process</span>.<span></span> <span>This</span> <span>prevents</span> <span>the</span> <span>medium-priority</span> <span>processes</span> <span>from</span> <span>preempting</span> <span>the</span> <span>low-priority</span> <span>process</span> <span>until</span> <span>it</span> <span>releases</span> <span>the</span> <span>resource,</span> <span>blocking</span> <span>the</span> <span>priority</span> <span>inversion</span> <span>problem</span>.</li>
    <li><span>The</span> <span>book</span> <span>has</span> <span>an</span> <span>interesting</span> <span>discussion</span> <span>of</span> <span>how</span> <span>a</span> <span>priority</span> <span>inversion</span> <span>almost</span> <span>doomed</span> <span>the</span> <span>Mars</span> <span>Pathfinder</span> <span>mission,</span> <span>and</span> <span>how</span> <span>the</span> <span>problem</span> <span>was</span> <span>solved</span> <span>when</span> <span>the</span> <span>priority</span> <span>inversion</span> <span>was</span> <span>stopped</span>.<span></span> <span>Full</span> <span>details</span> <span>are</span> <span>available</span> <span>online</span> <span>at</span> <span></span><a href="http://research.microsoft.com/en-us/um/people/mbj/mars_pathfinder/authoritative_account.html"><span>http://research</span>.<span>microsoft</span>.<span>com/en-us/um/people/mbj/mars_pathfinder/authoritative_account</span>.<span>htm</span></a></li></ul></blockquote>
<h3><span>5</span>.<span>7</span> <span>Classic</span> <span>Problems</span> <span>of</span> <span>Synchronization</span> </h3>
<blockquote>
  <p><span>The</span> <span>following</span> <span>classic</span> <span>problems</span> <span>are</span> <span>used</span> <span>to</span> <span>test</span> <span>virtually</span> <span>every</span> <span>new</span> <span>proposed</span> <span>synchronization</span> <span>algorithm</span>.<span></span> </p>
  <h4><span>5</span>.<span>7</span>.<span>1</span> <span>The</span> <span>Bounded-Buffer</span> </h4>
  <ul>
    <li><span>This</span> <span>is</span> <span>a</span> <span>generalization</span> <span>of</span> <span>the</span> <span>producer-consumer</span> <span>problem</span> <span>wherein</span> <span>access</span> <span>is</span> <span>controlled</span> <span>to</span> <span>a</span> <span>shared</span> <span>group</span> <span>of</span> <span>buffers</span> <span>of</span> <span>a</span> <span>limited</span> <span>size</span>.<span></span> </li>
    <li><span>In</span> <span>this</span> <span>solution,</span> <span>the</span> <span>two</span> <span>counting</span> <span>semaphores</span> <span>"full"</span> <span>and</span> <span>"empty"</span> <span></span> <span>keep</span> <span>track</span> <span>of</span> <span>the</span> <span>current</span> <span>number</span> <span>of</span> <span>full</span> <span>and</span> <span>empty</span> <span>buffers</span> <span>respectively</span> <span>(</span> <span>and</span> <span>initialized</span> <span>to</span> <span>0</span> <span>and</span> <span>N</span> <span>respectively</span>.<span></span> <span>)</span> <span>The</span> <span>binary</span> <span>semaphore</span> <span>mutex</span> <span>controls</span> <span>access</span> <span>to</span> <span>the</span> <span>critical</span> <span>section</span>.<span></span> <span>The</span> <span>producer</span> <span>and</span> <span>consumer</span> <span>processes</span> <span>are</span> <span>nearly</span> <span>identical</span> <span>-</span> <span>One</span> <span>can</span> <span>think</span> <span>of</span> <span>the</span> <span>producer</span> <span>as</span> <span>producing</span> <span>full</span> <span>buffers,</span> <span>and</span> <span>the</span> <span>consumer</span> <span>producing</span> <span>empty</span> <span>buffers</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_0910_ProducerConsumer.jpg" width="570" height="760"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figures</span> <span>5</span>.<span>9</span> <span>and</span> <span>5</span>.<span>10</span> <span>use</span> <span>variables</span> <span>next_produced</span> <span>and</span> <span>next_consumed</span></strong><span>
</span> <span></span> </p>
  <h4><span>5</span>.<span>7</span>.<span>2</span> <span>The</span> <span>Readers-Writers</span> </h4>
  <ul>
    <li><span>In</span> <span>the</span> <span>readers-writers</span> <span>problem</span> <span>there</span> <span>are</span> <span>some</span> <span>processes</span> <span>(</span> <span>termed</span> <span>readers</span> <span>)</span> <span>who</span> <span>only</span> <span>read</span> <span>the</span> <span>shared</span> <span>data,</span> <span>and</span> <span>never</span> <span>change</span> <span>it,</span> <span>and</span> <span>there</span> <span>are</span> <span>other</span> <span>processes</span> <span>(</span> <span>termed</span> <span>writers</span> <span>)</span> <span>who</span> <span>may</span> <span>change</span> <span>the</span> <span>data</span> <span>in</span> <span>addition</span> <span>to</span> <span>or</span> <span>instead</span> <span>of</span> <span>reading</span> <span>it</span>.<span></span> <span>There</span> <span>is</span> <span>no</span> <span>limit</span> <span>to</span> <span>how</span> <span>many</span> <span>readers</span> <span>can</span> <span>access</span> <span>the</span> <span>data</span> <span>simultaneously,</span> <span>but</span> <span>when</span> <span>a</span> <span>writer</span> <span>accesses</span> <span>the</span> <span>data,</span> <span>it</span> <span>needs</span> <span>exclusive</span> <span>access</span>.</li>
    <li><span>There</span> <span>are</span> <span>several</span> <span>variations</span> <span>to</span> <span>the</span> <span>readers-writers</span> <span>problem,</span> <span>most</span> <span>centered</span> <span>around</span> <span>relative</span> <span>priorities</span> <span>of</span> <span>readers</span> <span>versus</span> <span>writers</span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span></span><em><span>first</span></em><span></span> <span>readers-writers</span> <span>problem</span> <span>gives</span> <span>priority</span> <span>to</span> <span>readers</span>.<span></span> <span>In</span> <span>this</span> <span>problem,</span> <span>if</span> <span>a</span> <span>reader</span> <span>wants</span> <span>access</span> <span>to</span> <span>the</span> <span>data,</span> <span>and</span> <span>there</span> <span>is</span> <span>not</span> <span>already</span> <span>a</span> <span>writer</span> <span>accessing</span> <span>it,</span> <span>then</span> <span>access</span> <span>is</span> <span>granted</span> <span>to</span> <span>the</span> <span>reader</span>.<span></span> <span>A</span> <span>solution</span> <span>to</span> <span>this</span> <span>problem</span> <span>can</span> <span>lead</span> <span>to</span> <span>starvation</span> <span>of</span> <span>the</span> <span>writers,</span> <span>as</span> <span>there</span> <span>could</span> <span>always</span> <span>be</span> <span>more</span> <span>readers</span> <span>coming</span> <span>along</span> <span>to</span> <span>access</span> <span>the</span> <span>data</span>.<span></span> <span>(</span> <span>A</span> <span>steady</span> <span>stream</span> <span>of</span> <span>readers</span> <span>will</span> <span>jump</span> <span>ahead</span> <span>of</span> <span>waiting</span> <span>writers</span> <span>as</span> <span>long</span> <span>as</span> <span>there</span> <span>is</span> <span>currently</span> <span>already</span> <span>another</span> <span>reader</span> <span>accessing</span> <span>the</span> <span>data,</span> <span>because</span> <span>the</span> <span>writer</span> <span>is</span> <span>forced</span> <span>to</span> <span>wait</span> <span>until</span> <span>the</span> <span>data</span> <span>is</span> <span>idle,</span> <span>which</span> <span>may</span> <span>never</span> <span>happen</span> <span>if</span> <span>there</span> <span>are</span> <span>enough</span> <span>readers</span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span></span><em><span>second</span> <span></span></em><span>readers-writers</span> <span>problem</span> <span>gives</span> <span>priority</span> <span>to</span> <span>the</span> <span>writers</span>.<span></span> <span>In</span> <span>this</span> <span>problem,</span> <span>when</span> <span>a</span> <span>writer</span> <span>wants</span> <span>access</span> <span>to</span> <span>the</span> <span>data</span> <span>it</span> <span>jumps</span> <span>to</span> <span>the</span> <span>head</span> <span>of</span> <span>the</span> <span>queue</span> <span>-</span> <span>All</span> <span>waiting</span> <span>readers</span> <span>are</span> <span>blocked,</span> <span>and</span> <span>the</span> <span>writer</span> <span>gets</span> <span>access</span> <span>to</span> <span>the</span> <span>data</span> <span>as</span> <span>soon</span> <span>as</span> <span>it</span> <span>becomes</span> <span>available</span>.<span></span> <span>In</span> <span>this</span> <span>solution</span> <span>the</span> <span>readers</span> <span>may</span> <span>be</span> <span>starved</span> <span>by</span> <span>a</span> <span>steady</span> <span>stream</span> <span>of</span> <span>writers</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>The</span> <span>following</span> <span>code</span> <span>is</span> <span>an</span> <span>example</span> <span>of</span> <span>the</span> <span>first</span> <span>readers-writers</span> <span>problem,</span> <span>and</span> <span>involves</span> <span>an</span> <span>important</span> <span>counter</span> <span>and</span> <span>two</span> <span>binary</span> <span>semaphores:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><span class="courierFont"><span>readcount</span></span><span></span> <span>is</span> <span>used</span> <span>by</span> <span>the</span> <span>reader</span> <span>processes,</span> <span>to</span> <span>count</span> <span>the</span> <span>number</span> <span>of</span> <span>readers</span> <span>currently</span> <span>accessing</span> <span>the</span> <span>data</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><span class="courierFont"><span>mutex</span></span><span></span> <span>is</span> <span>a</span> <span>semaphore</span> <span>used</span> <span>only</span> <span>by</span> <span>the</span> <span>readers</span> <span>for</span> <span>controlled</span> <span>access</span> <span>to</span> <span></span><span class="courierFont"><span>readcount</span></span><span></span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><span class="courierFont"><span>rw_mutex</span></span><span></span> <span>is</span> <span>a</span> <span>semaphore</span> <span>used</span> <span>to</span> <span>block</span> <span>and</span> <span>release</span> <span>the</span> <span>writers</span>.<span></span> <span>The</span> <span>first</span> <span>reader</span> <span>to</span> <span>access</span> <span>the</span> <span>data</span> <span>will</span> <span>set</span> <span>this</span> <span>lock</span> <span>and</span> <span>the</span> <span>last</span> <span>reader</span> <span>to</span> <span>exit</span> <span>will</span> <span>release</span> <span>it;</span> <span>The</span> <span>remaining</span> <span>readers</span> <span>do</span> <span>not</span> <span>touch</span> <span></span><span class="courierFont"><span>rw_mutex</span></span><span></span>.<span></span> <span>(</span> <span>Eighth</span> <span>edition</span> <span>called</span> <span>this</span> <span>variable</span> <span></span><span class="courierFont"><span>wrt</span></span><span></span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Note</span> <span>that</span> <span>the</span> <span>first</span> <span>reader</span> <span>to</span> <span>come</span> <span>along</span> <span>will</span> <span>block</span> <span>on</span> <span></span><span class="courierFont"><span>rw_mutex</span></span><span></span> <span>if</span> <span>there</span> <span>is</span> <span>currently</span> <span>a</span> <span>writer</span> <span>accessing</span> <span>the</span> <span>data,</span> <span>and</span> <span>that</span> <span>all</span> <span>following</span> <span>readers</span> <span>will</span> <span>only</span> <span>block</span> <span>on</span> <span></span><span class="courierFont"><span>mutex</span></span><span></span> <span>for</span> <span>their</span> <span>turn</span> <span>to</span> <span>increment</span> <span></span><span class="courierFont"><span>readcount</span></span><span></span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_1112_ReaderWriterStructures.jpg" width="442" height="735"></p>
  <ul>
    <li><span></span> <span></span> <span></span> <span></span> <span>Some</span> <span>hardware</span> <span>implementations</span> <span>provide</span> <span>specific</span> <span>reader-writer</span> <span>locks,</span> <span>which</span> <span>are</span> <span>accessed</span> <span>using</span> <span>an</span> <span>argument</span> <span>specifying</span> <span>whether</span> <span>access</span> <span>is</span> <span>requested</span> <span>for</span> <span>reading</span> <span>or</span> <span>writing</span>.<span></span> <span>The</span> <span>use</span> <span>of</span> <span>reader-writer</span> <span>locks</span> <span>is</span> <span>beneficial</span> <span>for</span> <span>situation</span> <span>in</span> <span>which:</span> <span>(1)</span> <span>processes</span> <span>can</span> <span>be</span> <span>easily</span> <span>identified</span> <span>as</span> <span>either</span> <span>readers</span> <span>or</span> <span>writers,</span> <span>and</span> <span>(2)</span> <span>there</span> <span>are</span> <span>significantly</span> <span>more</span> <span>readers</span> <span>than</span> <span>writers,</span> <span>making</span> <span>the</span> <span>additional</span> <span>overhead</span> <span>of</span> <span>the</span> <span>reader-writer</span> <span>lock</span> <span>pay</span> <span>off</span> <span>in</span> <span>terms</span> <span>of</span> <span>increased</span> <span>concurrency</span> <span>of</span> <span>the</span> <span>readers</span>.<span></span> </li>
  </ul>
  <h4><span>5</span>.<span>7</span>.<span>3</span> <span>The</span> <span>Dining-Philosophers</span> </h4>
  <ul>
    <li><span>The</span> <span>dining</span> <span>philosophers</span> <span>problem</span> <span>is</span> <span>a</span> <span>classic</span> <span>synchronization</span> <span>problem</span> <span>involving</span> <span>the</span> <span>allocation</span> <span>of</span> <span>limited</span> <span>resources</span> <span>amongst</span> <span>a</span> <span>group</span> <span>of</span> <span>processes</span> <span>in</span> <span>a</span> <span>deadlock-free</span> <span>and</span> <span>starvation-free</span> <span>manner:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Consider</span> <span>five</span> <span>philosophers</span> <span>sitting</span> <span>around</span> <span>a</span> <span>table,</span> <span>in</span> <span>which</span> <span>there</span> <span>are</span> <span>five</span> <span>chopsticks</span> <span>evenly</span> <span>distributed</span> <span>and</span> <span>an</span> <span>endless</span> <span>bowl</span> <span>of</span> <span>rice</span> <span>in</span> <span>the</span> <span>center,</span> <span>as</span> <span>shown</span> <span>in</span> <span>the</span> <span>diagram</span> <span>below</span>.<span></span> <span>(</span> <span>There</span> <span>is</span> <span>exactly</span> <span>one</span> <span>chopstick</span> <span>between</span> <span>each</span> <span>pair</span> <span>of</span> <span>dining</span> <span>philosophers</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>These</span> <span>philosophers</span> <span>spend</span> <span>their</span> <span>lives</span> <span>alternating</span> <span>between</span> <span>two</span> <span>activities:</span> <span>eating</span> <span>and</span> <span>thinking</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>When</span> <span>it</span> <span>is</span> <span>time</span> <span>for</span> <span>a</span> <span>philosopher</span> <span>to</span> <span>eat,</span> <span>it</span> <span>must</span> <span>first</span> <span>acquire</span> <span>two</span> <span>chopsticks</span> <span>-</span> <span>one</span> <span>from</span> <span>their</span> <span>left</span> <span>and</span> <span>one</span> <span>from</span> <span>their</span> <span>right</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>When</span> <span>a</span> <span>philosopher</span> <span>thinks,</span> <span>it</span> <span>puts</span> <span>down</span> <span>both</span> <span>chopsticks</span> <span>in</span> <span>their</span> <span>original</span> <span>locations</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_13_DiningPhilosophers.jpg" width="305" height="293"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>13</span> <span>-</span> <span>The</span> <span>situation</span> <span>of</span> <span>the</span> <span>dining</span> <span>philosophers</span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>One</span> <span>possible</span> <span>solution,</span> <span>as</span> <span>shown</span> <span>in</span> <span>the</span> <span>following</span> <span>code</span> <span>section,</span> <span>is</span> <span>to</span> <span>use</span> <span>a</span> <span>set</span> <span>of</span> <span>five</span> <span>semaphores</span> <span>(</span> <span>chopsticks[</span> <span>5</span> <span>]</span> <span>),</span> <span>and</span> <span>to</span> <span>have</span> <span>each</span> <span>hungry</span> <span>philosopher</span> <span>first</span> <span>wait</span> <span>on</span> <span>their</span> <span>left</span> <span>chopstick</span> <span>(</span> <span>chopsticks[</span> <span>i</span> <span>]</span> <span>),</span> <span>and</span> <span>then</span> <span>wait</span> <span>on</span> <span>their</span> <span>right</span> <span>chopstick</span> <span>(</span> <span>chopsticks[</span> <span>(</span> <span>i</span> <span>+</span> <span>1</span> <span>)</span> <span>%</span> <span>5</span> <span>]</span> <span>)</span> </li>
    <li><span>But</span> <span></span> <span>suppose</span> <span>that</span> <span>all</span> <span>five</span> <span>philosophers</span> <span>get</span> <span>hungry</span> <span>at</span> <span>the</span> <span>same</span> <span>time,</span> <span>and</span> <span>each</span> <span>starts</span> <span>by</span> <span>picking</span> <span>up</span> <span>their</span> <span>left</span> <span>chopstick</span>.<span></span> <span>They</span> <span>then</span> <span>look</span> <span>for</span> <span>their</span> <span>right</span> <span>chopstick,</span> <span>but</span> <span>because</span> <span>it</span> <span>is</span> <span>unavailable,</span> <span>they</span> <span>wait</span> <span>for</span> <span>it,</span> <span>forever,</span> <span>and</span> <span>eventually</span> <span>all</span> <span>the</span> <span>philosophers</span> <span>starve</span> <span>due</span> <span>to</span> <span>the</span> <span>resulting</span> <span>deadlock</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_14_Philosopher_i.jpg" width="454" height="342"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>14</span> <span>-</span> <span>The</span> <span>structure</span> <span>of</span> <span>philosopher</span> <span>i</span>.<span></span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>Some</span> <span>potential</span> <span>solutions</span> <span>to</span> <span>the</span> <span>problem</span> <span>include:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Only</span> <span>allow</span> <span>four</span> <span>philosophers</span> <span>to</span> <span>dine</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.<span></span> <span>(</span> <span>Limited</span> <span>simultaneous</span> <span>processes</span>.<span></span> <span>)</span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Allow</span> <span>philosophers</span> <span>to</span> <span>pick</span> <span>up</span> <span>chopsticks</span> <span>only</span> <span>when</span> <span>both</span> <span>are</span> <span>available,</span> <span>in</span> <span>a</span> <span>critical</span> <span>section</span>.<span></span> <span></span> <span></span> <span>(</span> <span>All</span> <span>or</span> <span>nothing</span> <span>allocation</span> <span>of</span> <span>critical</span> <span>resources</span>.<span></span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Use</span> <span>an</span> <span>asymmetric</span> <span>solution,</span> <span>in</span> <span>which</span> <span>odd</span> <span>philosophers</span> <span>pick</span> <span>up</span> <span>their</span> <span>left</span> <span>chopstick</span> <span>first</span> <span>and</span> <span>even</span> <span>philosophers</span> <span>pick</span> <span>up</span> <span>their</span> <span>right</span> <span>chopstick</span> <span>first</span>.<span></span> <span>(</span> <span>Will</span> <span>this</span> <span>solution</span> <span>always</span> <span>work?</span> <span>What</span> <span>if</span> <span>there</span> <span>are</span> <span>an</span> <span>even</span> <span>number</span> <span>of</span> <span>philosophers?</span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Note</span> <span>carefully</span> <span>that</span> <span>a</span> <span>deadlock-free</span> <span>solution</span> <span>to</span> <span>the</span> <span>dining</span> <span>philosophers</span> <span>problem</span> <span>does</span> <span>not</span> <span>necessarily</span> <span>guarantee</span> <span>a</span> <span>starvation-free</span> <span>one</span>.<span></span> <span>(</span> <span>While</span> <span>some</span> <span>or</span> <span>even</span> <span>most</span> <span>of</span> <span>the</span> <span>philosophers</span> <span>may</span> <span>be</span> <span>able</span> <span>to</span> <span>get</span> <span>on</span> <span>with</span> <span>their</span> <span>normal</span> <span>lives</span> <span>of</span> <span>eating</span> <span>and</span> <span>thinking,</span> <span>there</span> <span>may</span> <span>be</span> <span>one</span> <span>unlucky</span> <span>soul</span> <span>who</span> <span>never</span> <span>seems</span> <span>to</span> <span>be</span> <span>able</span> <span>to</span> <span>get</span> <span>both</span> <span>chopsticks</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.<span></span> <span>:-(</span> </li></ul></blockquote>
<h3><span>5</span>.<span>8</span> <span>Monitors</span> </h3>
<ul>
  <li><span>Semaphores</span> <span>can</span> <span>be</span> <span>very</span> <span>useful</span> <span>for</span> <span>solving</span> <span>concurrency</span> <span>problems,</span> <span></span><em><span></span><strong><span>but</span> <span>only</span> <span>if</span> <span>programmers</span> <span>use</span> <span>them</span> <span>properly</span>.<span></span></strong><span></span></em><span></span> <span>If</span> <span>even</span> <span>one</span> <span>process</span> <span>fails</span> <span>to</span> <span>abide</span> <span>by</span> <span>the</span> <span>proper</span> <span>use</span> <span>of</span> <span>semaphores,</span> <span>either</span> <span>accidentally</span> <span>or</span> <span>deliberately,</span> <span>then</span> <span>the</span> <span>whole</span> <span>system</span> <span>breaks</span> <span>down</span>.<span></span> <span>(</span> <span>And</span> <span>since</span> <span>concurrency</span> <span>problems</span> <span>are</span> <span>by</span> <span>definition</span> <span>rare</span> <span>events,</span> <span>the</span> <span>problem</span> <span>code</span> <span>may</span> <span>easily</span> <span>go</span> <span>unnoticed</span> <span>and/or</span> <span>be</span> <span>heinous</span> <span>to</span> <span>debug</span>.<span></span> </li>
  <li><span>For</span> <span>this</span> <span>reason</span> <span>a</span> <span>higher-level</span> <span>language</span> <span>construct</span> <span>has</span> <span>been</span> <span>developed,</span> <span>called</span> <span></span><em><span></span><strong><span>monitors</span></strong><span></span></em><span></span>.<span></span> <span></span> </li>
</ul>
<blockquote>
  <h4><span>5</span>.<span>8</span>.<span>1</span> <span>Monitor</span> </h4>
  <ul>
    <li><span>A</span> <span>monitor</span> <span>is</span> <span>essentially</span> <span>a</span> <span>class,</span> <span>in</span> <span>which</span> <span>all</span> <span>data</span> <span>is</span> <span>private,</span> <span>and</span> <span>with</span> <span>the</span> <span>special</span> <span>restriction</span> <span>that</span> <span>only</span> <span>one</span> <span>method</span> <span>within</span> <span>any</span> <span>given</span> <span>monitor</span> <span>object</span> <span>may</span> <span>be</span> <span>active</span> <span>at</span> <span>the</span> <span>same</span> <span>time</span>.<span></span> <span>An</span> <span>additional</span> <span>restriction</span> <span>is</span> <span>that</span> <span>monitor</span> <span>methods</span> <span>may</span> <span>only</span> <span>access</span> <span>the</span> <span>shared</span> <span>data</span> <span>within</span> <span>the</span> <span>monitor</span> <span>and</span> <span>any</span> <span>data</span> <span>passed</span> <span>to</span> <span>them</span> <span>as</span> <span>parameters</span>.<span></span> <span>I</span>.<span>e</span>.<span></span> <span>they</span> <span>cannot</span> <span>access</span> <span>any</span> <span>data</span> <span>external</span> <span>to</span> <span>the</span> <span>monitor</span>.</li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_15_Monitor.jpg" width="496" height="605"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>15</span> <span>-</span> <span>Syntax</span> <span>of</span> <span>a</span> <span>monitor</span>.<span></span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>Figure</span> <span>5</span>.<span>16</span> <span>shows</span> <span>a</span> <span>schematic</span> <span>of</span> <span>a</span> <span>monitor,</span> <span>with</span> <span>an</span> <span>entry</span> <span>queue</span> <span>of</span> <span>processes</span> <span>waiting</span> <span>their</span> <span>turn</span> <span>to</span> <span>execute</span> <span>monitor</span> <span>operations</span> <span>(</span> <span>methods</span>.<span></span> <span>)</span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_16_MonitorSchematic.jpg" width="517" height="491"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>16</span> <span>-</span> <span>Schematic</span> <span>view</span> <span>of</span> <span>a</span> <span>monitor</span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>In</span> <span>order</span> <span>to</span> <span>fully</span> <span>realize</span> <span>the</span> <span>potential</span> <span>of</span> <span>monitors,</span> <span>we</span> <span>need</span> <span>to</span> <span>introduce</span> <span>one</span> <span>additional</span> <span>new</span> <span>data</span> <span>type,</span> <span>known</span> <span>as</span> <span>a</span> <span></span><em><span></span><strong><span>condition</span></strong><span></span></em><span></span>.<span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>variable</span> <span>of</span> <span>type</span> <span>condition</span> <span>has</span> <span>only</span> <span>two</span> <span>legal</span> <span>operations,</span> <span></span><em><span></span><strong><span>wait</span></strong><span></span></em><span></span> <span>and</span> <span></span><em><span></span><strong><span>signal</span></strong><span></span>.<span></span></em><span></span> <span>I</span>.<span>e</span>.<span></span> <span>if</span> <span>X</span> <span>was</span> <span>defined</span> <span>as</span> <span>type</span> <span>condition,</span> <span>then</span> <span>legal</span> <span>operations</span> <span>would</span> <span>be</span> <span>X</span>.<span>wait(</span> <span>)</span> <span>and</span> <span>X</span>.<span>signal(</span> <span>)</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>wait</span> <span>operation</span> <span>blocks</span> <span>a</span> <span>process</span> <span>until</span> <span>some</span> <span>other</span> <span>process</span> <span>calls</span> <span>signal,</span> <span>and</span> <span>adds</span> <span>the</span> <span>blocked</span> <span>process</span> <span>onto</span> <span>a</span> <span>list</span> <span>associated</span> <span>with</span> <span>that</span> <span>condition</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>signal</span> <span>process</span> <span>does</span> <span>nothing</span> <span>if</span> <span>there</span> <span>are</span> <span>no</span> <span>processes</span> <span>waiting</span> <span>on</span> <span>that</span> <span>condition</span>.<span></span> <span>Otherwise</span> <span>it</span> <span>wakes</span> <span>up</span> <span>exactly</span> <span>one</span> <span></span> <span>process</span> <span>from</span> <span>the</span> <span>condition's</span> <span>list</span> <span>of</span> <span>waiting</span> <span>processes</span>.<span></span> <span>(</span> <span>Contrast</span> <span>this</span> <span>with</span> <span>counting</span> <span>semaphores,</span> <span>which</span> <span>always</span> <span>affect</span> <span>the</span> <span>semaphore</span> <span>on</span> <span>a</span> <span>signal</span> <span>call</span>.<span></span> <span>)</span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Figure</span> <span>6</span>.<span>18</span> <span>below</span> <span>illustrates</span> <span>a</span> <span>monitor</span> <span>that</span> <span>includes</span> <span>condition</span> <span>variables</span> <span>within</span> <span>its</span> <span>data</span> <span>space</span>.<span></span> <span>Note</span> <span>that</span> <span>the</span> <span>condition</span> <span>variables,</span> <span>along</span> <span>with</span> <span>the</span> <span>list</span> <span>of</span> <span>processes</span> <span>currently</span> <span>waiting</span> <span>for</span> <span>the</span> <span>conditions,</span> <span>are</span> <span>in</span> <span>the</span> <span>data</span> <span>space</span> <span>of</span> <span>the</span> <span>monitor</span> <span>-</span> <span>The</span> <span>processes</span> <span>on</span> <span>these</span> <span>lists</span> <span>are</span> <span>not</span> <span>"in"</span> <span>the</span> <span>monitor,</span> <span>in</span> <span>the</span> <span>sense</span> <span>that</span> <span>they</span> <span>are</span> <span>not</span> <span>executing</span> <span>any</span> <span>code</span> <span>in</span> <span>the</span> <span>monitor</span>.<span></span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_17_MonitorConditions.jpg" width="711" height="491"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>17</span> <span>-</span> <span>Monitor</span> <span>with</span> <span>condition</span> <span>variables</span></strong><span></span> </p>
</blockquote>
  <ul>
    <li><span>But</span> <span>now</span> <span>there</span> <span>is</span> <span>a</span> <span>potential</span> <span>problem</span> <span>-</span> <span>If</span> <span>process</span> <span>P</span> <span>within</span> <span>the</span> <span>monitor</span> <span>issues</span> <span>a</span> <span>signal</span> <span>that</span> <span>would</span> <span>wake</span> <span>up</span> <span>process</span> <span>Q</span> <span>also</span> <span>within</span> <span>the</span> <span>monitor,</span> <span>then</span> <span>there</span> <span>would</span> <span>be</span> <span>two</span> <span>processes</span> <span>running</span> <span>simultaneously</span> <span>within</span> <span>the</span> <span>monitor,</span> <span>violating</span> <span>the</span> <span>exclusion</span> <span>requirement</span>.<span></span> <span>Accordingly</span> <span>there</span> <span>are</span> <span>two</span> <span>possible</span> <span>solutions</span> <span>to</span> <span>this</span> <span>dilemma:</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <blockquote>
    <blockquote>
      <p><span></span><strong><span>Signal</span> <span>and</span> <span>wait</span></strong><span></span> <span>-</span> <span>When</span> <span>process</span> <span>P</span> <span>issues</span> <span>the</span> <span>signal</span> <span>to</span> <span>wake</span> <span>up</span> <span>process</span> <span>Q,</span> <span>P</span> <span>then</span> <span>waits,</span> <span>either</span> <span>for</span> <span>Q</span> <span>to</span> <span>leave</span> <span>the</span> <span>monitor</span> <span>or</span> <span>on</span> <span>some</span> <span>other</span> <span>condition</span>.</p>
      <p><span></span><strong><span>Signal</span> <span>and</span> <span>continue</span></strong><span></span> <span>-</span> <span>When</span> <span>P</span> <span>issues</span> <span>the</span> <span>signal,</span> <span>Q</span> <span>waits,</span> <span>either</span> <span>for</span> <span>P</span> <span>to</span> <span>exit</span> <span>the</span> <span>monitor</span> <span>or</span> <span>for</span> <span>some</span> <span>other</span> <span>condition</span>.</p>
      <p><span>There</span> <span>are</span> <span>arguments</span> <span>for</span> <span>and</span> <span>against</span> <span>either</span> <span>choice</span>.<span></span> <span>Concurrent</span> <span>Pascal</span> <span>offers</span> <span>a</span> <span>third</span> <span>alternative</span> <span>-</span> <span>The</span> <span>signal</span> <span>call</span> <span>causes</span> <span>the</span> <span>signaling</span> <span>process</span> <span>to</span> <span>immediately</span> <span>exit</span> <span>the</span> <span>monitor,</span> <span>so</span> <span>that</span> <span>the</span> <span>waiting</span> <span>process</span> <span>can</span> <span>then</span> <span>wake</span> <span>up</span> <span>and</span> <span>proceed</span>.<span></span> <span></span> </p>
    </blockquote>
  </blockquote>
  <ul>
    <li><span>Java</span> <span>and</span> <span>C#</span> <span>(</span> <span>C</span> <span>sharp</span> <span>)</span> <span>offer</span> <span>monitors</span> <span>bulit-in</span> <span>to</span> <span>the</span> <span>language</span>.<span></span> <span>Erlang</span> <span>offers</span> <span>similar</span> <span>but</span> <span>different</span> <span>constructs</span>.</li>
  </ul>
  <h4><span>5</span>.<span>8</span>.<span>2</span> <span>Dining-Philosophers</span> <span>Solution</span> <span>Using</span> </h4>
  <ul>
    <li><span>This</span> <span>solution</span> <span>to</span> <span>the</span> <span>dining</span> <span>philosophers</span> <span>uses</span> <span>monitors,</span> <span>and</span> <span>the</span> <span>restriction</span> <span>that</span> <span>a</span> <span>philosopher</span> <span>may</span> <span>only</span> <span>pick</span> <span>up</span> <span>chopsticks</span> <span>when</span> <span>both</span> <span>are</span> <span>available</span>.<span></span> <span>There</span> <span>are</span> <span>also</span> <span>two</span> <span>key</span> <span>data</span> <span>structures</span> <span>in</span> <span>use</span> <span>in</span> <span>this</span> <span>solution:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><span class="style3"><span>enum</span> <span>{</span> <span>THINKING,</span> <span>HUNGRY,EATING</span> <span>}</span> <span>state[</span> <span>5</span> <span>];</span></span><span></span> <span>A</span> <span>philosopher</span> <span>may</span> <span>only</span> <span>set</span> <span>their</span> <span>state</span> <span>to</span> <span>eating</span> <span>when</span> <span>neither</span> <span>of</span> <span>their</span> <span>adjacent</span> <span>neighbors</span> <span>is</span> <span>eating</span>.<span></span> <span>(&nbsp;state[&nbsp;(&nbsp;i&nbsp;+&nbsp;1&nbsp;)&nbsp;%&nbsp;5&nbsp;]</span> <span>!=</span> <span>EATING</span> <span>&amp;&amp;</span> <span></span> <span>state[&nbsp;(&nbsp;i&nbsp;+&nbsp;4&nbsp;)&nbsp;%&nbsp;5&nbsp;]</span> <span>!=</span> <span>EATING&nbsp;)</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span></span><span class="style3"><span>condition</span> <span>self[</span> <span>5</span> <span>];</span> <span></span></span><span>This</span> <span>condition</span> <span>is</span> <span>used</span> <span>to</span> <span>delay</span> <span>a</span> <span>hungry</span> <span>philosopher</span> <span>who</span> <span>is</span> <span>unable</span> <span>to</span> <span>acquire</span> <span>chopsticks</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>In</span> <span>the</span> <span>following</span> <span>solution</span> <span>philosophers</span> <span>share</span> <span>a</span> <span>monitor,</span> <span>DiningPhilosophers,</span> <span>and</span> <span>eat</span> <span>using</span> <span>the</span> <span>following</span> <span>sequence</span> <span>of</span> <span>operations:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ol><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>DiningPhilosophers</span>.<span>pickup(</span> <span>)</span> <span>-</span> <span>Acquires</span> <span>chopsticks,</span> <span>which</span> <span>may</span> <span>block</span> <span>the</span> <span>process</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>eat</span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>DiningPhilosophers</span>.<span>putdown(</span> <span>)</span> <span>-</span> <span>Releases</span> <span>the</span> <span>chopsticks</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ol><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_18_MonitorDiningPhilosophers.jpg" width="618" height="880"></p>
  <h4><span>5</span>.<span>8</span>.<span>3</span> <span>Implementing</span> <span>a</span> <span>Monitor</span> <span>Using</span> </h4>
  <ul>
    <li><span>One</span> <span>possible</span> <span>implementation</span> <span>of</span> <span>a</span> <span>monitor</span> <span>uses</span> <span>a</span> <span>semaphore</span> <span>"mutex"</span> <span>to</span> <span>control</span> <span>mutual</span> <span>exclusionary</span> <span>access</span> <span>to</span> <span>the</span> <span>monitor,</span> <span>and</span> <span>a</span> <span>counting</span> <span>semaphore</span> <span>"next"</span> <span>on</span> <span>which</span> <span>processes</span> <span>can</span> <span>suspend</span> <span>themselves</span> <span>after</span> <span>they</span> <span>are</span> <span>already</span> <span>"inside"</span> <span>the</span> <span>monitor</span> <span>(</span> <span>in</span> <span>conjunction</span> <span>with</span> <span>condition</span> <span>variables,</span> <span>see</span> <span>below</span>.<span></span> <span>)</span> <span>The</span> <span>integer</span> <span>next_count</span> <span>keeps</span> <span>track</span> <span>of</span> <span>how</span> <span>many</span> <span>processes</span> <span>are</span> <span>waiting</span> <span>in</span> <span>the</span> <span>next</span> <span>queue</span>.<span></span> <span>Externally</span> <span>accessible</span> <span>monitor</span> <span>processes</span> <span>are</span> <span>then</span> <span>implemented</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_MonitorUsage.jpg" width="269" height="229"><span></span> </p>
  </blockquote>
  <ul>
    <li><span>Condition</span> <span>variables</span> <span>can</span> <span>be</span> <span>implemented</span> <span>using</span> <span>semaphores</span> <span>as</span> <span>well</span>.<span></span> <span>For</span> <span>a</span> <span>condition</span> <span>x,</span> <span>a</span> <span>semaphore</span> <span>"x_sem"</span> <span>and</span> <span>an</span> <span>integer</span> <span>"x_count"</span> <span>are</span> <span>introduced,</span> <span>both</span> <span>initialized</span> <span>to</span> <span>zero</span>.<span></span> <span>The</span> <span>wait</span> <span>and</span> <span>signal</span> <span>methods</span> <span>are</span> <span>then</span> <span>implemented</span> <span>as</span> <span>follows</span>.<span></span> <span>(</span> <span>This</span> <span>approach</span> <span>to</span> <span>the</span> <span>condition</span> <span>implements</span> <span>the</span> <span>signal-and-wait</span> <span>option</span> <span>described</span> <span>above</span> <span>for</span> <span>ensuring</span> <span>that</span> <span>only</span> <span>one</span> <span>process</span> <span>at</span> <span>a</span> <span>time</span> <span>is</span> <span>active</span> <span>inside</span> <span>the</span> <span>monitor</span>.<span></span> <span>)</span> </li>
  </ul>
  <blockquote>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_ConditionWaitSignal.jpg" width="296" height="461"><span></span> </p>
  </blockquote>
  <h4><span>5</span>.<span>8</span>.<span>4</span> <span>Resuming</span> <span>Processes</span> <span>Within</span> <span>a</span> </h4>
  <ul>
    <li><span>When</span> <span>there</span> <span>are</span> <span>multiple</span> <span>processes</span> <span>waiting</span> <span>on</span> <span>the</span> <span>same</span> <span>condition</span> <span>within</span> <span>a</span> <span>monitor,</span> <span>how</span> <span>does</span> <span>one</span> <span>decide</span> <span>which</span> <span>one</span> <span>to</span> <span>wake</span> <span>up</span> <span>in</span> <span>response</span> <span>to</span> <span>a</span> <span>signal</span> <span>on</span> <span>that</span> <span>condition?</span> <span>One</span> <span>obvious</span> <span>approach</span> <span>is</span> <span>FCFS,</span> <span>and</span> <span>this</span> <span>may</span> <span>be</span> <span>suitable</span> <span>in</span> <span>many</span> <span>cases</span>.</li>
    <li><span>Another</span> <span>alternative</span> <span>is</span> <span>to</span> <span>assign</span> <span>(</span> <span>integer</span> <span>)</span> <span>priorities,</span> <span>and</span> <span>to</span> <span>wake</span> <span>up</span> <span>the</span> <span>process</span> <span>with</span> <span>the</span> <span>smallest</span> <span>(</span> <span>best</span> <span>)</span> <span>priority</span>.</li>
    <li><span>Figure</span> <span>5</span>.<span>19</span> <span>illustrates</span> <span>the</span> <span>use</span> <span>of</span> <span>such</span> <span>a</span> <span>condition</span> <span>within</span> <span>a</span> <span>monitor</span> <span>used</span> <span>for</span> <span>resource</span> <span>allocation</span>.<span></span> <span>Processes</span> <span>wishing</span> <span>to</span> <span>access</span> <span>this</span> <span>resource</span> <span>must</span> <span>specify</span> <span>the</span> <span>time</span> <span>they</span> <span>expect</span> <span>to</span> <span>use</span> <span>it</span> <span>using</span> <span>the</span> <span>acquire(</span> <span>time</span> <span>)</span> <span>method,</span> <span>and</span> <span>must</span> <span>call</span> <span>the</span> <span>release(</span> <span>)</span> <span>method</span> <span>when</span> <span>they</span> <span>are</span> <span>done</span> <span>with</span> <span>the</span> <span>resource</span>.<span></span> </li>
  </ul>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_19_MonitorResource.jpg" width="496" height="546"><span></span><br><span>
</span> <span></span> <span></span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>19</span> <span>-</span> <span>A</span> <span>monitor</span> <span>to</span> <span>allocate</span> <span>a</span> <span>single</span> <span>resource</span>.<span></span></strong><span>
</span> <span></span> </p>
  <ul>
    <li><span>Unfortunately</span> <span>the</span> <span>use</span> <span>of</span> <span>monitors</span> <span>to</span> <span>restrict</span> <span>access</span> <span>to</span> <span>resources</span> <span>still</span> <span>only</span> <span>works</span> <span>if</span> <span>programmers</span> <span>make</span> <span>the</span> <span>requisite</span> <span>acquire</span> <span>and</span> <span>release</span> <span>calls</span> <span>properly</span>.<span></span> <span>One</span> <span>option</span> <span>would</span> <span>be</span> <span>to</span> <span>place</span> <span>the</span> <span>resource</span> <span>allocation</span> <span>code</span> <span>into</span> <span>the</span> <span>monitor,</span> <span>thereby</span> <span>eliminating</span> <span>the</span> <span>option</span> <span>for</span> <span>programmers</span> <span>to</span> <span>bypass</span> <span>or</span> <span>ignore</span> <span>the</span> <span>monitor,</span> <span>but</span> <span>then</span> <span>that</span> <span>would</span> <span>substitute</span> <span>the</span> <span>monitor's</span> <span>scheduling</span> <span>algorithms</span> <span>for</span> <span>whatever</span> <span>other</span> <span>scheduling</span> <span>algorithms</span> <span>may</span> <span>have</span> <span>been</span> <span>chosen</span> <span>for</span> <span>that</span> <span>particular</span> <span>resource</span>.<span></span> <span>Chapter</span> <span>14</span> <span>on</span> <span>Protection</span> <span>presents</span> <span>more</span> <span>advanced</span> <span>methods</span> <span>for</span> <span>enforcing</span> <span>"nice"</span> <span>cooperation</span> <span>among</span> <span>processes</span> <span>contending</span> <span>for</span> <span>shared</span> <span>resources</span>.</li>
    <li><span>Concurrent</span> <span>Pascal,</span> <span>Mesa,</span> <span>C#,</span> <span>and</span> <span>Java</span> <span>all</span> <span>implement</span> <span>monitors</span> <span>as</span> <span>described</span> <span>here</span>.<span></span> <span>Erlang</span> <span>provides</span> <span>concurrency</span> <span>support</span> <span>using</span> <span>a</span> <span>similar</span> <span>mechanism</span>.<span></span> </li>
  </ul>
</blockquote>
<h3><span>5</span>.<span>9</span> <span>Synchronization</span> <span>Examples</span> <span>(</span> <span>Optional</span> </h3>
<blockquote>
  <blockquote>
    <p><span>This</span> <span>section</span> <span>looks</span> <span>at</span> <span>how</span> <span>synchronization</span> <span>is</span> <span>handled</span> <span>in</span> <span>a</span> <span>number</span> <span>of</span> <span>different</span> <span>systems</span>.<span></span> </p>
  </blockquote>
<h4><span>5</span>.<span>9</span>.<span>1</span> <span>Synchronization</span> <span>in</span> <span>Windows</span> </h4>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/5_20_MutexDispatcher.jpg" width="456" height="145"><span></span><br><span>
</span> <span></span> <span></span><strong><span>Figure</span> <span>5</span>.<span>20</span> <span>-</span> <span>Mutex</span> <span>dispatcher</span> <span>object</span></strong></p>
  <h4><span>5</span>.<span>9</span>.<span>2</span> <span>Synchronization</span> <span>in</span> </h4>
  <p align="center"><span></span><img src="./3_ Process Synchronization_files/in-5_1.jpg" width="491" height="111"></p>
  <h4><span>5</span>.<span>9</span>.<span>3</span> <span>Synchronization</span> <span>in</span> <span>Solaris</span> </h4>
<ul>
  <li><span>Solaris</span> <span>controls</span> <span>access</span> <span>to</span> <span>critical</span> <span>sections</span> <span>using</span> <span>five</span> <span>tools:</span> <span>semaphores,</span> <span>condition</span> <span>variables,</span> <span>adaptive</span> <span>mutexes,</span> <span>reader-writer</span> <span>locks,</span> <span>and</span> <span>turnstiles</span>.<span></span> <span>The</span> <span>first</span> <span>two</span> <span>are</span> <span>as</span> <span>described</span> <span>above,</span> <span>and</span> <span>the</span> <span>other</span> <span>three</span> <span>are</span> <span>described</span> </li>
</ul>
<blockquote>
  <h4><span>Adaptive</span> </h4>
</blockquote>
<ul>
  <li><span>Adaptive</span> <span>mutexes</span> <span>are</span> <span>basically</span> <span>binary</span> <span>semaphores</span> <span>that</span> <span>are</span> <span>implemented</span> <span>differently</span> <span>depending</span> <span>upon</span> <span>the</span> <span>conditions:
</span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>On</span> <span>a</span> <span>single</span> <span>processor</span> <span>system,</span> <span>the</span> <span>semaphore</span> <span>sleeps</span> <span>when</span> <span>it</span> <span>is</span> <span>blocked,</span> <span>until</span> <span>the</span> <span>block</span> <span>is</span> <span>released</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>On</span> <span>a</span> <span>multi-processor</span> <span>system,</span> <span>if</span> <span>the</span> <span>thread</span> <span>that</span> <span>is</span> <span>blocking</span> <span>the</span> <span>semaphore</span> <span>is</span> <span>running</span> <span>on</span> <span>the</span> <span>same</span> <span>processor</span> <span>as</span> <span>the</span> <span>thread</span> <span>that</span> <span>is</span> <span>blocked,</span> <span>or</span> <span>if</span> <span>the</span> <span>blocking</span> <span>thread</span> <span>is</span> <span>not</span> <span>running</span> <span>at</span> <span>all,</span> <span>then</span> <span>the</span> <span>blocked</span> <span>thread</span> <span>sleeps</span> <span>just</span> <span>like</span> <span>a</span> <span>single</span> <span>processor</span> <span>system</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>However</span> <span>if</span> <span>the</span> <span>blocking</span> <span>thread</span> <span>is</span> <span>currently</span> <span>running</span> <span>on</span> <span>a</span> <span>different</span> <span>processor</span> <span>than</span> <span>the</span> <span>blocked</span> <span>thread,</span> <span>then</span> <span>the</span> <span>blocked</span> <span>thread</span> <span>does</span> <span>a</span> <span>spinlock,</span> <span>under</span> <span>the</span> <span>assumption</span> <span>that</span> <span>the</span> <span>block</span> <span>will</span> <span>soon</span> <span>be</span> <span>released</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Adaptive</span> <span>mutexes</span> <span>are</span> <span>only</span> <span>used</span> <span>for</span> <span>protecting</span> <span>short</span> <span>critical</span> <span>sections,</span> <span>where</span> <span>the</span> <span>benefit</span> <span>of</span> <span>not</span> <span>doing</span> <span>context</span> <span>switching</span> <span>is</span> <span>worth</span> <span>a</span> <span>short</span> <span>bit</span> <span>of</span> <span>spinlocking</span>.<span></span> <span>Otherwise</span> <span>traditional</span> <span>semaphores</span> <span>and</span> <span>condition</span> <span>variables</span> <span>are</span> <span>used</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> </li>
</ul>
<blockquote>
  <h4><span>Reader-Writer</span> </h4>
</blockquote>
<ul>
  <li><span>Reader-writer</span> <span>locks</span> <span>are</span> <span>used</span> <span>only</span> <span>for</span> <span>protecting</span> <span>longer</span> <span>sections</span> <span>of</span> <span>code</span> <span>which</span> <span>are</span> <span>accessed</span> <span>frequently</span> <span>but</span> <span>which</span> <span>are</span> <span>changed</span> <span>infrequently</span>.<span></span> </li>
</ul>
<blockquote>
  <h4></h4>
</blockquote>
<ul>
  <li><span>A</span> <span></span><em><span></span><strong><span>turnstile</span></strong><span></span></em><span></span> <span>is</span> <span>a</span> <span>queue</span> <span>of</span> <span>threads</span> <span>waiting</span> <span>on</span> <span>a</span> <span>lock</span>.<span></span> </li>
  <li><span>Each</span> <span>synchronized</span> <span>object</span> <span></span> <span>which</span> <span>has</span> <span>threads</span> <span>blocked</span> <span>waiting</span> <span>for</span> <span>access</span> <span>to</span> <span>it</span> <span>needs</span> <span>a</span> <span>separate</span> <span>turnstile</span>.<span></span> <span>For</span> <span>efficiency,</span> <span>however,</span> <span>the</span> <span>turnstile</span> <span>is</span> <span>associated</span> <span>with</span> <span>the</span> <span>thread</span> <span>currently</span> <span>holding</span> <span>the</span> <span>object,</span> <span>rather</span> <span>than</span> <span>the</span> <span>object</span> <span>itself</span>.</li>
  <li><span>In</span> <span>order</span> <span>to</span> <span>prevent</span> <span></span><em><span></span><strong><span>priority</span> <span>inversion,</span> <span></span></strong><span></span></em><span>the</span> <span>thread</span> <span>holding</span> <span>a</span> <span>lock</span> <span>for</span> <span>an</span> <span>object</span> <span>will</span> <span>temporarily</span> <span>acquire</span> <span>the</span> <span>highest</span> <span>priority</span> <span>of</span> <span>any</span> <span>process</span> <span>in</span> <span>the</span> <span>turnstile</span> <span>waiting</span> <span>for</span> <span>the</span> <span>blocked</span> <span>object</span>.<span></span> <span>This</span> <span>is</span> <span>called</span> <span>a</span> <span></span><em><span></span><strong><span>priority-inheritance</span> <span>protocol</span>.<span></span></strong><span></span></em></li>
  <li><span>User</span> <span>threads</span> <span>are</span> <span>controlled</span> <span>the</span> <span>same</span> <span>as</span> <span>for</span> <span>kernel</span> <span>threads,</span> <span>except</span> <span>that</span> <span>the</span> <span>priority-inheritance</span> <span>protocol</span> <span>does</span> <span>not</span> <span>apply</span>.<span></span> </li>
</ul>
<h4><span>5</span>.<span>9</span> <span>4</span> <span></span> <span></span> <span>Pthreads</span> <span>Synchronization(</span> <span>was</span> <span>6</span>.<span>8</span>.<span>4</span> </h4>
</blockquote>
<h3><span>5</span>.<span>10</span> <span>Alternate</span> <span>Approaches</span> <span>(</span> <span>Optional</span> </h3>
<blockquote>
  <h4><span>5</span>.<span>10</span>.<span>1</span> <span>Transactional</span> </h4>
  <h4><span>5</span>.<span>10</span>.<span>2</span> </h4>
  <h4><span>5</span>.<span>10</span>.<span>3</span> <span>Functional</span> <span>Programming</span> </h4>
</blockquote>
<h3><span>5</span>.<span>11</span> <span>Summary</span> </h3>
<hr>
<h3><span>Old</span> <span>6</span>.<span>9</span> <span>Atomic</span> <span>Transactions</span> <span>(</span> <span>Optional,</span> <span>Not</span> <span>in</span> <span>Ninth</span> <span>Edition</span> </h3>
<ul>
  <li><span>Database</span> <span>operations</span> <span>frequently</span> <span>need</span> <span>to</span> <span>carry</span> <span>out</span> <span></span><em><span></span><strong><span>atomic</span> <span>transactions,</span></strong><span></span></em><span></span> <span>in</span> <span>which</span> <span>the</span> <span>entire</span> <span>transaction</span> <span>must</span> <span>either</span> <span>complete</span> <span>or</span> <span>not</span> <span>occur</span> <span>at</span> <span>all</span>.<span></span> <span>The</span> <span>classic</span> <span>example</span> <span>is</span> <span>a</span> <span>transfer</span> <span>of</span> <span>funds,</span> <span>which</span> <span>involves</span> <span>withdrawing</span> <span>funds</span> <span>from</span> <span>one</span> <span>account</span> <span>and</span> <span>depositing</span> <span>them</span> <span>into</span> <span>another</span> <span>-</span> <span>Either</span> <span>both</span> <span>halves</span> <span>of</span> <span>the</span> <span>transaction</span> <span>must</span> <span>complete,</span> <span>or</span> <span>neither</span> <span>must</span> <span>complete</span>.</li>
  <li><span>Operating</span> <span>Systems</span> <span>can</span> <span>be</span> <span>viewed</span> <span>as</span> <span>having</span> <span>many</span> <span>of</span> <span>the</span> <span>same</span> <span></span> <span>needs</span> <span>and</span> <span>problems</span> <span>as</span> <span>databases,</span> <span>in</span> <span>that</span> <span>an</span> <span>OS</span> <span>can</span> <span>be</span> <span>said</span> <span>to</span> <span>manage</span> <span>a</span> <span>small</span> <span>database</span> <span>of</span> <span>process-related</span> <span>information</span>.<span></span> <span>As</span> <span>such,</span> <span>OSes</span> <span>can</span> <span>benefit</span> <span>from</span> <span>emulating</span> <span>some</span> <span>of</span> <span>the</span> <span>techniques</span> <span>originally</span> <span>developed</span> <span>for</span> <span>databases</span>.<span></span> <span>Here</span> <span>we</span> <span>first</span> <span>look</span> <span>at</span> <span>some</span> <span>of</span> <span>those</span> <span>techniques,</span> <span>and</span> <span>then</span> <span>how</span> <span>they</span> <span>can</span> <span>be</span> <span>used</span> <span>to</span> <span>benefit</span> <span>OS</span> <span>development</span>.<span></span> </li>
</ul>
<blockquote>
  <h4><span>6</span>.<span>9</span>.<span>1</span> <span>System</span> </h4>
  <ul>
    <li><span>A</span> <span>transaction</span> <span>is</span> <span>a</span> <span>series</span> <span>of</span> <span>actions</span> <span>that</span> <span>must</span> <span>either</span> <span>complete</span> <span>in</span> <span>its</span> <span>entirety</span> <span>or</span> <span>must</span> <span>be</span> <span></span><em><span></span><strong><span>rolled-back</span></strong><span></span></em><span></span> <span>as</span> <span>if</span> <span>it</span> <span>had</span> <span>never</span> <span>commenced</span>.</li>
    <li><span>The</span> <span>system</span> <span>is</span> <span>considered</span> <span>to</span> <span>have</span> <span>three</span> <span>types</span> <span>of</span> <span>storage:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Volatile</span> <span>storage</span> <span>usually</span> <span>gets</span> <span>lost</span> <span>in</span> <span>a</span> <span>system</span> <span>crash</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Non-volatile</span> <span>storage</span> <span>usually</span> <span>survives</span> <span>system</span> <span>crashes,</span> <span>but</span> <span>may</span> <span>still</span> <span>get</span> <span>lost</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Stable</span> <span>storage</span> <span>"never"</span> <span>gets</span> <span>lost</span> <span>or</span> <span>damaged</span>.<span></span> <span>In</span> <span>practice</span> <span>this</span> <span>is</span> <span>implemented</span> <span>using</span> <span>multiple</span> <span>copies</span> <span>stored</span> <span>on</span> <span>different</span> <span>media</span> <span>with</span> <span>different</span> <span>failure</span> <span>modes</span>.<span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
  </ul>
  <h4><span>6</span>.<span>9</span>.<span>2</span> <span>Log-Based</span> </h4>
  <ul>
    <li><span></span><strong><span></span><em><span>Before</span></em><span></span></strong><span></span> <span>each</span> <span>step</span> <span>of</span> <span>a</span> <span>transaction</span> <span>is</span> <span>conducted,</span> <span>a</span> <span>entry</span> <span>is</span> <span>written</span> <span>to</span> <span>a</span> <span>log</span> <span>on</span> <span>stable</span> <span>storage:
</span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Each</span> <span>transaction</span> <span>has</span> <span>a</span> <span>unique</span> <span>serial</span> <span>number</span>.<span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>first</span> <span>entry</span> <span>is</span> <span>a</span> <span>"start"</span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Every</span> <span>data</span> <span>changing</span> <span>entry</span> <span>specifies</span> <span>the</span> <span>transaction</span> <span>number,</span> <span>the</span> <span>old</span> <span>value,</span> <span>and</span> <span>the</span> <span>new</span> <span>value</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>The</span> <span>final</span> <span>entry</span> <span>is</span> <span>a</span> <span>"commit"</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>All</span> <span>transactions</span> <span>are</span> <span>idempotent</span> <span>-</span> <span>The</span> <span>can</span> <span>be</span> <span>repeated</span> <span>any</span> <span>number</span> <span>of</span> <span>times</span> <span>and</span> <span>the</span> <span>effect</span> <span>is</span> <span>the</span> <span>same</span> <span>as</span> <span>doing</span> <span>them</span> <span>once</span>.<span></span> <span>Likewise</span> <span>they</span> <span>can</span> <span>be</span> <span>undone</span> <span>any</span> <span>number</span> <span>of</span> <span>times</span> <span>and</span> <span>the</span> <span>effect</span> <span>is</span> <span>the</span> <span>same</span> <span>as</span> <span>undoing</span> <span>them</span> <span>once</span>.<span></span> <span>(</span> <span>I</span>.<span>e</span>.<span></span> <span>"change</span> <span>x</span> <span>from</span> <span>5</span> <span>to</span> <span>6",</span> <span>rather</span> <span>than</span> <span>"add</span> <span>1</span> <span>to</span> <span>x"</span> <span>)</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>After</span> <span>a</span> <span>crash,</span> <span>any</span> <span>transaction</span> <span>which</span> <span>has</span> <span>"commit"</span> <span>recorded</span> <span>in</span> <span>the</span> <span>log</span> <span>can</span> <span>be</span> <span>redone</span> <span>from</span> <span>the</span> <span>log</span> <span>information</span>.<span></span> <span>Any</span> <span>which</span> <span>has</span> <span>"start"</span> <span>but</span> <span>not</span> <span>"commit"</span> <span>can</span> <span>be</span> <span>undone</span>.<span></span> </li>
  </ul>
  <h4><span>6</span>.<span>9</span>.<span>3</span> </h4>
  <ul>
    <li><span>In</span> <span>the</span> <span>event</span> <span>of</span> <span>a</span> <span>crash,</span> <span>all</span> <span>data</span> <span>can</span> <span>be</span> <span>recovered</span> <span>using</span> <span>the</span> <span>system</span> <span>described</span> <span>above,</span> <span>by</span> <span>going</span> <span>through</span> <span>the</span> <span>entire</span> <span>log</span> <span>and</span> <span>performing</span> <span>either</span> <span>redo</span> <span>or</span> <span>undo</span> <span>operations</span> <span>on</span> <span>all</span> <span>the</span> <span>transactions</span> <span>listed</span> <span>there</span>.</li>
    <li><span>Unfortunately</span> <span>this</span> <span>approach</span> <span>can</span> <span>be</span> <span>slow</span> <span>and</span> <span>wasteful,</span> <span>because</span> <span>many</span> <span>transactions</span> <span>are</span> <span>repeated</span> <span>that</span> <span>were</span> <span>not</span> <span>lost</span> <span>in</span> <span>the</span> <span>crash</span>.</li>
    <li><span>Alternatively,</span> <span>one</span> <span>can</span> <span>periodically</span> <span>establish</span> <span>a</span> <span></span><em><span></span><strong><span>checkpoint,</span> <span></span></strong><span></span></em><span>as</span> <span>follows:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Write</span> <span>all</span> <span>data</span> <span>that</span> <span>has</span> <span>been</span> <span>affected</span> <span>by</span> <span>recent</span> <span>transactions</span> <span>(</span> <span>since</span> <span>the</span> <span>last</span> <span>checkpoint</span> <span>)</span> <span>to</span> <span>stable</span> <span>storage</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Write</span> <span>a</span> <span>&lt;checkpoint&gt;</span> <span>entry</span> <span>to</span> <span>the</span> <span>log</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> </li>
    <li><span>Now</span> <span>for</span> <span>crash</span> <span>recovery</span> <span>one</span> <span>only</span> <span>needs</span> <span>to</span> <span>find</span> <span>transactions</span> <span>that</span> <span>did</span> <span>not</span> <span>commit</span> <span>prior</span> <span>to</span> <span>the</span> <span>most</span> <span>recent</span> <span>checkpoint</span>.<span></span> <span>Specifically</span> <span>one</span> <span>looks</span> <span>backwards</span> <span>from</span> <span>the</span> <span>end</span> <span>of</span> <span>the</span> <span>log</span> <span>for</span> <span>the</span> <span>last</span> <span>&lt;checkpoint&gt;</span> <span>record,</span> <span>and</span> <span>then</span> <span>looks</span> <span>backward</span> <span>from</span> <span>there</span> <span>for</span> <span>the</span> <span>most</span> <span>recent</span> <span>transaction</span> <span>that</span> <span>started</span> <span>before</span> <span>the</span> <span>checkpoint</span>.<span></span> <span>Only</span> <span>that</span> <span>transaction</span> <span>and</span> <span>the</span> <span>ones</span> <span>more</span> <span>recent</span> <span>need</span> <span>to</span> <span>be</span> <span>redone</span> <span>or</span> <span>undone</span>.</li>
  </ul>
  <h4><span>6</span>.<span>9</span>.<span>4</span> <span>Concurrent</span> <span>Atomic</span> </h4>
  <ul>
    <li><span>All</span> <span>of</span> <span>the</span> <span>previous</span> <span>discussion</span> <span>on</span> <span>log-based</span> <span>recovery</span> <span>assumed</span> <span>that</span> <span>only</span> <span>one</span> <span>transaction</span> <span>could</span> <span>be</span> <span>conducted</span> <span>at</span> <span>a</span> <span>time</span>.<span></span> <span>We</span> <span>now</span> <span>relax</span> <span>that</span> <span>restriction,</span> <span>and</span> <span>allow</span> <span>multiple</span> <span>transactions</span> <span>to</span> <span>occur</span> <span>concurrently,</span> <span>while</span> <span>still</span> <span>keeping</span> <span>each</span> <span>individual</span> <span>transaction</span> <span>atomic</span>.</li>
  </ul>
  <blockquote>
    <h4><span>6</span>.<span>9</span>.<span>4</span>.<span>1</span> </h4>
    <ul>
      <li><span>Figure</span> <span>6</span>.<span>22</span> <span>below</span> <span>shows</span> <span>a</span> <span></span><em><span></span><strong><span>schedule</span> <span></span></strong><span></span></em><span></span> <span>in</span> <span>which</span> <span>transaction</span> <span>0</span> <span>reads</span> <span>and</span> <span>writes</span> <span>data</span> <span>items</span> <span>A</span> <span>and</span> <span>B,</span> <span>followed</span> <span>by</span> <span>transaction</span> <span>1</span> <span>which</span> <span>also</span> <span>reads</span> <span>and</span> <span>writes</span> <span>A</span> <span>and</span> <span>B</span>.</li>
      <li><span>This</span> <span>is</span> <span>termed</span> <span>a</span><strong><span></span> <span></span><em><span>serial</span> <span>schedule</span></em><span></span></strong><span>,</span> <span>because</span> <span>the</span> <span>two</span> <span>transactions</span> <span>are</span> <span>conducted</span> <span>serially</span>.<span></span> <span>For</span> <span>any</span> <span>N</span> <span>transactions,</span> <span>there</span> <span>are</span> <span>N!</span> <span>possible</span> <span>serial</span> <span>schedules</span>.</li>
      <li><span>A</span> <span></span><em><span></span><strong><span>nonserial</span> <span>schedule</span></strong><span></span></em><span></span> <span>is</span> <span>one</span> <span>in</span> <span>which</span> <span>the</span> <span>steps</span> <span>of</span> <span>the</span> <span>transactions</span> <span>are</span> <span>not</span> <span>completely</span> <span>serial,</span> <span>i</span>.<span>e</span>.<span></span> <span>they</span> <span>interleave</span> <span>in</span> <span>some</span> <span>manner</span>.</li>
      <li><span>Nonserial</span> <span>schedules</span> <span>are</span> <span>not</span> <span>necessarily</span> <span>bad</span> <span>or</span> <span>wrong,</span> <span>so</span> <span>long</span> <span>as</span> <span>they</span> <span>can</span> <span>be</span> <span>shown</span> <span>to</span> <span>be</span> <span>equivalent</span> <span>to</span> <span>some</span> <span>serial</span> <span>schedule</span>.<span></span> <span>A</span> <span>nonserial</span> <span>schedule</span> <span>that</span> <span>can</span> <span>be</span> <span>converted</span> <span>to</span> <span>a</span> <span>serial</span> <span>one</span> <span>is</span> <span>said</span> <span>to</span> <span>be</span> <span></span><em><span></span><strong><span>conflict</span> <span>serializable,</span> <span></span></strong><span></span></em><span>such</span> <span>as</span> <span>that</span> <span>shown</span> <span>in</span> <span>Figure</span> <span>6</span>.<span>23</span> <span>below</span>.<span></span> <span>Legal</span> <span>steps</span> <span>in</span> <span>the</span> <span>conversion</span> <span>are</span> <span>as</span> <span>follows:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Two</span> <span>operations</span> <span>from</span> <span>different</span> <span>transactions</span> <span>are</span> <span>said</span> <span>to</span> <span>be</span> <span></span><em><span></span><strong><span>conflicting</span></strong><span></span></em><span></span> <span>if</span> <span>they</span> <span>involve</span> <span>the</span> <span>same</span> <span>data</span> <span>item</span> <span>and</span> <span>at</span> <span>least</span> <span>one</span> <span>of</span> <span>the</span> <span>operations</span> <span>is</span> <span>a</span> <span>write</span> <span>operations</span>.<span></span> <span>Operations</span> <span>from</span> <span>two</span> <span>transactions</span> <span>are</span> <span></span><em><span></span><strong><span>non-conflicting</span></strong><span></span></em><span></span> <span>if</span> <span>they</span> <span>either</span> <span>involve</span> <span>different</span> <span>data</span> <span>items</span> <span>or</span> <span>do</span> <span>not</span> <span>involve</span> <span>any</span> <span>write</span> <span>operations</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Two</span> <span>operations</span> <span>in</span> <span>a</span> <span>schedule</span> <span>can</span> <span>be</span> <span>swapped</span> <span>if</span> <span>they</span> <span>are</span> <span>from</span> <span>two</span> <span>different</span> <span>transactions</span> <span>and</span> <span>if</span> <span>they</span> <span>are</span> <span>non-conflicting</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span>schedules</span> <span>is</span> <span>conflict</span> <span>serializable</span> <span>if</span> <span>there</span> <span>exists</span> <span>a</span> <span>series</span> <span>of</span> <span>valid</span> <span>swap</span> <span>that</span> <span>converts</span> <span>the</span> <span>schedule</span> <span>into</span> <span>a</span> <span>serial</span> <span>schedule</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
    </ul>
    <p align="center"><span></span><img src="./3_ Process Synchronization_files/6_2224_Schedules.jpg" width="686" height="1050"></p>
  
    <h4><span>6</span>.<span>9</span>.<span>4</span>.<span>2</span> <span>Locking</span> </h4>
    <ul>
      <li><span>One</span> <span>way</span> <span>to</span> <span>ensure</span> <span>serializability</span> <span>is</span> <span>to</span> <span>use</span> <span>locks</span> <span>on</span> <span>data</span> <span>items</span> <span>during</span> <span>atomic</span> <span>transactions</span>.</li>
      <li><span>Shared</span> <span>and</span> <span>Exclusive</span> <span>locks</span> <span>correspond</span> <span>to</span> <span>the</span> <span>Readers</span> <span>and</span> <span>Writers</span> <span>problem</span> <span>discussed</span> <span>above</span>.</li>
      <li><span>The</span> <span></span><em><span></span><strong><span>two-phase</span> <span>locking</span> <span>protocol</span></strong><span></span></em><span></span> <span>operates</span> <span>in</span> <span>two</span> <span>phases:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span></span><em><span></span><strong><span>growing</span> <span>phase,</span> <span></span></strong><span></span></em><span>in</span> <span>which</span> <span>the</span> <span>transaction</span> <span>continues</span> <span>to</span> <span>gain</span> <span>additional</span> <span>locks</span> <span>on</span> <span>data</span> <span>items</span> <span>as</span> <span>it</span> <span>needs</span> <span>them,</span> <span>and</span> <span>has</span> <span>not</span> <span>yet</span> <span>relinquished</span> <span>any</span> <span>of</span> <span>its</span> <span>locks</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>A</span> <span></span><em><span></span><strong><span>shrinking</span> <span>phase,</span> <span></span></strong><span></span></em><span>in</span> <span>which</span> <span>it</span> <span>relinquishes</span> <span>locks</span>.<span></span> <span>Once</span> <span>a</span> <span>transaction</span> <span>releases</span> <span>any</span> <span>lock,</span> <span>then</span> <span>it</span> <span>is</span> <span>in</span> <span>the</span> <span>shrinking</span> <span>phase</span> <span>and</span> <span>cannot</span> <span>acquire</span> <span>any</span> <span>more</span> <span>locks</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
      <li><span>The</span> <span>two-phase</span> <span>locking</span> <span>protocol</span> <span>can</span> <span>be</span> <span>proven</span> <span>to</span> <span>yield</span> <span>serializable</span> <span>schedules,</span> <span>but</span> <span>it</span> <span>does</span> <span>not</span> <span>guarantee</span> <span>avoidance</span> <span>of</span> <span>deadlock</span>.<span></span> <span>There</span> <span>may</span> <span>also</span> <span>be</span> <span>perfectly</span> <span>valid</span> <span>serializable</span> <span>schedules</span> <span>that</span> <span>are</span> <span>unobtainable</span> <span>with</span> <span>this</span> <span>protocol</span>.</li>
    </ul>
    <h4><span>6</span>.<span>9</span>.<span>4</span>.<span>3</span> <span>Timestamp-Based</span> </h4>
    <ul>
      <li><span>Under</span> <span>the</span> <span>timestamp</span> <span>protocol,</span> <span>each</span> <span></span><em><span></span><strong><span>transaction</span></strong><span></span></em><span></span> <span>is</span> <span>issued</span> <span>a</span> <span>unique</span> <span>timestamp</span> <span>entry</span> <span>before</span> <span>it</span> <span>begins</span> <span>execution</span>.<span></span> <span>This</span> <span>can</span> <span>be</span> <span>the</span> <span>system</span> <span>time</span> <span>on</span> <span>systems</span> <span>where</span> <span>all</span> <span>process</span> <span>access</span> <span>the</span> <span>same</span> <span>clock,</span> <span>or</span> <span>some</span> <span>non-decreasing</span> <span>serial</span> <span>number</span>.<span></span> <span>The</span> <span>timestamp</span> <span>for</span> <span>transaction</span> <span>Ti</span> <span>is</span> <span>denoted</span> <span>TS(</span> <span>Ti</span> </li>
      <li><span>The</span> <span>schedules</span> <span>generated</span> <span>are</span> <span>all</span> <span>equivalent</span> <span>to</span> <span>a</span> <span>serial</span> <span>schedule</span> <span>occurring</span> <span>in</span> <span>timestamp</span> <span>order</span>.</li>
      <li><span>Each</span> <span></span><em><span></span><strong><span>data</span> <span>item</span></strong><span></span></em><span></span> <span>also</span> <span>has</span> <span>two</span> <span>timestamp</span> <span>values</span> <span>associated</span> <span>with</span> <span>it</span> <span>-</span> <span>The</span> <span>W-timestamp</span> <span>is</span> <span>the</span> <span>timestamp</span> <span>of</span> <span>the</span> <span>last</span> <span>transaction</span> <span>to</span> <span>successfully</span> <span>write</span> <span>the</span> <span>data</span> <span>item,</span> <span>and</span> <span>the</span> <span>R-timestamp</span> <span>is</span> <span>the</span> <span>stamp</span> <span>of</span> <span>the</span> <span>last</span> <span>transaction</span> <span>to</span> <span>successfully</span> <span>read</span> <span>from</span> <span>it</span>.<span></span> <span>(</span> <span>Note</span> <span>that</span> <span>these</span> <span>are</span> <span>the</span> <span>timestamps</span> <span>of</span> <span>the</span> <span>respective</span> <span>transactions,</span> <span>not</span> <span>the</span> <span>time</span> <span>at</span> <span>which</span> <span>the</span> <span>read</span> <span>or</span> <span>write</span> <span>occurred</span>.<span></span> </li>
      <li><span>The</span> <span>timestamps</span> <span>are</span> <span>used</span> <span>in</span> <span>the</span> <span>following</span> <span>manner:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Suppose</span> <span>transaction</span> <span>Ti</span> <span>issues</span> <span>a</span> <span>read</span> <span>on</span> <span>data</span> <span>item</span> <span>Q:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>TS(</span> <span>Ti</span> <span>)</span> <span>&lt;</span> <span>the</span> <span>W-timestamp</span> <span>for</span> <span>Q,</span> <span>then</span> <span>it</span> <span>is</span> <span>attempting</span> <span>to</span> <span>read</span> <span>data</span> <span>that</span> <span>has</span> <span>been</span> <span>changed</span>.<span></span> <span>Transaction</span> <span>Ti</span> <span>is</span> <span>rolled</span> <span>back,</span> <span>and</span> <span>restarted</span> <span>with</span> <span>a</span> <span>new</span> <span>timestamp</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>TS(</span> <span>Ti</span> <span>)</span> <span>&gt;</span> <span>the</span> <span>W-timestamp</span> <span>for</span> <span>Q,</span> <span>then</span> <span>the</span> <span>R-timestamp</span> <span>for</span> <span>Q</span> <span>is</span> <span>updated</span> <span>to</span> <span>the</span> <span>later</span> <span>of</span> <span>its</span> <span>current</span> <span>value</span> <span>and</span> <span>TS(</span> <span>Ti</span> <span>)</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Suppose</span> <span>Ti</span> <span>issues</span> <span>a</span> <span>write</span> <span>on</span> <span>Q:
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>TS(</span> <span>Ti</span> <span>)</span> <span>&lt;</span> <span>the</span> <span>R-timestamp</span> <span>for</span> <span>Q,</span> <span>then</span> <span>it</span> <span>is</span> <span>attempting</span> <span>to</span> <span>change</span> <span>data</span> <span>that</span> <span>has</span> <span>already</span> <span>been</span> <span>read</span> <span>in</span> <span>its</span> <span>unaltered</span> <span>state</span>.<span></span> <span>Ti</span> <span>is</span> <span>rolled</span> <span>back</span> <span>and</span> <span>restarted</span> <span>with</span> <span>a</span> <span>new</span> <span>timestamp</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>If</span> <span>TS(</span> <span>Ti</span> <span>)</span> <span>&lt;</span> <span>the</span> <span>W-timestamp</span> <span>for</span> <span>Q</span> <span>it</span> <span>is</span> <span>also</span> <span>rolled</span> <span>back</span> <span>and</span> <span>restarted,</span> <span>for</span> <span>similar</span> <span>reasons</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span><li><span>Otherwise,</span> <span>the</span> <span>operation</span> <span>proceeds,</span> <span>and</span> <span>the</span> <span>W-timestamp</span> <span>for</span> <span>Q</span> <span>is</span> <span>updated</span> <span>to</span> <span>TS(</span> <span>Ti</span> <span>)</span>.<span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></li><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span> <span></span></ul><span>
</span> <span></span> <span></span> <span></span> <span></span> <span></span> </li>
    </ul>
  </blockquote>
</blockquote>
<h4></h4>
<p><span>&nbsp;</span> <span></span> </p>


</body><script src="./3_ Process Synchronization_files/jquery.min.js.download"></script><script>function makeSpans(){$("h1, h2, h3, h4, h5, h6, p, li, td, img").each(function(){var s=splitText($(this).html());$(this).empty();for(var a="",h=0;h<s.length;h++)a+=s[h];$(this).html(a)})}function splitText(s){for(var a=[],h="",e=0;e<s.length;e++)if("<"===s.charAt(e)){a.push("<span>"+h+"</span>"),h="<";var i=1;do e++,"<"===s.charAt(e)&&i++,">"===s.charAt(e)&&i--,h+=s.charAt(e);while(i>0);console.log(h),a.push(h),h=""}else" "!=s.charAt(e)&&"."!=s.charAt(e)?h+=s.charAt(e):(console.log(h),a.push("<span>"+h+"</span>"),h="",a.push(""+s.charAt(e)));return a}$(document).ready(function(){makeSpans(),$("BODY").addClass("whiteBG"),$("span").on("click",function(){$(this).hasClass("hideWord")?($(this).removeClass("hideWord hoverOver"),$(this).addClass("hideWord2")):$(this).hasClass("hideWord2")?$(this).removeClass("hideWord2"):$(this).addClass("hideWord")}),$("span").hover(function(){$(this).hasClass("hideWord")&&$(this).addClass("hoverOver")},function(){$(this).removeClass("hoverOver")}),$("img").on("click",function(){$(this).hasClass("imageHide")?($(this).removeClass("imageHide"),$(this).addClass("imageReveal")):$(this).addClass("imageHide")}),$("img").hover(function(){$(this).hasClass("imageHide")&&$(this).addClass("imageReveal")},function(){$(this).removeClass("imageReveal")})});</script></html>